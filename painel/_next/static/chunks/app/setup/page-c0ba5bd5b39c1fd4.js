(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7413],{6834:function(e,t,n){Promise.resolve().then(n.bind(n,883))},6428:function(e,t,n){"use strict";n.d(t,{Fw:function(){return m},LP:function(){return r},SC:function(){return c},apiDelete:function(){return h},jn:function(){return f},o4:function(){return i},pE:function(){return p},sg:function(){return u},w9:function(){return g},zi:function(){return d}});let a="/api/mercado/partner",o="/api/mercado/parceiro",l="painel_partner_token";function r(){try{return localStorage.getItem(l)}catch(e){return null}}function i(e){try{e?localStorage.setItem(l,e):localStorage.removeItem(l)}catch(e){}}function s(){let e=r();return e?{Authorization:"Bearer ".concat(e)}:{}}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),o=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");o&&(n+="?".concat(o));let l=await fetch(n,{credentials:"include",headers:s()});if(!l.ok){let e=await l.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(l.status," ").concat(l.statusText))}let r=await l.json();if(!r.success)throw Error(r.message||"Erro desconhecido na API");return r.data}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...s()},body:JSON.stringify(t)}),o=await n.json().catch(()=>null);if(!n.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(n.status));return o.data}async function d(e,t){let n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:s(),body:t}),o=await n.json().catch(()=>null);if(!n.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(n.status));return o.data}async function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...s()},body:JSON.stringify(t)}),o=await n.json().catch(()=>null);if(!n.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(n.status));return o.data}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),o=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");o&&(n+="?".concat(o));let l=await fetch(n,{method:"DELETE",credentials:"include",headers:s()}),r=await l.json().catch(()=>null);if(!l.ok||!(null==r?void 0:r.success))throw Error((null==r?void 0:r.message)||"API error: ".concat(l.status));return r.data}async function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(o).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...s()},body:JSON.stringify(t)}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function f(e,t){let n=await fetch("".concat(o).concat(e),{method:"POST",credentials:"include",headers:s(),body:t}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return u(e,t)}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return i},a:function(){return s}});var a=n(7437),o=n(2265),l=n(6428);let r=(0,o.createContext)(null);function i(e){let{children:t}=e,[n,i]=(0,o.useState)(null),[s,c]=(0,o.useState)(!0),[u,d]=(0,o.useState)(null),p=(0,o.useCallback)(async()=>{if(!(0,l.LP)()){i(null),c(!1);return}try{let e=await (0,l.SC)("/auth/session.php");e.authenticated&&e.partner?i(e.partner):((0,l.o4)(null),i(null))}catch(e){console.warn("Session check failed (network error), keeping session:",e)}finally{c(!1)}},[]);(0,o.useEffect)(()=>{p()},[p]);let h=(0,o.useCallback)(async(e,t)=>{let n=await (0,l.sg)("/auth/login.php",{email:e,senha:t});if(n.requires_2fa)return d({partner_id:n.partner_id,nome:n.nome,temp_token:n.temp_token}),{requires_2fa:!0};(0,l.o4)(n.token);let a=n.partner||{id:n.partner_id,nome:n.nome,email:n.email,cnpj:n.cnpj,logo:n.logo,categoria:n.categoria,status:n.status};return i(a),d(null),a},[]),m=(0,o.useCallback)(async e=>{if(!u)throw Error("Nenhuma verificacao 2FA pendente");let t=await (0,l.sg)("/auth/totp-verify.php",{temp_token:u.temp_token,code:e});(0,l.o4)(t.token);let n=t.partner||{id:t.partner_id,nome:t.nome,email:t.email,cnpj:t.cnpj,logo:t.logo,categoria:t.categoria,status:t.status};return i(n),d(null),n},[u]),f=(0,o.useCallback)(()=>{d(null)},[]),g=(0,o.useCallback)(e=>{i(t=>t?{...t,...e}:t)},[]),y=(0,o.useCallback)(()=>{(0,l.o4)(null),i(null),d(null)},[]);return(0,a.jsx)(r.Provider,{value:{partner:n,loading:s,isAuthenticated:!!n,twoFactorPending:u,login:h,verifyTotp:m,cancelTotp:f,logout:y,updatePartner:g,refreshSession:p},children:t})}function s(){let e=(0,o.useContext)(r);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},883:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var a=n(7437),o=n(2265),l=n(9376),r=n(7128),i=n(6428);let s=[{key:"logo",label:"Logo e Banner",icon:"\uD83D\uDDBC"},{key:"hours",label:"Horarios",icon:"\uD83D\uDD50"},{key:"bank",label:"Dados Bancarios",icon:"\uD83C\uDFE6"},{key:"menu_done",label:"Primeiro Produto",icon:"\uD83D\uDCE6"}],c=[{key:"seg",label:"Segunda"},{key:"ter",label:"Terca"},{key:"qua",label:"Quarta"},{key:"qui",label:"Quinta"},{key:"sex",label:"Sexta"},{key:"sab",label:"Sabado"},{key:"dom",label:"Domingo"}],u=[{value:"cpf",label:"CPF"},{value:"cnpj",label:"CNPJ"},{value:"email",label:"Email"},{value:"telefone",label:"Telefone"},{value:"aleatoria",label:"Chave Aleatoria"}];function d(){var e;let{isAuthenticated:t,loading:n,refreshSession:d}=(0,r.a)(),h=(0,l.useRouter)(),[m,f]=(0,o.useState)(0),[g,y]=(0,o.useState)(null),[b,v]=(0,o.useState)(!0),[x,k]=(0,o.useState)(!1),[j,S]=(0,o.useState)(""),[C,w]=(0,o.useState)(""),[_,P]=(0,o.useState)(""),[E,I]=(0,o.useState)(()=>{let e={};return c.forEach(t=>{e[t.key]={open:"08:00",close:"22:00",closed:!1}}),e}),[N,T]=(0,o.useState)(""),[D,B]=(0,o.useState)(""),[A,z]=(0,o.useState)(""),[O,R]=(0,o.useState)("cpf"),[F,L]=(0,o.useState)("");async function W(){try{var e,t,n,a,o,l;let r=await (0,i.SC)("/setup-complete.php");if(y(r),r.first_setup_complete){h.push("/");return}if((null===(t=r.steps)||void 0===t?void 0:null===(e=t.logo)||void 0===e?void 0:e.data)&&(w(r.steps.logo.data.logo||""),P(r.steps.logo.data.banner||"")),null===(a=r.steps)||void 0===a?void 0:null===(n=a.hours)||void 0===n?void 0:n.data){let e=r.steps.hours.data;I(t=>{let n={...t};return Object.entries(e).forEach(e=>{let[t,a]=e;n[t]&&(n[t]={...n[t],...a})}),n})}(null===(l=r.steps)||void 0===l?void 0:null===(o=l.bank)||void 0===o?void 0:o.data)&&(T(r.steps.bank.data.bank_name||""),B(r.steps.bank.data.bank_agency||""),z(r.steps.bank.data.bank_account||""),R(r.steps.bank.data.pix_type||"cpf"),L(r.steps.bank.data.pix_key||""));let c=r.steps||{},u=s.findIndex(e=>{var t;return!(null===(t=c[e.key])||void 0===t?void 0:t.complete)});u>=0&&f(u)}catch(e){S(e.message)}finally{v(!1)}}async function G(e,t){S(""),k(!0);try{let n=await (0,i.sg)("/setup-complete.php",{step:e,data:t});await W(),n.first_setup_complete?(await d(),h.push("/")):m<s.length-1&&f(m+1)}catch(e){S(e.message||"Erro ao salvar")}finally{k(!1)}}async function U(e){var t;let n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(n){k(!0);try{let e=new FormData;e.append("image",n),e.append("type","logo");let t=await (0,i.zi)("/upload.php",e);w(t.url||t.path)}catch(e){S(e.message||"Erro no upload")}finally{k(!1)}}}async function J(e){var t;let n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(n){k(!0);try{let e=new FormData;e.append("image",n),e.append("type","banner");let t=await (0,i.zi)("/upload.php",e);P(t.url||t.path)}catch(e){S(e.message||"Erro no upload")}finally{k(!1)}}}if((0,o.useEffect)(()=>{if(!n&&!t){h.push("/login");return}t&&W()},[n,t]),n||b)return(0,a.jsx)("div",{className:"loading-screen",children:(0,a.jsx)("div",{className:"spinner"})});let q=s[m],V=(null==g?void 0:g.steps)||{};return(0,a.jsx)("div",{style:p.page,children:(0,a.jsxs)("div",{style:p.container,children:[(0,a.jsxs)("div",{style:{textAlign:"center",marginBottom:32},children:[(0,a.jsx)("h1",{style:{fontSize:24,fontWeight:700,color:"#1e293b"},children:"Configuracao Inicial"}),(0,a.jsx)("p",{style:{color:"#64748b",fontSize:14,marginTop:4},children:"Configure seu estabelecimento para comecar a vender"})]}),(0,a.jsx)("div",{style:p.progressBar,children:s.map((e,t)=>{var n;let o=null===(n=V[e.key])||void 0===n?void 0:n.complete,l=t===m;return(0,a.jsxs)("div",{onClick:()=>f(t),style:{...p.progressStep,cursor:"pointer",opacity:l?1:.7},children:[(0,a.jsx)("div",{style:{...p.progressDot,background:o?"#16a34a":l?"#2563eb":"#cbd5e1",color:o||l?"#fff":"#64748b"},children:o?"✓":t+1}),(0,a.jsx)("span",{style:{fontSize:12,fontWeight:l?600:400,color:l?"#1e293b":"#64748b"},children:e.label})]},e.key)})}),(0,a.jsxs)("div",{style:p.card,children:[(0,a.jsxs)("h2",{style:{fontSize:18,fontWeight:600,marginBottom:4},children:[q.icon," ",q.label]}),(0,a.jsxs)("p",{style:{color:"#64748b",fontSize:14,marginBottom:24},children:["logo"===q.key&&"Adicione o logo e banner do seu estabelecimento","hours"===q.key&&"Defina os horarios de funcionamento","bank"===q.key&&"Informe seus dados bancarios para receber pagamentos","menu_done"===q.key&&"Adicione pelo menos 1 produto ao seu cardapio"]}),j&&(0,a.jsx)("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",borderRadius:8,padding:"10px 14px",color:"#dc2626",fontSize:14,marginBottom:16},children:j}),"logo"===q.key&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:p.formGroup,children:[(0,a.jsx)("label",{style:p.label,children:"Logo *"}),C&&(0,a.jsx)("img",{src:C,alt:"Logo",style:{width:80,height:80,borderRadius:12,objectFit:"cover",marginBottom:8}}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:U,disabled:x}),(0,a.jsx)("input",{type:"text",className:"form-input",placeholder:"Ou cole a URL da imagem",value:C,onChange:e=>w(e.target.value),style:{marginTop:8}})]}),(0,a.jsxs)("div",{style:p.formGroup,children:[(0,a.jsx)("label",{style:p.label,children:"Banner (opcional)"}),_&&(0,a.jsx)("img",{src:_,alt:"Banner",style:{width:"100%",height:120,borderRadius:12,objectFit:"cover",marginBottom:8}}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:J,disabled:x}),(0,a.jsx)("input",{type:"text",className:"form-input",placeholder:"Ou cole a URL da imagem",value:_,onChange:e=>P(e.target.value),style:{marginTop:8}})]}),(0,a.jsx)("button",{className:"btn btn-primary btn-block",disabled:x||!C,onClick:()=>G("logo",{logo:C,banner:_}),children:x?"Salvando...":"Salvar e Continuar"})]}),"hours"===q.key&&(0,a.jsxs)("div",{children:[c.map(e=>{var t,n,o,l;return(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:12,flexWrap:"wrap"},children:[(0,a.jsx)("label",{style:{width:80,fontSize:14,fontWeight:500},children:e.label}),(0,a.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:4,fontSize:13},children:[(0,a.jsx)("input",{type:"checkbox",checked:(null===(t=E[e.key])||void 0===t?void 0:t.closed)||!1,onChange:t=>I(n=>({...n,[e.key]:{...n[e.key],closed:t.target.checked}}))}),"Fechado"]}),!(null===(n=E[e.key])||void 0===n?void 0:n.closed)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{type:"time",className:"form-input",value:(null===(o=E[e.key])||void 0===o?void 0:o.open)||"08:00",onChange:t=>I(n=>({...n,[e.key]:{...n[e.key],open:t.target.value}})),style:{width:130}}),(0,a.jsx)("span",{style:{color:"#64748b"},children:"ate"}),(0,a.jsx)("input",{type:"time",className:"form-input",value:(null===(l=E[e.key])||void 0===l?void 0:l.close)||"22:00",onChange:t=>I(n=>({...n,[e.key]:{...n[e.key],close:t.target.value}})),style:{width:130}})]})]},e.key)}),(0,a.jsx)("button",{className:"btn btn-primary btn-block",disabled:x,onClick:()=>{let e={};Object.entries(E).forEach(t=>{let[n,a]=t;a.closed||(e[n]={open:a.open,close:a.close})}),G("hours",{hours:e})},style:{marginTop:16},children:x?"Salvando...":"Salvar e Continuar"})]}),"bank"===q.key&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:p.formGroup,children:[(0,a.jsx)("label",{style:p.label,children:"Banco *"}),(0,a.jsx)("input",{className:"form-input",placeholder:"Ex: Nubank, Bradesco, Itau...",value:N,onChange:e=>T(e.target.value)})]}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[(0,a.jsxs)("div",{style:p.formGroup,children:[(0,a.jsx)("label",{style:p.label,children:"Agencia"}),(0,a.jsx)("input",{className:"form-input",placeholder:"0001",value:D,onChange:e=>B(e.target.value)})]}),(0,a.jsxs)("div",{style:p.formGroup,children:[(0,a.jsx)("label",{style:p.label,children:"Conta"}),(0,a.jsx)("input",{className:"form-input",placeholder:"12345-6",value:A,onChange:e=>z(e.target.value)})]})]}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:16},children:[(0,a.jsxs)("div",{style:p.formGroup,children:[(0,a.jsx)("label",{style:p.label,children:"Tipo PIX"}),(0,a.jsx)("select",{className:"form-input",value:O,onChange:e=>R(e.target.value),children:u.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsxs)("div",{style:p.formGroup,children:[(0,a.jsx)("label",{style:p.label,children:"Chave PIX"}),(0,a.jsx)("input",{className:"form-input",placeholder:"Sua chave PIX",value:F,onChange:e=>L(e.target.value)})]})]}),(0,a.jsx)("button",{className:"btn btn-primary btn-block",disabled:x||!N,onClick:()=>G("bank",{bank_name:N,bank_agency:D,bank_account:A,pix_type:O,pix_key:F}),style:{marginTop:8},children:x?"Salvando...":"Salvar e Continuar"})]}),"menu_done"===q.key&&(0,a.jsx)("div",{children:(null===(e=V.menu_done)||void 0===e?void 0:e.complete)?(0,a.jsxs)("div",{style:{textAlign:"center",padding:24},children:[(0,a.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"#16a34a",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),(0,a.jsx)("polyline",{points:"22 4 12 14.01 9 11.01"})]}),(0,a.jsxs)("p",{style:{marginTop:12,fontWeight:600,fontSize:16},children:["Voce ja tem ",V.menu_done.product_count," produto(s) cadastrado(s)!"]}),(0,a.jsx)("button",{className:"btn btn-primary btn-block",onClick:()=>G("menu_done",{}),style:{marginTop:16},disabled:x,children:x?"Finalizando...":"Concluir Configuracao"})]}):(0,a.jsxs)("div",{style:{textAlign:"center",padding:24},children:[(0,a.jsx)("p",{style:{color:"#64748b",marginBottom:16},children:"Voce precisa cadastrar pelo menos 1 produto antes de comecar a vender."}),(0,a.jsx)("button",{className:"btn btn-primary",onClick:()=>h.push("/produtos"),children:"Ir para Produtos"}),(0,a.jsx)("div",{style:{marginTop:16},children:(0,a.jsx)("button",{className:"btn btn-secondary",onClick:W,style:{fontSize:13},children:"Ja cadastrei, verificar novamente"})})]})}),m>0&&(0,a.jsx)("button",{onClick:()=>f(m-1),style:{marginTop:16,background:"none",border:"none",color:"#64748b",cursor:"pointer",fontSize:14},children:"← Voltar"})]})]})})}let p={page:{minHeight:"100vh",background:"linear-gradient(135deg, #eff6ff 0%, #f1f5f9 100%)",padding:"32px 16px"},container:{maxWidth:700,margin:"0 auto"},progressBar:{display:"flex",justifyContent:"space-between",marginBottom:32,gap:8},progressStep:{display:"flex",flexDirection:"column",alignItems:"center",gap:6,flex:1},progressDot:{width:32,height:32,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:600},card:{background:"#fff",borderRadius:16,boxShadow:"0 4px 12px rgba(0,0,0,0.08)",padding:32},formGroup:{marginBottom:16},label:{display:"block",fontSize:14,fontWeight:500,color:"#374151",marginBottom:6}}},9376:function(e,t,n){"use strict";var a=n(5475);n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}}),n.o(a,"useSearchParams")&&n.d(t,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=6834)}),_N_E=e.O()}]);