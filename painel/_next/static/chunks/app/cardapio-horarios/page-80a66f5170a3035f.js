(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[656],{9950:function(e,t,n){Promise.resolve().then(n.bind(n,6614))},6428:function(e,t,n){"use strict";n.d(t,{Fw:function(){return m},LP:function(){return s},SC:function(){return c},apiDelete:function(){return h},jn:function(){return f},o4:function(){return i},pE:function(){return p},sg:function(){return d},w9:function(){return g},zi:function(){return u}});let a="/api/mercado/partner",l="/api/mercado/parceiro",o="painel_partner_token";function s(){try{return localStorage.getItem(o)}catch(e){return null}}function i(e){try{e?localStorage.setItem(o,e):localStorage.removeItem(o)}catch(e){}}function r(){let e=s();return e?{Authorization:"Bearer ".concat(e)}:{}}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),l=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");l&&(n+="?".concat(l));let o=await fetch(n,{credentials:"include",headers:r()});if(!o.ok){let e=await o.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(o.status," ").concat(o.statusText))}let s=await o.json();if(!s.success)throw Error(s.message||"Erro desconhecido na API");return s.data}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...r()},body:JSON.stringify(t)}),l=await n.json().catch(()=>null);if(!n.ok||!(null==l?void 0:l.success))throw Error((null==l?void 0:l.message)||"API error: ".concat(n.status));return l.data}async function u(e,t){let n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:r(),body:t}),l=await n.json().catch(()=>null);if(!n.ok||!(null==l?void 0:l.success))throw Error((null==l?void 0:l.message)||"API error: ".concat(n.status));return l.data}async function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...r()},body:JSON.stringify(t)}),l=await n.json().catch(()=>null);if(!n.ok||!(null==l?void 0:l.success))throw Error((null==l?void 0:l.message)||"API error: ".concat(n.status));return l.data}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),l=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");l&&(n+="?".concat(l));let o=await fetch(n,{method:"DELETE",credentials:"include",headers:r()}),s=await o.json().catch(()=>null);if(!o.ok||!(null==s?void 0:s.success))throw Error((null==s?void 0:s.message)||"API error: ".concat(o.status));return s.data}async function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(l).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...r()},body:JSON.stringify(t)}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function f(e,t){let n=await fetch("".concat(l).concat(e),{method:"POST",credentials:"include",headers:r(),body:t}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d(e,t)}},6614:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var a=n(7437),l=n(2265),o=n(7128),s=n(6428);let i=[{value:"0",label:"Dom"},{value:"1",label:"Seg"},{value:"2",label:"Ter"},{value:"3",label:"Qua"},{value:"4",label:"Qui"},{value:"5",label:"Sex"},{value:"6",label:"Sab"}],r={time_based:"Horario (ex: cafe da manha)",day_based:"Dia da semana (ex: feijoada sabado)",seasonal:"Temporario (ex: menu de natal)"};function c(){let{partner:e}=(0,o.a)(),[t,n]=(0,l.useState)([]),[c,d]=(0,l.useState)([]),[u,p]=(0,l.useState)(!0),[h,m]=(0,l.useState)(""),[f,g]=(0,l.useState)(!1),[x,y]=(0,l.useState)(null),[v,b]=(0,l.useState)(!1),[j,S]=(0,l.useState)(null),[C,w]=(0,l.useState)(""),[k,_]=(0,l.useState)(!1),[N,E]=(0,l.useState)(""),[z,P]=(0,l.useState)("time_based"),[A,I]=(0,l.useState)("07:00"),[T,B]=(0,l.useState)("11:00"),[W,F]=(0,l.useState)(["1","2","3","4","5"]),[O,D]=(0,l.useState)(""),[R,L]=(0,l.useState)("");async function H(){try{let e=await (0,s.SC)("/menu-schedules.php");n(e.schedules||[]),d(e.products||[])}catch(e){m(e.message)}finally{p(!1)}}function M(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e){var t,n;y(e),E(e.name),P(e.schedule_type),I((null===(t=e.start_time)||void 0===t?void 0:t.slice(0,5))||"07:00"),B((null===(n=e.end_time)||void 0===n?void 0:n.slice(0,5))||"11:00"),F(e.days||[]),D(e.start_date||""),L(e.end_date||"")}else y(null),E(""),P("time_based"),I("07:00"),B("11:00"),F(["1","2","3","4","5"]),D(""),L("");g(!0)}async function U(){if(N.trim()){_(!0),m("");try{let e={action:x?"update":"create",name:N,schedule_type:z,start_time:A+":00",end_time:T+":00",days_of_week:W};x&&(e.id=x.id),"seasonal"===z&&(e.start_date=O||null,e.end_date=R||null),await (0,s.sg)("/menu-schedules.php",e),g(!1),await H()}catch(e){m(e.message)}finally{_(!1)}}}async function q(e){if(confirm("Excluir este agendamento?"))try{await (0,s.apiDelete)("/menu-schedules.php",{id:e}),await H()}catch(e){m(e.message)}}async function J(e){if(j&&0!==e.length){_(!0);try{await (0,s.sg)("/menu-schedules.php",{action:"add_products",schedule_id:j.id,product_ids:e}),await H();let t=(await (0,s.SC)("/menu-schedules.php")).schedules||[];S(t.find(e=>e.id===j.id)||null)}catch(e){m(e.message)}finally{_(!1)}}}async function Q(e,t){try{if(await (0,s.sg)("/menu-schedules.php",{action:"remove_product",schedule_id:e,product_id:t}),await H(),(null==j?void 0:j.id)===e){let t=(await (0,s.SC)("/menu-schedules.php")).schedules||[];S(t.find(t=>t.id===e)||null)}}catch(e){m(e.message)}}(0,l.useEffect)(()=>{H()},[]);let Y=e=>e?e.slice(0,5):"",G=e=>e&&0!==e.length?7===e.length?"Todos os dias":e.map(e=>{var t;return(null===(t=i.find(t=>t.value===e))||void 0===t?void 0:t.label)||e}).join(", "):"Nenhum dia";if(u)return(0,a.jsx)("div",{className:"loading-screen",children:(0,a.jsx)("div",{className:"spinner"})});let K=new Set(((null==j?void 0:j.products)||[]).map(e=>e.id)),V=c.filter(e=>{var t;return!K.has(e.id)&&(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(C.toLowerCase()))});return(0,a.jsxs)("div",{className:"page-container",children:[(0,a.jsxs)("div",{className:"page-header",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"page-title",children:"Cardapio por Horario"}),(0,a.jsx)("p",{className:"page-subtitle",children:"Defina quais produtos aparecem em cada periodo do dia"})]}),(0,a.jsx)("button",{className:"btn btn-primary",onClick:()=>M(),children:"+ Novo Agendamento"})]}),h&&(0,a.jsxs)("div",{className:"alert alert-error",style:{marginBottom:16},children:[h,(0,a.jsx)("button",{onClick:()=>m(""),style:{marginLeft:8,background:"none",border:"none",cursor:"pointer"},children:"x"})]}),0===t.length?(0,a.jsxs)("div",{className:"card",style:{textAlign:"center",padding:48,color:"#94a3b8"},children:[(0,a.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",style:{margin:"0 auto 12px"},children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,a.jsx)("path",{d:"M12 6v6l4 2",strokeLinecap:"round",strokeLinejoin:"round"})]}),(0,a.jsx)("p",{style:{fontSize:16,fontWeight:500},children:"Nenhum agendamento criado"}),(0,a.jsx)("p",{style:{fontSize:13,marginTop:4},children:'Crie agendamentos como "Cafe da Manha", "Almoco", "Menu de Natal" etc.'})]}):(0,a.jsx)("div",{style:{display:"grid",gap:16},children:t.map(e=>(0,a.jsxs)("div",{className:"card",style:{padding:0,overflow:"hidden"},children:[(0,a.jsxs)("div",{style:{padding:"16px 20px",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{style:{fontSize:16,fontWeight:600,marginBottom:4},children:e.name}),(0,a.jsxs)("div",{style:{display:"flex",gap:12,flexWrap:"wrap",fontSize:13,color:"#64748b"},children:[(0,a.jsx)("span",{style:{padding:"2px 8px",borderRadius:12,background:"time_based"===e.schedule_type?"#FFF7ED":"day_based"===e.schedule_type?"#dcfce7":"#fef3c7",color:"time_based"===e.schedule_type?"#F97316":"day_based"===e.schedule_type?"#16a34a":"#d97706",fontSize:11,fontWeight:500},children:r[e.schedule_type]||e.schedule_type}),e.start_time&&(0,a.jsxs)("span",{children:[Y(e.start_time)," - ",Y(e.end_time)]}),(0,a.jsx)("span",{children:G(e.days)}),(0,a.jsxs)("span",{children:[e.product_count||0," produto(s)"]})]})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,a.jsx)("button",{onClick:()=>{S(e),w(""),b(!0)},className:"btn btn-sm",style:{fontSize:12,padding:"4px 10px",background:"#F97316",color:"#fff",border:"none",borderRadius:6,cursor:"pointer"},children:"Produtos"}),(0,a.jsx)("button",{onClick:()=>M(e),style:{background:"none",border:"none",cursor:"pointer",color:"#64748b",fontSize:13},children:"Editar"}),(0,a.jsx)("button",{onClick:()=>q(e.id),style:{background:"none",border:"none",cursor:"pointer",color:"#ef4444",fontSize:13},children:"Excluir"})]})]}),(e.products||[]).length>0&&(0,a.jsxs)("div",{style:{padding:"0 20px 12px",display:"flex",gap:8,flexWrap:"wrap"},children:[e.products.slice(0,8).map(t=>(0,a.jsxs)("span",{style:{padding:"4px 10px",background:"#f1f5f9",borderRadius:6,fontSize:12,color:"#374151",display:"flex",alignItems:"center",gap:4},children:[t.name,(0,a.jsx)("button",{onClick:()=>Q(e.id,t.id),style:{background:"none",border:"none",cursor:"pointer",color:"#94a3b8",fontSize:14,lineHeight:1,padding:0},children:"x"})]},t.id)),e.products.length>8&&(0,a.jsxs)("span",{style:{fontSize:12,color:"#94a3b8",padding:"4px 6px"},children:["+",e.products.length-8," mais"]})]})]},e.id))}),f&&(0,a.jsx)("div",{className:"modal-overlay",onClick:()=>g(!1),children:(0,a.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),style:{maxWidth:480},children:[(0,a.jsx)("h3",{style:{fontSize:18,fontWeight:600,marginBottom:16},children:x?"Editar Agendamento":"Novo Agendamento"}),(0,a.jsxs)("div",{style:{marginBottom:12},children:[(0,a.jsx)("label",{className:"form-label",children:"Nome *"}),(0,a.jsx)("input",{className:"form-input",placeholder:"Ex: Cafe da Manha, Almoco, Menu de Natal...",value:N,onChange:e=>E(e.target.value)})]}),(0,a.jsxs)("div",{style:{marginBottom:12},children:[(0,a.jsx)("label",{className:"form-label",children:"Tipo"}),(0,a.jsx)("select",{className:"form-input",value:z,onChange:e=>P(e.target.value),children:Object.entries(r).map(e=>{let[t,n]=e;return(0,a.jsx)("option",{value:t,children:n},t)})})]}),("time_based"===z||"day_based"===z)&&(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:12},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Inicio"}),(0,a.jsx)("input",{type:"time",className:"form-input",value:A,onChange:e=>I(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Fim"}),(0,a.jsx)("input",{type:"time",className:"form-input",value:T,onChange:e=>B(e.target.value)})]})]}),(0,a.jsxs)("div",{style:{marginBottom:12},children:[(0,a.jsx)("label",{className:"form-label",children:"Dias da semana"}),(0,a.jsx)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:i.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.value,void F(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},style:{padding:"6px 12px",borderRadius:8,border:"1px solid",borderColor:W.includes(e.value)?"#F97316":"#e2e8f0",background:W.includes(e.value)?"#F97316":"#fff",color:W.includes(e.value)?"#fff":"#64748b",cursor:"pointer",fontSize:13,fontWeight:500},children:e.label},e.value))})]}),"seasonal"===z&&(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:12},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Data inicio"}),(0,a.jsx)("input",{type:"date",className:"form-input",value:O,onChange:e=>D(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Data fim"}),(0,a.jsx)("input",{type:"date",className:"form-input",value:R,onChange:e=>L(e.target.value)})]})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:16},children:[(0,a.jsx)("button",{className:"btn btn-secondary",onClick:()=>g(!1),children:"Cancelar"}),(0,a.jsx)("button",{className:"btn btn-primary",onClick:U,disabled:k||!N.trim(),children:k?"Salvando...":x?"Salvar":"Criar"})]})]})}),v&&j&&(0,a.jsx)("div",{className:"modal-overlay",onClick:()=>b(!1),children:(0,a.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),style:{maxWidth:560,maxHeight:"80vh",display:"flex",flexDirection:"column"},children:[(0,a.jsxs)("h3",{style:{fontSize:18,fontWeight:600,marginBottom:4},children:["Produtos - ",j.name]}),(0,a.jsxs)("p",{style:{fontSize:13,color:"#64748b",marginBottom:16},children:[(j.products||[]).length," produto(s) vinculado(s)"]}),(j.products||[]).length>0&&(0,a.jsx)("div",{style:{marginBottom:16,maxHeight:200,overflowY:"auto",border:"1px solid #e2e8f0",borderRadius:8},children:j.products.map(e=>(0,a.jsxs)("div",{style:{padding:"8px 12px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #f1f5f9"},children:[(0,a.jsx)("span",{style:{fontSize:13},children:e.name}),(0,a.jsx)("button",{onClick:()=>Q(j.id,e.id),style:{background:"none",border:"none",cursor:"pointer",color:"#ef4444",fontSize:12},children:"Remover"})]},e.id))}),(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsx)("input",{className:"form-input",placeholder:"Buscar produto para adicionar...",value:C,onChange:e=>w(e.target.value),style:{fontSize:13}})}),(0,a.jsx)("div",{style:{flex:1,overflowY:"auto",border:"1px solid #e2e8f0",borderRadius:8,maxHeight:250},children:0===V.length?(0,a.jsx)("p",{style:{padding:16,color:"#94a3b8",fontSize:13,textAlign:"center"},children:C?"Nenhum produto encontrado":"Todos os produtos ja estao vinculados"}):V.map(e=>(0,a.jsxs)("div",{style:{padding:"8px 12px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #f1f5f9"},children:[(0,a.jsx)("span",{style:{fontSize:13},children:e.name}),(0,a.jsx)("button",{onClick:()=>J([e.id]),disabled:k,style:{background:"none",border:"none",cursor:"pointer",color:"#F97316",fontSize:12,fontWeight:500},children:"+ Adicionar"})]},e.id))}),(0,a.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:16},children:(0,a.jsx)("button",{className:"btn btn-secondary",onClick:()=>b(!1),children:"Fechar"})})]})})]})}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return i},a:function(){return r}});var a=n(7437),l=n(2265),o=n(6428);let s=(0,l.createContext)(null);function i(e){let{children:t}=e,[n,i]=(0,l.useState)(null),[r,c]=(0,l.useState)(!0),[d,u]=(0,l.useState)(null),p=(0,l.useCallback)(async()=>{if(!(0,o.LP)()){i(null),c(!1);return}try{let e=await (0,o.SC)("/auth/session.php");e.authenticated&&e.partner?i(e.partner):((0,o.o4)(null),i(null))}catch(e){console.warn("Session check failed (network error), keeping session:",e)}finally{c(!1)}},[]);(0,l.useEffect)(()=>{p()},[p]);let h=(0,l.useCallback)(async(e,t)=>{let n=await (0,o.sg)("/auth/login.php",{email:e,senha:t});if(n.requires_2fa)return u({partner_id:n.partner_id,nome:n.nome,temp_token:n.temp_token}),{requires_2fa:!0};(0,o.o4)(n.token);let a=n.partner||{id:n.partner_id,nome:n.nome,email:n.email,cnpj:n.cnpj,logo:n.logo,categoria:n.categoria,status:n.status};return i(a),u(null),a},[]),m=(0,l.useCallback)(async e=>{if(!d)throw Error("Nenhuma verificacao 2FA pendente");let t=await (0,o.sg)("/auth/totp-verify.php",{temp_token:d.temp_token,code:e});(0,o.o4)(t.token);let n=t.partner||{id:t.partner_id,nome:t.nome,email:t.email,cnpj:t.cnpj,logo:t.logo,categoria:t.categoria,status:t.status};return i(n),u(null),n},[d]),f=(0,l.useCallback)(()=>{u(null)},[]),g=(0,l.useCallback)(e=>{i(t=>t?{...t,...e}:t)},[]),x=(0,l.useCallback)(()=>{(0,o.o4)(null),i(null),u(null)},[]);return(0,a.jsx)(s.Provider,{value:{partner:n,loading:r,isAuthenticated:!!n,twoFactorPending:d,login:h,verifyTotp:m,cancelTotp:f,logout:x,updatePartner:g,refreshSession:p},children:t})}function r(){let e=(0,l.useContext)(s);if(!e)throw Error("useAuth must be used within AuthProvider");return e}}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=9950)}),_N_E=e.O()}]);