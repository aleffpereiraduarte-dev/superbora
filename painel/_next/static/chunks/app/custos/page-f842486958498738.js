(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3067],{9071:function(e,t,s){Promise.resolve().then(s.bind(s,5678))},5678:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return u}});var l=s(7437),r=s(2265),a=s(4565),i=s(4477),o=s(6428);function n(e){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e||0)}function c(e){return"".concat((e||0).toFixed(1),"%")}let d={A:{bg:"#d1fae5",color:"#065f46",label:"A - Alta"},B:{bg:"#fef3c7",color:"#92400e",label:"B - Media"},C:{bg:"#fee2e2",color:"#991b1b",label:"C - Baixa"}},h={estrela:{emoji:"★",label:"Estrela",desc:"Alto volume + alta margem",color:"#f59e0b",bg:"#fffbeb"},vaca_leiteira:{emoji:"\uD83D\uDC04",label:"Vaca Leiteira",desc:"Alto volume + margem moderada",color:"#16a34a",bg:"#f0fdf4"},interrogacao:{emoji:"?",label:"Interrogacao",desc:"Baixo volume + alta margem",color:"#2563eb",bg:"#eff6ff"},abacaxi:{emoji:"✕",label:"Abacaxi",desc:"Baixo volume + baixa margem",color:"#dc2626",bg:"#fef2f2"}};function u(){return(0,l.jsx)(a.Z,{children:(0,l.jsx)(i.Z,{children:(0,l.jsx)(x,{})})})}function x(){var e,t,s,a,i,u;let x=new Date,[m,p]=(0,r.useState)([]),[g,v]=(0,r.useState)(!0),[j,f]=(0,r.useState)(""),[y,b]=(0,r.useState)(""),[N,_]=(0,r.useState)("nome"),[C,k]=(0,r.useState)("asc"),[S,w]=(0,r.useState)(null),[M,A]=(0,r.useState)(""),[z,B]=(0,r.useState)(""),[W,L]=(0,r.useState)(!1),[R,F]=(0,r.useState)("tabela"),[I,T]=(0,r.useState)(null),[E,V]=(0,r.useState)(!1),[P,D]=(0,r.useState)("".concat(x.getFullYear(),"-").concat(String(x.getMonth()+1).padStart(2,"0"))),[O,q]=(0,r.useState)(!1),[G,H]=(0,r.useState)(""),[Z,K]=(0,r.useState)(!1),[Q,X]=(0,r.useState)(null),Y=(0,r.useRef)(null),$=(0,r.useCallback)(async()=>{v(!0),f("");try{let e=await (0,o.SC)("/product-costs.php",{limit:200});p(e.items||[])}catch(e){f(e.message)}finally{v(!1)}},[]),J=(0,r.useCallback)(async()=>{V(!0);try{let e=await (0,o.SC)("/product-costs.php",{action:"analysis",mes:P});T(e)}catch(e){console.error("Erro ao carregar analise:",e)}finally{V(!1)}},[P]);(0,r.useEffect)(()=>{$()},[$]),(0,r.useEffect)(()=>{("matrix"===R||"ranking"===R)&&J()},[R,J]);let U=(0,r.useMemo)(()=>{let e=[...m];if(y.trim()){let t=y.toLowerCase();e=e.filter(e=>{var s,l,r;return(null===(s=e.nome)||void 0===s?void 0:s.toLowerCase().includes(t))||(null===(l=e.fornecedor)||void 0===l?void 0:l.toLowerCase().includes(t))||(null===(r=e.category_name)||void 0===r?void 0:r.toLowerCase().includes(t))})}return e.sort((e,t)=>{let s=e[N],l=t[N];return("string"==typeof s&&(s=(null==s?void 0:s.toLowerCase())||""),"string"==typeof l&&(l=(null==l?void 0:l.toLowerCase())||""),"asc"===C)?s>l?1:s<l?-1:0:s<l?1:s>l?-1:0}),e},[m,y,N,C]);function ee(e){N===e?k(e=>"asc"===e?"desc":"asc"):(_(e),k("asc"))}function et(e){return N!==e?"↕":"asc"===C?"↑":"↓"}function es(){w(null),A(""),B("")}async function el(e){let t=parseFloat(M.replace(",","."));if(isNaN(t)||t<0){alert("Custo invalido");return}L(!0);try{await (0,o.sg)("/product-costs.php?action=set_cost",{product_id:e,custo:t,fornecedor:z}),p(s=>s.map(s=>{if(s.product_id===e){let e=s.preco_venda-t,l=s.preco_venda>0?(s.preco_venda-t)/s.preco_venda*100:0;return{...s,custo:t,margem_valor:Math.round(100*e)/100,margem_percentual:Math.round(10*l)/10,classificacao:l>=40?"A":l>=20?"B":"C",fornecedor:z||s.fornecedor}}return s})),w(null)}catch(e){alert("Erro ao salvar: "+e.message)}finally{L(!1)}}async function er(){if(!G.trim()){alert("Cole ou carregue dados CSV");return}K(!0),X(null);try{let e=G.trim().split("\n"),t=[];for(let s=0;s<e.length;s++){let l=e[s].trim();if(!l)continue;let r=l.includes(";")?l.split(";"):l.split(",");if(0===s&&(r[0].toLowerCase().includes("product")||r[0].toLowerCase().includes("id")||r[0].toLowerCase().includes("nome")))continue;let a=parseInt(r[0]),i=parseFloat((r[1]||"0").replace(",",".").replace(/[^\d.]/g,""));a>0&&!isNaN(i)&&i>=0&&t.push({product_id:a,custo:i})}if(0===t.length){alert("Nenhum item valido encontrado no CSV. Formato: product_id;custo"),K(!1);return}let s=await (0,o.sg)("/product-costs.php?action=bulk_costs",{items:t});X(s),$()}catch(e){alert("Erro ao importar: "+e.message)}finally{K(!1)}}function ea(e){return e<20?"#dc2626":e<40?"#f59e0b":"#16a34a"}function ei(e){return e<20?"#fee2e2":e<40?"#fef3c7":"#d1fae5"}let eo=(0,r.useMemo)(()=>{let e=m.filter(e=>e.custo>0),t=e.length>0?e.reduce((e,t)=>e+t.margem_percentual,0)/e.length:0,s=e.length>0?e.reduce((e,t)=>e.margem_percentual>t.margem_percentual?e:t):null,l=e.length>0?e.reduce((e,t)=>e.margem_percentual<t.margem_percentual?e:t):null;return{total:m.length,comCusto:e.length,semCusto:m.length-e.length,margemMedia:Math.round(10*t)/10,melhor:s,pior:l}},[m]);return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"page-header",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"page-title",children:"Custos e Margens"}),(0,l.jsx)("p",{className:"page-subtitle",children:"Gerencie custos dos produtos e analise lucratividade"})]}),(0,l.jsx)("div",{style:{display:"flex",gap:8},children:(0,l.jsxs)("button",{className:"btn btn-secondary",onClick:()=>q(!O),style:{display:"inline-flex",alignItems:"center",gap:6,fontSize:13},children:[(0,l.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,l.jsx)("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"})}),"Importar CSV"]})})]}),(0,l.jsxs)("div",{className:"stats-grid",children:[(0,l.jsxs)("div",{className:"stat-card",children:[(0,l.jsx)("div",{className:"stat-card-icon",style:{background:"#eff6ff",color:"#2563eb"},children:(0,l.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,l.jsx)("path",{d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}),(0,l.jsx)("div",{className:"stat-card-value",children:eo.total}),(0,l.jsxs)("div",{className:"stat-card-label",children:["Produtos | ",eo.comCusto," com custo"]})]}),(0,l.jsxs)("div",{className:"stat-card",children:[(0,l.jsx)("div",{className:"stat-card-icon",style:{background:ei(eo.margemMedia),color:ea(eo.margemMedia)},children:(0,l.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,l.jsx)("path",{d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})}),(0,l.jsx)("div",{className:"stat-card-value",style:{color:ea(eo.margemMedia)},children:c(eo.margemMedia)}),(0,l.jsx)("div",{className:"stat-card-label",children:"Margem Media"})]}),(0,l.jsxs)("div",{className:"stat-card",children:[(0,l.jsx)("div",{className:"stat-card-icon",style:{background:"#d1fae5",color:"#065f46"},children:(0,l.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,l.jsx)("polyline",{points:"23 6 13.5 15.5 8.5 10.5 1 18"}),(0,l.jsx)("polyline",{points:"17 6 23 6 23 12"})]})}),(0,l.jsx)("div",{className:"stat-card-value",style:{fontSize:16},children:(null===(e=eo.melhor)||void 0===e?void 0:e.nome)||"--"}),(0,l.jsxs)("div",{className:"stat-card-label",children:["Melhor Margem (",c(null===(t=eo.melhor)||void 0===t?void 0:t.margem_percentual),")"]})]}),(0,l.jsxs)("div",{className:"stat-card",children:[(0,l.jsx)("div",{className:"stat-card-icon",style:{background:"#fee2e2",color:"#991b1b"},children:(0,l.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,l.jsx)("polyline",{points:"23 18 13.5 8.5 8.5 13.5 1 6"}),(0,l.jsx)("polyline",{points:"17 18 23 18 23 12"})]})}),(0,l.jsx)("div",{className:"stat-card-value",style:{fontSize:16},children:(null===(s=eo.pior)||void 0===s?void 0:s.nome)||"--"}),(0,l.jsxs)("div",{className:"stat-card-label",children:["Pior Margem (",c(null===(a=eo.pior)||void 0===a?void 0:a.margem_percentual),")"]})]})]}),O&&(0,l.jsxs)("div",{className:"card",style:{marginBottom:24},children:[(0,l.jsx)("div",{className:"card-header",children:(0,l.jsx)("h2",{className:"card-title",children:"Importar Custos via CSV"})}),(0,l.jsxs)("div",{style:{padding:"0 20px 20px"},children:[(0,l.jsxs)("p",{style:{fontSize:13,color:"var(--color-text-muted)",marginBottom:12},children:["Formato: ",(0,l.jsx)("code",{children:"product_id;custo"})," (uma linha por produto). A primeira linha de cabecalho sera ignorada."]}),(0,l.jsxs)("div",{style:{display:"flex",gap:12,marginBottom:12,flexWrap:"wrap"},children:[(0,l.jsx)("input",{type:"file",accept:".csv,.txt",ref:Y,onChange:function(e){let t=e.target.files[0];if(!t)return;let s=new FileReader;s.onload=e=>{H(e.target.result)},s.readAsText(t)},style:{display:"none"}}),(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>{var e;return null===(e=Y.current)||void 0===e?void 0:e.click()},style:{fontSize:13},children:"Carregar Arquivo CSV"})]}),(0,l.jsx)("textarea",{className:"form-input",rows:6,placeholder:"product_id;custo\n101;5.50\n102;12.00\n103;8.75",value:G,onChange:e=>H(e.target.value),style:{fontFamily:"monospace",fontSize:13}}),(0,l.jsxs)("div",{style:{display:"flex",gap:12,marginTop:12,alignItems:"center"},children:[(0,l.jsx)("button",{className:"btn btn-primary",onClick:er,disabled:Z||!G.trim(),style:{fontSize:13},children:Z?"Importando...":"Importar"}),Q&&(0,l.jsxs)("span",{style:{fontSize:13,color:"var(--color-success)"},children:[Q.updated," custos atualizados de ",Q.total,(null===(i=Q.errors)||void 0===i?void 0:i.length)>0&&" (".concat(Q.errors.length," erros)")]})]})]})]}),(0,l.jsxs)("div",{className:"tabs",style:{marginBottom:24},children:[(0,l.jsx)("button",{className:"tab ".concat("tabela"===R?"tab-active":""),onClick:()=>F("tabela"),children:"Tabela de Custos"}),(0,l.jsx)("button",{className:"tab ".concat("matrix"===R?"tab-active":""),onClick:()=>F("matrix"),children:"Matriz BCG"}),(0,l.jsx)("button",{className:"tab ".concat("ranking"===R?"tab-active":""),onClick:()=>F("ranking"),children:"Ranking Lucratividade"})]}),"tabela"===R&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{style:{marginBottom:16},children:(0,l.jsx)("input",{type:"text",className:"form-input",placeholder:"Buscar produto por nome, fornecedor ou categoria...",value:y,onChange:e=>b(e.target.value),style:{maxWidth:400}})}),g?(0,l.jsx)("div",{className:"loading-screen",children:(0,l.jsx)("div",{className:"spinner"})}):j?(0,l.jsxs)("div",{className:"empty-state",children:[(0,l.jsx)("div",{className:"empty-state-title",children:"Erro ao carregar produtos"}),(0,l.jsx)("div",{className:"empty-state-text",children:j})]}):0===U.length?(0,l.jsxs)("div",{className:"empty-state",children:[(0,l.jsx)("div",{className:"empty-state-title",children:"Nenhum produto encontrado"}),(0,l.jsx)("div",{className:"empty-state-text",children:y?"Tente outro termo de busca":"Cadastre produtos para ver custos"})]}):(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("div",{className:"table-wrapper",style:{boxShadow:"none"},children:(0,l.jsxs)("table",{className:"table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsxs)("th",{onClick:()=>ee("nome"),style:{cursor:"pointer",userSelect:"none"},children:["Produto ",et("nome")]}),(0,l.jsxs)("th",{onClick:()=>ee("preco_venda"),style:{cursor:"pointer",textAlign:"right",userSelect:"none"},children:["Preco Venda ",et("preco_venda")]}),(0,l.jsxs)("th",{onClick:()=>ee("custo"),style:{cursor:"pointer",textAlign:"right",userSelect:"none"},children:["Custo ",et("custo")]}),(0,l.jsxs)("th",{onClick:()=>ee("margem_valor"),style:{cursor:"pointer",textAlign:"right",userSelect:"none"},children:["Margem R$ ",et("margem_valor")]}),(0,l.jsxs)("th",{onClick:()=>ee("margem_percentual"),style:{cursor:"pointer",textAlign:"right",userSelect:"none"},children:["Margem % ",et("margem_percentual")]}),(0,l.jsxs)("th",{onClick:()=>ee("classificacao"),style:{cursor:"pointer",textAlign:"center",userSelect:"none"},children:["Class. ",et("classificacao")]}),(0,l.jsx)("th",{style:{textAlign:"center"},children:"Acoes"})]})}),(0,l.jsx)("tbody",{children:U.map(e=>{var t,s,r;return(0,l.jsxs)("tr",{children:[(0,l.jsxs)("td",{children:[(0,l.jsx)("div",{style:{fontWeight:500},children:e.nome}),e.fornecedor&&(0,l.jsxs)("div",{style:{fontSize:11,color:"var(--color-text-muted)"},children:["Forn: ",e.fornecedor]}),e.category_name&&(0,l.jsx)("div",{style:{fontSize:11,color:"var(--color-text-muted)"},children:e.category_name})]}),(0,l.jsx)("td",{style:{textAlign:"right",fontWeight:500},children:n(e.preco_venda)}),(0,l.jsx)("td",{style:{textAlign:"right"},children:S===e.product_id?(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4,alignItems:"flex-end"},children:[(0,l.jsx)("input",{type:"text",className:"form-input",value:M,onChange:e=>A(e.target.value),placeholder:"0.00",style:{width:90,textAlign:"right",fontSize:13,padding:"4px 8px"},autoFocus:!0,onKeyDown:t=>{"Enter"===t.key&&el(e.product_id),"Escape"===t.key&&es()}}),(0,l.jsx)("input",{type:"text",className:"form-input",value:z,onChange:e=>B(e.target.value),placeholder:"Fornecedor",style:{width:120,fontSize:12,padding:"2px 6px"}})]}):(0,l.jsx)("span",{style:{color:e.custo>0?"inherit":"var(--color-text-muted)"},children:e.custo>0?n(e.custo):"--"})}),(0,l.jsx)("td",{style:{textAlign:"right",fontWeight:500},children:e.custo>0?(0,l.jsx)("span",{style:{color:ea(e.margem_percentual)},children:n(e.margem_valor)}):"--"}),(0,l.jsx)("td",{style:{textAlign:"right"},children:e.custo>0?(0,l.jsx)("span",{style:{display:"inline-block",padding:"2px 8px",borderRadius:4,fontSize:13,fontWeight:600,background:ei(e.margem_percentual),color:ea(e.margem_percentual)},children:c(e.margem_percentual)}):"--"}),(0,l.jsx)("td",{style:{textAlign:"center"},children:e.custo>0?(0,l.jsx)("span",{style:{display:"inline-block",padding:"2px 10px",borderRadius:4,fontSize:12,fontWeight:600,background:(null===(t=d[e.classificacao])||void 0===t?void 0:t.bg)||"#f1f5f9",color:(null===(s=d[e.classificacao])||void 0===s?void 0:s.color)||"#64748b"},children:(null===(r=d[e.classificacao])||void 0===r?void 0:r.label)||e.classificacao}):"-"}),(0,l.jsx)("td",{style:{textAlign:"center"},children:S===e.product_id?(0,l.jsxs)("div",{style:{display:"flex",gap:4,justifyContent:"center"},children:[(0,l.jsx)("button",{className:"btn btn-primary",style:{fontSize:12,padding:"4px 10px"},onClick:()=>el(e.product_id),disabled:W,children:W?"...":"Salvar"}),(0,l.jsx)("button",{className:"btn btn-secondary",style:{fontSize:12,padding:"4px 10px"},onClick:es,children:"X"})]}):(0,l.jsx)("button",{className:"btn btn-secondary",style:{fontSize:12,padding:"4px 10px"},onClick:()=>{w(e.product_id),A(e.custo>0?String(e.custo):""),B(e.fornecedor||"")},children:"Editar"})})]},e.product_id)})})]})}),(0,l.jsxs)("div",{style:{padding:"12px 20px",borderTop:"1px solid var(--color-border)",fontSize:13,color:"var(--color-text-muted)"},children:[U.length," produtos | ",eo.semCusto," sem custo cadastrado"]})]})]}),"matrix"===R&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{style:{marginBottom:16,display:"flex",gap:12,alignItems:"center"},children:[(0,l.jsx)("span",{style:{fontSize:13,fontWeight:500},children:"Periodo de vendas:"}),(0,l.jsx)("input",{type:"month",className:"form-input",value:P,onChange:e=>D(e.target.value),style:{width:"auto"}})]}),E?(0,l.jsx)("div",{style:{padding:60,textAlign:"center"},children:(0,l.jsx)("div",{className:"spinner"})}):I?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"stats-grid",style:{marginBottom:24},children:[(0,l.jsxs)("div",{className:"stat-card",children:[(0,l.jsx)("div",{className:"stat-card-icon",style:{background:"#fee2e2",color:"#dc2626"},children:(0,l.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,l.jsx)("path",{d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1"})})}),(0,l.jsx)("div",{className:"stat-card-value",style:{color:"#dc2626"},children:n(I.cmv_total)}),(0,l.jsx)("div",{className:"stat-card-label",children:"CMV Total"})]}),(0,l.jsxs)("div",{className:"stat-card",children:[(0,l.jsx)("div",{className:"stat-card-icon",style:{background:"#eff6ff",color:"#2563eb"},children:(0,l.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,l.jsx)("path",{d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1"})})}),(0,l.jsx)("div",{className:"stat-card-value",children:n(I.receita_total)}),(0,l.jsx)("div",{className:"stat-card-label",children:"Receita Total"})]}),(0,l.jsxs)("div",{className:"stat-card",children:[(0,l.jsx)("div",{className:"stat-card-icon",style:{background:ei(I.margem_media),color:ea(I.margem_media)},children:(0,l.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,l.jsx)("path",{d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})}),(0,l.jsx)("div",{className:"stat-card-value",style:{color:ea(I.margem_media)},children:c(I.margem_media)}),(0,l.jsx)("div",{className:"stat-card-label",children:"Margem Media"})]}),(0,l.jsxs)("div",{className:"stat-card",children:[(0,l.jsx)("div",{className:"stat-card-icon",style:{background:"#f5f3ff",color:"#8b5cf6"},children:(0,l.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,l.jsx)("path",{d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}),(0,l.jsx)("div",{className:"stat-card-value",children:I.total_produtos}),(0,l.jsxs)("div",{className:"stat-card-label",children:[I.produtos_com_custo," com custo"]})]})]}),(0,l.jsxs)("div",{className:"card",style:{marginBottom:24},children:[(0,l.jsx)("div",{className:"card-header",children:(0,l.jsx)("h2",{className:"card-title",children:"Matriz BCG - Classificacao de Produtos"})}),(0,l.jsxs)("div",{style:{padding:"0 20px 20px"},children:[(0,l.jsx)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:Object.entries(h).map(e=>{let[t,s]=e,r="estrela"===t?I.produtos_estrela:"vaca_leiteira"===t?I.produtos_vaca_leiteira:"interrogacao"===t?I.produtos_interrogacao:I.produtos_abacaxi;return(0,l.jsxs)("div",{style:{border:"2px solid ".concat(s.color,"20"),borderRadius:12,background:s.bg,padding:16,minHeight:160},children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[(0,l.jsx)("span",{style:{fontSize:20},children:s.emoji}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{fontWeight:700,color:s.color,fontSize:15},children:s.label}),(0,l.jsx)("div",{style:{fontSize:11,color:"var(--color-text-muted)"},children:s.desc})]}),(0,l.jsx)("span",{style:{marginLeft:"auto",padding:"2px 8px",borderRadius:12,fontSize:12,fontWeight:600,background:"".concat(s.color,"20"),color:s.color},children:(null==r?void 0:r.length)||0})]}),(null==r?void 0:r.length)>0?(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[r.slice(0,5).map((e,t)=>(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"#fff",borderRadius:6,fontSize:13},children:[(0,l.jsx)("span",{style:{fontWeight:500,flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginRight:8},children:e.nome}),(0,l.jsxs)("div",{style:{display:"flex",gap:12,whiteSpace:"nowrap",fontSize:12},children:[(0,l.jsx)("span",{style:{color:ea(e.margem_percentual),fontWeight:600},children:c(e.margem_percentual)}),(0,l.jsxs)("span",{style:{color:"var(--color-text-muted)"},children:[e.qtd_vendida," un"]})]})]},e.product_id||t)),r.length>5&&(0,l.jsxs)("div",{style:{fontSize:12,color:"var(--color-text-muted)",textAlign:"center",paddingTop:4},children:["+",r.length-5," produtos"]})]}):(0,l.jsx)("div",{style:{fontSize:13,color:"var(--color-text-muted)",textAlign:"center",paddingTop:20},children:"Nenhum produto nesta categoria"})]},t)})}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginTop:12,fontSize:11,color:"var(--color-text-muted)"},children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,l.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,l.jsx)("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),(0,l.jsx)("polyline",{points:"5 12 12 5 19 12"})]}),"Margem alta"]}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:["Volume alto",(0,l.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,l.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"}),(0,l.jsx)("polyline",{points:"12 5 19 12 12 19"})]})]})]})]})]})]}):(0,l.jsx)("div",{className:"empty-state",children:(0,l.jsx)("div",{className:"empty-state-text",children:"Cadastre custos nos produtos para ver a analise"})})]}),"ranking"===R&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{style:{marginBottom:16,display:"flex",gap:12,alignItems:"center"},children:[(0,l.jsx)("span",{style:{fontSize:13,fontWeight:500},children:"Periodo:"}),(0,l.jsx)("input",{type:"month",className:"form-input",value:P,onChange:e=>D(e.target.value),style:{width:"auto"}})]}),E?(0,l.jsx)("div",{style:{padding:60,textAlign:"center"},children:(0,l.jsx)("div",{className:"spinner"})}):(null==I?void 0:null===(u=I.ranking_lucratividade)||void 0===u?void 0:u.length)>0?(0,l.jsxs)("div",{className:"card",children:[(0,l.jsxs)("div",{className:"card-header",children:[(0,l.jsx)("h2",{className:"card-title",children:"Ranking por Lucro Total"}),(0,l.jsx)("span",{style:{fontSize:12,color:"var(--color-text-muted)"},children:"Contribuicao de lucro = margem x volume vendido"})]}),(0,l.jsx)("div",{className:"table-wrapper",style:{boxShadow:"none"},children:(0,l.jsxs)("table",{className:"table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{style:{width:40},children:"#"}),(0,l.jsx)("th",{children:"Produto"}),(0,l.jsx)("th",{style:{textAlign:"right"},children:"Preco"}),(0,l.jsx)("th",{style:{textAlign:"right"},children:"Custo"}),(0,l.jsx)("th",{style:{textAlign:"right"},children:"Margem %"}),(0,l.jsx)("th",{style:{textAlign:"right"},children:"Qtd Vendida"}),(0,l.jsx)("th",{style:{textAlign:"right"},children:"Receita"}),(0,l.jsx)("th",{style:{textAlign:"right"},children:"CMV"}),(0,l.jsx)("th",{style:{textAlign:"right"},children:"Lucro Total"})]})}),(0,l.jsx)("tbody",{children:I.ranking_lucratividade.map((e,t)=>{var s;let r=(null===(s=I.ranking_lucratividade[0])||void 0===s?void 0:s.lucro_total)||1,a=r>0?Math.max(e.lucro_total/r*100,0):0;return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{style:{fontWeight:600,color:t<3?"#f59e0b":"var(--color-text-muted)"},children:t+1}),(0,l.jsxs)("td",{children:[(0,l.jsx)("div",{style:{fontWeight:500},children:e.nome}),(0,l.jsx)("div",{style:{marginTop:4,height:4,background:"#f1f5f9",borderRadius:2,overflow:"hidden"},children:(0,l.jsx)("div",{style:{height:"100%",width:"".concat(a,"%"),background:e.lucro_total>=0?"#16a34a":"#dc2626",borderRadius:2}})})]}),(0,l.jsx)("td",{style:{textAlign:"right"},children:n(e.preco_venda)}),(0,l.jsx)("td",{style:{textAlign:"right"},children:e.custo>0?n(e.custo):"--"}),(0,l.jsx)("td",{style:{textAlign:"right"},children:e.custo>0?(0,l.jsx)("span",{style:{color:ea(e.margem_percentual),fontWeight:600},children:c(e.margem_percentual)}):"--"}),(0,l.jsx)("td",{style:{textAlign:"right"},children:e.qtd_vendida}),(0,l.jsx)("td",{style:{textAlign:"right"},children:n(e.receita)}),(0,l.jsx)("td",{style:{textAlign:"right",color:"#dc2626"},children:e.custo>0?n(e.cmv):"--"}),(0,l.jsx)("td",{style:{textAlign:"right",fontWeight:700,color:e.lucro_total>=0?"#16a34a":"#dc2626"},children:n(e.lucro_total)})]},e.product_id||t)})})]})}),I.melhor_produto&&I.pior_produto&&(0,l.jsxs)("div",{style:{padding:"12px 20px",borderTop:"1px solid var(--color-border)",display:"flex",gap:24,flexWrap:"wrap",fontSize:13},children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{style:{color:"var(--color-text-muted)"},children:"Melhor produto: "}),(0,l.jsxs)("span",{style:{fontWeight:600,color:"#16a34a"},children:[I.melhor_produto.nome," (",n(I.melhor_produto.lucro_total)," lucro)"]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{style:{color:"var(--color-text-muted)"},children:"Pior produto: "}),(0,l.jsxs)("span",{style:{fontWeight:600,color:"#dc2626"},children:[I.pior_produto.nome," (",n(I.pior_produto.lucro_total)," lucro)"]})]})]})]}):(0,l.jsxs)("div",{className:"empty-state",children:[(0,l.jsx)("div",{className:"empty-state-title",children:"Sem dados de vendas"}),(0,l.jsx)("div",{className:"empty-state-text",children:"Cadastre custos e tenha vendas no periodo para ver o ranking"})]})]})]})}}},function(e){e.O(0,[3448,565,2205,2971,2117,1744],function(){return e(e.s=9071)}),_N_E=e.O()}]);