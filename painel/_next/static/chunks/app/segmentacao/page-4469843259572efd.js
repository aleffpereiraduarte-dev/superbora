(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1935],{7748:function(e,t,r){Promise.resolve().then(r.bind(r,2297))},2297:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return a}});var i=r(7437),s=r(2265),n=r(4565),l=r(4477),o=r(6428);function a(){return(0,i.jsx)(n.Z,{children:(0,i.jsx)(l.Z,{children:(0,i.jsx)(g,{})})})}let d=[{key:"90d",label:"90 dias"},{key:"180d",label:"180 dias"},{key:"365d",label:"1 ano"}],c={champions:{label:"Champions",icon:"\uD83C\uDFC6",color:"#16a34a",bg:"#f0fdf4",border:"#86efac",desc:"Melhores clientes - compram frequentemente e gastam mais"},loyal:{label:"Leais",icon:"\uD83D\uDC9A",color:"#0ea5e9",bg:"#f0f9ff",border:"#7dd3fc",desc:"Compradores frequentes e engajados"},potential:{label:"Potenciais",icon:"⭐",color:"#8b5cf6",bg:"#f5f3ff",border:"#c4b5fd",desc:"Podem se tornar leais com incentivo"},new:{label:"Novos",icon:"\uD83C\uDF1F",color:"#3b82f6",bg:"#eff6ff",border:"#93c5fd",desc:"Primeira compra recente"},at_risk:{label:"Em Risco",icon:"⚠️",color:"#f59e0b",bg:"#fffbeb",border:"#fcd34d",desc:"Foram bons clientes mas estao sumindo"},lost:{label:"Perdidos",icon:"\uD83D\uDCA4",color:"#ef4444",bg:"#fef2f2",border:"#fca5a5",desc:"Nao compram ha muito tempo"}};function x(e){let t=parseFloat(e);return isNaN(t)?"R$ 0,00":t.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}function h(e){if(!e)return"-";try{return new Date(e).toLocaleDateString("pt-BR")}catch(t){return e}}function g(){let[e,t]=(0,s.useState)("90d"),[r,n]=(0,s.useState)("segmentos"),[l,a]=(0,s.useState)(null),[g,m]=(0,s.useState)(null),[u,v]=(0,s.useState)(!0),[j,y]=(0,s.useState)(!0),[b,S]=(0,s.useState)(""),[k,w]=(0,s.useState)(null),[N,z]=(0,s.useState)(null),[_,C]=(0,s.useState)(!1),R=(0,s.useCallback)(async e=>{v(!0),S("");try{let t=await (0,o.SC)("/customer-segments.php",{periodo:e});a(t)}catch(e){S(e.message||"Erro ao carregar segmentacao")}v(!1)},[]),A=(0,s.useCallback)(async e=>{y(!0);try{let t=await (0,o.SC)("/customer-segments.php",{action:"overview",periodo:e});m(t)}catch(e){console.error("Overview error:",e)}y(!1)},[]);async function W(t){if(k===t){w(null),z(null);return}w(t),C(!0);try{let r=await (0,o.SC)("/customer-segments.php",{action:"segment_detail",segmento:t,periodo:e});z(r)}catch(e){console.error(e)}C(!1)}if((0,s.useEffect)(()=>{R(e),A(e)},[e,R,A]),u)return(0,i.jsx)("div",{style:{padding:60,textAlign:"center"},children:(0,i.jsx)("div",{className:"spinner"})});if(b)return(0,i.jsxs)("div",{style:{padding:40,textAlign:"center"},children:[(0,i.jsx)("p",{style:{color:"var(--color-danger)",marginBottom:16},children:b}),(0,i.jsx)("button",{className:"btn btn-primary",onClick:()=>R(e),children:"Tentar novamente"})]});let M=(null==l?void 0:l.segmentos)||[],D=(null==l?void 0:l.total_clientes)||0;return(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"page-header",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"page-title",children:"Segmentacao de Clientes"}),(0,i.jsx)("p",{className:"page-subtitle",children:"Analise RFM (Recencia, Frequencia, Monetario) - entenda e engaje seus clientes"})]}),(0,i.jsx)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:d.map(r=>(0,i.jsx)("button",{onClick:()=>t(r.key),style:e===r.key?{padding:"8px 16px",borderRadius:8,fontSize:13,fontWeight:600,background:"var(--color-primary)",color:"#fff",border:"none",cursor:"pointer"}:{padding:"8px 16px",borderRadius:8,fontSize:13,fontWeight:500,background:"var(--color-bg-muted)",color:"var(--color-text-secondary)",border:"none",cursor:"pointer"},children:r.label},r.key))})]}),(0,i.jsx)("div",{style:{display:"flex",gap:4,padding:4,background:"var(--color-bg-muted)",borderRadius:8,marginBottom:24,overflowX:"auto"},children:[{key:"segmentos",label:"Segmentos"},{key:"overview",label:"Visao Geral"},{key:"rfm",label:"Distribuicao RFM"}].map(e=>(0,i.jsx)("button",{onClick:()=>n(e.key),style:{padding:"8px 16px",borderRadius:6,fontSize:13,fontWeight:r===e.key?600:500,background:r===e.key?"var(--color-bg)":"transparent",color:r===e.key?"var(--color-text)":"var(--color-text-secondary)",boxShadow:r===e.key?"var(--shadow-sm)":"none",border:"none",cursor:"pointer",whiteSpace:"nowrap",transition:"all 0.15s"},children:e.label},e.key))}),"segmentos"===r&&(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{marginBottom:20,fontSize:14,color:"var(--color-text-secondary)"},children:[(0,i.jsx)("strong",{style:{color:"var(--color-text)",fontSize:20},children:D})," clientes analisados no periodo"]}),(0,i.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",gap:16},children:M.map(e=>{var t;let r=c[e.segmento]||{},s=k===e.segmento;return(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,i.jsxs)("div",{onClick:()=>W(e.segmento),style:{background:r.bg,border:"2px solid ".concat(r.border),borderRadius:12,padding:20,cursor:"pointer",transition:"all 0.2s",boxShadow:s?"var(--shadow-md)":"var(--shadow-xs)",transform:s?"scale(1.01)":"none"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10},children:[(0,i.jsx)("span",{style:{fontSize:28},children:r.icon}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontWeight:700,fontSize:16,color:r.color},children:r.label}),(0,i.jsx)("div",{style:{fontSize:11,color:"var(--color-text-muted)",maxWidth:220},children:r.desc})]})]}),(0,i.jsx)("span",{style:{fontSize:20,color:"var(--color-text-muted)",transform:s?"rotate(180deg)":"none",transition:"transform 0.2s"},children:"▼"})]}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8},children:[(0,i.jsxs)("div",{style:{textAlign:"center",padding:8,background:"rgba(255,255,255,0.6)",borderRadius:8},children:[(0,i.jsx)("div",{style:{fontSize:20,fontWeight:700,color:r.color},children:e.count}),(0,i.jsx)("div",{style:{fontSize:11,color:"var(--color-text-muted)"},children:"Clientes"})]}),(0,i.jsxs)("div",{style:{textAlign:"center",padding:8,background:"rgba(255,255,255,0.6)",borderRadius:8},children:[(0,i.jsx)("div",{style:{fontSize:14,fontWeight:700},children:x(e.total_valor)}),(0,i.jsx)("div",{style:{fontSize:11,color:"var(--color-text-muted)"},children:"Valor Total"})]}),(0,i.jsxs)("div",{style:{textAlign:"center",padding:8,background:"rgba(255,255,255,0.6)",borderRadius:8},children:[(0,i.jsxs)("div",{style:{fontSize:14,fontWeight:700},children:[e.percentual,"%"]}),(0,i.jsx)("div",{style:{fontSize:11,color:"var(--color-text-muted)"},children:"do Total"})]})]}),(0,i.jsx)("div",{style:{marginTop:10},children:(0,i.jsx)("div",{style:{width:"100%",height:6,background:"rgba(255,255,255,0.8)",borderRadius:3},children:(0,i.jsx)("div",{style:{width:"".concat(Math.min(e.percentual,100),"%"),height:"100%",background:r.color,borderRadius:3,transition:"width 0.5s ease"}})})})]}),s&&(0,i.jsx)("div",{style:{background:"var(--color-bg)",border:"1px solid ".concat(r.border),borderTop:"none",borderRadius:"0 0 12px 12px",padding:16,animation:"slideUp 0.2s ease"},children:_?(0,i.jsx)("div",{style:{padding:20,textAlign:"center"},children:(0,i.jsx)("div",{className:"spinner-sm"})}):(null==N?void 0:null===(t=N.clientes)||void 0===t?void 0:t.length)>0?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,i.jsxs)("span",{style:{fontSize:13,fontWeight:600},children:[N.total," clientes"]}),(0,i.jsx)("button",{onClick:t=>{t.stopPropagation(),function(e,t){if(!e||0===e.length)return;let r=new Blob(["\uFEFF"+["Nome,Email,Telefone,Total Pedidos,Total Gasto,Ticket Medio,Ultimo Pedido,RFM Score",...e.map(e=>[e.nome,e.email||"",e.telefone||"",e.total_pedidos,e.total_gasto,e.ticket_medio,e.ultimo_pedido,e.rfm_score]).map(e=>e.map(e=>'"'.concat(e,'"')).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(r),s=document.createElement("a");s.href=i,s.download="segmento_".concat(t,"_").concat(new Date().toISOString().slice(0,10),".csv"),s.click(),URL.revokeObjectURL(i)}(N.clientes,e.segmento)},style:{fontSize:12,padding:"4px 12px",borderRadius:6,background:"var(--color-bg-muted)",border:"1px solid var(--color-border)",cursor:"pointer",color:"var(--color-text-secondary)",fontWeight:500},children:"Exportar CSV"})]}),(0,i.jsxs)("div",{style:{maxHeight:300,overflowY:"auto"},children:[(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[(0,i.jsx)("th",{style:{textAlign:"left",padding:"6px 8px",fontSize:11,fontWeight:600,color:"var(--color-text-muted)"},children:"Cliente"}),(0,i.jsx)("th",{style:{textAlign:"left",padding:"6px 8px",fontSize:11,fontWeight:600,color:"var(--color-text-muted)"},children:"Contato"}),(0,i.jsx)("th",{style:{textAlign:"right",padding:"6px 8px",fontSize:11,fontWeight:600,color:"var(--color-text-muted)"},children:"Pedidos"}),(0,i.jsx)("th",{style:{textAlign:"right",padding:"6px 8px",fontSize:11,fontWeight:600,color:"var(--color-text-muted)"},children:"Total"}),(0,i.jsx)("th",{style:{textAlign:"right",padding:"6px 8px",fontSize:11,fontWeight:600,color:"var(--color-text-muted)"},children:"Ultimo Pedido"})]})}),(0,i.jsx)("tbody",{children:N.clientes.slice(0,20).map(e=>(0,i.jsxs)("tr",{style:{borderBottom:"1px solid var(--color-border-light)"},children:[(0,i.jsx)("td",{style:{padding:"8px",fontWeight:500},children:e.nome}),(0,i.jsx)("td",{style:{padding:"8px",color:"var(--color-text-secondary)"},children:e.telefone||e.email||"-"}),(0,i.jsx)("td",{style:{padding:"8px",textAlign:"right"},children:e.total_pedidos}),(0,i.jsx)("td",{style:{padding:"8px",textAlign:"right",fontWeight:600},children:x(e.total_gasto)}),(0,i.jsx)("td",{style:{padding:"8px",textAlign:"right",color:"var(--color-text-secondary)"},children:h(e.ultimo_pedido)})]},e.customer_id))})]}),N.clientes.length>20&&(0,i.jsxs)("div",{style:{padding:8,textAlign:"center",fontSize:12,color:"var(--color-text-muted)"},children:["Mostrando 20 de ",N.clientes.length," clientes. Exporte CSV para ver todos."]})]})]}):(0,i.jsx)("div",{style:{padding:20,textAlign:"center",color:"var(--color-text-muted)",fontSize:13},children:"Nenhum cliente neste segmento"})})]},e.segmento)})})]}),"overview"===r&&(0,i.jsx)(p,{overview:g,loading:j}),"rfm"===r&&(0,i.jsx)(f,{clientes:(null==l?void 0:l.clientes)||[]})]})}function p(e){let{overview:t,loading:r}=e;if(r)return(0,i.jsx)("div",{style:{padding:60,textAlign:"center"},children:(0,i.jsx)("div",{className:"spinner"})});if(!t)return(0,i.jsx)("div",{className:"card",style:{textAlign:"center",padding:40,color:"var(--color-text-muted)"},children:"Dados nao disponiveis"});let s=t.ratio_novos_recorrentes||{},n=t.retention_curve||[],l=t.distribuicao_pedidos||[],o=Math.max(...n.map(e=>e.retention_rate),1);return(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"stats-grid",children:[(0,i.jsxs)("div",{className:"stat-card",children:[(0,i.jsx)("div",{className:"stat-card-icon",style:{background:"#dbeafe"},children:(0,i.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#3b82f6",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),(0,i.jsx)("circle",{cx:"9",cy:"7",r:"4"}),(0,i.jsx)("path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}),(0,i.jsx)("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})}),(0,i.jsx)("div",{className:"stat-card-value",children:t.total_clientes||0}),(0,i.jsx)("div",{className:"stat-card-label",children:"Total de Clientes"})]}),(0,i.jsxs)("div",{className:"stat-card",children:[(0,i.jsx)("div",{className:"stat-card-icon",style:{background:"#d1fae5"},children:(0,i.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#16a34a",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),(0,i.jsx)("circle",{cx:"9",cy:"7",r:"4"}),(0,i.jsx)("line",{x1:"19",y1:"8",x2:"19",y2:"14"}),(0,i.jsx)("line",{x1:"22",y1:"11",x2:"16",y2:"11"})]})}),(0,i.jsx)("div",{className:"stat-card-value",children:t.novos_mes||0}),(0,i.jsx)("div",{className:"stat-card-label",children:"Novos Este Mes"})]}),(0,i.jsxs)("div",{className:"stat-card",children:[(0,i.jsx)("div",{className:"stat-card-icon",style:{background:"#fef3c7"},children:(0,i.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#f59e0b",strokeWidth:"2",children:[(0,i.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),(0,i.jsx)("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]})}),(0,i.jsx)("div",{className:"stat-card-value",children:x(t.clv_medio)}),(0,i.jsx)("div",{className:"stat-card-label",children:"CLV Medio"})]}),(0,i.jsxs)("div",{className:"stat-card",children:[(0,i.jsx)("div",{className:"stat-card-icon",style:{background:t.churn_rate>30?"#fee2e2":"#f0f9ff"},children:(0,i.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:t.churn_rate>30?"#ef4444":"#0ea5e9",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),(0,i.jsx)("circle",{cx:"9",cy:"7",r:"4"}),(0,i.jsx)("line",{x1:"17",y1:"11",x2:"23",y2:"11"})]})}),(0,i.jsxs)("div",{className:"stat-card-value",style:{color:t.churn_rate>30?"var(--color-danger)":void 0},children:[t.churn_rate||0,"%"]}),(0,i.jsx)("div",{className:"stat-card-label",children:"Taxa de Churn (60d)"})]})]}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:20},children:[(0,i.jsxs)("div",{className:"card",children:[(0,i.jsx)("div",{className:"card-header",children:(0,i.jsx)("h2",{className:"card-title",children:"Novos vs Recorrentes"})}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:32,padding:"16px 0"},children:[(0,i.jsxs)("div",{style:{position:"relative",width:140,height:140},children:[(0,i.jsxs)("svg",{viewBox:"0 0 36 36",style:{width:140,height:140,transform:"rotate(-90deg)"},children:[(0,i.jsx)("circle",{cx:"18",cy:"18",r:"15.9155",fill:"transparent",stroke:"#e2e8f0",strokeWidth:"3"}),(0,i.jsx)("circle",{cx:"18",cy:"18",r:"15.9155",fill:"transparent",stroke:"#3b82f6",strokeWidth:"3",strokeDasharray:"".concat(s.percent_recorrentes||0," ").concat(100-(s.percent_recorrentes||0))})]}),(0,i.jsxs)("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,i.jsxs)("span",{style:{fontSize:20,fontWeight:700},children:[s.percent_recorrentes||0,"%"]}),(0,i.jsx)("span",{style:{fontSize:10,color:"var(--color-text-muted)"},children:"Recorrentes"})]})]}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)("div",{style:{width:12,height:12,borderRadius:3,background:"#3b82f6"}}),(0,i.jsxs)("span",{style:{fontSize:13},children:["Recorrentes: ",(0,i.jsx)("strong",{children:s.recorrentes||0})]})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)("div",{style:{width:12,height:12,borderRadius:3,background:"#e2e8f0"}}),(0,i.jsxs)("span",{style:{fontSize:13},children:["Novos: ",(0,i.jsx)("strong",{children:s.novos||0})]})]})]})]})]}),(0,i.jsxs)("div",{className:"card",children:[(0,i.jsx)("div",{className:"card-header",children:(0,i.jsx)("h2",{className:"card-title",children:"Curva de Retencao"})}),0===n.length?(0,i.jsx)("div",{style:{padding:20,textAlign:"center",color:"var(--color-text-muted)",fontSize:13},children:"Sem dados suficientes"}):(0,i.jsx)("div",{style:{display:"flex",alignItems:"flex-end",gap:16,padding:"16px 0",height:180},children:n.map((e,t)=>(0,i.jsxs)("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:6},children:[(0,i.jsxs)("span",{style:{fontSize:13,fontWeight:700,color:e.retention_rate>40?"var(--color-success)":e.retention_rate>20?"var(--color-warning)":"var(--color-danger)"},children:[e.retention_rate,"%"]}),(0,i.jsx)("div",{style:{width:"100%",maxWidth:50,borderRadius:"6px 6px 0 0",height:"".concat(Math.max(e.retention_rate/o*120,8),"px"),background:e.retention_rate>40?"var(--color-success)":e.retention_rate>20?"var(--color-warning)":"var(--color-danger)",transition:"height 0.5s ease",opacity:.85}}),(0,i.jsx)("span",{style:{fontSize:11,color:"var(--color-text-muted)",textAlign:"center"},children:e.label}),(0,i.jsxs)("span",{style:{fontSize:10,color:"var(--color-text-muted)"},children:["(",e.cohort_size," clientes)"]})]},t))})]})]}),l.length>0&&(0,i.jsxs)("div",{className:"card",style:{marginTop:20},children:[(0,i.jsx)("div",{className:"card-header",children:(0,i.jsx)("h2",{className:"card-title",children:"Distribuicao de Pedidos por Cliente"})}),(0,i.jsx)("div",{style:{display:"flex",gap:12,flexWrap:"wrap",padding:"8px 0"},children:l.map((e,t)=>{let r=l.reduce((e,t)=>e+parseInt(t.clientes),0),s=r>0?(parseInt(e.clientes)/r*100).toFixed(1):0;return(0,i.jsxs)("div",{style:{flex:1,minWidth:120,padding:"14px 16px",borderRadius:10,background:"var(--color-bg-muted)",textAlign:"center"},children:[(0,i.jsx)("div",{style:{fontSize:20,fontWeight:700},children:e.clientes}),(0,i.jsx)("div",{style:{fontSize:12,color:"var(--color-text-secondary)",marginTop:2},children:e.faixa}),(0,i.jsx)("div",{style:{marginTop:6,height:4,background:"var(--color-border)",borderRadius:2},children:(0,i.jsx)("div",{style:{height:"100%",background:"var(--color-primary)",borderRadius:2,width:"".concat(Math.min(s,100),"%"),transition:"width 0.5s ease"}})}),(0,i.jsxs)("div",{style:{fontSize:11,color:"var(--color-text-muted)",marginTop:4},children:[s,"%"]})]},t)})})]})]})}function f(e){let{clientes:t}=e;if(!t||0===t.length)return(0,i.jsxs)("div",{className:"card",style:{textAlign:"center",padding:40},children:[(0,i.jsx)("div",{style:{fontSize:40,marginBottom:12},children:"\uD83D\uDCCA"}),(0,i.jsx)("p",{style:{color:"var(--color-text-secondary)"},children:"Sem dados de clientes para exibir distribuicao RFM."})]});let r=[0,0,0,0,0],s=[0,0,0,0,0],n=[0,0,0,0,0];t.forEach(e=>{e.recencia>=1&&e.recencia<=5&&r[e.recencia-1]++,e.frequencia>=1&&e.frequencia<=5&&s[e.frequencia-1]++,e.monetario>=1&&e.monetario<=5&&n[e.monetario-1]++});let l=t.length;function o(e){let{label:t,distribution:r,color:s}=e,n=Math.max(...r,1);return(0,i.jsxs)("div",{className:"card",style:{flex:1,minWidth:280},children:[(0,i.jsxs)("div",{className:"card-header",children:[(0,i.jsx)("h2",{className:"card-title",children:t}),(0,i.jsxs)("span",{style:{fontSize:12,color:"var(--color-text-muted)"},children:[l," clientes"]})]}),(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:r.map((e,t)=>{let r=l>0?(e/l*100).toFixed(1):0;return(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10},children:[(0,i.jsxs)("span",{style:{width:60,fontSize:13,fontWeight:500,textAlign:"right"},children:["Score ",t+1]}),(0,i.jsxs)("div",{style:{flex:1,height:24,background:"var(--color-bg-muted)",borderRadius:6,overflow:"hidden",position:"relative"},children:[(0,i.jsx)("div",{style:{height:"100%",background:s,borderRadius:6,opacity:.2+t/5*.8,width:"".concat(Math.max(e/n*100,2),"%"),transition:"width 0.5s ease"}}),(0,i.jsxs)("span",{style:{position:"absolute",right:8,top:"50%",transform:"translateY(-50%)",fontSize:11,fontWeight:600,color:"var(--color-text-secondary)"},children:[e," (",r,"%)"]})]})]},t)})})]})}let a={};return t.forEach(e=>{a[e.segmento]=(a[e.segmento]||0)+1}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:16,marginBottom:20},children:[(0,i.jsx)(o,{label:"Recencia (R)",distribution:r,color:"#3b82f6"}),(0,i.jsx)(o,{label:"Frequencia (F)",distribution:s,color:"#16a34a"}),(0,i.jsx)(o,{label:"Monetario (M)",distribution:n,color:"#f59e0b"})]}),(0,i.jsxs)("div",{className:"card",children:[(0,i.jsx)("div",{className:"card-header",children:(0,i.jsx)("h2",{className:"card-title",children:"Distribuicao por Segmento"})}),(0,i.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:12,justifyContent:"center",padding:"16px 0"},children:Object.entries(c).map(e=>{let[t,r]=e,s=a[t]||0,n=l>0?(s/l*100).toFixed(1):0,o=Math.max(60,Math.min(140,60+s/l*200));return(0,i.jsxs)("div",{style:{width:o,height:o,borderRadius:"50%",background:r.bg,border:"2px solid ".concat(r.border),display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",transition:"all 0.3s ease"},children:[(0,i.jsx)("span",{style:{fontSize:o>80?18:14},children:r.icon}),(0,i.jsx)("span",{style:{fontSize:o>80?16:12,fontWeight:700,color:r.color},children:s}),(0,i.jsxs)("span",{style:{fontSize:o>80?10:8,color:"var(--color-text-muted)"},children:[n,"%"]})]},t)})})]}),(0,i.jsxs)("div",{className:"card",style:{marginTop:20},children:[(0,i.jsxs)("div",{className:"card-header",children:[(0,i.jsx)("h2",{className:"card-title",children:"Todos os Clientes com Score RFM"}),(0,i.jsxs)("span",{style:{fontSize:12,color:"var(--color-text-muted)"},children:[l," clientes"]})]}),(0,i.jsxs)("div",{style:{overflowX:"auto",maxHeight:500},children:[(0,i.jsxs)("table",{className:"table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Cliente"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"R"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"F"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"M"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"RFM"}),(0,i.jsx)("th",{children:"Segmento"}),(0,i.jsx)("th",{style:{textAlign:"right"},children:"Pedidos"}),(0,i.jsx)("th",{style:{textAlign:"right"},children:"Total"}),(0,i.jsx)("th",{style:{textAlign:"right"},children:"Ultimo Pedido"})]})}),(0,i.jsx)("tbody",{children:t.slice(0,50).map(e=>{let t=c[e.segmento]||{};return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{fontWeight:500,maxWidth:160,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.nome}),(0,i.jsx)("td",{style:{textAlign:"center"},children:(0,i.jsx)(m,{score:e.recencia})}),(0,i.jsx)("td",{style:{textAlign:"center"},children:(0,i.jsx)(m,{score:e.frequencia})}),(0,i.jsx)("td",{style:{textAlign:"center"},children:(0,i.jsx)(m,{score:e.monetario})}),(0,i.jsx)("td",{style:{textAlign:"center",fontFamily:"monospace",fontWeight:700,fontSize:14},children:e.rfm_score}),(0,i.jsx)("td",{children:(0,i.jsxs)("span",{style:{display:"inline-flex",alignItems:"center",gap:4,background:t.bg,color:t.color,border:"1px solid ".concat(t.border),borderRadius:20,padding:"2px 8px",fontSize:11,fontWeight:600,whiteSpace:"nowrap"},children:[t.icon," ",t.label]})}),(0,i.jsx)("td",{style:{textAlign:"right"},children:e.total_pedidos}),(0,i.jsx)("td",{style:{textAlign:"right",fontWeight:600},children:x(e.total_gasto)}),(0,i.jsx)("td",{style:{textAlign:"right",color:"var(--color-text-secondary)",fontSize:13},children:h(e.ultimo_pedido)})]},e.customer_id)})})]}),t.length>50&&(0,i.jsxs)("div",{style:{padding:12,textAlign:"center",fontSize:12,color:"var(--color-text-muted)"},children:["Mostrando 50 de ",t.length," clientes"]})]})]})]})}function m(e){let{score:t}=e,r={5:{bg:"#f0fdf4",color:"#16a34a"},4:{bg:"#ecfdf5",color:"#22c55e"},3:{bg:"#fefce8",color:"#ca8a04"},2:{bg:"#fff7ed",color:"#ea580c"},1:{bg:"#fef2f2",color:"#dc2626"}},s=r[t]||r[1];return(0,i.jsx)("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:28,height:28,borderRadius:6,fontSize:13,fontWeight:700,background:s.bg,color:s.color},children:t})}}},function(e){e.O(0,[3448,565,2205,2971,2117,1744],function(){return e(e.s=7748)}),_N_E=e.O()}]);