(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[484],{1776:function(e,t,n){Promise.resolve().then(n.bind(n,6058))},6428:function(e,t,n){"use strict";n.d(t,{Fw:function(){return m},LP:function(){return r},SC:function(){return c},apiDelete:function(){return h},jn:function(){return f},o4:function(){return s},pE:function(){return p},sg:function(){return d},w9:function(){return g},zi:function(){return u}});let a="/api/mercado/partner",o="/api/mercado/parceiro",i="painel_partner_token";function r(){try{return localStorage.getItem(i)}catch(e){return null}}function s(e){try{e?localStorage.setItem(i,e):localStorage.removeItem(i)}catch(e){}}function l(){let e=r();return e?{Authorization:"Bearer ".concat(e)}:{}}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),o=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");o&&(n+="?".concat(o));let i=await fetch(n,{credentials:"include",headers:l()});if(!i.ok){let e=await i.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(i.status," ").concat(i.statusText))}let r=await i.json();if(!r.success)throw Error(r.message||"Erro desconhecido na API");return r.data}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...l()},body:JSON.stringify(t)}),o=await n.json().catch(()=>null);if(!n.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(n.status));return o.data}async function u(e,t){let n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:l(),body:t}),o=await n.json().catch(()=>null);if(!n.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(n.status));return o.data}async function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...l()},body:JSON.stringify(t)}),o=await n.json().catch(()=>null);if(!n.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(n.status));return o.data}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),o=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");o&&(n+="?".concat(o));let i=await fetch(n,{method:"DELETE",credentials:"include",headers:l()}),r=await i.json().catch(()=>null);if(!i.ok||!(null==r?void 0:r.success))throw Error((null==r?void 0:r.message)||"API error: ".concat(i.status));return r.data}async function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(o).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...l()},body:JSON.stringify(t)}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function f(e,t){let n=await fetch("".concat(o).concat(e),{method:"POST",credentials:"include",headers:l(),body:t}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d(e,t)}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return s},a:function(){return l}});var a=n(7437),o=n(2265),i=n(6428);let r=(0,o.createContext)(null);function s(e){let{children:t}=e,[n,s]=(0,o.useState)(null),[l,c]=(0,o.useState)(!0),[d,u]=(0,o.useState)(null),p=(0,o.useCallback)(async()=>{if(!(0,i.LP)()){s(null),c(!1);return}try{let e=await (0,i.SC)("/auth/session.php");e.authenticated&&e.partner?s(e.partner):((0,i.o4)(null),s(null))}catch(e){console.warn("Session check failed (network error), keeping session:",e)}finally{c(!1)}},[]);(0,o.useEffect)(()=>{p()},[p]);let h=(0,o.useCallback)(async(e,t)=>{let n=await (0,i.sg)("/auth/login.php",{email:e,senha:t});if(n.requires_2fa)return u({partner_id:n.partner_id,nome:n.nome,temp_token:n.temp_token}),{requires_2fa:!0};(0,i.o4)(n.token);let a=n.partner||{id:n.partner_id,nome:n.nome,email:n.email,cnpj:n.cnpj,logo:n.logo,categoria:n.categoria,status:n.status};return s(a),u(null),a},[]),m=(0,o.useCallback)(async e=>{if(!d)throw Error("Nenhuma verificacao 2FA pendente");let t=await (0,i.sg)("/auth/totp-verify.php",{temp_token:d.temp_token,code:e});(0,i.o4)(t.token);let n=t.partner||{id:t.partner_id,nome:t.nome,email:t.email,cnpj:t.cnpj,logo:t.logo,categoria:t.categoria,status:t.status};return s(n),u(null),n},[d]),f=(0,o.useCallback)(()=>{u(null)},[]),g=(0,o.useCallback)(e=>{s(t=>t?{...t,...e}:t)},[]),x=(0,o.useCallback)(()=>{(0,i.o4)(null),s(null),u(null)},[]);return(0,a.jsx)(r.Provider,{value:{partner:n,loading:l,isAuthenticated:!!n,twoFactorPending:d,login:h,verifyTotp:m,cancelTotp:f,logout:x,updatePartner:g,refreshSession:p},children:t})}function l(){let e=(0,o.useContext)(r);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},6058:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var a=n(7437),o=n(2265),i=n(9376),r=n(7128),s=n(6428);function l(){return(0,a.jsx)(o.Suspense,{fallback:(0,a.jsx)("div",{className:"loading-screen",children:(0,a.jsx)("div",{className:"spinner"})}),children:(0,a.jsx)(c,{})})}function c(){let{partner:e}=(0,r.a)();(0,i.useRouter)();let t=(0,i.useSearchParams)().get("product_id"),[n,l]=(0,o.useState)([]),[c,d]=(0,o.useState)(null),[u,p]=(0,o.useState)([]),[h,m]=(0,o.useState)(!0),[f,g]=(0,o.useState)(!1),[x,y]=(0,o.useState)(""),[j,v]=(0,o.useState)(""),[b,S]=(0,o.useState)(!1),[w,C]=(0,o.useState)(!1),[k,N]=(0,o.useState)(null),[_,E]=(0,o.useState)(null),[P,z]=(0,o.useState)(null),[I,B]=(0,o.useState)(!1),[A,O]=(0,o.useState)(""),[T,R]=(0,o.useState)(!1),[L,W]=(0,o.useState)(0),[M,q]=(0,o.useState)(1),[G,F]=(0,o.useState)(""),[U,D]=(0,o.useState)(""),[H,J]=(0,o.useState)("");async function $(){try{let e=await (0,s.SC)("/produtos.php");l(e.products||e||[])}catch(e){y(e.message)}finally{m(!1)}}async function Y(e){d(e),g(!0),y("");try{let t=await (0,s.SC)("/opcoes.php",{product_id:e.id});p(t.groups||[])}catch(e){y(e.message),p([])}finally{g(!1)}}function K(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?(N(e),O(e.name),R(e.required),W(e.min_select||0),q(e.max_select||1)):(N(null),O(""),R(!1),W(0),q(1)),S(!0)}async function Q(){if(A.trim()){B(!0),y("");try{k?await (0,s.sg)("/opcoes.php",{action:"update_group",group_id:k.id,name:A,required:T?1:0,min_select:L,max_select:M}):await (0,s.sg)("/opcoes.php",{action:"create_group",product_id:c.id,name:A,required:T?1:0,min_select:L,max_select:M,sort_order:u.length}),S(!1),await Y(c)}catch(e){y(e.message)}finally{B(!1)}}}async function V(e){if(confirm("Excluir este grupo e todas as opcoes?"))try{await (0,s.sg)("/opcoes.php",{action:"delete_group",group_id:e}),await Y(c)}catch(e){y(e.message)}}function X(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;z(e),t?(E(t),F(t.name),D(String(t.price_extra||0)),J(t.description||"")):(E(null),F(""),D(""),J("")),C(!0)}async function Z(){if(G.trim()){B(!0),y("");try{let e=parseFloat(U)||0;_?await (0,s.sg)("/opcoes.php",{action:"update_option",option_id:_.id,name:G,price_extra:e,description:H||void 0}):await (0,s.sg)("/opcoes.php",{action:"create_option",group_id:P,name:G,price_extra:e,description:H||void 0,sort_order:0}),C(!1),await Y(c)}catch(e){y(e.message)}finally{B(!1)}}}async function ee(e){if(confirm("Excluir esta opcao?"))try{await (0,s.sg)("/opcoes.php",{action:"delete_option",option_id:e}),await Y(c)}catch(e){y(e.message)}}async function et(e){try{await (0,s.sg)("/opcoes.php",{action:"toggle_option",option_id:e}),await Y(c)}catch(e){y(e.message)}}(0,o.useEffect)(()=>{$()},[]),(0,o.useEffect)(()=>{if(t&&n.length>0){let e=n.find(e=>String(e.id)===t);e&&Y(e)}},[t,n]);let en=n.filter(e=>{var t;return null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(j.toLowerCase())}),ea=e=>{let t=parseFloat(e);return isNaN(t)?"R$ 0,00":t.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})};return h?(0,a.jsx)("div",{className:"loading-screen",children:(0,a.jsx)("div",{className:"spinner"})}):(0,a.jsxs)("div",{className:"page-container",children:[(0,a.jsx)("div",{className:"page-header",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"page-title",children:"Opcoes de Produto"}),(0,a.jsx)("p",{className:"page-subtitle",children:"Gerencie complementos, tamanhos e adicionais dos seus produtos"})]})}),x&&(0,a.jsxs)("div",{className:"alert alert-error",style:{marginBottom:16},children:[x,(0,a.jsx)("button",{onClick:()=>y(""),style:{marginLeft:8,background:"none",border:"none",cursor:"pointer"},children:"x"})]}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"300px 1fr",gap:24,minHeight:400},children:[(0,a.jsxs)("div",{className:"card",style:{padding:0,overflow:"hidden"},children:[(0,a.jsx)("div",{style:{padding:"12px 16px",borderBottom:"1px solid #e2e8f0"},children:(0,a.jsx)("input",{className:"form-input",placeholder:"Buscar produto...",value:j,onChange:e=>v(e.target.value),style:{fontSize:13}})}),(0,a.jsx)("div",{style:{maxHeight:500,overflowY:"auto"},children:0===en.length?(0,a.jsx)("p",{style:{padding:16,color:"#94a3b8",fontSize:13,textAlign:"center"},children:"Nenhum produto encontrado"}):en.map(e=>(0,a.jsxs)("div",{onClick:()=>Y(e),style:{padding:"10px 16px",cursor:"pointer",borderBottom:"1px solid #f1f5f9",background:(null==c?void 0:c.id)===e.id?"#eff6ff":"transparent",display:"flex",alignItems:"center",gap:10},children:[e.image&&(0,a.jsx)("img",{src:e.image,alt:"",style:{width:36,height:36,borderRadius:8,objectFit:"cover"}}),(0,a.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,a.jsx)("div",{style:{fontSize:13,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e.name}),(0,a.jsx)("div",{style:{fontSize:12,color:"#64748b"},children:ea(e.price)})]})]},e.id))})]}),(0,a.jsx)("div",{children:c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{style:{fontSize:18,fontWeight:600},children:c.name}),(0,a.jsxs)("p",{style:{fontSize:13,color:"#64748b"},children:[u.length," grupo(s) de opcao"]})]}),(0,a.jsx)("button",{className:"btn btn-primary",onClick:()=>K(),children:"+ Novo Grupo"})]}),f?(0,a.jsx)("div",{className:"card",style:{textAlign:"center",padding:32},children:(0,a.jsx)("div",{className:"spinner"})}):0===u.length?(0,a.jsxs)("div",{className:"card",style:{textAlign:"center",padding:32,color:"#94a3b8"},children:[(0,a.jsx)("p",{children:"Nenhum grupo de opcao cadastrado."}),(0,a.jsx)("p",{style:{fontSize:13,marginTop:4},children:'Crie grupos como "Tamanho", "Adicionais", "Bebida" etc.'})]}):u.map(e=>(0,a.jsxs)("div",{className:"card",style:{marginBottom:16,padding:0,overflow:"hidden"},children:[(0,a.jsxs)("div",{style:{padding:"12px 16px",background:"#f8fafc",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontWeight:600,fontSize:15},children:e.name}),(0,a.jsxs)("div",{style:{fontSize:12,color:"#64748b",marginTop:2},children:[e.required?"Obrigatorio":"Opcional"," \xb7 ",e.min_select>0?"Min: ".concat(e.min_select):"",e.min_select>0&&e.max_select>0?" \xb7 ":"",e.max_select>0?"Max: ".concat(e.max_select):""]})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,a.jsx)("button",{onClick:()=>X(e.id),className:"btn btn-sm",style:{fontSize:12,padding:"4px 10px",background:"#2563eb",color:"#fff",border:"none",borderRadius:6,cursor:"pointer"},children:"+ Opcao"}),(0,a.jsx)("button",{onClick:()=>K(e),style:{background:"none",border:"none",cursor:"pointer",color:"#64748b",fontSize:13},children:"Editar"}),(0,a.jsx)("button",{onClick:()=>V(e.id),style:{background:"none",border:"none",cursor:"pointer",color:"#ef4444",fontSize:13},children:"Excluir"})]})]}),0===(e.options||[]).length?(0,a.jsx)("div",{style:{padding:16,color:"#94a3b8",fontSize:13,textAlign:"center"},children:"Nenhuma opcao neste grupo"}):(0,a.jsx)("div",{children:e.options.map(t=>(0,a.jsxs)("div",{style:{padding:"10px 16px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #f1f5f9",opacity:!1===t.available?.5:1},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{style:{fontSize:14,fontWeight:500},children:t.name}),t.description&&(0,a.jsx)("span",{style:{fontSize:12,color:"#94a3b8",marginLeft:8},children:t.description})]}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[t.price_extra>0&&(0,a.jsxs)("span",{style:{fontSize:13,color:"#16a34a",fontWeight:500},children:["+ ",ea(t.price_extra)]}),(0,a.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:4,fontSize:12,color:"#64748b",cursor:"pointer"},children:[(0,a.jsx)("input",{type:"checkbox",checked:!1!==t.available,onChange:()=>et(t.id),style:{accentColor:"#2563eb"}}),"Ativo"]}),(0,a.jsx)("button",{onClick:()=>X(e.id,t),style:{background:"none",border:"none",cursor:"pointer",color:"#64748b",fontSize:12},children:"Editar"}),(0,a.jsx)("button",{onClick:()=>ee(t.id),style:{background:"none",border:"none",cursor:"pointer",color:"#ef4444",fontSize:12},children:"Excluir"})]})]},t.id))})]},e.id))]}):(0,a.jsxs)("div",{className:"card",style:{textAlign:"center",padding:48,color:"#94a3b8"},children:[(0,a.jsx)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",style:{margin:"0 auto 12px"},children:(0,a.jsx)("path",{d:"M4 6h16M4 12h16M4 18h7",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,a.jsx)("p",{children:"Selecione um produto para gerenciar suas opcoes"})]})})]}),b&&(0,a.jsx)("div",{className:"modal-overlay",onClick:()=>S(!1),children:(0,a.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),style:{maxWidth:420},children:[(0,a.jsx)("h3",{style:{fontSize:18,fontWeight:600,marginBottom:16},children:k?"Editar Grupo":"Novo Grupo de Opcao"}),(0,a.jsxs)("div",{style:{marginBottom:12},children:[(0,a.jsx)("label",{className:"form-label",children:"Nome do Grupo *"}),(0,a.jsx)("input",{className:"form-input",placeholder:"Ex: Tamanho, Adicionais, Bebida...",value:A,onChange:e=>O(e.target.value)})]}),(0,a.jsx)("div",{style:{marginBottom:12},children:(0,a.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14,cursor:"pointer"},children:[(0,a.jsx)("input",{type:"checkbox",checked:T,onChange:e=>R(e.target.checked),style:{accentColor:"#2563eb"}}),"Obrigatorio (cliente precisa escolher)"]})}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Min. selecoes"}),(0,a.jsx)("input",{type:"number",className:"form-input",min:0,value:L,onChange:e=>W(parseInt(e.target.value)||0)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Max. selecoes"}),(0,a.jsx)("input",{type:"number",className:"form-input",min:1,value:M,onChange:e=>q(parseInt(e.target.value)||1)})]})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[(0,a.jsx)("button",{className:"btn btn-secondary",onClick:()=>S(!1),children:"Cancelar"}),(0,a.jsx)("button",{className:"btn btn-primary",onClick:Q,disabled:I||!A.trim(),children:I?"Salvando...":k?"Salvar":"Criar Grupo"})]})]})}),w&&(0,a.jsx)("div",{className:"modal-overlay",onClick:()=>C(!1),children:(0,a.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),style:{maxWidth:420},children:[(0,a.jsx)("h3",{style:{fontSize:18,fontWeight:600,marginBottom:16},children:_?"Editar Opcao":"Nova Opcao"}),(0,a.jsxs)("div",{style:{marginBottom:12},children:[(0,a.jsx)("label",{className:"form-label",children:"Nome *"}),(0,a.jsx)("input",{className:"form-input",placeholder:"Ex: Pequeno, Medio, Grande...",value:G,onChange:e=>F(e.target.value)})]}),(0,a.jsxs)("div",{style:{marginBottom:12},children:[(0,a.jsx)("label",{className:"form-label",children:"Preco adicional (R$)"}),(0,a.jsx)("input",{type:"number",className:"form-input",placeholder:"0.00",step:"0.01",min:"0",value:U,onChange:e=>D(e.target.value)})]}),(0,a.jsxs)("div",{style:{marginBottom:16},children:[(0,a.jsx)("label",{className:"form-label",children:"Descricao (opcional)"}),(0,a.jsx)("input",{className:"form-input",placeholder:"Ex: Serve 1-2 pessoas",value:H,onChange:e=>J(e.target.value)})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[(0,a.jsx)("button",{className:"btn btn-secondary",onClick:()=>C(!1),children:"Cancelar"}),(0,a.jsx)("button",{className:"btn btn-primary",onClick:Z,disabled:I||!G.trim(),children:I?"Salvando...":_?"Salvar":"Criar Opcao"})]})]})})]})}},9376:function(e,t,n){"use strict";var a=n(5475);n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}}),n.o(a,"useSearchParams")&&n.d(t,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=1776)}),_N_E=e.O()}]);