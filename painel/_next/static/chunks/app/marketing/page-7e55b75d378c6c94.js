(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[245],{9528:function(e,a,s){Promise.resolve().then(s.bind(s,3781))},3781:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return d}});var t=s(7437),r=s(2265),i=s(4565),c=s(4477),l=s(6428),n=s(6971);function d(){return(0,t.jsx)(i.Z,{children:(0,t.jsx)(c.Z,{children:(0,t.jsx)(o,{})})})}function o(){let{addNotification:e}=(0,n.l)(),[a,s]=(0,r.useState)("deals"),[i,c]=(0,r.useState)([]),[d,o]=(0,r.useState)([]),[h,m]=(0,r.useState)(!0),[p,x]=(0,r.useState)(!1),[u,v]=(0,r.useState)(!1),[g,b]=(0,r.useState)(null),[y,f]=(0,r.useState)(null),[j,_]=(0,r.useState)([]),[N,k]=(0,r.useState)(!1),[S,C]=(0,r.useState)(!1),[w,z]=(0,r.useState)({product_id:"",discount_percent:15,deal_date:new Date().toISOString().split("T")[0]}),[R,O]=(0,r.useState)({enabled:!1,cashback_percent:5,min_order_value:0,max_cashback:50,valid_days:30}),B=e=>{let a=parseFloat(e);return isNaN(a)?"R$ 0,00":a.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})};async function D(){try{let[e,a]=await Promise.all([(0,l.SC)("/daily-deals.php"),(0,l.SC)("/products.php",{page:1,limit:200})]);c(e.deals||[]);let s=a.products||a.items||[];o(s.filter(e=>1===e.status||"1"===e.status))}catch(e){console.error(e)}m(!1)}async function T(){k(!0);try{let e=await (0,l.SC)("/cashback-config.php");e.config&&(b(e.config),O({enabled:e.config.enabled,cashback_percent:e.config.cashback_percent,min_order_value:e.config.min_order_value,max_cashback:e.config.max_cashback,valid_days:e.config.valid_days})),e.stats&&f(e.stats),e.recent_transactions&&_(e.recent_transactions)}catch(e){console.error("Erro ao carregar cashback:",e)}k(!1)}async function E(a){if(a.preventDefault(),!w.product_id){e("Selecione um produto","error");return}v(!0);try{await (0,l.sg)("/daily-deals.php",w),e("Oferta criada!","success"),x(!1),z({product_id:"",discount_percent:15,deal_date:new Date().toISOString().split("T")[0]}),await D()}catch(a){e(a.message||"Erro ao criar oferta","error")}finally{v(!1)}}async function W(a){if(confirm("Remover esta oferta?"))try{await (0,l.apiDelete)("/daily-deals.php?id=".concat(a)),e("Oferta removida","success"),c(e=>e.filter(e=>e.id!==a))}catch(a){e(a.message||"Erro ao remover","error")}}async function A(a){a.preventDefault(),C(!0);try{await (0,l.sg)("/cashback-config.php",{enabled:R.enabled?1:0,cashback_percent:R.cashback_percent,min_order_value:R.min_order_value,max_cashback:R.max_cashback,valid_days:R.valid_days}),e("Configuracao de cashback salva!","success"),await T()}catch(a){e(a.message||"Erro ao salvar","error")}finally{C(!1)}}(0,r.useEffect)(()=>{D()},[]),(0,r.useEffect)(()=>{"cashback"!==a||g||T()},[a]);let I=d.find(e=>String(e.id)===String(w.product_id)),F=I?parseFloat(I.price||I.preco)*(1-w.discount_percent/100):0,P=Math.min(R.cashback_percent/100*50,R.max_cashback);return h?(0,t.jsx)("div",{style:{padding:60,textAlign:"center"},children:(0,t.jsx)("div",{className:"spinner"})}):(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"page-header",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"page-title",children:"Marketing"}),(0,t.jsx)("p",{className:"page-subtitle",children:"Ofertas, promocoes e cashback para fidelizar clientes"})]})}),(0,t.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:24},children:[(0,t.jsx)("button",{className:"btn ".concat("deals"===a?"btn-primary":"btn-secondary"),onClick:()=>s("deals"),children:"Ofertas do Dia"}),(0,t.jsx)("button",{className:"btn ".concat("cashback"===a?"btn-primary":"btn-secondary"),onClick:()=>s("cashback"),children:"Cashback"})]}),"deals"===a&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:16},children:(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>x(!p),children:p?"Cancelar":"+ Nova Oferta"})}),p&&(0,t.jsxs)("div",{className:"card",style:{marginBottom:24},children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h2",{className:"card-title",children:"Nova Oferta do Dia"})}),(0,t.jsxs)("form",{onSubmit:E,style:{maxWidth:500},children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Produto"}),(0,t.jsxs)("select",{className:"form-input",value:w.product_id,onChange:e=>z(a=>({...a,product_id:e.target.value})),children:[(0,t.jsx)("option",{value:"",children:"Selecione um produto..."}),d.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name||e.nome," - ",B(e.price||e.preco)]},e.id))]})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsxs)("label",{className:"form-label",children:["Desconto: ",w.discount_percent,"%"]}),(0,t.jsx)("input",{type:"range",min:"5",max:"70",step:"5",value:w.discount_percent,onChange:e=>z(a=>({...a,discount_percent:parseInt(e.target.value)})),style:{width:"100%"}}),(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:12,color:"var(--color-text-secondary)"},children:[(0,t.jsx)("span",{children:"5%"}),(0,t.jsx)("span",{children:"70%"})]})]}),I&&(0,t.jsxs)("div",{style:{padding:12,background:"#f0fdf4",borderRadius:8,marginBottom:16,fontSize:14},children:[(0,t.jsxs)("div",{children:["Preco original: ",(0,t.jsx)("strong",{children:B(I.price||I.preco)})]}),(0,t.jsxs)("div",{children:["Preco com desconto: ",(0,t.jsx)("strong",{style:{color:"var(--color-success)"},children:B(F)})]})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Data da Oferta"}),(0,t.jsx)("input",{type:"date",className:"form-input",value:w.deal_date,onChange:e=>z(a=>({...a,deal_date:e.target.value})),min:new Date().toISOString().split("T")[0]})]}),(0,t.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:u,children:u?"Criando...":"Criar Oferta"})]})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsxs)("h2",{className:"card-title",children:["Ofertas Ativas (",i.length,")"]})}),0===i.length?(0,t.jsxs)("div",{className:"empty-state",children:[(0,t.jsx)("div",{className:"empty-state-icon",children:(0,t.jsx)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:(0,t.jsx)("path",{d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A2 2 0 013 12V7a4 4 0 014-4z"})})}),(0,t.jsx)("div",{className:"empty-state-text",children:"Nenhuma oferta ativa"}),(0,t.jsx)("p",{style:{color:"var(--color-text-secondary)",fontSize:14},children:"Crie ofertas do dia para atrair mais clientes"})]}):(0,t.jsx)("div",{className:"deal-grid",children:i.map(e=>(0,t.jsxs)("div",{className:"deal-card",children:[e.product_image?(0,t.jsx)("img",{src:e.product_image,alt:e.product_name,className:"deal-card-img"}):(0,t.jsx)("div",{className:"deal-card-img",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,t.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"#cbd5e1",strokeWidth:"1.5",children:[(0,t.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),(0,t.jsx)("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),(0,t.jsx)("path",{d:"m21 15-5-5L5 21"})]})}),(0,t.jsxs)("div",{className:"deal-card-body",children:[(0,t.jsx)("div",{className:"deal-card-name",children:e.product_name}),(0,t.jsxs)("div",{className:"deal-card-prices",children:[(0,t.jsx)("span",{className:"deal-price-original",children:B(e.product_price)}),(0,t.jsx)("span",{className:"deal-price-discount",children:B(e.discount_price)}),(0,t.jsxs)("span",{className:"deal-card-discount-badge",children:["-",Math.round(e.discount_percent),"%"]})]}),(0,t.jsx)("div",{className:"deal-card-date",children:new Date(e.deal_date+"T12:00:00").toLocaleDateString("pt-BR")}),(0,t.jsx)("div",{className:"deal-card-actions",children:(0,t.jsx)("button",{className:"btn btn-danger btn-sm",onClick:()=>W(e.id),children:"Remover"})})]})]},e.id))})]})]}),"cashback"===a&&(0,t.jsx)(t.Fragment,{children:N?(0,t.jsx)("div",{style:{padding:60,textAlign:"center"},children:(0,t.jsx)("div",{className:"spinner"})}):(0,t.jsxs)("div",{style:{display:"grid",gap:24,gridTemplateColumns:"repeat(auto-fit, minmax(350px, 1fr))"},children:[(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h2",{className:"card-title",children:"Configuracao de Cashback"})}),(0,t.jsxs)("form",{onSubmit:A,children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:12,cursor:"pointer"},children:[(0,t.jsx)("input",{type:"checkbox",checked:R.enabled,onChange:e=>O(a=>({...a,enabled:e.target.checked})),style:{width:20,height:20}}),(0,t.jsx)("span",{style:{fontWeight:500,fontSize:16},children:"Ativar Cashback"})]}),(0,t.jsx)("p",{style:{fontSize:13,color:"var(--color-text-secondary)",marginTop:4,marginLeft:32},children:"Clientes recebem % do valor gasto de volta"})]}),(0,t.jsxs)("div",{className:"form-group",style:{opacity:R.enabled?1:.5},children:[(0,t.jsxs)("label",{className:"form-label",children:["Porcentagem de Cashback: ",(0,t.jsxs)("strong",{style:{color:"var(--color-primary)"},children:[R.cashback_percent,"%"]})]}),(0,t.jsx)("input",{type:"range",min:"1",max:"20",step:"1",value:R.cashback_percent,onChange:e=>O(a=>({...a,cashback_percent:parseInt(e.target.value)})),style:{width:"100%"},disabled:!R.enabled}),(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:12,color:"var(--color-text-secondary)"},children:[(0,t.jsx)("span",{children:"1%"}),(0,t.jsx)("span",{children:"20%"})]})]}),(0,t.jsxs)("div",{className:"form-group",style:{opacity:R.enabled?1:.5},children:[(0,t.jsx)("label",{className:"form-label",children:"Valor minimo do pedido (R$)"}),(0,t.jsx)("input",{type:"number",className:"form-input",value:R.min_order_value,onChange:e=>O(a=>({...a,min_order_value:parseFloat(e.target.value)||0})),min:"0",step:"0.01",disabled:!R.enabled}),(0,t.jsx)("p",{style:{fontSize:12,color:"var(--color-text-secondary)",marginTop:4},children:"Pedidos abaixo desse valor nao ganham cashback"})]}),(0,t.jsxs)("div",{className:"form-group",style:{opacity:R.enabled?1:.5},children:[(0,t.jsx)("label",{className:"form-label",children:"Maximo de cashback por pedido (R$)"}),(0,t.jsx)("input",{type:"number",className:"form-input",value:R.max_cashback,onChange:e=>O(a=>({...a,max_cashback:parseFloat(e.target.value)||0})),min:"1",step:"0.01",disabled:!R.enabled})]}),(0,t.jsxs)("div",{className:"form-group",style:{opacity:R.enabled?1:.5},children:[(0,t.jsx)("label",{className:"form-label",children:"Validade do cashback (dias)"}),(0,t.jsx)("input",{type:"number",className:"form-input",value:R.valid_days,onChange:e=>O(a=>({...a,valid_days:parseInt(e.target.value)||30})),min:"1",max:"365",disabled:!R.enabled}),(0,t.jsx)("p",{style:{fontSize:12,color:"var(--color-text-secondary)",marginTop:4},children:"Apos esse periodo, o cashback expira"})]}),R.enabled&&(0,t.jsxs)("div",{style:{padding:16,background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",borderRadius:12,color:"white",marginBottom:16},children:[(0,t.jsx)("div",{style:{fontSize:13,opacity:.9,marginBottom:4},children:"Exemplo de cashback:"}),(0,t.jsxs)("div",{style:{fontSize:18,fontWeight:600},children:["Cliente que gastar R$ ","50.00"," recebe"," ",(0,t.jsxs)("span",{style:{fontSize:24},children:["R$ ",P.toFixed(2)]})," de volta"]})]}),(0,t.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:S,style:{width:"100%"},children:S?"Salvando...":"Salvar Configuracao"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"card",style:{marginBottom:24},children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h2",{className:"card-title",children:"Estatisticas de Cashback"})}),(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:16},children:[(0,t.jsxs)("div",{style:{padding:16,background:"var(--color-bg-secondary)",borderRadius:8,textAlign:"center"},children:[(0,t.jsx)("div",{style:{fontSize:28,fontWeight:700,color:"var(--color-primary)"},children:(null==y?void 0:y.total_customers)||0}),(0,t.jsx)("div",{style:{fontSize:13,color:"var(--color-text-secondary)"},children:"Clientes com cashback"})]}),(0,t.jsxs)("div",{style:{padding:16,background:"var(--color-bg-secondary)",borderRadius:8,textAlign:"center"},children:[(0,t.jsx)("div",{style:{fontSize:28,fontWeight:700,color:"#10b981"},children:B((null==y?void 0:y.total_given)||0)}),(0,t.jsx)("div",{style:{fontSize:13,color:"var(--color-text-secondary)"},children:"Total concedido"})]}),(0,t.jsxs)("div",{style:{padding:16,background:"var(--color-bg-secondary)",borderRadius:8,textAlign:"center"},children:[(0,t.jsx)("div",{style:{fontSize:28,fontWeight:700,color:"#3b82f6"},children:B((null==y?void 0:y.total_used)||0)}),(0,t.jsx)("div",{style:{fontSize:13,color:"var(--color-text-secondary)"},children:"Total utilizado"})]}),(0,t.jsxs)("div",{style:{padding:16,background:"var(--color-bg-secondary)",borderRadius:8,textAlign:"center"},children:[(0,t.jsx)("div",{style:{fontSize:28,fontWeight:700,color:"#f59e0b"},children:B((null==y?void 0:y.net_outstanding)||0)}),(0,t.jsx)("div",{style:{fontSize:13,color:"var(--color-text-secondary)"},children:"Saldo pendente"})]})]})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h2",{className:"card-title",children:"Transacoes Recentes"})}),0===j.length?(0,t.jsx)("div",{className:"empty-state",children:(0,t.jsx)("div",{className:"empty-state-text",children:"Nenhuma transacao ainda"})}):(0,t.jsx)("div",{style:{maxHeight:300,overflowY:"auto"},children:j.map(e=>(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"12px 0",borderBottom:"1px solid var(--color-border)"},children:[(0,t.jsx)("div",{style:{width:36,height:36,borderRadius:"50%",background:"credit"===e.type?"#dcfce7":"debit"===e.type?"#dbeafe":"#fee2e2",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18},children:"credit"===e.type?"+":"debit"===e.type?"-":"x"}),(0,t.jsxs)("div",{style:{flex:1},children:[(0,t.jsx)("div",{style:{fontWeight:500,fontSize:14},children:e.customer_name}),(0,t.jsx)("div",{style:{fontSize:12,color:"var(--color-text-secondary)"},children:e.description||(e.order_number?"Pedido #".concat(e.order_number):"-")})]}),(0,t.jsxs)("div",{style:{fontWeight:600,color:"credit"===e.type?"#10b981":"debit"===e.type?"#3b82f6":"#ef4444"},children:["credit"===e.type?"+":"-","R$ ",parseFloat(e.amount).toFixed(2)]})]},e.id))})]})]})]})})]})}}},function(e){e.O(0,[3448,565,2205,2971,2117,1744],function(){return e(e.s=9528)}),_N_E=e.O()}]);