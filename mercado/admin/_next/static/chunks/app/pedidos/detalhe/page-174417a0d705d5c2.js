(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1804],{8695:function(e,a,s){Promise.resolve().then(s.bind(s,6440))},4445:function(e,a,s){"use strict";s.d(a,{Z:function(){return t}});var l=s(7437),n=s(8253);function t(e){let{section:a,children:s}=e,{hasPermission:t}=(0,n.q)();return t(a)?(0,l.jsx)(l.Fragment,{children:s}):(0,l.jsxs)("div",{className:"role-denied",children:[(0,l.jsx)("div",{className:"role-denied-icon",children:"\uD83D\uDD12"}),(0,l.jsx)("h2",{children:"Acesso Negado"}),(0,l.jsx)("p",{children:"Voce nao tem permissao para acessar esta secao."}),(0,l.jsx)("p",{className:"role-denied-hint",children:"Contate o administrador para solicitar acesso."})]})}},1656:function(e,a,s){"use strict";s.d(a,{X:function(){return i},Z:function(){return t}});var l=s(7437);let n={success:"badge-success",warning:"badge-warning",danger:"badge-danger",info:"badge-info",neutral:"badge-neutral"};function t(e){let{label:a,variant:s="neutral"}=e;return(0,l.jsx)("span",{className:"badge ".concat(n[s]||n.neutral),children:a})}function i(e){return({pendente:"warning",confirmado:"info",preparando:"info",pronto:"info",coletado:"info",em_entrega:"warning",entregue:"success",cancelado:"danger",recusado:"danger",ativo:"success",inativo:"neutral",bloqueado:"danger",online:"success",offline:"neutral",aprovado:"success",reprovado:"danger",pago:"success",pendente_pagamento:"warning",processando:"info",aberto:"warning",resolvido:"success",fechado:"neutral"})[e]||"neutral"}},7714:function(e,a,s){"use strict";s.d(a,{Z:function(){return i}});var l=s(7437),n=s(2265);let t={sm:"400px",md:"560px",lg:"720px",xl:"960px"};function i(e){let{isOpen:a,onClose:s,title:i,children:d,size:c="md"}=e;return((0,n.useEffect)(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[a]),(0,n.useEffect)(()=>{let e=e=>{"Escape"===e.key&&a&&(null==s||s())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a,s]),a)?(0,l.jsx)("div",{className:"modal-overlay",onClick:s,children:(0,l.jsxs)("div",{className:"modal-container",style:{maxWidth:t[c]||t.md},onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"modal-header",children:[(0,l.jsx)("h3",{className:"modal-title",children:i}),(0,l.jsx)("button",{className:"modal-close",onClick:s,children:"✕"})]}),(0,l.jsx)("div",{className:"modal-body",children:d})]})}):null}},3378:function(e,a,s){"use strict";s.d(a,{Z:function(){return n}});var l=s(7437);function n(e){let{tabs:a=[],activeTab:s,onChange:n}=e;return(0,l.jsx)("div",{className:"tabs",children:a.map(e=>(0,l.jsx)("button",{className:"tab-btn ".concat(s===e.key?"tab-active":""),onClick:()=>n(e.key),children:e.label},e.key))})}},6939:function(e,a,s){"use strict";s.d(a,{Z:function(){return i}});var l=s(7437),n=s(6971);let t={success:"&#10003;",error:"&#10007;",warning:"&#9888;",info:"&#8505;"};function i(){let{toasts:e,removeToast:a}=(0,n.l)();return 0===e.length?null:(0,l.jsx)("div",{className:"toast-container",children:e.map(e=>(0,l.jsxs)("div",{className:"toast toast-".concat(e.type),children:[(0,l.jsx)("span",{className:"toast-icon",dangerouslySetInnerHTML:{__html:t[e.type]||t.info}}),(0,l.jsx)("span",{className:"toast-message",children:e.message}),(0,l.jsx)("button",{className:"toast-close",onClick:()=>a(e.id),children:"✕"})]},e.id))})}},6440:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return b}});var l=s(7437),n=s(2265),t=s(9376),i=s(8779),d=s(4477),c=s(4445),r=s(1656),o=s(7714),m=s(3378),u=s(6939),h=s(8789),x=s(6971),j=s(6428);let p=["pendente","confirmado","preparando","pronto","coletado","em_entrega","entregue","cancelado"];function v(){let e=(0,t.useSearchParams)(),a=(0,t.useRouter)(),s=e.get("id"),{collapsed:i}=(0,h.A)(),{success:c,error:v}=(0,x.l)(),[N,b]=(0,n.useState)(null),[f,g]=(0,n.useState)([]),[y,_]=(0,n.useState)([]),[C,k]=(0,n.useState)([]),[S,w]=(0,n.useState)(!0),[E,Z]=(0,n.useState)("info"),[P,R]=(0,n.useState)(!1),[A,T]=(0,n.useState)(!1),[q,D]=(0,n.useState)(""),[z,I]=(0,n.useState)(""),[L,O]=(0,n.useState)(""),[V,F]=(0,n.useState)(""),[M,X]=(0,n.useState)(!1);(0,n.useEffect)(()=>{s&&$()},[s]);let $=async()=>{w(!0);try{let[a,l,n,t]=await Promise.allSettled([(0,j.SC)("/order.php?id=".concat(s)),(0,j.SC)("/order-timeline.php?id=".concat(s)),(0,j.SC)("/order-notes.php?id=".concat(s)),(0,j.SC)("/order-chat.php?id=".concat(s))]);if("fulfilled"===a.status){var e;b(a.value.order||a.value),D((null===(e=a.value.order)||void 0===e?void 0:e.status)||a.value.status||"")}"fulfilled"===l.status&&g(l.value.timeline||l.value.data||[]),"fulfilled"===n.status&&_(n.value.notes||n.value.data||[]),"fulfilled"===t.status&&k(t.value.messages||t.value.data||[])}catch(e){v("Erro ao carregar pedido")}finally{w(!1)}},B=async()=>{if(q){X(!0);try{await (0,j.sg)("/order-status.php",{order_id:s,status:q}),c("Status atualizado com sucesso"),R(!1),$()}catch(e){v("Erro ao atualizar status: "+e.message)}finally{X(!1)}}},H=async()=>{if(L){X(!0);try{await (0,j.sg)("/order-refund.php",{order_id:s,reason:L,amount:V||void 0}),c("Reembolso solicitado com sucesso"),T(!1),O(""),F(""),$()}catch(e){v("Erro ao solicitar reembolso: "+e.message)}finally{X(!1)}}},K=async()=>{if(z.trim())try{await (0,j.sg)("/order-notes.php",{order_id:s,note:z}),c("Nota adicionada"),I(""),$()}catch(e){v("Erro ao adicionar nota: "+e.message)}},Q=e=>null==e?"R$ 0,00":"R$ ".concat(Number(e).toLocaleString("pt-BR",{minimumFractionDigits:2}));return s?(0,l.jsxs)("div",{className:"admin-layout",children:[(0,l.jsx)(d.Z,{}),(0,l.jsxs)("main",{className:"admin-main ".concat(i?"main-collapsed":""),children:[(0,l.jsxs)("div",{className:"page-header",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("h1",{className:"page-title",children:["Pedido #",s,N&&(0,l.jsx)(r.Z,{label:N.status||"pendente",variant:(0,r.X)(N.status)})]}),(0,l.jsx)("p",{className:"page-subtitle",children:(null==N?void 0:N.created_at)||""})]}),(0,l.jsxs)("div",{className:"page-actions",children:[(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>a.push("/pedidos/"),children:"Voltar"}),(0,l.jsx)("button",{className:"btn btn-primary",onClick:()=>R(!0),children:"Alterar Status"}),(0,l.jsx)("button",{className:"btn btn-danger",onClick:()=>T(!0),children:"Reembolso"})]})]}),S?(0,l.jsx)("div",{className:"card",children:(0,l.jsx)("div",{className:"datatable-skeleton",children:[...Array(6)].map((e,a)=>(0,l.jsxs)("div",{className:"skeleton-row",children:[(0,l.jsx)("div",{className:"skeleton-cell"}),(0,l.jsx)("div",{className:"skeleton-cell"})]},a))})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(m.Z,{tabs:[{key:"info",label:"Informacoes"},{key:"items",label:"Itens"},{key:"timeline",label:"Timeline"},{key:"notes",label:"Notas"},{key:"chat",label:"Chat"}],activeTab:E,onChange:Z}),"info"===E&&(0,l.jsxs)("div",{className:"grid-2 gap-4",children:[(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{className:"card-title mb-4",children:"Pedido"}),(0,l.jsxs)("div",{className:"detail-grid",children:[(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"ID"}),(0,l.jsxs)("span",{className:"detail-value",children:["#",(null==N?void 0:N.id)||(null==N?void 0:N.order_id)]})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Status"}),(0,l.jsx)("span",{className:"detail-value",children:(0,l.jsx)(r.Z,{label:(null==N?void 0:N.status)||"pendente",variant:(0,r.X)(null==N?void 0:N.status)})})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Total"}),(0,l.jsx)("span",{className:"detail-value",children:Q(null==N?void 0:N.total)})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Taxa Entrega"}),(0,l.jsx)("span",{className:"detail-value",children:Q((null==N?void 0:N.delivery_fee)||(null==N?void 0:N.taxa_entrega))})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Criado em"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.created_at)||"-"})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Atualizado em"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.updated_at)||"-"})]})]})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{className:"card-title mb-4",children:"Cliente"}),(0,l.jsxs)("div",{className:"detail-grid",children:[(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Nome"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.cliente_nome)||(null==N?void 0:N.customer_name)||"-"})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Telefone"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.cliente_telefone)||(null==N?void 0:N.customer_phone)||"-"})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Endereco"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.endereco)||(null==N?void 0:N.address)||"-"})]})]})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{className:"card-title mb-4",children:"Parceiro"}),(0,l.jsxs)("div",{className:"detail-grid",children:[(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Nome"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.parceiro_nome)||(null==N?void 0:N.partner_name)||"-"})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Tipo"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.parceiro_tipo)||(null==N?void 0:N.partner_type)||"-"})]})]})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{className:"card-title mb-4",children:"Shopper"}),(0,l.jsxs)("div",{className:"detail-grid",children:[(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Nome"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.shopper_nome)||(null==N?void 0:N.shopper_name)||"-"})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Telefone"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.shopper_telefone)||(null==N?void 0:N.shopper_phone)||"-"})]})]})]})]}),"items"===E&&(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{className:"card-title mb-4",children:"Itens do Pedido"}),(0,l.jsx)("div",{className:"datatable-wrapper",children:(0,l.jsxs)("table",{className:"datatable-table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Produto"}),(0,l.jsx)("th",{children:"Qtd"}),(0,l.jsx)("th",{children:"Preco Unit."}),(0,l.jsx)("th",{children:"Subtotal"})]})}),(0,l.jsx)("tbody",{children:0===((null==N?void 0:N.items)||(null==N?void 0:N.itens)||[]).length?(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:4,className:"datatable-empty",children:"Nenhum item"})}):((null==N?void 0:N.items)||(null==N?void 0:N.itens)||[]).map((e,a)=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:e.produto_nome||e.product_name||e.name||"-"}),(0,l.jsx)("td",{children:e.quantidade||e.qty||e.quantity||0}),(0,l.jsx)("td",{children:Q(e.preco||e.price)}),(0,l.jsx)("td",{children:Q((e.preco||e.price||0)*(e.quantidade||e.qty||e.quantity||0))})]},a))})]})})]}),"timeline"===E&&(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{className:"card-title mb-4",children:"Timeline"}),0===f.length?(0,l.jsx)("p",{className:"text-muted",children:"Nenhum evento registrado"}):(0,l.jsx)("div",{className:"timeline",children:f.map((e,a)=>(0,l.jsxs)("div",{className:"timeline-item",children:[(0,l.jsx)("div",{className:"timeline-item-time",children:e.created_at||e.time||e.data}),(0,l.jsx)("div",{className:"timeline-item-text",children:e.description||e.descricao||e.text})]},a))})]}),"notes"===E&&(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{className:"card-title mb-4",children:"Notas"}),(0,l.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,l.jsx)("input",{type:"text",className:"form-input",placeholder:"Adicionar nota...",value:z,onChange:e=>I(e.target.value),onKeyDown:e=>"Enter"===e.key&&K()}),(0,l.jsx)("button",{className:"btn btn-primary",onClick:K,children:"Adicionar"})]}),0===y.length?(0,l.jsx)("p",{className:"text-muted",children:"Nenhuma nota"}):(0,l.jsx)("div",{className:"flex flex-col gap-3",children:y.map((e,a)=>(0,l.jsxs)("div",{style:{padding:"12px",background:"var(--bg)",borderRadius:"var(--radius)",border:"1px solid var(--border)"},children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("span",{className:"font-semibold text-sm",children:e.admin_name||e.author||"Admin"}),(0,l.jsx)("span",{className:"text-xs text-dim",children:e.created_at||e.data||""})]}),(0,l.jsx)("p",{className:"text-sm",children:e.note||e.text||e.content})]},a))})]}),"chat"===E&&(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{className:"card-title mb-4",children:"Chat do Pedido"}),0===C.length?(0,l.jsx)("p",{className:"text-muted",children:"Nenhuma mensagem"}):(0,l.jsx)("div",{className:"chat-messages",children:C.map((e,a)=>(0,l.jsxs)("div",{className:"chat-msg ".concat("admin"===e.sender_type?"chat-msg-sent":"chat-msg-received"),children:[(0,l.jsx)("span",{className:"chat-msg-sender",children:e.sender_name||e.sender||""}),(0,l.jsx)("div",{className:"chat-bubble",children:e.message||e.text||e.content}),(0,l.jsx)("span",{className:"chat-msg-time",children:e.created_at||e.time||""})]},a))})]})]}),(0,l.jsxs)(o.Z,{isOpen:P,onClose:()=>R(!1),title:"Alterar Status",size:"sm",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{className:"form-label",children:"Novo Status"}),(0,l.jsx)("select",{className:"form-select",value:q,onChange:e=>D(e.target.value),children:p.map(e=>(0,l.jsx)("option",{value:e,children:e},e))})]}),(0,l.jsxs)("div",{className:"flex gap-2",style:{justifyContent:"flex-end"},children:[(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>R(!1),children:"Cancelar"}),(0,l.jsx)("button",{className:"btn btn-primary",onClick:B,disabled:M,children:M?"Salvando...":"Confirmar"})]})]}),(0,l.jsxs)(o.Z,{isOpen:A,onClose:()=>T(!1),title:"Solicitar Reembolso",size:"sm",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{className:"form-label",children:"Motivo"}),(0,l.jsx)("textarea",{className:"form-textarea",value:L,onChange:e=>O(e.target.value),placeholder:"Motivo do reembolso..."})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{className:"form-label",children:"Valor (opcional, vazio = total)"}),(0,l.jsx)("input",{type:"number",className:"form-input",value:V,onChange:e=>F(e.target.value),placeholder:"R$ 0,00",step:"0.01"})]}),(0,l.jsxs)("div",{className:"flex gap-2",style:{justifyContent:"flex-end"},children:[(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>T(!1),children:"Cancelar"}),(0,l.jsx)("button",{className:"btn btn-danger",onClick:H,disabled:M,children:M?"Processando...":"Confirmar Reembolso"})]})]})]}),(0,l.jsx)(u.Z,{})]}):(0,l.jsxs)("div",{className:"admin-layout",children:[(0,l.jsx)(d.Z,{}),(0,l.jsx)("main",{className:"admin-main ".concat(i?"main-collapsed":""),children:(0,l.jsxs)("div",{className:"role-denied",children:[(0,l.jsx)("h2",{children:"Pedido nao encontrado"}),(0,l.jsx)("p",{children:"Nenhum ID de pedido fornecido."}),(0,l.jsx)("button",{className:"btn btn-primary mt-4",onClick:()=>a.push("/pedidos/"),children:"Voltar para Pedidos"})]})})]})}function N(){return(0,l.jsx)(n.Suspense,{fallback:(0,l.jsxs)("div",{className:"auth-loading",children:[(0,l.jsx)("div",{className:"auth-loading-spinner"}),(0,l.jsx)("p",{children:"Carregando..."})]}),children:(0,l.jsx)(v,{})})}function b(){return(0,l.jsx)(i.Z,{children:(0,l.jsx)(c.Z,{section:"orders",children:(0,l.jsx)(N,{})})})}}},function(e){e.O(0,[3448,1006,2971,2117,1744],function(){return e(e.s=8695)}),_N_E=e.O()}]);