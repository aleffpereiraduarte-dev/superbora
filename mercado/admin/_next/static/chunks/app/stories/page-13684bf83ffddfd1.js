(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2747],{920:function(e,t,n){Promise.resolve().then(n.bind(n,6816))},6428:function(e,t,n){"use strict";n.d(t,{LP:function(){return r},QW:function(){return u},SC:function(){return c},o4:function(){return i},pE:function(){return d},sg:function(){return l}});let a="/api/mercado/admin",s="admin_token";function r(){try{return localStorage.getItem(s)}catch(e){return null}}function i(e){try{e?localStorage.setItem(s,e):localStorage.removeItem(s)}catch(e){}}function o(){let e=r(),t={"Content-Type":"application/json"};return e&&(t.Authorization="Bearer ".concat(e)),t}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),s=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");s&&(n+="?".concat(s));let r=await fetch(n,{headers:o()});if(!r.ok)throw Error((await r.json().catch(()=>({message:"Erro de rede"}))).message||"HTTP ".concat(r.status));let i=await r.json();if(!1===i.success)throw Error(i.message||"Erro desconhecido");return void 0!==i.data?i.data:i}async function l(e,t){let n=await fetch("".concat(a).concat(e),{method:"POST",headers:o(),body:JSON.stringify(t)}),s=await n.json().catch(()=>null);if(!n.ok||s&&!1===s.success)throw Error((null==s?void 0:s.message)||"HTTP ".concat(n.status));return(null==s?void 0:s.data)!==void 0?s.data:s}async function d(e,t){let n=await fetch("".concat(a).concat(e),{method:"PUT",headers:o(),body:JSON.stringify(t)}),s=await n.json().catch(()=>null);if(!n.ok||s&&!1===s.success)throw Error((null==s?void 0:s.message)||"HTTP ".concat(n.status));return(null==s?void 0:s.data)!==void 0?s.data:s}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),s=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");s&&(n+="?".concat(s));let r=await fetch(n,{method:"DELETE",headers:o()}),i=await r.json().catch(()=>null);if(!r.ok||i&&!1===i.success)throw Error((null==i?void 0:i.message)||"HTTP ".concat(r.status));return(null==i?void 0:i.data)!==void 0?i.data:i}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return o},a:function(){return c}});var a=n(7437),s=n(2265),r=n(6428);let i=(0,s.createContext)(null);function o(e){let{children:t}=e,[n,o]=(0,s.useState)(null),[c,l]=(0,s.useState)(!0),d=(0,s.useCallback)(async()=>{if(!(0,r.LP)()){l(!1);return}try{let e=await (0,r.SC)("/auth/session.php");e.admin?o({...e.admin,name:e.admin.nome||e.admin.name,admin_id:e.admin.admin_id||e.admin.id}):((0,r.o4)(null),o(null))}catch(e){(0,r.o4)(null),o(null)}finally{l(!1)}},[]);(0,s.useEffect)(()=>{d()},[d]);let u=async(e,t)=>{let n=await (0,r.sg)("/auth/login.php",{email:e,senha:t});if(n.token)return(0,r.o4)(n.token),o({admin_id:n.admin_id,name:n.nome||n.name,email:n.email,role:n.role}),n;throw Error(n.message||"Erro ao fazer login")};return(0,a.jsx)(i.Provider,{value:{admin:n,loading:c,isAuthenticated:!!n,login:u,logout:()=>{(0,r.o4)(null),o(null)},checkSession:d},children:t})}function c(){let e=(0,s.useContext)(i);if(!e)throw Error("useAuth must be inside AuthProvider");return e}},6816:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var a=n(7437),s=n(2265),r=n(7128);let i=n(257).env.NEXT_PUBLIC_API_URL||"https://espocopi.com/api/mercado";function o(){let{token:e}=(0,r.a)(),[t,n]=(0,s.useState)(!0),[o,c]=(0,s.useState)([]),[l,d]=(0,s.useState)(null),[u,h]=(0,s.useState)(null),[m,p]=(0,s.useState)({status:"pending",page:1}),[v,f]=(0,s.useState)([]),[j,g]=(0,s.useState)(null),x=(0,s.useCallback)(async()=>{if(e){n(!0);try{let t=new URLSearchParams;t.append("status",m.status),t.append("page",m.page);let n=await fetch("".concat(i,"/admin/stories.php?").concat(t),{headers:{Authorization:"Bearer ".concat(e)}}),a=await n.json();a.success&&(c(a.data.stories),d(a.data.stats),h(a.data.pagination))}catch(e){console.error("Erro:",e)}finally{n(!1)}}},[e,m]);(0,s.useEffect)(()=>{x()},[x]);let y=async function(t,n){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let s=await fetch("".concat(i,"/admin/stories.php"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({action:t,story_id:n,...a})}),r=await s.json();r.success?(x(),f([])):alert(r.error||"Erro")}catch(e){alert("Erro ao executar acao")}},b=async t=>{if(0===v.length){alert("Selecione ao menos um story");return}let n="bulk_reject"===t?prompt("Motivo da rejeicao:"):null,a=n?n.replace(/<[^>]*>/g,"").trim():null;try{let n=await fetch("".concat(i,"/admin/stories.php"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({action:t,story_ids:v,reason:a})}),s=await n.json();alert(s.message||(s.success?"Sucesso!":"Erro")),s.success&&(x(),f([]))}catch(e){alert("Erro ao executar acao em lote")}},N=e=>{f(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},w=e=>(0,a.jsx)("span",{className:"badge",style:{backgroundColor:{active:"#22c55e",pending:"#f59e0b",rejected:"#ef4444",expired:"#6b7280"}[e]},children:e});return(0,a.jsxs)("div",{className:"page-container",children:[(0,a.jsx)("div",{className:"page-header",children:(0,a.jsx)("h1",{children:"Moderacao de Stories"})}),l&&(0,a.jsxs)("div",{className:"stats-grid",children:[(0,a.jsxs)("div",{className:"stat-card warning",children:[(0,a.jsx)("div",{className:"stat-value",children:l.pending}),(0,a.jsx)("div",{className:"stat-label",children:"Pendentes"})]}),(0,a.jsxs)("div",{className:"stat-card success",children:[(0,a.jsx)("div",{className:"stat-value",children:l.active}),(0,a.jsx)("div",{className:"stat-label",children:"Ativos"})]}),(0,a.jsxs)("div",{className:"stat-card danger",children:[(0,a.jsx)("div",{className:"stat-value",children:l.rejected}),(0,a.jsx)("div",{className:"stat-label",children:"Rejeitados"})]}),(0,a.jsxs)("div",{className:"stat-card",children:[(0,a.jsx)("div",{className:"stat-value",children:l.expired}),(0,a.jsx)("div",{className:"stat-label",children:"Expirados"})]})]}),(0,a.jsxs)("div",{className:"filters-bar",children:[(0,a.jsxs)("select",{value:m.status,onChange:e=>p({...m,status:e.target.value,page:1}),children:[(0,a.jsx)("option",{value:"all",children:"Todos"}),(0,a.jsx)("option",{value:"pending",children:"Pendentes"}),(0,a.jsx)("option",{value:"active",children:"Ativos"}),(0,a.jsx)("option",{value:"rejected",children:"Rejeitados"}),(0,a.jsx)("option",{value:"expired",children:"Expirados"})]}),v.length>0&&(0,a.jsxs)("div",{className:"bulk-actions",children:[(0,a.jsxs)("span",{children:[v.length," selecionados"]}),(0,a.jsx)("button",{className:"btn btn-success btn-small",onClick:()=>b("bulk_approve"),children:"Aprovar"}),(0,a.jsx)("button",{className:"btn btn-danger btn-small",onClick:()=>b("bulk_reject"),children:"Rejeitar"})]})]}),t?(0,a.jsx)("div",{className:"loading",children:"Carregando..."}):(0,a.jsxs)("div",{className:"stories-grid",children:[(0,a.jsx)("div",{className:"stories-header",children:(0,a.jsxs)("label",{className:"checkbox-label",children:[(0,a.jsx)("input",{type:"checkbox",checked:v.length===o.length&&o.length>0,onChange:()=>{v.length===o.length?f([]):f(o.map(e=>e.id))}}),"Selecionar todos"]})}),o.map(e=>(0,a.jsxs)("div",{className:"story-card ".concat(v.includes(e.id)?"selected":""),children:[(0,a.jsx)("div",{className:"story-checkbox",children:(0,a.jsx)("input",{type:"checkbox",checked:v.includes(e.id),onChange:()=>N(e.id)})}),(0,a.jsxs)("div",{className:"story-media",onClick:()=>g(e),children:["video"===e.media_type?(0,a.jsx)("video",{src:e.media_url}):(0,a.jsx)("img",{src:e.thumbnail_url||e.media_url,alt:""}),(0,a.jsx)("div",{className:"story-overlay",children:(0,a.jsx)("span",{className:"play-icon",children:"video"===e.media_type?"â–¶":"\uD83D\uDD0D"})})]}),(0,a.jsxs)("div",{className:"story-info",children:[(0,a.jsxs)("div",{className:"story-partner",children:[e.partner_logo&&(0,a.jsx)("img",{src:e.partner_logo,alt:"",className:"partner-logo-small"}),(0,a.jsx)("span",{children:e.partner_name})]}),e.caption&&(0,a.jsx)("p",{className:"story-caption",children:e.caption}),(0,a.jsxs)("div",{className:"story-meta",children:[(0,a.jsxs)("span",{children:[e.view_count||0," views"]}),(0,a.jsx)("span",{children:new Date(e.created_at).toLocaleDateString("pt-BR")})]}),(0,a.jsx)("div",{className:"story-status",children:w(e.status)})]}),(0,a.jsxs)("div",{className:"story-actions",children:["pending"===e.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{className:"btn btn-success btn-small",onClick:()=>y("approve",e.id),children:"Aprovar"}),(0,a.jsx)("button",{className:"btn btn-danger btn-small",onClick:()=>{let t=prompt("Motivo da rejeicao:");t&&y("reject",e.id,{reason:t.replace(/<[^>]*>/g,"").trim()})},children:"Rejeitar"})]}),"active"===e.status&&(0,a.jsx)("button",{className:"btn btn-danger btn-small",onClick:()=>{confirm("Remover este story?")&&y("delete",e.id)},children:"Remover"})]})]},e.id))]}),u&&(0,a.jsxs)("div",{className:"pagination",children:[(0,a.jsx)("button",{disabled:1===m.page,onClick:()=>p({...m,page:m.page-1}),children:"Anterior"}),(0,a.jsxs)("span",{children:["Pagina ",m.page," de ",u.pages]}),(0,a.jsx)("button",{disabled:m.page>=u.pages,onClick:()=>p({...m,page:m.page+1}),children:"Proxima"})]}),j&&(0,a.jsx)("div",{className:"modal-overlay",onClick:()=>g(null),children:(0,a.jsxs)("div",{className:"modal-content story-preview",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("button",{className:"modal-close",onClick:()=>g(null),children:"\xd7"}),"video"===j.media_type?(0,a.jsx)("video",{src:j.media_url,controls:!0,autoPlay:!0,className:"story-preview-media"}):(0,a.jsx)("img",{src:j.media_url,alt:"",className:"story-preview-media"}),(0,a.jsxs)("div",{className:"story-preview-info",children:[(0,a.jsx)("h3",{children:j.partner_name}),j.caption&&(0,a.jsx)("p",{children:j.caption})]})]})})]})}},257:function(e,t,n){"use strict";var a,s;e.exports=(null==(a=n.g.process)?void 0:a.env)&&"object"==typeof(null==(s=n.g.process)?void 0:s.env)?n.g.process:n(4227)},4227:function(e){!function(){var t={229:function(e){var t,n,a,s=e.exports={};function r(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var c=[],l=!1,d=-1;function u(){l&&a&&(l=!1,a.length?c=a.concat(c):d=-1,c.length&&h())}function h(){if(!l){var e=o(u);l=!0;for(var t=c.length;t;){for(a=c,c=[];++d<t;)a&&a[d].run();d=-1,t=c.length}a=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function p(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new m(e,t)),1!==c.length||l||o(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=p,s.addListener=p,s.once=p,s.off=p,s.removeListener=p,s.removeAllListeners=p,s.emit=p,s.prependListener=p,s.prependOnceListener=p,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},n={};function a(e){var s=n[e];if(void 0!==s)return s.exports;var r=n[e]={exports:{}},i=!0;try{t[e](r,r.exports,a),i=!1}finally{i&&delete n[e]}return r.exports}a.ab="//";var s=a(229);e.exports=s}()}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=920)}),_N_E=e.O()}]);