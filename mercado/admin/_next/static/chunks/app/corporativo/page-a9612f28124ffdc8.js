(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5234],{9504:function(e,t,n){Promise.resolve().then(n.bind(n,7584))},6428:function(e,t,n){"use strict";n.d(t,{LP:function(){return c},QW:function(){return u},SC:function(){return o},o4:function(){return i},pE:function(){return d},sg:function(){return l}});let a="/api/mercado/admin",s="admin_token";function c(){try{return localStorage.getItem(s)}catch(e){return null}}function i(e){try{e?localStorage.setItem(s,e):localStorage.removeItem(s)}catch(e){}}function r(){let e=c(),t={"Content-Type":"application/json"};return e&&(t.Authorization="Bearer ".concat(e)),t}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),s=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");s&&(n+="?".concat(s));let c=await fetch(n,{headers:r()});if(!c.ok)throw Error((await c.json().catch(()=>({message:"Erro de rede"}))).message||"HTTP ".concat(c.status));let i=await c.json();if(!1===i.success)throw Error(i.message||"Erro desconhecido");return void 0!==i.data?i.data:i}async function l(e,t){let n=await fetch("".concat(a).concat(e),{method:"POST",headers:r(),body:JSON.stringify(t)}),s=await n.json().catch(()=>null);if(!n.ok||s&&!1===s.success)throw Error((null==s?void 0:s.message)||"HTTP ".concat(n.status));return(null==s?void 0:s.data)!==void 0?s.data:s}async function d(e,t){let n=await fetch("".concat(a).concat(e),{method:"PUT",headers:r(),body:JSON.stringify(t)}),s=await n.json().catch(()=>null);if(!n.ok||s&&!1===s.success)throw Error((null==s?void 0:s.message)||"HTTP ".concat(n.status));return(null==s?void 0:s.data)!==void 0?s.data:s}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),s=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");s&&(n+="?".concat(s));let c=await fetch(n,{method:"DELETE",headers:r()}),i=await c.json().catch(()=>null);if(!c.ok||i&&!1===i.success)throw Error((null==i?void 0:i.message)||"HTTP ".concat(c.status));return(null==i?void 0:i.data)!==void 0?i.data:i}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return r},a:function(){return o}});var a=n(7437),s=n(2265),c=n(6428);let i=(0,s.createContext)(null);function r(e){let{children:t}=e,[n,r]=(0,s.useState)(null),[o,l]=(0,s.useState)(!0),d=(0,s.useCallback)(async()=>{if(!(0,c.LP)()){l(!1);return}try{let e=await (0,c.SC)("/auth/session.php");e.admin?r({...e.admin,name:e.admin.nome||e.admin.name,admin_id:e.admin.admin_id||e.admin.id}):((0,c.o4)(null),r(null))}catch(e){(0,c.o4)(null),r(null)}finally{l(!1)}},[]);(0,s.useEffect)(()=>{d()},[d]);let u=async(e,t)=>{let n=await (0,c.sg)("/auth/login.php",{email:e,senha:t});if(n.token)return(0,c.o4)(n.token),r({admin_id:n.admin_id,name:n.nome||n.name,email:n.email,role:n.role}),n;throw Error(n.message||"Erro ao fazer login")};return(0,a.jsx)(i.Provider,{value:{admin:n,loading:o,isAuthenticated:!!n,login:u,logout:()=>{(0,c.o4)(null),r(null)},checkSession:d},children:t})}function o(){let e=(0,s.useContext)(i);if(!e)throw Error("useAuth must be inside AuthProvider");return e}},7584:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var a=n(7437),s=n(2265),c=n(7128);let i=n(257).env.NEXT_PUBLIC_API_URL||"https://espocopi.com/api/mercado";function r(){let{token:e}=(0,c.a)(),[t,n]=(0,s.useState)(!0),[r,o]=(0,s.useState)([]),[l,d]=(0,s.useState)(null),[u,h]=(0,s.useState)(null),[m,p]=(0,s.useState)(null),[j,x]=(0,s.useState)("all"),v=(0,s.useCallback)(async()=>{if(e){n(!0);try{let t="all"!==j?"?status=".concat(j):"",n=await fetch("".concat(i,"/admin/corporate.php").concat(t),{headers:{Authorization:"Bearer ".concat(e)}}),a=await n.json();a.success&&(o(a.data.accounts),d(a.data.stats))}catch(e){console.error("Erro:",e)}finally{n(!1)}}},[e,j]),f=async t=>{try{let n=await fetch("".concat(i,"/admin/corporate.php?id=").concat(t),{headers:{Authorization:"Bearer ".concat(e)}}),a=await n.json();a.success&&p(a.data)}catch(e){console.error("Erro:",e)}};(0,s.useEffect)(()=>{v()},[v]),(0,s.useEffect)(()=>{u&&f(u)},[u]);let g=async function(t,n){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(confirm({approve:"Aprovar esta conta corporativa?",suspend:"Suspender esta conta?",generate_invoice:"Gerar fatura para esta conta?"}[t]||"Confirma esta acao?"))try{let s=await fetch("".concat(i,"/admin/corporate.php"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({action:t,corporate_id:n,...a})}),c=await s.json();alert(c.message||(c.success?"Sucesso!":"Erro")),c.success&&(v(),u===n&&f(n))}catch(e){alert("Erro ao executar acao")}},y=e=>(0,a.jsx)("span",{className:"badge",style:{backgroundColor:{active:"#22c55e",pending:"#f59e0b",suspended:"#ef4444"}[e]},children:{active:"Ativa",pending:"Pendente",suspended:"Suspensa"}[e]||e});return(0,a.jsxs)("div",{className:"page-container",children:[(0,a.jsx)("div",{className:"page-header",children:(0,a.jsx)("h1",{children:"Contas Corporativas"})}),l&&(0,a.jsxs)("div",{className:"stats-grid",children:[(0,a.jsxs)("div",{className:"stat-card",children:[(0,a.jsx)("div",{className:"stat-value",children:l.total}),(0,a.jsx)("div",{className:"stat-label",children:"Total"})]}),(0,a.jsxs)("div",{className:"stat-card warning",children:[(0,a.jsx)("div",{className:"stat-value",children:l.pending}),(0,a.jsx)("div",{className:"stat-label",children:"Pendentes"})]}),(0,a.jsxs)("div",{className:"stat-card success",children:[(0,a.jsx)("div",{className:"stat-value",children:l.active}),(0,a.jsx)("div",{className:"stat-label",children:"Ativas"})]}),(0,a.jsxs)("div",{className:"stat-card danger",children:[(0,a.jsx)("div",{className:"stat-value",children:l.suspended}),(0,a.jsx)("div",{className:"stat-label",children:"Suspensas"})]})]}),(0,a.jsxs)("div",{className:"content-split",children:[(0,a.jsxs)("div",{className:"list-panel",children:[(0,a.jsx)("div",{className:"filters-bar",children:(0,a.jsxs)("select",{value:j,onChange:e=>x(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"Todos Status"}),(0,a.jsx)("option",{value:"pending",children:"Pendentes"}),(0,a.jsx)("option",{value:"active",children:"Ativas"}),(0,a.jsx)("option",{value:"suspended",children:"Suspensas"})]})}),t?(0,a.jsx)("div",{className:"loading",children:"Carregando..."}):(0,a.jsx)("div",{className:"account-list",children:r.map(e=>(0,a.jsxs)("div",{className:"account-item ".concat(u===e.id?"selected":""),onClick:()=>h(e.id),children:[(0,a.jsxs)("div",{className:"account-item-header",children:[(0,a.jsx)("strong",{children:e.company_name}),y(e.status)]}),(0,a.jsxs)("div",{className:"account-item-meta",children:[(0,a.jsxs)("span",{children:["CNPJ: ",e.cnpj]}),(0,a.jsxs)("span",{children:[e.employee_count||0," funcionarios"]})]}),e.month_spent>0&&(0,a.jsxs)("div",{className:"account-item-spent",children:["Gasto mes: R$ ",parseFloat(e.month_spent).toFixed(2)]})]},e.id))})]}),(0,a.jsx)("div",{className:"detail-panel",children:m?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"detail-header",children:[(0,a.jsx)("h2",{children:m.account.company_name}),y(m.account.status)]}),(0,a.jsxs)("div",{className:"detail-section",children:[(0,a.jsx)("h3",{children:"Informacoes"}),(0,a.jsxs)("div",{className:"info-grid",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"CNPJ:"})," ",m.account.cnpj]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"Contato:"})," ",m.account.contact_name]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"Email:"})," ",m.account.contact_email]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"Telefone:"})," ",m.account.contact_phone]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"Endereco:"})," ",m.account.address,", ",m.account.city,"/",m.account.state]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"Limite Mensal:"})," R$ ",parseFloat(m.account.monthly_limit).toFixed(2)]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"Limite/Func:"})," R$ ",parseFloat(m.account.per_employee_limit).toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"detail-actions",children:["pending"===m.account.status&&(0,a.jsx)("button",{className:"btn btn-success",onClick:()=>g("approve",m.account.id),children:"Aprovar Conta"}),"active"===m.account.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{className:"btn btn-danger",onClick:()=>g("suspend",m.account.id,{reason:prompt("Motivo da suspensao:")}),children:"Suspender"}),(0,a.jsx)("button",{className:"btn btn-primary",onClick:()=>g("generate_invoice",m.account.id,{reference_month:new Date().toISOString().slice(0,7)}),children:"Gerar Fatura"}),(0,a.jsx)("button",{className:"btn",onClick:()=>{let e=prompt("Novo limite mensal:",m.account.monthly_limit),t=prompt("Novo limite por funcionario:",m.account.per_employee_limit);e&&t&&g("update_limits",m.account.id,{monthly_limit:e,per_employee_limit:t})},children:"Alterar Limites"})]})]}),(0,a.jsxs)("div",{className:"detail-section",children:[(0,a.jsxs)("h3",{children:["Funcionarios (",m.employees.length,")"]}),(0,a.jsxs)("table",{className:"data-table compact",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Nome"}),(0,a.jsx)("th",{children:"Email"}),(0,a.jsx)("th",{children:"Depto"}),(0,a.jsx)("th",{children:"Gasto Mes"}),(0,a.jsx)("th",{children:"Status"})]})}),(0,a.jsx)("tbody",{children:m.employees.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.name}),(0,a.jsx)("td",{children:e.email}),(0,a.jsx)("td",{children:e.department||"-"}),(0,a.jsxs)("td",{children:["R$ ",parseFloat(e.current_month_spent).toFixed(2)]}),(0,a.jsx)("td",{children:(0,a.jsx)("span",{className:"status-dot ".concat("active"===e.status?"active":"")})})]},e.id))})]})]}),m.invoices.length>0&&(0,a.jsxs)("div",{className:"detail-section",children:[(0,a.jsx)("h3",{children:"Faturas"}),(0,a.jsxs)("table",{className:"data-table compact",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Ref"}),(0,a.jsx)("th",{children:"Valor"}),(0,a.jsx)("th",{children:"Vencimento"}),(0,a.jsx)("th",{children:"Status"}),(0,a.jsx)("th",{children:"Acoes"})]})}),(0,a.jsx)("tbody",{children:m.invoices.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.reference_month}),(0,a.jsxs)("td",{children:["R$ ",parseFloat(e.amount).toFixed(2)]}),(0,a.jsx)("td",{children:new Date(e.due_date).toLocaleDateString("pt-BR")}),(0,a.jsx)("td",{children:y(e.status)}),(0,a.jsx)("td",{children:"pending"===e.status&&(0,a.jsx)("button",{className:"btn btn-small btn-success",onClick:()=>g("mark_invoice_paid",m.account.id,{invoice_id:e.id}),children:"Pago"})})]},e.id))})]})]}),m.recent_orders.length>0&&(0,a.jsxs)("div",{className:"detail-section",children:[(0,a.jsx)("h3",{children:"Pedidos Recentes"}),(0,a.jsxs)("table",{className:"data-table compact",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Pedido"}),(0,a.jsx)("th",{children:"Funcionario"}),(0,a.jsx)("th",{children:"Valor"}),(0,a.jsx)("th",{children:"Status"})]})}),(0,a.jsx)("tbody",{children:m.recent_orders.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{children:["#",e.order_id]}),(0,a.jsx)("td",{children:e.employee_name}),(0,a.jsxs)("td",{children:["R$ ",parseFloat(e.amount).toFixed(2)]}),(0,a.jsx)("td",{children:e.order_status})]},e.id))})]})]})]}):(0,a.jsx)("div",{className:"empty-state",children:(0,a.jsx)("p",{children:"Selecione uma conta para ver detalhes"})})})]})]})}},257:function(e,t,n){"use strict";var a,s;e.exports=(null==(a=n.g.process)?void 0:a.env)&&"object"==typeof(null==(s=n.g.process)?void 0:s.env)?n.g.process:n(4227)},4227:function(e){!function(){var t={229:function(e){var t,n,a,s=e.exports={};function c(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function r(e){if(t===setTimeout)return setTimeout(e,0);if((t===c||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:c}catch(e){t=c}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var o=[],l=!1,d=-1;function u(){l&&a&&(l=!1,a.length?o=a.concat(o):d=-1,o.length&&h())}function h(){if(!l){var e=r(u);l=!0;for(var t=o.length;t;){for(a=o,o=[];++d<t;)a&&a[d].run();d=-1,t=o.length}a=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function p(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];o.push(new m(e,t)),1!==o.length||l||r(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=p,s.addListener=p,s.once=p,s.off=p,s.removeListener=p,s.removeAllListeners=p,s.emit=p,s.prependListener=p,s.prependOnceListener=p,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},n={};function a(e){var s=n[e];if(void 0!==s)return s.exports;var c=n[e]={exports:{}},i=!0;try{t[e](c,c.exports,a),i=!1}finally{i&&delete n[e]}return c.exports}a.ab="//";var s=a(229);e.exports=s}()}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=9504)}),_N_E=e.O()}]);