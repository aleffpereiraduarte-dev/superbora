(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6910],{6048:function(e,t,n){Promise.resolve().then(n.bind(n,2216))},6428:function(e,t,n){"use strict";n.d(t,{LP:function(){return r},QW:function(){return u},SC:function(){return i},o4:function(){return o},pE:function(){return d},sg:function(){return l}});let a="/api/mercado/admin",s="admin_token";function r(){try{return localStorage.getItem(s)}catch(e){return null}}function o(e){try{e?localStorage.setItem(s,e):localStorage.removeItem(s)}catch(e){}}function c(){let e=r(),t={"Content-Type":"application/json"};return e&&(t.Authorization="Bearer ".concat(e)),t}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),s=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");s&&(n+="?".concat(s));let r=await fetch(n,{headers:c()});if(!r.ok)throw Error((await r.json().catch(()=>({message:"Erro de rede"}))).message||"HTTP ".concat(r.status));let o=await r.json();if(!1===o.success)throw Error(o.message||"Erro desconhecido");return void 0!==o.data?o.data:o}async function l(e,t){let n=await fetch("".concat(a).concat(e),{method:"POST",headers:c(),body:JSON.stringify(t)}),s=await n.json().catch(()=>null);if(!n.ok||s&&!1===s.success)throw Error((null==s?void 0:s.message)||"HTTP ".concat(n.status));return(null==s?void 0:s.data)!==void 0?s.data:s}async function d(e,t){let n=await fetch("".concat(a).concat(e),{method:"PUT",headers:c(),body:JSON.stringify(t)}),s=await n.json().catch(()=>null);if(!n.ok||s&&!1===s.success)throw Error((null==s?void 0:s.message)||"HTTP ".concat(n.status));return(null==s?void 0:s.data)!==void 0?s.data:s}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),s=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");s&&(n+="?".concat(s));let r=await fetch(n,{method:"DELETE",headers:c()}),o=await r.json().catch(()=>null);if(!r.ok||o&&!1===o.success)throw Error((null==o?void 0:o.message)||"HTTP ".concat(r.status));return(null==o?void 0:o.data)!==void 0?o.data:o}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return c},a:function(){return i}});var a=n(7437),s=n(2265),r=n(6428);let o=(0,s.createContext)(null);function c(e){let{children:t}=e,[n,c]=(0,s.useState)(null),[i,l]=(0,s.useState)(!0),d=(0,s.useCallback)(async()=>{if(!(0,r.LP)()){l(!1);return}try{let e=await (0,r.SC)("/auth/session.php");e.admin?c({...e.admin,name:e.admin.nome||e.admin.name,admin_id:e.admin.admin_id||e.admin.id}):((0,r.o4)(null),c(null))}catch(e){(0,r.o4)(null),c(null)}finally{l(!1)}},[]);(0,s.useEffect)(()=>{d()},[d]);let u=async(e,t)=>{let n=await (0,r.sg)("/auth/login.php",{email:e,senha:t});if(n.token)return(0,r.o4)(n.token),c({admin_id:n.admin_id,name:n.nome||n.name,email:n.email,role:n.role}),n;throw Error(n.message||"Erro ao fazer login")};return(0,a.jsx)(o.Provider,{value:{admin:n,loading:i,isAuthenticated:!!n,login:u,logout:()=>{(0,r.o4)(null),c(null)},checkSession:d},children:t})}function i(){let e=(0,s.useContext)(o);if(!e)throw Error("useAuth must be inside AuthProvider");return e}},2216:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var a=n(7437),s=n(2265),r=n(7128);let o=n(257).env.NEXT_PUBLIC_API_URL||"https://espocopi.com/api/mercado";function c(){let{token:e}=(0,r.a)(),[t,n]=(0,s.useState)(!0),[c,i]=(0,s.useState)([]),[l,d]=(0,s.useState)(null),[u,h]=(0,s.useState)(null),[p,m]=(0,s.useState)({status:"pending",page:1}),[f,v]=(0,s.useState)([]),[g,j]=(0,s.useState)(null),x=(0,s.useCallback)(async()=>{if(e){n(!0);try{let t=new URLSearchParams;t.append("status",p.status),t.append("page",p.page);let n=await fetch("".concat(o,"/admin/review-photos.php?").concat(t),{headers:{Authorization:"Bearer ".concat(e)}}),a=await n.json();a.success&&(i(a.data.photos),d(a.data.stats),h(a.data.pagination))}catch(e){console.error("Erro:",e)}finally{n(!1)}}},[e,p]);(0,s.useEffect)(()=>{x()},[x]);let b=async function(t,n){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let s=await fetch("".concat(o,"/admin/review-photos.php"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({action:t,photo_id:n,...a})}),r=await s.json();r.success?(x(),v([])):alert(r.error||"Erro")}catch(e){alert("Erro ao executar acao")}},N=async t=>{if(0===f.length){alert("Selecione ao menos uma foto");return}try{let n=await fetch("".concat(o,"/admin/review-photos.php"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({action:t,photo_ids:f})}),a=await n.json();alert(a.message||(a.success?"Sucesso!":"Erro")),a.success&&(x(),v([]))}catch(e){alert("Erro ao executar acao em lote")}},y=e=>{v(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},w=e=>(0,a.jsx)("span",{className:"badge",style:{backgroundColor:{approved:"#22c55e",pending:"#f59e0b",rejected:"#ef4444"}[e]},children:{approved:"Aprovada",pending:"Pendente",rejected:"Rejeitada"}[e]||e});return(0,a.jsxs)("div",{className:"page-container",children:[(0,a.jsx)("div",{className:"page-header",children:(0,a.jsx)("h1",{children:"Moderacao de Fotos de Reviews"})}),l&&(0,a.jsxs)("div",{className:"stats-grid",children:[(0,a.jsxs)("div",{className:"stat-card warning",children:[(0,a.jsx)("div",{className:"stat-value",children:l.pending}),(0,a.jsx)("div",{className:"stat-label",children:"Pendentes"})]}),(0,a.jsxs)("div",{className:"stat-card success",children:[(0,a.jsx)("div",{className:"stat-value",children:l.approved}),(0,a.jsx)("div",{className:"stat-label",children:"Aprovadas"})]}),(0,a.jsxs)("div",{className:"stat-card danger",children:[(0,a.jsx)("div",{className:"stat-value",children:l.rejected}),(0,a.jsx)("div",{className:"stat-label",children:"Rejeitadas"})]}),(0,a.jsxs)("div",{className:"stat-card",children:[(0,a.jsx)("div",{className:"stat-value",children:l.total}),(0,a.jsx)("div",{className:"stat-label",children:"Total"})]})]}),(0,a.jsxs)("div",{className:"filters-bar",children:[(0,a.jsxs)("select",{value:p.status,onChange:e=>m({...p,status:e.target.value,page:1}),children:[(0,a.jsx)("option",{value:"all",children:"Todas"}),(0,a.jsx)("option",{value:"pending",children:"Pendentes"}),(0,a.jsx)("option",{value:"approved",children:"Aprovadas"}),(0,a.jsx)("option",{value:"rejected",children:"Rejeitadas"})]}),f.length>0&&(0,a.jsxs)("div",{className:"bulk-actions",children:[(0,a.jsxs)("span",{children:[f.length," selecionadas"]}),(0,a.jsx)("button",{className:"btn btn-success btn-small",onClick:()=>N("bulk_approve"),children:"Aprovar"}),(0,a.jsx)("button",{className:"btn btn-danger btn-small",onClick:()=>N("bulk_reject"),children:"Rejeitar"})]})]}),t?(0,a.jsx)("div",{className:"loading",children:"Carregando..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"photos-header",children:(0,a.jsxs)("label",{className:"checkbox-label",children:[(0,a.jsx)("input",{type:"checkbox",checked:f.length===c.length&&c.length>0,onChange:()=>{f.length===c.length?v([]):v(c.map(e=>e.id))}}),"Selecionar todas"]})}),(0,a.jsx)("div",{className:"photos-grid",children:c.map(e=>(0,a.jsxs)("div",{className:"photo-card ".concat(f.includes(e.id)?"selected":""),children:[(0,a.jsx)("div",{className:"photo-checkbox",children:(0,a.jsx)("input",{type:"checkbox",checked:f.includes(e.id),onChange:()=>y(e.id)})}),(0,a.jsx)("div",{className:"photo-image",onClick:()=>j(e),children:(0,a.jsx)("img",{src:e.photo_url,alt:""})}),(0,a.jsxs)("div",{className:"photo-info",children:[(0,a.jsxs)("div",{className:"photo-meta",children:[(0,a.jsx)("span",{className:"customer-name",children:e.customer_name}),(0,a.jsx)("span",{className:"partner-name",children:e.partner_name})]}),e.caption&&(0,a.jsx)("p",{className:"photo-caption",children:e.caption}),(0,a.jsx)("div",{className:"photo-date",children:new Date(e.created_at).toLocaleDateString("pt-BR")}),(0,a.jsx)("div",{className:"photo-status",children:w(e.status)})]}),(0,a.jsx)("div",{className:"photo-actions",children:"pending"===e.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{className:"btn btn-success btn-small",onClick:()=>b("approve",e.id),children:"Aprovar"}),(0,a.jsx)("button",{className:"btn btn-danger btn-small",onClick:()=>{let t=prompt("Motivo da rejeicao:");t&&b("reject",e.id,{reason:t.replace(/<[^>]*>/g,"").trim()})},children:"Rejeitar"})]})})]},e.id))})]}),u&&(0,a.jsxs)("div",{className:"pagination",children:[(0,a.jsx)("button",{disabled:1===p.page,onClick:()=>m({...p,page:p.page-1}),children:"Anterior"}),(0,a.jsxs)("span",{children:["Pagina ",p.page," de ",u.pages]}),(0,a.jsx)("button",{disabled:p.page>=u.pages,onClick:()=>m({...p,page:p.page+1}),children:"Proxima"})]}),g&&(0,a.jsx)("div",{className:"modal-overlay",onClick:()=>j(null),children:(0,a.jsxs)("div",{className:"modal-content photo-preview",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("button",{className:"modal-close",onClick:()=>j(null),children:"\xd7"}),(0,a.jsx)("img",{src:g.photo_url,alt:"",className:"photo-preview-image"}),(0,a.jsxs)("div",{className:"photo-preview-info",children:[(0,a.jsx)("h3",{children:g.customer_name}),(0,a.jsxs)("p",{children:["Pedido #",g.order_id," - ",g.partner_name]}),g.caption&&(0,a.jsx)("p",{className:"caption",children:g.caption})]})]})})]})}},257:function(e,t,n){"use strict";var a,s;e.exports=(null==(a=n.g.process)?void 0:a.env)&&"object"==typeof(null==(s=n.g.process)?void 0:s.env)?n.g.process:n(4227)},4227:function(e){!function(){var t={229:function(e){var t,n,a,s=e.exports={};function r(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var i=[],l=!1,d=-1;function u(){l&&a&&(l=!1,a.length?i=a.concat(i):d=-1,i.length&&h())}function h(){if(!l){var e=c(u);l=!0;for(var t=i.length;t;){for(a=i,i=[];++d<t;)a&&a[d].run();d=-1,t=i.length}a=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];i.push(new p(e,t)),1!==i.length||l||c(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},n={};function a(e){var s=n[e];if(void 0!==s)return s.exports;var r=n[e]={exports:{}},o=!0;try{t[e](r,r.exports,a),o=!1}finally{o&&delete n[e]}return r.exports}a.ab="//";var s=a(229);e.exports=s}()}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=6048)}),_N_E=e.O()}]);