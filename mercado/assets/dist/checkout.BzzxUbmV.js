import{m as t,a,b as d,c as n,d as c,u as p,e as h,f as l,s as u,g as m,k as g,i as r}from"./shipping.CRkdE5c0.js";function f(){return{step:1,maxSteps:4,address_id:null,shipping_method:null,payment_method:"pix",coupon:"",card:{number:"",holder:"",expiry:"",cvv:""},loading:!1,error:"",validating:!1,couponApplied:!1,couponDiscount:"R$ 0,00",async init(){if(!window.SuperBora.token){window.location.href="/login?redirect=/checkout";return}await Promise.all([t.store("cart").fetch(),t.store("addresses").fetch()]);const s=t.store("addresses").items.find(i=>i.is_default);s&&(this.address_id=s.id,await this.calculateShipping())},canGoNext(){switch(this.step){case 1:return this.address_id!==null;case 2:return this.shipping_method!==null;case 3:return this.payment_method!==null;default:return!0}},async nextStep(){if(!this.canGoNext()){this.error=this.getStepError();return}this.error="",this.step===1&&await this.calculateShipping(),this.step<this.maxSteps&&(this.step++,window.scrollTo({top:0,behavior:"smooth"}))},prevStep(){this.step>1&&(this.step--,this.error="")},goToStep(e){e<this.step&&(this.step=e,this.error="")},getStepError(){switch(this.step){case 1:return"Selecione um endereco de entrega";case 2:return"Selecione um metodo de envio";case 3:return"Selecione uma forma de pagamento";default:return""}},selectAddress(e){this.address_id=e,this.shipping_method=null},getSelectedAddress(){return t.store("addresses").items.find(s=>s.id===this.address_id)},async calculateShipping(){const e=this.getSelectedAddress();if(!e)return;await t.store("shipping").calculate(e.postcode)},selectShipping(e){this.shipping_method=e,t.store("shipping").selectById(e)},selectPayment(e){this.payment_method=e},async applyCoupon(){if(this.coupon.trim()){this.validating=!0;try{const e=await r("/coupons/validate",{method:"POST",body:{code:this.coupon}});e.success&&e.data?(this.couponApplied=!0,this.couponDiscount=e.data.discount_formatted,t.store("ui").showToast("Cupom aplicado!","success")):this.error=e.message||"Cupom invalido"}catch{this.error="Erro ao validar cupom"}this.validating=!1}},removeCoupon(){this.coupon="",this.couponApplied=!1,this.couponDiscount="R$ 0,00"},get subtotal(){return t.store("cart").subtotal},get shippingPrice(){return t.store("shipping").selectedPriceFormatted},get total(){const e=t.store("cart");return t.store("shipping"),e.total},async finalize(){this.loading=!0,this.error="";try{const e={address_id:this.address_id,shipping_method:this.shipping_method,payment_method:this.payment_method};this.couponApplied&&(e.coupon=this.coupon),this.payment_method==="card"&&(e.card={number:this.card.number.replace(/\s/g,""),holder:this.card.holder,expiry:this.card.expiry,cvv:this.card.cvv});const s=await r("/orders",{method:"POST",body:e});if(s.success&&s.data){const i=t.store("cart");i.items=[],i.count=0;const o=s.data.id||s.data.order_id;window.location.href=`/pedido/${o}/confirmacao`}else this.error=s.message||"Erro ao finalizar pedido"}catch(e){this.error=e.message||"Erro ao processar pedido"}this.loading=!1},formatCardNumber(e){const s=e.target;let i=s.value.replace(/\D/g,"");i=i.replace(/(\d{4})/g,"$1 ").trim(),s.value=i.slice(0,19),this.card.number=s.value},formatExpiry(e){const s=e.target;let i=s.value.replace(/\D/g,"");i.length>=2&&(i=i.slice(0,2)+"/"+i.slice(2,4)),s.value=i,this.card.expiry=i}}}t.plugin(a);t.plugin(d);t.plugin(n);t.store("cart",c);t.store("user",p);t.store("ui",h);t.store("addresses",l);t.store("shipping",u);t.data("checkout",f);t.magic("money",()=>m);t.magic("formatCep",()=>g);window.Alpine=t;t.start();document.addEventListener("alpine:init",async()=>{await t.store("user").init()});console.log("%cSuperBora Checkout v2.0.0","color: #FF6A00; font-size: 14px; font-weight: bold;");
