(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8921],{4041:function(e,a,s){Promise.resolve().then(s.bind(s,7514))},4445:function(e,a,s){"use strict";s.d(a,{Z:function(){return i}});var l=s(7437),n=s(8253);function i(e){let{section:a,children:s}=e,{hasPermission:i}=(0,n.q)();return i(a)?(0,l.jsx)(l.Fragment,{children:s}):(0,l.jsxs)("div",{className:"role-denied",children:[(0,l.jsx)("div",{className:"role-denied-icon",children:"\uD83D\uDD12"}),(0,l.jsx)("h2",{children:"Acesso Negado"}),(0,l.jsx)("p",{children:"Voce nao tem permissao para acessar esta secao."}),(0,l.jsx)("p",{className:"role-denied-hint",children:"Contate o administrador para solicitar acesso."})]})}},1656:function(e,a,s){"use strict";s.d(a,{X:function(){return t},Z:function(){return i}});var l=s(7437);let n={success:"badge-success",warning:"badge-warning",danger:"badge-danger",info:"badge-info",neutral:"badge-neutral"};function i(e){let{label:a,variant:s="neutral"}=e;return(0,l.jsx)("span",{className:"badge ".concat(n[s]||n.neutral),children:a})}function t(e){return({pendente:"warning",confirmado:"info",preparando:"info",pronto:"info",coletado:"info",em_entrega:"warning",entregue:"success",cancelado:"danger",recusado:"danger",ativo:"success",inativo:"neutral",bloqueado:"danger",online:"success",offline:"neutral",aprovado:"success",reprovado:"danger",pago:"success",pendente_pagamento:"warning",processando:"info",aberto:"warning",resolvido:"success",fechado:"neutral"})[e]||"neutral"}},9531:function(e,a,s){"use strict";s.d(a,{Z:function(){return d}});var l=s(7437),n=s(2265);function i(e){let{value:a,onChange:s,placeholder:i="Buscar...",delay:t=300}=e,[d,c]=(0,n.useState)(a||""),r=(0,n.useRef)(null);return(0,n.useEffect)(()=>{c(a||"")},[a]),(0,l.jsxs)("div",{className:"search-input-wrapper",children:[(0,l.jsx)("span",{className:"search-input-icon",children:"\uD83D\uDD0D"}),(0,l.jsx)("input",{type:"text",className:"search-input",value:d,onChange:e=>{let a=e.target.value;c(a),r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{null==s||s(a)},t)},placeholder:i}),d&&(0,l.jsx)("button",{className:"search-input-clear",onClick:()=>{c(""),null==s||s("")},children:"✕"})]})}function t(e){let{page:a,totalPages:s,onPageChange:n}=e,i=[],t=Math.max(1,a-Math.floor(2.5)),d=Math.min(s,t+5-1);d-t<4&&(t=Math.max(1,d-5+1));for(let e=t;e<=d;e++)i.push(e);return(0,l.jsxs)("div",{className:"pagination",children:[(0,l.jsx)("button",{className:"pagination-btn",disabled:a<=1,onClick:()=>n(a-1),children:"‹ Anterior"}),t>1&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{className:"pagination-btn",onClick:()=>n(1),children:"1"}),t>2&&(0,l.jsx)("span",{className:"pagination-dots",children:"..."})]}),i.map(e=>(0,l.jsx)("button",{className:"pagination-btn ".concat(e===a?"pagination-active":""),onClick:()=>n(e),children:e},e)),d<s&&(0,l.jsxs)(l.Fragment,{children:[d<s-1&&(0,l.jsx)("span",{className:"pagination-dots",children:"..."}),(0,l.jsx)("button",{className:"pagination-btn",onClick:()=>n(s),children:s})]}),(0,l.jsx)("button",{className:"pagination-btn",disabled:a>=s,onClick:()=>n(a+1),children:"Proximo ›"})]})}function d(e){let{columns:a=[],data:s=[],loading:d=!1,searchable:c=!0,pageSize:r=15,emptyMessage:o="Nenhum registro encontrado",onRowClick:u}=e,[m,h]=(0,n.useState)(""),[v,x]=(0,n.useState)(null),[j,p]=(0,n.useState)("asc"),[N,b]=(0,n.useState)(1),g=(0,n.useMemo)(()=>{if(!m)return s;let e=m.toLowerCase();return s.filter(s=>a.some(a=>{let l=s[a.key];return null!=l&&String(l).toLowerCase().includes(e)}))},[s,m,a]),f=(0,n.useMemo)(()=>v?[...g].sort((e,a)=>{var s,l;let n=null!==(s=e[v])&&void 0!==s?s:"",i=null!==(l=a[v])&&void 0!==l?l:"";if("number"==typeof n&&"number"==typeof i)return"asc"===j?n-i:i-n;let t=String(n).localeCompare(String(i));return"asc"===j?t:-t}):g,[g,v,j]),k=Math.max(1,Math.ceil(f.length/r)),y=f.slice((N-1)*r,N*r);(0,n.useEffect)(()=>{N>k&&b(1)},[N,k]);let _=e=>{v===e?p(e=>"asc"===e?"desc":"asc"):(x(e),p("asc"))};return d?(0,l.jsxs)("div",{className:"datatable",children:[c&&(0,l.jsx)("div",{className:"datatable-toolbar",children:(0,l.jsx)(i,{value:"",onChange:()=>{},placeholder:"Buscar..."})}),(0,l.jsx)("div",{className:"datatable-skeleton",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,l.jsx)("div",{className:"skeleton-row",children:a.map((e,a)=>(0,l.jsx)("div",{className:"skeleton-cell"},a))},s))})]}):(0,l.jsxs)("div",{className:"datatable",children:[c&&(0,l.jsxs)("div",{className:"datatable-toolbar",children:[(0,l.jsx)(i,{value:m,onChange:e=>{h(e),b(1)},placeholder:"Buscar na tabela..."}),(0,l.jsxs)("span",{className:"datatable-count",children:[g.length," registro(s)"]})]}),(0,l.jsx)("div",{className:"datatable-wrapper",children:(0,l.jsxs)("table",{className:"datatable-table",children:[(0,l.jsx)("thead",{children:(0,l.jsx)("tr",{children:a.map(e=>(0,l.jsxs)("th",{onClick:()=>!1!==e.sortable&&_(e.key),className:!1!==e.sortable?"sortable":"",style:e.width?{width:e.width}:void 0,children:[e.label,v===e.key&&(0,l.jsx)("span",{className:"sort-indicator",children:"asc"===j?" ▲":" ▼"})]},e.key))})}),(0,l.jsx)("tbody",{children:0===y.length?(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:a.length,className:"datatable-empty",children:o})}):y.map((e,s)=>(0,l.jsx)("tr",{onClick:()=>null==u?void 0:u(e),className:u?"clickable-row":"",children:a.map(a=>{var s;return(0,l.jsx)("td",{children:a.render?a.render(e[a.key],e):null!==(s=e[a.key])&&void 0!==s?s:"-"},a.key)})},e.id||s))})]})}),k>1&&(0,l.jsx)(t,{page:N,totalPages:k,onPageChange:b})]})}},3197:function(e,a,s){"use strict";s.d(a,{Z:function(){return n}});var l=s(7437);function n(e){let{icon:a,label:s,value:n,change:i,color:t="#f97316"}=e,d=i&&parseFloat(i)>=0;return(0,l.jsxs)("div",{className:"stats-card",style:{borderTopColor:t},children:[(0,l.jsxs)("div",{className:"stats-card-header",children:[(0,l.jsx)("span",{className:"stats-card-icon",style:{color:t},dangerouslySetInnerHTML:{__html:a||"&#128202;"}}),(0,l.jsx)("span",{className:"stats-card-label",children:s})]}),(0,l.jsx)("div",{className:"stats-card-value",children:null!=n?n:"-"}),null!=i&&(0,l.jsxs)("div",{className:"stats-card-change ".concat(d?"change-positive":"change-negative"),children:[d?"&#9650;":"&#9660;"," ",i,"%"]})]})}},3378:function(e,a,s){"use strict";s.d(a,{Z:function(){return n}});var l=s(7437);function n(e){let{tabs:a=[],activeTab:s,onChange:n}=e;return(0,l.jsx)("div",{className:"tabs",children:a.map(e=>(0,l.jsx)("button",{className:"tab-btn ".concat(s===e.key?"tab-active":""),onClick:()=>n(e.key),children:e.label},e.key))})}},6939:function(e,a,s){"use strict";s.d(a,{Z:function(){return t}});var l=s(7437),n=s(6971);let i={success:"&#10003;",error:"&#10007;",warning:"&#9888;",info:"&#8505;"};function t(){let{toasts:e,removeToast:a}=(0,n.l)();return 0===e.length?null:(0,l.jsx)("div",{className:"toast-container",children:e.map(e=>(0,l.jsxs)("div",{className:"toast toast-".concat(e.type),children:[(0,l.jsx)("span",{className:"toast-icon",dangerouslySetInnerHTML:{__html:i[e.type]||i.info}}),(0,l.jsx)("span",{className:"toast-message",children:e.message}),(0,l.jsx)("button",{className:"toast-close",onClick:()=>a(e.id),children:"✕"})]},e.id))})}},7514:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return b}});var l=s(7437),n=s(2265),i=s(9376),t=s(8779),d=s(4477),c=s(4445),r=s(1656),o=s(3197),u=s(9531),m=s(3378),h=s(6939),v=s(8789),x=s(6971),j=s(6428);function p(){let e=(0,i.useSearchParams)(),a=(0,i.useRouter)(),s=e.get("id"),{collapsed:t}=(0,v.A)(),{success:c,error:p}=(0,x.l)(),[N,b]=(0,n.useState)(null),[g,f]=(0,n.useState)([]),[k,y]=(0,n.useState)(null),[_,C]=(0,n.useState)([]),[S,D]=(0,n.useState)(!0),[w,Z]=(0,n.useState)("info");(0,n.useEffect)(()=>{s&&M()},[s,M]);let M=async()=>{D(!0);try{let[e,a,l,n]=await Promise.allSettled([(0,j.SC)("/mercado.php?id=".concat(s)),(0,j.SC)("/orders.php?market_id=".concat(s,"&limit=50")),(0,j.SC)("/mercado.php?id=".concat(s,"&section=stats")),(0,j.SC)("/mercado.php?id=".concat(s,"&section=products"))]);"fulfilled"===e.status&&b(e.value.market||e.value.mercado||e.value),"fulfilled"===a.status&&f(a.value.orders||a.value.data||[]),"fulfilled"===l.status&&y(l.value.stats||l.value),"fulfilled"===n.status&&C(n.value.products||n.value.produtos||[])}catch(e){p("Erro ao carregar mercado")}finally{D(!1)}},P=async()=>{try{let e=(null==N?void 0:N.status)==="ativo"?"inativo":"ativo";await (0,j.sg)("/mercado.php",{market_id:s,action:"toggle_status",status:e}),c("Mercado ".concat("ativo"===e?"ativado":"desativado")),M()}catch(e){p("Erro: "+e.message)}},E=e=>null!=e?"R$ ".concat(Number(e).toLocaleString("pt-BR",{minimumFractionDigits:2})):"R$ 0,00";if(!s)return(0,l.jsxs)("div",{className:"admin-layout",children:[(0,l.jsx)(d.Z,{}),(0,l.jsx)("main",{className:"admin-main ".concat(t?"main-collapsed":""),children:(0,l.jsxs)("div",{className:"role-denied",children:[(0,l.jsx)("h2",{children:"Mercado nao encontrado"}),(0,l.jsx)("button",{className:"btn btn-primary mt-4",onClick:()=>a.push("/mercados/"),children:"Voltar"})]})})]});let T=[{key:"info",label:"Info"},{key:"pedidos",label:"Pedidos (".concat(g.length,")")},{key:"stats",label:"Estatisticas"},{key:"produtos",label:"Produtos (".concat(_.length,")")}],R=[{key:"id",label:"ID",render:(e,a)=>(0,l.jsxs)("strong",{children:["#",a.id||a.order_id]})},{key:"cliente_nome",label:"Cliente",render:(e,a)=>e||a.customer_name||"-"},{key:"total",label:"Total",render:e=>E(e)},{key:"status",label:"Status",render:e=>(0,l.jsx)(r.Z,{label:e||"pendente",variant:(0,r.X)(e)})},{key:"created_at",label:"Data",render:(e,a)=>e||a.data||"-"}],F=(null==N?void 0:N.status)==="ativo";return(0,l.jsxs)("div",{className:"admin-layout",children:[(0,l.jsx)(d.Z,{}),(0,l.jsxs)("main",{className:"admin-main ".concat(t?"main-collapsed":""),children:[(0,l.jsxs)("div",{className:"page-header",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("h1",{className:"page-title",children:[(null==N?void 0:N.name)||(null==N?void 0:N.nome)||"Mercado"," ",N&&(0,l.jsx)(r.Z,{label:N.status||"ativo",variant:(0,r.X)(N.status||"ativo")})]}),(0,l.jsxs)("p",{className:"page-subtitle",children:["ID: ",s," | ",(null==N?void 0:N.category)||(null==N?void 0:N.categoria)||"-"]})]}),(0,l.jsxs)("div",{className:"page-actions",children:[(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>a.push("/mercados/"),children:"Voltar"}),(0,l.jsx)("button",{className:"btn ".concat(F?"btn-danger":"btn-success"),onClick:P,children:F?"Desativar":"Ativar"})]})]}),S?(0,l.jsx)("div",{className:"card",children:(0,l.jsx)("div",{className:"datatable-skeleton",children:[void 0,void 0,void 0,void 0].map((e,a)=>(0,l.jsxs)("div",{className:"skeleton-row",children:[(0,l.jsx)("div",{className:"skeleton-cell"}),(0,l.jsx)("div",{className:"skeleton-cell"})]},a))})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"stats-grid mb-6",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:[(0,l.jsx)(o.Z,{icon:"\uD83D\uDCE6",label:"Total Pedidos",value:(null==N?void 0:N.total_orders)||(null==N?void 0:N.total_pedidos)||g.length,color:"#f97316"}),(0,l.jsx)(o.Z,{icon:"\uD83D\uDCB0",label:"Receita Total",value:E((null==N?void 0:N.revenue)||(null==N?void 0:N.receita)),color:"#22c55e"}),(0,l.jsx)(o.Z,{icon:"⭐",label:"Rating",value:(null==N?void 0:N.rating)?Number(N.rating).toFixed(1):"-",color:"#eab308"}),(0,l.jsx)(o.Z,{icon:"\uD83D\uDED2",label:"Produtos",value:_.length||(null==N?void 0:N.total_products)||0,color:"#8b5cf6"})]}),(0,l.jsx)(m.Z,{tabs:T,activeTab:w,onChange:Z}),"info"===w&&(0,l.jsxs)("div",{className:"grid-2 gap-4",children:[(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{className:"card-title mb-4",children:"Informacoes do Mercado"}),(0,l.jsxs)("div",{className:"detail-grid",children:[(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Nome"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.name)||(null==N?void 0:N.nome)||"-"})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Email"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.email)||"-"})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Telefone"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.phone)||(null==N?void 0:N.telefone)||"-"})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"CNPJ"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.cnpj)||"-"})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Categoria"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.category)||(null==N?void 0:N.categoria)||"-"})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Cadastro"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.created_at)||(null==N?void 0:N.data_cadastro)||"-"})]})]})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{className:"card-title mb-4",children:"Endereco e Horario"}),(0,l.jsxs)("div",{className:"detail-grid",children:[(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Endereco"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.address)||(null==N?void 0:N.endereco)||"-"})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Bairro"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.neighborhood)||(null==N?void 0:N.bairro)||"-"})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Cidade"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.city)||(null==N?void 0:N.cidade)||"-"})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Horario"}),(0,l.jsx)("span",{className:"detail-value",children:(null==N?void 0:N.hours)||(null==N?void 0:N.horario)||"-"})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Raio Entrega"}),(0,l.jsxs)("span",{className:"detail-value",children:[(null==N?void 0:N.delivery_radius)||(null==N?void 0:N.raio_entrega)||"-"," km"]})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Taxa Entrega"}),(0,l.jsx)("span",{className:"detail-value",children:E((null==N?void 0:N.delivery_fee)||(null==N?void 0:N.taxa_entrega))})]})]})]})]}),"pedidos"===w&&(0,l.jsx)(u.Z,{columns:R,data:g,loading:!1,emptyMessage:"Nenhum pedido"}),"stats"===w&&(0,l.jsxs)("div",{className:"grid-2 gap-4",children:[(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{className:"card-title mb-4",children:"Desempenho"}),(0,l.jsxs)("div",{className:"detail-grid",children:[(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Pedidos Hoje"}),(0,l.jsx)("span",{className:"detail-value",children:(null==k?void 0:k.orders_today)||(null==k?void 0:k.pedidos_hoje)||0})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Pedidos Semana"}),(0,l.jsx)("span",{className:"detail-value",children:(null==k?void 0:k.orders_week)||(null==k?void 0:k.pedidos_semana)||0})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Pedidos Mes"}),(0,l.jsx)("span",{className:"detail-value",children:(null==k?void 0:k.orders_month)||(null==k?void 0:k.pedidos_mes)||0})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Ticket Medio"}),(0,l.jsx)("span",{className:"detail-value",children:E((null==k?void 0:k.avg_ticket)||(null==k?void 0:k.ticket_medio))})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Taxa Cancelamento"}),(0,l.jsxs)("span",{className:"detail-value",children:[(null==k?void 0:k.cancel_rate)||(null==k?void 0:k.taxa_cancelamento)||0,"%"]})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Tempo Medio Preparo"}),(0,l.jsxs)("span",{className:"detail-value",children:[(null==k?void 0:k.avg_prep_time)||(null==k?void 0:k.tempo_medio)||0," min"]})]})]})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{className:"card-title mb-4",children:"Financeiro"}),(0,l.jsxs)("div",{className:"detail-grid",children:[(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Receita Hoje"}),(0,l.jsx)("span",{className:"detail-value",children:E((null==k?void 0:k.revenue_today)||(null==k?void 0:k.receita_hoje))})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Receita Semana"}),(0,l.jsx)("span",{className:"detail-value",children:E((null==k?void 0:k.revenue_week)||(null==k?void 0:k.receita_semana))})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Receita Mes"}),(0,l.jsx)("span",{className:"detail-value",children:E((null==k?void 0:k.revenue_month)||(null==k?void 0:k.receita_mes))})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Comissao Paga"}),(0,l.jsx)("span",{className:"detail-value",children:E((null==k?void 0:k.commission_paid)||(null==k?void 0:k.comissao_paga))})]})]})]})]}),"produtos"===w&&(0,l.jsx)(u.Z,{columns:[{key:"id",label:"ID",render:e=>(0,l.jsxs)("strong",{children:["#",e]})},{key:"name",label:"Produto",render:(e,a)=>e||a.nome||"-"},{key:"price",label:"Preco",render:(e,a)=>E(e||a.preco)},{key:"stock",label:"Estoque",render:(e,a)=>e||a.estoque||0},{key:"active",label:"Ativo",render:e=>(0,l.jsx)(r.Z,{label:e?"Sim":"Nao",variant:e?"success":"neutral"})}],data:_,loading:!1,emptyMessage:"Nenhum produto"})]})]}),(0,l.jsx)(h.Z,{})]})}function N(){return(0,l.jsx)(n.Suspense,{fallback:(0,l.jsxs)("div",{className:"auth-loading",children:[(0,l.jsx)("div",{className:"auth-loading-spinner"}),(0,l.jsx)("p",{children:"Carregando..."})]}),children:(0,l.jsx)(p,{})})}function b(){return(0,l.jsx)(t.Z,{children:(0,l.jsx)(c.Z,{section:"markets",children:(0,l.jsx)(N,{})})})}}},function(e){e.O(0,[3448,1006,2971,2117,1744],function(){return e(e.s=4041)}),_N_E=e.O()}]);