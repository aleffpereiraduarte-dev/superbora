(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2626],{381:function(e,t,n){Promise.resolve().then(n.bind(n,2175))},6428:function(e,t,n){"use strict";n.d(t,{LP:function(){return o},QW:function(){return d},SC:function(){return c},o4:function(){return s},pE:function(){return l},sg:function(){return u}});let a="/api/mercado/admin",r="admin_token";function o(){try{return localStorage.getItem(r)}catch(e){return null}}function s(e){try{e?localStorage.setItem(r,e):localStorage.removeItem(r)}catch(e){}}function i(){let e=o(),t={"Content-Type":"application/json"};return e&&(t.Authorization="Bearer ".concat(e)),t}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),r=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");r&&(n+="?".concat(r));let o=await fetch(n,{headers:i()});if(!o.ok)throw Error((await o.json().catch(()=>({message:"Erro de rede"}))).message||"HTTP ".concat(o.status));let s=await o.json();if(!1===s.success)throw Error(s.message||"Erro desconhecido");return void 0!==s.data?s.data:s}async function u(e,t){let n=await fetch("".concat(a).concat(e),{method:"POST",headers:i(),body:JSON.stringify(t)}),r=await n.json().catch(()=>null);if(!n.ok||r&&!1===r.success)throw Error((null==r?void 0:r.message)||"HTTP ".concat(n.status));return(null==r?void 0:r.data)!==void 0?r.data:r}async function l(e,t){let n=await fetch("".concat(a).concat(e),{method:"PUT",headers:i(),body:JSON.stringify(t)}),r=await n.json().catch(()=>null);if(!n.ok||r&&!1===r.success)throw Error((null==r?void 0:r.message)||"HTTP ".concat(n.status));return(null==r?void 0:r.data)!==void 0?r.data:r}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),r=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");r&&(n+="?".concat(r));let o=await fetch(n,{method:"DELETE",headers:i()}),s=await o.json().catch(()=>null);if(!o.ok||s&&!1===s.success)throw Error((null==s?void 0:s.message)||"HTTP ".concat(o.status));return(null==s?void 0:s.data)!==void 0?s.data:s}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return i},a:function(){return c}});var a=n(7437),r=n(2265),o=n(6428);let s=(0,r.createContext)(null);function i(e){let{children:t}=e,[n,i]=(0,r.useState)(null),[c,u]=(0,r.useState)(!0),l=(0,r.useCallback)(async()=>{if(!(0,o.LP)()){u(!1);return}try{let e=await (0,o.SC)("/auth/session.php");e.admin?i({...e.admin,name:e.admin.nome||e.admin.name,admin_id:e.admin.admin_id||e.admin.id}):((0,o.o4)(null),i(null))}catch(e){(0,o.o4)(null),i(null)}finally{u(!1)}},[]);(0,r.useEffect)(()=>{l()},[l]);let d=async(e,t)=>{let n=await (0,o.sg)("/auth/login.php",{email:e,senha:t});if(n.token)return(0,o.o4)(n.token),i({admin_id:n.admin_id,name:n.nome||n.name,email:n.email,role:n.role}),n;throw Error(n.message||"Erro ao fazer login")};return(0,a.jsx)(s.Provider,{value:{admin:n,loading:c,isAuthenticated:!!n,login:d,logout:()=>{(0,o.o4)(null),i(null)},checkSession:l},children:t})}function c(){let e=(0,r.useContext)(s);if(!e)throw Error("useAuth must be inside AuthProvider");return e}},2175:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return i}});var a=n(7437),r=n(2265),o=n(7128),s=n(9376);function i(){let{login:e,isAuthenticated:t,loading:n}=(0,o.a)(),i=(0,s.useRouter)(),[c,u]=(0,r.useState)(""),[l,d]=(0,r.useState)(""),[m,h]=(0,r.useState)(""),[f,p]=(0,r.useState)(!1),[g,v]=(0,r.useState)(!1);(0,r.useEffect)(()=>{!n&&t&&i.push("/")},[n,t,i]);let j=async t=>{if(t.preventDefault(),!c||!l){h("Preencha todos os campos");return}h(""),p(!0);try{await e(c,l),i.push("/")}catch(t){let e=t.message||"Erro ao fazer login";e.includes("rate")||e.includes("limite")||e.includes("429")?(v(!0),h("Muitas tentativas. Aguarde alguns minutos."),setTimeout(()=>v(!1),6e4)):h(e)}finally{p(!1)}};return n?null:(0,a.jsx)("div",{className:"login-page",children:(0,a.jsxs)("div",{className:"login-card",children:[(0,a.jsxs)("div",{className:"login-logo",children:[(0,a.jsx)("h1",{children:"SuperBora"}),(0,a.jsx)("p",{children:"Painel Administrativo"})]}),m&&(0,a.jsx)("div",{className:"login-error",children:m}),(0,a.jsxs)("form",{onSubmit:j,children:[(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{className:"form-label",children:"Email"}),(0,a.jsx)("input",{type:"email",className:"form-input",value:c,onChange:e=>u(e.target.value),placeholder:"admin@superbora.com",disabled:f||g,autoComplete:"email"})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{className:"form-label",children:"Senha"}),(0,a.jsx)("input",{type:"password",className:"form-input",value:l,onChange:e=>d(e.target.value),placeholder:"Sua senha",disabled:f||g,autoComplete:"current-password"})]}),(0,a.jsx)("button",{type:"submit",className:"btn btn-primary btn-lg w-full",disabled:f||g,style:{width:"100%",justifyContent:"center",marginTop:8},children:f?"Entrando...":"Entrar"})]}),g&&(0,a.jsx)("p",{style:{textAlign:"center",marginTop:16,fontSize:12,color:"var(--warning)"},children:"Aguarde antes de tentar novamente."})]})})}},9376:function(e,t,n){"use strict";var a=n(5475);n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}}),n.o(a,"useSearchParams")&&n.d(t,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=381)}),_N_E=e.O()}]);