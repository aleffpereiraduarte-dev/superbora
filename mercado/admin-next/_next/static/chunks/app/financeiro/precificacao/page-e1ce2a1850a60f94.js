(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2842],{9675:function(e,a,s){Promise.resolve().then(s.bind(s,561))},4445:function(e,a,s){"use strict";s.d(a,{Z:function(){return t}});var n=s(7437),l=s(8253);function t(e){let{section:a,children:s}=e,{hasPermission:t}=(0,l.q)();return t(a)?(0,n.jsx)(n.Fragment,{children:s}):(0,n.jsxs)("div",{className:"role-denied",children:[(0,n.jsx)("div",{className:"role-denied-icon",children:"\uD83D\uDD12"}),(0,n.jsx)("h2",{children:"Acesso Negado"}),(0,n.jsx)("p",{children:"Voce nao tem permissao para acessar esta secao."}),(0,n.jsx)("p",{className:"role-denied-hint",children:"Contate o administrador para solicitar acesso."})]})}},1656:function(e,a,s){"use strict";s.d(a,{X:function(){return i},Z:function(){return t}});var n=s(7437);let l={success:"badge-success",warning:"badge-warning",danger:"badge-danger",info:"badge-info",neutral:"badge-neutral"};function t(e){let{label:a,variant:s="neutral"}=e;return(0,n.jsx)("span",{className:"badge ".concat(l[s]||l.neutral),children:a})}function i(e){return({pendente:"warning",confirmado:"info",preparando:"info",pronto:"info",coletado:"info",em_entrega:"warning",entregue:"success",cancelado:"danger",recusado:"danger",ativo:"success",inativo:"neutral",bloqueado:"danger",online:"success",offline:"neutral",aprovado:"success",reprovado:"danger",pago:"success",pendente_pagamento:"warning",processando:"info",aberto:"warning",resolvido:"success",fechado:"neutral"})[e]||"neutral"}},9531:function(e,a,s){"use strict";s.d(a,{Z:function(){return c}});var n=s(7437),l=s(2265);function t(e){let{value:a,onChange:s,placeholder:t="Buscar...",delay:i=300}=e,[c,r]=(0,l.useState)(a||""),d=(0,l.useRef)(null);return(0,l.useEffect)(()=>{r(a||"")},[a]),(0,n.jsxs)("div",{className:"search-input-wrapper",children:[(0,n.jsx)("span",{className:"search-input-icon",children:"\uD83D\uDD0D"}),(0,n.jsx)("input",{type:"text",className:"search-input",value:c,onChange:e=>{let a=e.target.value;r(a),d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{null==s||s(a)},i)},placeholder:t}),c&&(0,n.jsx)("button",{className:"search-input-clear",onClick:()=>{r(""),null==s||s("")},children:"✕"})]})}function i(e){let{page:a,totalPages:s,onPageChange:l}=e,t=[],i=Math.max(1,a-Math.floor(2.5)),c=Math.min(s,i+5-1);c-i<4&&(i=Math.max(1,c-5+1));for(let e=i;e<=c;e++)t.push(e);return(0,n.jsxs)("div",{className:"pagination",children:[(0,n.jsx)("button",{className:"pagination-btn",disabled:a<=1,onClick:()=>l(a-1),children:"‹ Anterior"}),i>1&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:"pagination-btn",onClick:()=>l(1),children:"1"}),i>2&&(0,n.jsx)("span",{className:"pagination-dots",children:"..."})]}),t.map(e=>(0,n.jsx)("button",{className:"pagination-btn ".concat(e===a?"pagination-active":""),onClick:()=>l(e),children:e},e)),c<s&&(0,n.jsxs)(n.Fragment,{children:[c<s-1&&(0,n.jsx)("span",{className:"pagination-dots",children:"..."}),(0,n.jsx)("button",{className:"pagination-btn",onClick:()=>l(s),children:s})]}),(0,n.jsx)("button",{className:"pagination-btn",disabled:a>=s,onClick:()=>l(a+1),children:"Proximo ›"})]})}function c(e){let{columns:a=[],data:s=[],loading:c=!1,searchable:r=!0,pageSize:d=15,emptyMessage:o="Nenhum registro encontrado",onRowClick:u}=e,[m,h]=(0,l.useState)(""),[x,p]=(0,l.useState)(null),[g,j]=(0,l.useState)("asc"),[v,b]=(0,l.useState)(1),f=(0,l.useMemo)(()=>{if(!m)return s;let e=m.toLowerCase();return s.filter(s=>a.some(a=>{let n=s[a.key];return null!=n&&String(n).toLowerCase().includes(e)}))},[s,m,a]),N=(0,l.useMemo)(()=>x?[...f].sort((e,a)=>{var s,n;let l=null!==(s=e[x])&&void 0!==s?s:"",t=null!==(n=a[x])&&void 0!==n?n:"";if("number"==typeof l&&"number"==typeof t)return"asc"===g?l-t:t-l;let i=String(l).localeCompare(String(t));return"asc"===g?i:-i}):f,[f,x,g]),y=Math.max(1,Math.ceil(N.length/d)),k=N.slice((v-1)*d,v*d);(0,l.useEffect)(()=>{v>y&&b(1)},[v,y]);let C=e=>{x===e?j(e=>"asc"===e?"desc":"asc"):(p(e),j("asc"))};return c?(0,n.jsxs)("div",{className:"datatable",children:[r&&(0,n.jsx)("div",{className:"datatable-toolbar",children:(0,n.jsx)(t,{value:"",onChange:()=>{},placeholder:"Buscar..."})}),(0,n.jsx)("div",{className:"datatable-skeleton",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,n.jsx)("div",{className:"skeleton-row",children:a.map((e,a)=>(0,n.jsx)("div",{className:"skeleton-cell"},a))},s))})]}):(0,n.jsxs)("div",{className:"datatable",children:[r&&(0,n.jsxs)("div",{className:"datatable-toolbar",children:[(0,n.jsx)(t,{value:m,onChange:e=>{h(e),b(1)},placeholder:"Buscar na tabela..."}),(0,n.jsxs)("span",{className:"datatable-count",children:[f.length," registro(s)"]})]}),(0,n.jsx)("div",{className:"datatable-wrapper",children:(0,n.jsxs)("table",{className:"datatable-table",children:[(0,n.jsx)("thead",{children:(0,n.jsx)("tr",{children:a.map(e=>(0,n.jsxs)("th",{onClick:()=>!1!==e.sortable&&C(e.key),className:!1!==e.sortable?"sortable":"",style:e.width?{width:e.width}:void 0,children:[e.label,x===e.key&&(0,n.jsx)("span",{className:"sort-indicator",children:"asc"===g?" ▲":" ▼"})]},e.key))})}),(0,n.jsx)("tbody",{children:0===k.length?(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:a.length,className:"datatable-empty",children:o})}):k.map((e,s)=>(0,n.jsx)("tr",{onClick:()=>null==u?void 0:u(e),className:u?"clickable-row":"",children:a.map(a=>{var s;return(0,n.jsx)("td",{children:a.render?a.render(e[a.key],e):null!==(s=e[a.key])&&void 0!==s?s:"-"},a.key)})},e.id||s))})]})}),y>1&&(0,n.jsx)(i,{page:v,totalPages:y,onPageChange:b})]})}},7714:function(e,a,s){"use strict";s.d(a,{Z:function(){return i}});var n=s(7437),l=s(2265);let t={sm:"400px",md:"560px",lg:"720px",xl:"960px"};function i(e){let{isOpen:a,onClose:s,title:i,children:c,size:r="md"}=e;return((0,l.useEffect)(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[a]),(0,l.useEffect)(()=>{let e=e=>{"Escape"===e.key&&a&&(null==s||s())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a,s]),a)?(0,n.jsx)("div",{className:"modal-overlay",onClick:s,children:(0,n.jsxs)("div",{className:"modal-container",style:{maxWidth:t[r]||t.md},onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:"modal-header",children:[(0,n.jsx)("h3",{className:"modal-title",children:i}),(0,n.jsx)("button",{className:"modal-close",onClick:s,children:"✕"})]}),(0,n.jsx)("div",{className:"modal-body",children:c})]})}):null}},3197:function(e,a,s){"use strict";s.d(a,{Z:function(){return l}});var n=s(7437);function l(e){let{icon:a,label:s,value:l,change:t,color:i="#f97316"}=e,c=t&&parseFloat(t)>=0;return(0,n.jsxs)("div",{className:"stats-card",style:{borderTopColor:i},children:[(0,n.jsxs)("div",{className:"stats-card-header",children:[(0,n.jsx)("span",{className:"stats-card-icon",style:{color:i},dangerouslySetInnerHTML:{__html:a||"&#128202;"}}),(0,n.jsx)("span",{className:"stats-card-label",children:s})]}),(0,n.jsx)("div",{className:"stats-card-value",children:null!=l?l:"-"}),null!=t&&(0,n.jsxs)("div",{className:"stats-card-change ".concat(c?"change-positive":"change-negative"),children:[c?"&#9650;":"&#9660;"," ",t,"%"]})]})}},6939:function(e,a,s){"use strict";s.d(a,{Z:function(){return i}});var n=s(7437),l=s(6971);let t={success:"&#10003;",error:"&#10007;",warning:"&#9888;",info:"&#8505;"};function i(){let{toasts:e,removeToast:a}=(0,l.l)();return 0===e.length?null:(0,n.jsx)("div",{className:"toast-container",children:e.map(e=>(0,n.jsxs)("div",{className:"toast toast-".concat(e.type),children:[(0,n.jsx)("span",{className:"toast-icon",dangerouslySetInnerHTML:{__html:t[e.type]||t.info}}),(0,n.jsx)("span",{className:"toast-message",children:e.message}),(0,n.jsx)("button",{className:"toast-close",onClick:()=>a(e.id),children:"✕"})]},e.id))})}},561:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return j}});var n=s(7437),l=s(2265),t=s(8779),i=s(4477),c=s(4445),r=s(9531),d=s(1656),o=s(3197),u=s(7714),m=s(6939),h=s(8789),x=s(6971),p=s(6428);function g(){let e;let{collapsed:a}=(0,h.A)(),{success:s,error:t}=(0,x.l)(),[c,g]=(0,l.useState)(null),[j,v]=(0,l.useState)([]),[b,f]=(0,l.useState)([]),[N,y]=(0,l.useState)(!0),[k,C]=(0,l.useState)(!1),[S,w]=(0,l.useState)(null),[_,D]=(0,l.useState)(""),[Z,E]=(0,l.useState)(!1);(0,l.useEffect)(()=>{M()},[]);let M=async()=>{y(!0);try{let e=await (0,p.SC)("/precificacao.php");g(e),v(e.rules||e.regras||[]),f(e.suggestions||e.sugestoes||[])}catch(e){t("Erro ao carregar precificacao")}finally{y(!1)}},A=e=>{w(e),D(String(e.value||e.valor||"")),C(!0)},P=async()=>{if(S){E(!0);try{await (0,p.sg)("/precificacao.php",{rule_id:S.id,value:_}),s("Regra atualizada"),C(!1),M()}catch(e){t("Erro: "+e.message)}finally{E(!1)}}},R=async e=>{try{await (0,p.sg)("/precificacao.php",{action:"apply_suggestion",suggestion_id:e.id}),s("Sugestao aplicada"),M()}catch(e){t("Erro: "+e.message)}},T=e=>null!=e?"R$ ".concat(Number(e).toLocaleString("pt-BR",{minimumFractionDigits:2})):"R$ 0,00";return(0,n.jsxs)("div",{className:"admin-layout",children:[(0,n.jsx)(i.Z,{}),(0,n.jsxs)("main",{className:"admin-main ".concat(a?"main-collapsed":""),children:[(0,n.jsxs)("div",{className:"page-header",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"page-title",children:"Precificacao AI"}),(0,n.jsx)("p",{className:"page-subtitle",children:"Configuracao de precos e analise de margens"})]}),(0,n.jsx)("div",{className:"page-actions",children:(0,n.jsx)("button",{className:"btn btn-secondary",onClick:M,children:"Atualizar"})})]}),(0,n.jsxs)("div",{className:"stats-grid",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:[(0,n.jsx)(o.Z,{icon:"\uD83D\uDCB0",label:"Ticket Medio",value:N?"...":T(null==c?void 0:c.ticket_medio),color:"#f97316"}),(0,n.jsx)(o.Z,{icon:"\uD83D\uDCC8",label:"Margem Media",value:N?"...":null!=(e=null==c?void 0:c.margem_media)?"".concat(Number(e).toFixed(1),"%"):"0%",color:"#22c55e"}),(0,n.jsx)(o.Z,{icon:"\uD83D\uDCCA",label:"Taxa Entrega Media",value:N?"...":T(null==c?void 0:c.taxa_media),color:"#3b82f6"}),(0,n.jsx)(o.Z,{icon:"\uD83E\uDD16",label:"Sugestoes AI",value:N?"...":b.length,color:"#8b5cf6"})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h3",{style:{fontSize:18,fontWeight:600,marginBottom:16},children:"Regras de Precificacao"}),(0,n.jsx)(r.Z,{columns:[{key:"name",label:"Regra",render:(e,a)=>e||a.nome||"-"},{key:"type",label:"Tipo",render:(e,a)=>(0,n.jsx)(d.Z,{label:e||a.tipo||"geral",variant:"neutral"})},{key:"value",label:"Valor Atual",render:(e,a)=>e||a.valor||"-"},{key:"unit",label:"Unidade",render:(e,a)=>e||a.unidade||""},{key:"updated_at",label:"Atualizado",render:(e,a)=>e||a.data||"-"},{key:"actions",label:"Acoes",sortable:!1,render:(e,a)=>(0,n.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:e=>{e.stopPropagation(),A(a)},children:"Editar"})}],data:j,loading:N,searchable:!1,emptyMessage:"Nenhuma regra configurada"})]}),(0,n.jsxs)("div",{className:"card mb-6",children:[(0,n.jsx)("div",{className:"card-header",children:(0,n.jsx)("h3",{className:"card-title",children:"Sugestoes AI de Preco"})}),0===b.length?(0,n.jsx)("p",{className:"text-muted p-4",children:"Nenhuma sugestao no momento"}):(0,n.jsx)("div",{className:"flex flex-col gap-3 p-4",children:b.map((e,a)=>(0,n.jsxs)("div",{style:{padding:16,background:"var(--bg)",border:"1px solid var(--border)",borderRadius:"var(--radius)"},children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)("strong",{className:"text-sm",children:e.title||e.titulo||"Sugestao #".concat(a+1)}),(0,n.jsx)(d.Z,{label:e.impact||e.impacto||"medio",variant:"alto"===e.impact||"high"===e.impact?"success":"info"})]}),(0,n.jsx)("p",{className:"text-sm text-muted mb-3",children:e.description||e.descricao||""}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("span",{className:"text-xs text-dim",children:["Impacto estimado: ",e.estimated_impact||e.impacto_estimado||"-"]}),(0,n.jsx)("button",{className:"btn btn-sm btn-primary",onClick:()=>R(e),children:"Aplicar"})]})]},a))})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("h3",{className:"card-title mb-4",children:"Configuracao de Precificacao Dinamica"}),(0,n.jsxs)("div",{className:"detail-grid",children:[(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"detail-label",children:"Preco Dinamico"}),(0,n.jsx)("span",{className:"detail-value",children:(0,n.jsx)(d.Z,{label:(null==c?void 0:c.dynamic_enabled)?"Ativo":"Inativo",variant:(null==c?void 0:c.dynamic_enabled)?"success":"neutral"})})]}),(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"detail-label",children:"Variacao Maxima"}),(0,n.jsxs)("span",{className:"detail-value",children:[(null==c?void 0:c.max_variation)||"20","%"]})]}),(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"detail-label",children:"Fator Demanda"}),(0,n.jsxs)("span",{className:"detail-value",children:[(null==c?void 0:c.demand_factor)||"1.0","x"]})]}),(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"detail-label",children:"Ultima Analise AI"}),(0,n.jsx)("span",{className:"detail-value",children:(null==c?void 0:c.last_analysis)||"-"})]})]})]}),(0,n.jsx)(u.Z,{isOpen:k,onClose:()=>C(!1),title:"Editar Regra",size:"sm",children:S&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"form-label",children:S.name||S.nome}),(0,n.jsx)("input",{type:"text",className:"form-input",value:_,onChange:e=>D(e.target.value)}),S.unit||S.unidade?(0,n.jsxs)("p",{className:"text-xs text-dim mt-1",children:["Unidade: ",S.unit||S.unidade]}):null]}),(0,n.jsxs)("div",{className:"flex gap-2",style:{justifyContent:"flex-end"},children:[(0,n.jsx)("button",{className:"btn btn-secondary",onClick:()=>C(!1),children:"Cancelar"}),(0,n.jsx)("button",{className:"btn btn-primary",onClick:P,disabled:Z,children:Z?"Salvando...":"Salvar"})]})]})})]}),(0,n.jsx)(m.Z,{})]})}function j(){return(0,n.jsx)(t.Z,{children:(0,n.jsx)(c.Z,{section:"pricing",children:(0,n.jsx)(g,{})})})}}},function(e){e.O(0,[3448,1006,2971,2117,1744],function(){return e(e.s=9675)}),_N_E=e.O()}]);