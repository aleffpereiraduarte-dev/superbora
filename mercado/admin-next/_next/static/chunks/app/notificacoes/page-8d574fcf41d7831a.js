(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4227],{4611:function(e,a,s){Promise.resolve().then(s.bind(s,4799))},4445:function(e,a,s){"use strict";s.d(a,{Z:function(){return l}});var n=s(7437),t=s(8253);function l(e){let{section:a,children:s}=e,{hasPermission:l}=(0,t.q)();return l(a)?(0,n.jsx)(n.Fragment,{children:s}):(0,n.jsxs)("div",{className:"role-denied",children:[(0,n.jsx)("div",{className:"role-denied-icon",children:"\uD83D\uDD12"}),(0,n.jsx)("h2",{children:"Acesso Negado"}),(0,n.jsx)("p",{children:"Voce nao tem permissao para acessar esta secao."}),(0,n.jsx)("p",{className:"role-denied-hint",children:"Contate o administrador para solicitar acesso."})]})}},1656:function(e,a,s){"use strict";s.d(a,{X:function(){return i},Z:function(){return l}});var n=s(7437);let t={success:"badge-success",warning:"badge-warning",danger:"badge-danger",info:"badge-info",neutral:"badge-neutral"};function l(e){let{label:a,variant:s="neutral"}=e;return(0,n.jsx)("span",{className:"badge ".concat(t[s]||t.neutral),children:a})}function i(e){return({pendente:"warning",confirmado:"info",preparando:"info",pronto:"info",coletado:"info",em_entrega:"warning",entregue:"success",cancelado:"danger",recusado:"danger",ativo:"success",inativo:"neutral",bloqueado:"danger",online:"success",offline:"neutral",aprovado:"success",reprovado:"danger",pago:"success",pendente_pagamento:"warning",processando:"info",aberto:"warning",resolvido:"success",fechado:"neutral"})[e]||"neutral"}},9531:function(e,a,s){"use strict";s.d(a,{Z:function(){return r}});var n=s(7437),t=s(2265);function l(e){let{value:a,onChange:s,placeholder:l="Buscar...",delay:i=300}=e,[r,c]=(0,t.useState)(a||""),o=(0,t.useRef)(null);return(0,t.useEffect)(()=>{c(a||"")},[a]),(0,n.jsxs)("div",{className:"search-input-wrapper",children:[(0,n.jsx)("span",{className:"search-input-icon",children:"\uD83D\uDD0D"}),(0,n.jsx)("input",{type:"text",className:"search-input",value:r,onChange:e=>{let a=e.target.value;c(a),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{null==s||s(a)},i)},placeholder:l}),r&&(0,n.jsx)("button",{className:"search-input-clear",onClick:()=>{c(""),null==s||s("")},children:"✕"})]})}function i(e){let{page:a,totalPages:s,onPageChange:t}=e,l=[],i=Math.max(1,a-Math.floor(2.5)),r=Math.min(s,i+5-1);r-i<4&&(i=Math.max(1,r-5+1));for(let e=i;e<=r;e++)l.push(e);return(0,n.jsxs)("div",{className:"pagination",children:[(0,n.jsx)("button",{className:"pagination-btn",disabled:a<=1,onClick:()=>t(a-1),children:"‹ Anterior"}),i>1&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:"pagination-btn",onClick:()=>t(1),children:"1"}),i>2&&(0,n.jsx)("span",{className:"pagination-dots",children:"..."})]}),l.map(e=>(0,n.jsx)("button",{className:"pagination-btn ".concat(e===a?"pagination-active":""),onClick:()=>t(e),children:e},e)),r<s&&(0,n.jsxs)(n.Fragment,{children:[r<s-1&&(0,n.jsx)("span",{className:"pagination-dots",children:"..."}),(0,n.jsx)("button",{className:"pagination-btn",onClick:()=>t(s),children:s})]}),(0,n.jsx)("button",{className:"pagination-btn",disabled:a>=s,onClick:()=>t(a+1),children:"Proximo ›"})]})}function r(e){let{columns:a=[],data:s=[],loading:r=!1,searchable:c=!0,pageSize:o=15,emptyMessage:d="Nenhum registro encontrado",onRowClick:u}=e,[m,h]=(0,t.useState)(""),[g,p]=(0,t.useState)(null),[x,v]=(0,t.useState)("asc"),[j,f]=(0,t.useState)(1),b=(0,t.useMemo)(()=>{if(!m)return s;let e=m.toLowerCase();return s.filter(s=>a.some(a=>{let n=s[a.key];return null!=n&&String(n).toLowerCase().includes(e)}))},[s,m,a]),N=(0,t.useMemo)(()=>g?[...b].sort((e,a)=>{var s,n;let t=null!==(s=e[g])&&void 0!==s?s:"",l=null!==(n=a[g])&&void 0!==n?n:"";if("number"==typeof t&&"number"==typeof l)return"asc"===x?t-l:l-t;let i=String(t).localeCompare(String(l));return"asc"===x?i:-i}):b,[b,g,x]),y=Math.max(1,Math.ceil(N.length/o)),k=N.slice((j-1)*o,j*o),C=e=>{g===e?v(e=>"asc"===e?"desc":"asc"):(p(e),v("asc"))};return r?(0,n.jsxs)("div",{className:"datatable",children:[c&&(0,n.jsx)("div",{className:"datatable-toolbar",children:(0,n.jsx)(l,{value:"",onChange:()=>{},placeholder:"Buscar..."})}),(0,n.jsx)("div",{className:"datatable-skeleton",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,n.jsx)("div",{className:"skeleton-row",children:a.map((e,a)=>(0,n.jsx)("div",{className:"skeleton-cell"},a))},s))})]}):(0,n.jsxs)("div",{className:"datatable",children:[c&&(0,n.jsxs)("div",{className:"datatable-toolbar",children:[(0,n.jsx)(l,{value:m,onChange:e=>{h(e),f(1)},placeholder:"Buscar na tabela..."}),(0,n.jsxs)("span",{className:"datatable-count",children:[b.length," registro(s)"]})]}),(0,n.jsx)("div",{className:"datatable-wrapper",children:(0,n.jsxs)("table",{className:"datatable-table",children:[(0,n.jsx)("thead",{children:(0,n.jsx)("tr",{children:a.map(e=>(0,n.jsxs)("th",{onClick:()=>!1!==e.sortable&&C(e.key),className:!1!==e.sortable?"sortable":"",style:e.width?{width:e.width}:void 0,children:[e.label,g===e.key&&(0,n.jsx)("span",{className:"sort-indicator",children:"asc"===x?" ▲":" ▼"})]},e.key))})}),(0,n.jsx)("tbody",{children:0===k.length?(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:a.length,className:"datatable-empty",children:d})}):k.map((e,s)=>(0,n.jsx)("tr",{onClick:()=>null==u?void 0:u(e),className:u?"clickable-row":"",children:a.map(a=>{var s;return(0,n.jsx)("td",{children:a.render?a.render(e[a.key],e):null!==(s=e[a.key])&&void 0!==s?s:"-"},a.key)})},e.id||s))})]})}),y>1&&(0,n.jsx)(i,{page:j,totalPages:y,onPageChange:f})]})}},6939:function(e,a,s){"use strict";s.d(a,{Z:function(){return i}});var n=s(7437),t=s(6971);let l={success:"&#10003;",error:"&#10007;",warning:"&#9888;",info:"&#8505;"};function i(){let{toasts:e,removeToast:a}=(0,t.l)();return 0===e.length?null:(0,n.jsx)("div",{className:"toast-container",children:e.map(e=>(0,n.jsxs)("div",{className:"toast toast-".concat(e.type),children:[(0,n.jsx)("span",{className:"toast-icon",dangerouslySetInnerHTML:{__html:l[e.type]||l.info}}),(0,n.jsx)("span",{className:"toast-message",children:e.message}),(0,n.jsx)("button",{className:"toast-close",onClick:()=>a(e.id),children:"✕"})]},e.id))})}},4799:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return p}});var n=s(7437),t=s(2265),l=s(8779),i=s(4477),r=s(4445),c=s(9531),o=s(1656),d=s(6939),u=s(8789),m=s(6971),h=s(6428);function g(){let{collapsed:e}=(0,u.A)(),{success:a,error:s}=(0,m.l)(),[l,r]=(0,t.useState)([]),[g,p]=(0,t.useState)(!0),[x,v]=(0,t.useState)(!1),[j,f]=(0,t.useState)([]),[b,N]=(0,t.useState)({title:"",message:"",target:"all",segment:"",channel:"push",schedule:""});(0,t.useEffect)(()=>{k(),y()},[]);let y=async()=>{try{let e=await (0,h.SC)("/segments.php");f(e.segments||[])}catch(e){console.warn("Erro ao carregar segmentos:",e.message)}},k=async()=>{p(!0);try{let e=await (0,h.SC)("/notificacoes.php");r(e.notifications||e.notificacoes||e.data||[])}catch(e){s("Erro ao carregar historico")}finally{p(!1)}},C=async()=>{if(!b.title.trim()||!b.message.trim()){s("Preencha titulo e mensagem");return}if("segment"===b.target&&!b.segment){s("Selecione um segmento de cliente");return}v(!0);try{await (0,h.sg)("/notificacoes.php",{title:b.title,message:b.message,target:"segment"===b.target?"segment":b.target,segment:"segment"===b.target?b.segment:null,channel:b.channel,schedule:b.schedule||null}),a("Notificacao enviada com sucesso"),N({title:"",message:"",target:"all",segment:"",channel:"push",schedule:""}),k()}catch(e){s("Erro: "+e.message)}finally{v(!1)}},S={push:"Push",email:"E-mail",sms:"SMS",all:"Todos"},w={new_users:"Novos",first_order:"1o Pedido",regular:"Regulares",inactive:"Inativos",vip:"VIP",at_risk:"Em Risco"},E={all:"Todos",clients:"Clientes",shoppers:"Shoppers",partners:"Parceiros",segment:"Segmento"};return(0,n.jsxs)("div",{className:"admin-layout",children:[(0,n.jsx)(i.Z,{}),(0,n.jsxs)("main",{className:"admin-main ".concat(e?"main-collapsed":""),children:[(0,n.jsxs)("div",{className:"page-header",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"page-title",children:"Notificacoes"}),(0,n.jsx)("p",{className:"page-subtitle",children:"Enviar notificacoes e ver historico"})]}),(0,n.jsx)("div",{className:"page-actions",children:(0,n.jsx)("button",{className:"btn btn-secondary",onClick:k,children:"Atualizar"})})]}),(0,n.jsxs)("div",{className:"card mb-6",children:[(0,n.jsx)("h3",{className:"card-title mb-4",children:"Enviar Notificacao"}),(0,n.jsxs)("div",{className:"grid-2 gap-4",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"form-label",children:"Titulo"}),(0,n.jsx)("input",{className:"form-input",value:b.title,onChange:e=>N({...b,title:e.target.value}),placeholder:"Titulo da notificacao"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"form-label",children:"Canal"}),(0,n.jsxs)("select",{className:"form-select",value:b.channel,onChange:e=>N({...b,channel:e.target.value}),children:[(0,n.jsx)("option",{value:"push",children:"Push Notification"}),(0,n.jsx)("option",{value:"email",children:"E-mail"}),(0,n.jsx)("option",{value:"sms",children:"SMS"}),(0,n.jsx)("option",{value:"all",children:"Todos os Canais"})]})]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"form-label",children:"Mensagem"}),(0,n.jsx)("textarea",{className:"form-textarea",value:b.message,onChange:e=>N({...b,message:e.target.value}),placeholder:"Escreva a mensagem...",rows:3})]}),(0,n.jsxs)("div",{className:"grid-2 gap-4",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"form-label",children:"Publico Alvo"}),(0,n.jsxs)("select",{className:"form-select",value:b.target,onChange:e=>N({...b,target:e.target.value,segment:""}),children:[(0,n.jsx)("option",{value:"all",children:"Todos"}),(0,n.jsx)("option",{value:"clients",children:"Apenas Clientes"}),(0,n.jsx)("option",{value:"shoppers",children:"Apenas Shoppers"}),(0,n.jsx)("option",{value:"partners",children:"Apenas Parceiros"}),(0,n.jsx)("option",{value:"segment",children:"Por Segmento de Cliente"})]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"form-label",children:"Agendar para (opcional)"}),(0,n.jsx)("input",{className:"form-input",type:"datetime-local",value:b.schedule,onChange:e=>N({...b,schedule:e.target.value})})]})]}),"segment"===b.target&&(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"form-label",children:"Segmento de Cliente"}),(0,n.jsxs)("select",{className:"form-select",value:b.segment,onChange:e=>N({...b,segment:e.target.value}),children:[(0,n.jsx)("option",{value:"",children:"Selecione um segmento..."}),j.length>0?j.map(e=>(0,n.jsxs)("option",{value:e.key,children:[e.label," - ",e.description," (",e.count," clientes)"]},e.key)):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("option",{value:"new_users",children:"Novos Usuarios"}),(0,n.jsx)("option",{value:"first_order",children:"Primeiro Pedido"}),(0,n.jsx)("option",{value:"regular",children:"Regulares"}),(0,n.jsx)("option",{value:"inactive",children:"Inativos"}),(0,n.jsx)("option",{value:"vip",children:"VIP"}),(0,n.jsx)("option",{value:"at_risk",children:"Em Risco"})]})]}),b.segment&&j.length>0&&(()=>{let e=j.find(e=>e.key===b.segment);return e?(0,n.jsxs)("div",{style:{marginTop:6,padding:"8px 12px",background:"#eff6ff",borderRadius:6,fontSize:13,color:"#1e40af"},children:["Esta notificacao sera enviada para ",(0,n.jsx)("strong",{children:e.count})," clientes (",e.label,")"]}):null})()]}),(0,n.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,n.jsx)("button",{className:"btn btn-primary",onClick:C,disabled:x,children:x?"Enviando...":b.schedule?"Agendar Envio":"Enviar Agora"})})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("h3",{className:"card-title mb-4",children:"Historico de Notificacoes"}),(0,n.jsx)(c.Z,{columns:[{key:"id",label:"ID",render:e=>(0,n.jsxs)("strong",{children:["#",e]})},{key:"title",label:"Titulo",render:(e,a)=>e||a.titulo||"-"},{key:"message",label:"Mensagem",render:(e,a)=>(0,n.jsx)("span",{className:"truncate",style:{maxWidth:200,display:"inline-block"},children:e||a.mensagem||"-"})},{key:"target",label:"Alvo",render:(e,a)=>{let s=e||a.alvo||"all",t=a.segment||a.segmento;return"segment"===s&&t?(0,n.jsx)(o.Z,{label:w[t]||t,variant:"warning"}):(0,n.jsx)(o.Z,{label:E[s]||s,variant:"info"})}},{key:"channel",label:"Canal",render:(e,a)=>(0,n.jsx)(o.Z,{label:S[e||a.canal]||e||a.canal||"Push",variant:"neutral"})},{key:"sent_count",label:"Enviados",render:(e,a)=>e||a.total_enviados||0},{key:"read_count",label:"Lidos",render:(e,a)=>e||a.total_lidos||0},{key:"status",label:"Status",render:e=>(0,n.jsx)(o.Z,{label:"sent"===e||"enviado"===e?"Enviado":"scheduled"===e||"agendado"===e?"Agendado":e||"Enviado",variant:"sent"===e||"enviado"===e?"success":"warning"})},{key:"created_at",label:"Data",render:(e,a)=>e||a.data||"-"}],data:l,loading:g,emptyMessage:"Nenhuma notificacao enviada"})]})]}),(0,n.jsx)(d.Z,{})]})}function p(){return(0,n.jsx)(l.Z,{children:(0,n.jsx)(r.Z,{section:"notifications",children:(0,n.jsx)(g,{})})})}}},function(e){e.O(0,[3448,1006,2971,2117,1744],function(){return e(e.s=4611)}),_N_E=e.O()}]);