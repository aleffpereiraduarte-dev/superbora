(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1929],{5128:function(e,t,s){Promise.resolve().then(s.bind(s,645))},645:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var a=s(7437),n=s(2265),r=s(8779),i=s(4477),c=s(4445),d=s(1656),l=s(6939),o=s(8789),u=s(6971),m=s(6428);function x(){let{collapsed:e}=(0,o.A)(),{success:t,error:s}=(0,u.l)(),r=(0,n.useRef)(null),[c,x]=(0,n.useState)([]),[p,g]=(0,n.useState)(null),[h,f]=(0,n.useState)([]),[v,j]=(0,n.useState)(!0),[y,_]=(0,n.useState)(!1),[b,N]=(0,n.useState)(""),[w,k]=(0,n.useState)(!1),[C,S]=(0,n.useState)("");(0,n.useEffect)(()=>{E()},[]),(0,n.useEffect)(()=>{var e;null===(e=r.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[h]),(0,n.useEffect)(()=>{if(!p)return;let e=setInterval(()=>Z(p,!0),1e4);return()=>clearInterval(e)},[p,Z]);let E=async()=>{j(!0);try{let e=await (0,m.SC)("/chat-central.php?list=1");x(e.conversations||e.conversas||e.data||[])}catch(e){s("Erro ao carregar conversas")}finally{j(!1)}},Z=(0,n.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t||_(!0);try{let t=e.ticket_id?"ticket_id=".concat(e.ticket_id):"order_id=".concat(e.order_id),s=await (0,m.SC)("/chat-central.php?".concat(t));f(s.messages||s.mensagens||s.data||[])}catch(e){t||s("Erro ao carregar mensagens")}finally{t||_(!1)}},[s]),D=e=>{g(e),N(""),Z(e)},z=async()=>{if(b.trim()&&p){k(!0);try{let e={message:b,sender_type:"admin"};p.ticket_id&&(e.ticket_id=p.ticket_id),p.order_id&&(e.order_id=p.order_id),await (0,m.sg)("/chat-central.php",e),N(""),Z(p,!0)}catch(e){s("Erro: "+e.message)}finally{k(!1)}}},L=c.filter(e=>{if(!C)return!0;let t=C.toLowerCase();return(e.customer_name||e.cliente_nome||"").toLowerCase().includes(t)||(e.subject||e.assunto||"").toLowerCase().includes(t)||String(e.ticket_id||e.order_id||"").includes(t)});return(0,a.jsxs)("div",{className:"admin-layout",children:[(0,a.jsx)(i.Z,{}),(0,a.jsxs)("main",{className:"admin-main ".concat(e?"main-collapsed":""),children:[(0,a.jsxs)("div",{className:"page-header",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"page-title",children:"Chat Central"}),(0,a.jsx)("p",{className:"page-subtitle",children:"Central de mensagens com clientes e shoppers"})]}),(0,a.jsx)("div",{className:"page-actions",children:(0,a.jsx)("button",{className:"btn btn-secondary",onClick:E,children:"Atualizar"})})]}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"320px 1fr",gap:16,height:"calc(100vh - 180px)",minHeight:500},children:[(0,a.jsxs)("div",{className:"card",style:{display:"flex",flexDirection:"column",overflow:"hidden",padding:0},children:[(0,a.jsx)("div",{style:{padding:12,borderBottom:"1px solid var(--border)"},children:(0,a.jsx)("input",{className:"form-input",placeholder:"Buscar conversa...",value:C,onChange:e=>S(e.target.value),style:{width:"100%"}})}),(0,a.jsx)("div",{style:{flex:1,overflowY:"auto"},children:v?(0,a.jsx)("div",{className:"loading-spinner",style:{padding:32}}):0===L.length?(0,a.jsx)("p",{className:"text-muted text-sm",style:{padding:16},children:"Nenhuma conversa"}):L.map((e,t)=>{let s=p&&(e.ticket_id&&e.ticket_id===p.ticket_id||e.order_id&&e.order_id===p.order_id);return(0,a.jsxs)("div",{onClick:()=>D(e),style:{padding:"12px 16px",borderBottom:"1px solid var(--border)",cursor:"pointer",background:s?"rgba(59, 130, 246, 0.1)":"transparent"},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("strong",{className:"text-sm",children:e.customer_name||e.cliente_nome||"Cliente"}),(0,a.jsx)("span",{className:"text-xs text-muted",children:e.last_message_at||e.ultima_msg||""})]}),(0,a.jsxs)("p",{className:"text-xs text-muted",style:{margin:"2px 0 0",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.ticket_id?"Ticket #".concat(e.ticket_id):"Pedido #".concat(e.order_id)," - ",e.subject||e.assunto||e.last_message||"Sem mensagem"]}),e.unread_count>0&&(0,a.jsxs)("span",{className:"badge badge-danger",style:{fontSize:"0.65rem",marginTop:4},children:[e.unread_count," nova(s)"]})]},e.ticket_id||e.order_id||t)})})]}),(0,a.jsx)("div",{className:"card",style:{display:"flex",flexDirection:"column",overflow:"hidden",padding:0},children:p?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--border)",background:"var(--bg)"},children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:p.customer_name||p.cliente_nome||"Cliente"}),(0,a.jsx)("span",{className:"text-sm text-muted",style:{marginLeft:8},children:p.ticket_id?"Ticket #".concat(p.ticket_id):"Pedido #".concat(p.order_id)})]}),(0,a.jsx)(d.Z,{label:p.status||"aberto",variant:(0,d.X)(p.status||"aberto")})]})}),(0,a.jsxs)("div",{style:{flex:1,overflowY:"auto",padding:16},children:[y?(0,a.jsx)("div",{className:"loading-spinner"}):0===h.length?(0,a.jsx)("p",{className:"text-muted text-sm",style:{textAlign:"center"},children:"Nenhuma mensagem"}):h.map((e,t)=>{let s="admin"===e.sender_type||"admin"===e.tipo_remetente;return(0,a.jsxs)("div",{style:{marginBottom:8,padding:10,borderRadius:"var(--radius)",background:s?"rgba(59, 130, 246, 0.1)":"var(--bg)",border:"1px solid var(--border)",maxWidth:"80%",marginLeft:s?"auto":0,marginRight:s?0:"auto"},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("strong",{style:{fontSize:"0.75rem",color:s?"var(--primary)":"var(--text)"},children:s?"Admin":e.sender_name||e.remetente||"Cliente"}),(0,a.jsx)("span",{style:{fontSize:"0.65rem",color:"var(--text-dim)"},children:e.created_at||e.data||""})]}),(0,a.jsx)("p",{style:{margin:0,fontSize:"0.85rem",whiteSpace:"pre-wrap"},children:e.message||e.mensagem||""})]},e.id||t)}),(0,a.jsx)("div",{ref:r})]}),(0,a.jsx)("div",{style:{padding:12,borderTop:"1px solid var(--border)"},children:(0,a.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,a.jsx)("textarea",{className:"form-textarea",value:b,onChange:e=>N(e.target.value),placeholder:"Escreva uma mensagem...",rows:2,style:{flex:1,resize:"none"},onKeyDown:e=>{"Enter"===e.key&&e.ctrlKey&&z()}}),(0,a.jsx)("button",{className:"btn btn-primary",onClick:z,disabled:w||!b.trim(),style:{alignSelf:"flex-end"},children:w?"...":"Enviar"})]})})]}):(0,a.jsx)("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,a.jsx)("p",{className:"text-muted",children:"Selecione uma conversa"})})})]})]}),(0,a.jsx)(l.Z,{})]})}function p(){return(0,a.jsx)(r.Z,{children:(0,a.jsx)(c.Z,{section:"support",children:(0,a.jsx)(x,{})})})}},4445:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var a=s(7437),n=s(8253);function r(e){let{section:t,children:s}=e,{hasPermission:r}=(0,n.q)();return r(t)?(0,a.jsx)(a.Fragment,{children:s}):(0,a.jsxs)("div",{className:"role-denied",children:[(0,a.jsx)("div",{className:"role-denied-icon",children:"\uD83D\uDD12"}),(0,a.jsx)("h2",{children:"Acesso Negado"}),(0,a.jsx)("p",{children:"Voce nao tem permissao para acessar esta secao."}),(0,a.jsx)("p",{className:"role-denied-hint",children:"Contate o administrador para solicitar acesso."})]})}},1656:function(e,t,s){"use strict";s.d(t,{X:function(){return i},Z:function(){return r}});var a=s(7437);let n={success:"badge-success",warning:"badge-warning",danger:"badge-danger",info:"badge-info",neutral:"badge-neutral"};function r(e){let{label:t,variant:s="neutral"}=e;return(0,a.jsx)("span",{className:"badge ".concat(n[s]||n.neutral),children:t})}function i(e){return({pendente:"warning",confirmado:"info",preparando:"info",pronto:"info",coletado:"info",em_entrega:"warning",entregue:"success",cancelado:"danger",recusado:"danger",ativo:"success",inativo:"neutral",bloqueado:"danger",online:"success",offline:"neutral",aprovado:"success",reprovado:"danger",pago:"success",pendente_pagamento:"warning",processando:"info",aberto:"warning",resolvido:"success",fechado:"neutral"})[e]||"neutral"}},6939:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var a=s(7437),n=s(6971);let r={success:"&#10003;",error:"&#10007;",warning:"&#9888;",info:"&#8505;"};function i(){let{toasts:e,removeToast:t}=(0,n.l)();return 0===e.length?null:(0,a.jsx)("div",{className:"toast-container",children:e.map(e=>(0,a.jsxs)("div",{className:"toast toast-".concat(e.type),children:[(0,a.jsx)("span",{className:"toast-icon",dangerouslySetInnerHTML:{__html:r[e.type]||r.info}}),(0,a.jsx)("span",{className:"toast-message",children:e.message}),(0,a.jsx)("button",{className:"toast-close",onClick:()=>t(e.id),children:"âœ•"})]},e.id))})}}},function(e){e.O(0,[3448,1006,2971,2117,1744],function(){return e(e.s=5128)}),_N_E=e.O()}]);