(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2038],{3125:function(e,a,s){Promise.resolve().then(s.bind(s,3048))},4445:function(e,a,s){"use strict";s.d(a,{Z:function(){return r}});var n=s(7437),l=s(8253);function r(e){let{section:a,children:s}=e,{hasPermission:r}=(0,l.q)();return r(a)?(0,n.jsx)(n.Fragment,{children:s}):(0,n.jsxs)("div",{className:"role-denied",children:[(0,n.jsx)("div",{className:"role-denied-icon",children:"\uD83D\uDD12"}),(0,n.jsx)("h2",{children:"Acesso Negado"}),(0,n.jsx)("p",{children:"Voce nao tem permissao para acessar esta secao."}),(0,n.jsx)("p",{className:"role-denied-hint",children:"Contate o administrador para solicitar acesso."})]})}},1656:function(e,a,s){"use strict";s.d(a,{X:function(){return t},Z:function(){return r}});var n=s(7437);let l={success:"badge-success",warning:"badge-warning",danger:"badge-danger",info:"badge-info",neutral:"badge-neutral"};function r(e){let{label:a,variant:s="neutral"}=e;return(0,n.jsx)("span",{className:"badge ".concat(l[s]||l.neutral),children:a})}function t(e){return({pendente:"warning",confirmado:"info",preparando:"info",pronto:"info",coletado:"info",em_entrega:"warning",entregue:"success",cancelado:"danger",recusado:"danger",ativo:"success",inativo:"neutral",bloqueado:"danger",online:"success",offline:"neutral",aprovado:"success",reprovado:"danger",pago:"success",pendente_pagamento:"warning",processando:"info",aberto:"warning",resolvido:"success",fechado:"neutral"})[e]||"neutral"}},7714:function(e,a,s){"use strict";s.d(a,{Z:function(){return t}});var n=s(7437),l=s(2265);let r={sm:"400px",md:"560px",lg:"720px",xl:"960px"};function t(e){let{isOpen:a,onClose:s,title:t,children:i,size:c="md"}=e;return((0,l.useEffect)(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[a]),(0,l.useEffect)(()=>{let e=e=>{"Escape"===e.key&&a&&(null==s||s())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a,s]),a)?(0,n.jsx)("div",{className:"modal-overlay",onClick:s,children:(0,n.jsxs)("div",{className:"modal-container",style:{maxWidth:r[c]||r.md},onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:"modal-header",children:[(0,n.jsx)("h3",{className:"modal-title",children:t}),(0,n.jsx)("button",{className:"modal-close",onClick:s,children:"âœ•"})]}),(0,n.jsx)("div",{className:"modal-body",children:i})]})}):null}},3048:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return b}});var n=s(7437),l=s(2265),r=s(8779),t=s(4477),i=s(4445),c=s(1656),d=s(7714),o=s(6939),m=s(8789),u=s(6971),h=s(6428);let p=[{key:"pendente",label:"Pendente",color:"#eab308"},{key:"confirmado",label:"Confirmado",color:"#3b82f6"},{key:"preparando",label:"Preparando",color:"#8b5cf6"},{key:"pronto",label:"Pronto",color:"#06b6d4"},{key:"em_entrega",label:"Em Entrega",color:"#f97316"},{key:"entregue",label:"Entregue",color:"#22c55e"}];function x(){let{collapsed:e}=(0,m.A)(),{success:a,error:s}=(0,u.l)(),[r,i]=(0,l.useState)([]),[x,b]=(0,l.useState)(null),[j,N]=(0,l.useState)(!0),[v,f]=(0,l.useState)(!1),[g,y]=(0,l.useState)([]),[k,_]=(0,l.useState)(""),C=(0,l.useRef)(null);(0,l.useEffect)(()=>(w(),C.current=setInterval(w,1e4),()=>clearInterval(C.current)),[]);let w=async()=>{try{let e=await (0,h.SC)("/orders.php?active=1");if(i(e.orders||e.data||[]),!j)return}catch(e){}finally{N(!1)}},S=e=>r.filter(a=>a.status===e),E=async(e,n)=>{try{await (0,h.sg)("/order-status.php",{order_id:e,status:n}),a("Status atualizado"),w()}catch(e){s("Erro: "+e.message)}},P=async e=>{b(e);try{let e=await (0,h.SC)("/shoppers.php?status=online");y(e.shoppers||e.data||[])}catch(e){y([])}f(!0)},Z=async()=>{if(k&&x)try{await (0,h.sg)("/dispatch.php",{order_id:x.id||x.order_id,shopper_id:k}),a("Shopper atribuido"),f(!1),_(""),w()}catch(e){s("Erro: "+e.message)}},A=e=>null!=e?"R$ ".concat(Number(e).toLocaleString("pt-BR",{minimumFractionDigits:2})):"R$ 0,00";return(0,n.jsxs)("div",{className:"admin-layout",children:[(0,n.jsx)(t.Z,{}),(0,n.jsxs)("main",{className:"admin-main ".concat(e?"main-collapsed":""),children:[(0,n.jsxs)("div",{className:"page-header",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"page-title",children:"Central de Operacoes"}),(0,n.jsx)("p",{className:"page-subtitle",children:"Visao Kanban em tempo real (atualiza a cada 10s)"})]}),(0,n.jsx)("div",{className:"page-actions",children:(0,n.jsx)("button",{className:"btn btn-secondary",onClick:w,children:"Atualizar"})})]}),j?(0,n.jsxs)("div",{className:"auth-loading",children:[(0,n.jsx)("div",{className:"auth-loading-spinner"}),(0,n.jsx)("p",{children:"Carregando pedidos..."})]}):(0,n.jsxs)("div",{style:{display:"flex",gap:16},children:[(0,n.jsx)("div",{className:"kanban",style:{flex:1},children:p.map(e=>{let a=S(e.key);return(0,n.jsxs)("div",{className:"kanban-column",children:[(0,n.jsxs)("div",{className:"kanban-column-header",style:{borderBottom:"2px solid ".concat(e.color)},children:[(0,n.jsx)("span",{children:e.label}),(0,n.jsx)("span",{className:"kanban-column-count",children:a.length})]}),(0,n.jsxs)("div",{className:"kanban-column-body",children:[a.map(e=>(0,n.jsxs)("div",{className:"kanban-card",onClick:()=>b(e),style:(null==x?void 0:x.id)===e.id?{borderColor:"var(--accent)"}:void 0,children:[(0,n.jsxs)("div",{className:"kanban-card-id",children:["#",e.id||e.order_id]}),(0,n.jsx)("div",{className:"kanban-card-title",children:e.cliente_nome||e.customer_name||"-"}),(0,n.jsx)("div",{className:"kanban-card-meta",children:e.parceiro_nome||e.partner_name||"-"}),(0,n.jsx)("div",{className:"kanban-card-meta",style:{fontWeight:600},children:A(e.total)})]},e.id||e.order_id)),0===a.length&&(0,n.jsx)("p",{className:"text-xs text-dim text-center p-4",children:"Vazio"})]})]},e.key)})}),x&&(0,n.jsx)("div",{style:{width:360,flexShrink:0},children:(0,n.jsxs)("div",{className:"card",children:[(0,n.jsxs)("div",{className:"card-header",children:[(0,n.jsxs)("h3",{className:"card-title",children:["Pedido #",x.id||x.order_id]}),(0,n.jsx)(c.Z,{label:x.status,variant:(0,c.X)(x.status)})]}),(0,n.jsxs)("div",{className:"detail-grid",children:[(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"detail-label",children:"Cliente"}),(0,n.jsx)("span",{className:"detail-value",children:x.cliente_nome||x.customer_name||"-"})]}),(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"detail-label",children:"Parceiro"}),(0,n.jsx)("span",{className:"detail-value",children:x.parceiro_nome||x.partner_name||"-"})]}),(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"detail-label",children:"Shopper"}),(0,n.jsx)("span",{className:"detail-value",children:x.shopper_nome||x.shopper_name||"Nao atribuido"})]}),(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"detail-label",children:"Total"}),(0,n.jsx)("span",{className:"detail-value",children:A(x.total)})]}),(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"detail-label",children:"Data"}),(0,n.jsx)("span",{className:"detail-value",children:x.created_at||x.data||"-"})]})]}),(0,n.jsx)("hr",{className:"section-divider"}),(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("span",{className:"form-label",children:"Acoes Rapidas"}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,n.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:()=>P(x),children:"Atribuir Shopper"}),"pendente"===x.status&&(0,n.jsx)("button",{className:"btn btn-sm btn-success",onClick:()=>E(x.id||x.order_id,"confirmado"),children:"Confirmar"}),"confirmado"===x.status&&(0,n.jsx)("button",{className:"btn btn-sm btn-primary",onClick:()=>E(x.id||x.order_id,"preparando"),children:"Preparar"}),"preparando"===x.status&&(0,n.jsx)("button",{className:"btn btn-sm btn-primary",onClick:()=>E(x.id||x.order_id,"pronto"),children:"Pronto"}),"pronto"===x.status&&(0,n.jsx)("button",{className:"btn btn-sm btn-primary",onClick:()=>E(x.id||x.order_id,"em_entrega"),children:"Entregar"}),"em_entrega"===x.status&&(0,n.jsx)("button",{className:"btn btn-sm btn-success",onClick:()=>E(x.id||x.order_id,"entregue"),children:"Finalizar"}),(0,n.jsx)("button",{className:"btn btn-sm btn-danger",onClick:()=>E(x.id||x.order_id,"cancelado"),children:"Cancelar"})]})]})]})})]}),(0,n.jsxs)(d.Z,{isOpen:v,onClose:()=>f(!1),title:"Atribuir Shopper",size:"sm",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"form-label",children:"Shopper Disponivel"}),(0,n.jsxs)("select",{className:"form-select",value:k,onChange:e=>_(e.target.value),children:[(0,n.jsx)("option",{value:"",children:"Selecione..."}),g.map(e=>(0,n.jsxs)("option",{value:e.id||e.shopper_id,children:[e.name||e.nome," ",e.distance?"(".concat(e.distance,")"):""]},e.id||e.shopper_id))]})]}),(0,n.jsxs)("div",{className:"flex gap-2",style:{justifyContent:"flex-end"},children:[(0,n.jsx)("button",{className:"btn btn-secondary",onClick:()=>f(!1),children:"Cancelar"}),(0,n.jsx)("button",{className:"btn btn-primary",onClick:Z,disabled:!k,children:"Atribuir"})]})]})]}),(0,n.jsx)(o.Z,{})]})}function b(){return(0,n.jsx)(r.Z,{children:(0,n.jsx)(i.Z,{section:"orders",children:(0,n.jsx)(x,{})})})}}},function(e){e.O(0,[3448,5783,2971,2117,1744],function(){return e(e.s=3125)}),_N_E=e.O()}]);