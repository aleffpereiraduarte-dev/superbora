(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1304],{2829:function(e,s,a){Promise.resolve().then(a.bind(a,6331))},4445:function(e,s,a){"use strict";a.d(s,{Z:function(){return r}});var n=a(7437),t=a(8253);function r(e){let{section:s,children:a}=e,{hasPermission:r}=(0,t.q)();return r(s)?(0,n.jsx)(n.Fragment,{children:a}):(0,n.jsxs)("div",{className:"role-denied",children:[(0,n.jsx)("div",{className:"role-denied-icon",children:"\uD83D\uDD12"}),(0,n.jsx)("h2",{children:"Acesso Negado"}),(0,n.jsx)("p",{children:"Voce nao tem permissao para acessar esta secao."}),(0,n.jsx)("p",{className:"role-denied-hint",children:"Contate o administrador para solicitar acesso."})]})}},1656:function(e,s,a){"use strict";a.d(s,{X:function(){return l},Z:function(){return r}});var n=a(7437);let t={success:"badge-success",warning:"badge-warning",danger:"badge-danger",info:"badge-info",neutral:"badge-neutral"};function r(e){let{label:s,variant:a="neutral"}=e;return(0,n.jsx)("span",{className:"badge ".concat(t[a]||t.neutral),children:s})}function l(e){return({pendente:"warning",confirmado:"info",preparando:"info",pronto:"info",coletado:"info",em_entrega:"warning",entregue:"success",cancelado:"danger",recusado:"danger",ativo:"success",inativo:"neutral",bloqueado:"danger",online:"success",offline:"neutral",aprovado:"success",reprovado:"danger",pago:"success",pendente_pagamento:"warning",processando:"info",aberto:"warning",resolvido:"success",fechado:"neutral"})[e]||"neutral"}},7714:function(e,s,a){"use strict";a.d(s,{Z:function(){return l}});var n=a(7437),t=a(2265);let r={sm:"400px",md:"560px",lg:"720px",xl:"960px"};function l(e){let{isOpen:s,onClose:a,title:l,children:i,size:c="md"}=e;return((0,t.useEffect)(()=>(s?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[s]),(0,t.useEffect)(()=>{let e=e=>{"Escape"===e.key&&s&&(null==a||a())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s,a]),s)?(0,n.jsx)("div",{className:"modal-overlay",onClick:a,children:(0,n.jsxs)("div",{className:"modal-container",style:{maxWidth:r[c]||r.md},onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:"modal-header",children:[(0,n.jsx)("h3",{className:"modal-title",children:l}),(0,n.jsx)("button",{className:"modal-close",onClick:a,children:"✕"})]}),(0,n.jsx)("div",{className:"modal-body",children:i})]})}):null}},6939:function(e,s,a){"use strict";a.d(s,{Z:function(){return l}});var n=a(7437),t=a(6971);let r={success:"&#10003;",error:"&#10007;",warning:"&#9888;",info:"&#8505;"};function l(){let{toasts:e,removeToast:s}=(0,t.l)();return 0===e.length?null:(0,n.jsx)("div",{className:"toast-container",children:e.map(e=>(0,n.jsxs)("div",{className:"toast toast-".concat(e.type),children:[(0,n.jsx)("span",{className:"toast-icon",dangerouslySetInnerHTML:{__html:r[e.type]||r.info}}),(0,n.jsx)("span",{className:"toast-message",children:e.message}),(0,n.jsx)("button",{className:"toast-close",onClick:()=>s(e.id),children:"✕"})]},e.id))})}},6331:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return j}});var n=a(7437),t=a(2265),r=a(8779),l=a(4477),i=a(4445),c=a(1656),o=a(7714),d=a(6939),h=a(8789),u=a(6971),m=a(6428);let p=["pendente","confirmado","preparando","pronto","coletado","em_entrega","entregue","cancelado"];function x(){let{collapsed:e}=(0,h.A)(),{success:s,error:a}=(0,u.l)(),[r,i]=(0,t.useState)([]),[x,j]=(0,t.useState)(!0),[f,g]=(0,t.useState)(new Set),[b,v]=(0,t.useState)(!1),[N,y]=(0,t.useState)(!1),[S,C]=(0,t.useState)(""),[w,_]=(0,t.useState)([]),[k,z]=(0,t.useState)(""),[E,A]=(0,t.useState)(!1),[Z,P]=(0,t.useState)("");(0,t.useEffect)(()=>{D()},[Z]);let D=async()=>{j(!0);try{let e=Z?"?status=".concat(Z):"",s=await (0,m.SC)("/orders.php".concat(e));i(s.orders||s.data||[])}catch(e){a("Erro ao carregar pedidos")}finally{j(!1)}},O=e=>{g(s=>{let a=new Set(s);return a.has(e)?a.delete(e):a.add(e),a})},L=async()=>{if(S&&0!==f.size){A(!0);try{let e=Array.from(f);await Promise.all(e.map(e=>(0,m.sg)("/order-status.php",{order_id:e,status:S}))),s("".concat(e.length," pedidos atualizados")),v(!1),C(""),g(new Set),D()}catch(e){a("Erro ao atualizar: "+e.message)}finally{A(!1)}}},R=async()=>{try{let e=await (0,m.SC)("/shoppers.php?status=online");_(e.shoppers||e.data||[])}catch(e){_([])}y(!0)},F=async()=>{if(k&&0!==f.size){A(!0);try{let e=Array.from(f);await Promise.all(e.map(e=>(0,m.sg)("/dispatch.php",{order_id:e,shopper_id:k}))),s("".concat(e.length," pedidos atribuidos")),y(!1),z(""),g(new Set),D()}catch(e){a("Erro: "+e.message)}finally{A(!1)}}},T=async e=>{try{await (0,m.sg)("/order-status.php",{order_id:e,priority:!0}),s("Prioridade marcada"),D()}catch(e){a("Erro: "+e.message)}},q=e=>null!=e?"R$ ".concat(Number(e).toLocaleString("pt-BR",{minimumFractionDigits:2})):"R$ 0,00";return(0,n.jsxs)("div",{className:"admin-layout",children:[(0,n.jsx)(l.Z,{}),(0,n.jsxs)("main",{className:"admin-main ".concat(e?"main-collapsed":""),children:[(0,n.jsxs)("div",{className:"page-header",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"page-title",children:"Gestao de Pedidos"}),(0,n.jsx)("p",{className:"page-subtitle",children:"Operacoes em lote e gestao de workflow"})]}),(0,n.jsxs)("div",{className:"page-actions",children:[f.size>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("span",{className:"text-sm text-muted",children:[f.size," selecionado(s)"]}),(0,n.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>v(!0),children:"Alterar Status"}),(0,n.jsx)("button",{className:"btn btn-secondary btn-sm",onClick:R,children:"Atribuir Shopper"})]}),(0,n.jsx)("button",{className:"btn btn-secondary",onClick:D,children:"Atualizar"})]})]}),(0,n.jsx)("div",{className:"filters-bar",children:(0,n.jsxs)("select",{className:"form-select",value:Z,onChange:e=>P(e.target.value),children:[(0,n.jsx)("option",{value:"",children:"Todos Status"}),p.map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})}),(0,n.jsx)("div",{className:"card",children:(0,n.jsx)("div",{className:"datatable-wrapper",children:(0,n.jsxs)("table",{className:"datatable-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:{width:40},children:(0,n.jsx)("input",{type:"checkbox",checked:f.size===r.length&&r.length>0,onChange:()=>{f.size===r.length?g(new Set):g(new Set(r.map(e=>e.id||e.order_id)))}})}),(0,n.jsx)("th",{children:"ID"}),(0,n.jsx)("th",{children:"Cliente"}),(0,n.jsx)("th",{children:"Parceiro"}),(0,n.jsx)("th",{children:"Shopper"}),(0,n.jsx)("th",{children:"Total"}),(0,n.jsx)("th",{children:"Status"}),(0,n.jsx)("th",{children:"Data"}),(0,n.jsx)("th",{children:"Acoes"})]})}),(0,n.jsx)("tbody",{children:x?[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,n.jsx)("tr",{children:[...Array(9)].map((e,s)=>(0,n.jsx)("td",{children:(0,n.jsx)("div",{className:"skeleton-cell",style:{height:14,borderRadius:4}})},s))},s)):0===r.length?(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:9,className:"datatable-empty",children:"Nenhum pedido encontrado"})}):r.map(e=>{let s=e.id||e.order_id;return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)("input",{type:"checkbox",checked:f.has(s),onChange:()=>O(s)})}),(0,n.jsx)("td",{children:(0,n.jsxs)("strong",{children:["#",s]})}),(0,n.jsx)("td",{children:e.cliente_nome||e.customer_name||"-"}),(0,n.jsx)("td",{children:e.parceiro_nome||e.partner_name||"-"}),(0,n.jsx)("td",{children:e.shopper_nome||e.shopper_name||"-"}),(0,n.jsx)("td",{children:q(e.total)}),(0,n.jsx)("td",{children:(0,n.jsx)(c.Z,{label:e.status||"pendente",variant:(0,c.X)(e.status)})}),(0,n.jsx)("td",{className:"text-muted",children:e.created_at||e.data||"-"}),(0,n.jsx)("td",{children:(0,n.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:()=>T(s),title:"Marcar Prioridade",children:"★"})})]},s)})})]})})}),(0,n.jsxs)(o.Z,{isOpen:b,onClose:()=>v(!1),title:"Alterar Status (".concat(f.size," pedidos)"),size:"sm",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"form-label",children:"Novo Status"}),(0,n.jsxs)("select",{className:"form-select",value:S,onChange:e=>C(e.target.value),children:[(0,n.jsx)("option",{value:"",children:"Selecione..."}),p.map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})]}),(0,n.jsxs)("div",{className:"flex gap-2",style:{justifyContent:"flex-end"},children:[(0,n.jsx)("button",{className:"btn btn-secondary",onClick:()=>v(!1),children:"Cancelar"}),(0,n.jsx)("button",{className:"btn btn-primary",onClick:L,disabled:E||!S,children:E?"Processando...":"Confirmar"})]})]}),(0,n.jsxs)(o.Z,{isOpen:N,onClose:()=>y(!1),title:"Atribuir Shopper (".concat(f.size," pedidos)"),size:"sm",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"form-label",children:"Shopper"}),(0,n.jsxs)("select",{className:"form-select",value:k,onChange:e=>z(e.target.value),children:[(0,n.jsx)("option",{value:"",children:"Selecione..."}),w.map(e=>(0,n.jsx)("option",{value:e.id||e.shopper_id,children:e.name||e.nome},e.id||e.shopper_id))]})]}),(0,n.jsxs)("div",{className:"flex gap-2",style:{justifyContent:"flex-end"},children:[(0,n.jsx)("button",{className:"btn btn-secondary",onClick:()=>y(!1),children:"Cancelar"}),(0,n.jsx)("button",{className:"btn btn-primary",onClick:F,disabled:E||!k,children:E?"Processando...":"Atribuir"})]})]})]}),(0,n.jsx)(d.Z,{})]})}function j(){return(0,n.jsx)(r.Z,{children:(0,n.jsx)(i.Z,{section:"orders",children:(0,n.jsx)(x,{})})})}}},function(e){e.O(0,[3448,1006,2971,2117,1744],function(){return e(e.s=2829)}),_N_E=e.O()}]);