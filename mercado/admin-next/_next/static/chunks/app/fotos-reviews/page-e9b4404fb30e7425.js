(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6910],{6048:function(e,a,t){Promise.resolve().then(t.bind(t,2216))},6428:function(e,a,t){"use strict";t.d(a,{$V:function(){return r},LP:function(){return c},QW:function(){return u},SC:function(){return i},o4:function(){return o},pE:function(){return d},sg:function(){return l}});let n="/api/mercado/admin",s="admin_token";function c(){try{return localStorage.getItem(s)}catch(e){return null}}function o(e){try{e?localStorage.setItem(s,e):localStorage.removeItem(s)}catch(e){}}function r(){let e=c(),a={"Content-Type":"application/json"};return e&&(a.Authorization="Bearer ".concat(e)),a}async function i(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t="".concat(n).concat(e),s=Object.entries(a).filter(e=>{let[,a]=e;return null!=a&&""!==a}).map(e=>{let[a,t]=e;return"".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(t))}).join("&");s&&(t+="?".concat(s));let c=await fetch(t,{headers:r()});if(!c.ok)throw Error((await c.json().catch(()=>({message:"Erro de rede"}))).message||"HTTP ".concat(c.status));let o=await c.json();if(!1===o.success)throw Error(o.message||"Erro desconhecido");return void 0!==o.data?o.data:o}async function l(e,a){let t=await fetch("".concat(n).concat(e),{method:"POST",headers:r(),body:JSON.stringify(a)}),s=await t.json().catch(()=>null);if(!t.ok||s&&!1===s.success)throw Error((null==s?void 0:s.message)||"HTTP ".concat(t.status));return(null==s?void 0:s.data)!==void 0?s.data:s}async function d(e,a){let t=await fetch("".concat(n).concat(e),{method:"PUT",headers:r(),body:JSON.stringify(a)}),s=await t.json().catch(()=>null);if(!t.ok||s&&!1===s.success)throw Error((null==s?void 0:s.message)||"HTTP ".concat(t.status));return(null==s?void 0:s.data)!==void 0?s.data:s}async function u(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t="".concat(n).concat(e),s=Object.entries(a).filter(e=>{let[,a]=e;return null!=a&&""!==a}).map(e=>{let[a,t]=e;return"".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(t))}).join("&");s&&(t+="?".concat(s));let c=await fetch(t,{method:"DELETE",headers:r()}),o=await c.json().catch(()=>null);if(!c.ok||o&&!1===o.success)throw Error((null==o?void 0:o.message)||"HTTP ".concat(c.status));return(null==o?void 0:o.data)!==void 0?o.data:o}},8779:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});var n=t(7437),s=t(2265),c=t(7128),o=t(9376);function r(e){let{children:a}=e,{isAuthenticated:t,loading:r}=(0,c.a)(),i=(0,o.useRouter)();return((0,s.useEffect)(()=>{r||t||i.push("/login/")},[r,t,i]),r)?(0,n.jsxs)("div",{className:"auth-loading",children:[(0,n.jsx)("div",{className:"auth-loading-spinner"}),(0,n.jsx)("p",{children:"Carregando..."})]}):t?(0,n.jsx)(n.Fragment,{children:a}):null}},7128:function(e,a,t){"use strict";t.d(a,{H:function(){return r},a:function(){return i}});var n=t(7437),s=t(2265),c=t(6428);let o=(0,s.createContext)(null);function r(e){let{children:a}=e,[t,r]=(0,s.useState)(null),[i,l]=(0,s.useState)(!0),d=(0,s.useCallback)(async()=>{if(!(0,c.LP)()){l(!1);return}try{let e=await (0,c.SC)("/auth/session.php");e.admin?r({...e.admin,name:e.admin.nome||e.admin.name,admin_id:e.admin.admin_id||e.admin.id}):((0,c.o4)(null),r(null))}catch(e){(0,c.o4)(null),r(null)}finally{l(!1)}},[]);(0,s.useEffect)(()=>{d()},[d]);let u=async(e,a)=>{let t=await (0,c.sg)("/auth/login.php",{email:e,senha:a});if(t.token)return(0,c.o4)(t.token),r({admin_id:t.admin_id,name:t.nome||t.name,email:t.email,role:t.role}),t;throw Error(t.message||"Erro ao fazer login")};return(0,n.jsx)(o.Provider,{value:{admin:t,loading:i,isAuthenticated:!!t,login:u,logout:()=>{(0,c.o4)(null),r(null)},checkSession:d},children:a})}function i(){let e=(0,s.useContext)(o);if(!e)throw Error("useAuth must be inside AuthProvider");return e}},2216:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return i}});var n=t(7437),s=t(2265),c=t(8779),o=t(6428);function r(){let[e,a]=(0,s.useState)(!0),[t,c]=(0,s.useState)([]),[r,i]=(0,s.useState)(null),[l,d]=(0,s.useState)(null),[u,h]=(0,s.useState)({status:"pending",page:1}),[m,p]=(0,s.useState)([]),[j,g]=(0,s.useState)(null),v=(0,s.useCallback)(async()=>{a(!0);try{let e=await (0,o.SC)("/review-photos.php",{status:u.status,page:u.page});c(e.photos),i(e.stats),d(e.pagination)}catch(e){console.error("Erro:",e)}finally{a(!1)}},[u]);(0,s.useEffect)(()=>{v()},[v]);let x=async function(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{await (0,o.sg)("/review-photos.php",{action:e,photo_id:a,...t}),v(),p([])}catch(e){alert(e.message||"Erro ao executar acao")}},f=async e=>{if(0===m.length){alert("Selecione ao menos uma foto");return}try{let a=await (0,o.sg)("/review-photos.php",{action:e,photo_ids:m});alert(a.message||"Sucesso!"),v(),p([])}catch(e){alert(e.message||"Erro ao executar acao em lote")}},N=e=>{p(a=>a.includes(e)?a.filter(a=>a!==e):[...a,e])},b=e=>(0,n.jsx)("span",{className:"badge",style:{backgroundColor:{approved:"#22c55e",pending:"#f59e0b",rejected:"#ef4444"}[e]},children:{approved:"Aprovada",pending:"Pendente",rejected:"Rejeitada"}[e]||e});return(0,n.jsxs)("div",{className:"page-container",children:[(0,n.jsx)("div",{className:"page-header",children:(0,n.jsx)("h1",{children:"Moderacao de Fotos de Reviews"})}),r&&(0,n.jsxs)("div",{className:"stats-grid",children:[(0,n.jsxs)("div",{className:"stat-card warning",children:[(0,n.jsx)("div",{className:"stat-value",children:r.pending}),(0,n.jsx)("div",{className:"stat-label",children:"Pendentes"})]}),(0,n.jsxs)("div",{className:"stat-card success",children:[(0,n.jsx)("div",{className:"stat-value",children:r.approved}),(0,n.jsx)("div",{className:"stat-label",children:"Aprovadas"})]}),(0,n.jsxs)("div",{className:"stat-card danger",children:[(0,n.jsx)("div",{className:"stat-value",children:r.rejected}),(0,n.jsx)("div",{className:"stat-label",children:"Rejeitadas"})]}),(0,n.jsxs)("div",{className:"stat-card",children:[(0,n.jsx)("div",{className:"stat-value",children:r.total}),(0,n.jsx)("div",{className:"stat-label",children:"Total"})]})]}),(0,n.jsxs)("div",{className:"filters-bar",children:[(0,n.jsxs)("select",{value:u.status,onChange:e=>h({...u,status:e.target.value,page:1}),children:[(0,n.jsx)("option",{value:"all",children:"Todas"}),(0,n.jsx)("option",{value:"pending",children:"Pendentes"}),(0,n.jsx)("option",{value:"approved",children:"Aprovadas"}),(0,n.jsx)("option",{value:"rejected",children:"Rejeitadas"})]}),m.length>0&&(0,n.jsxs)("div",{className:"bulk-actions",children:[(0,n.jsxs)("span",{children:[m.length," selecionadas"]}),(0,n.jsx)("button",{className:"btn btn-success btn-small",onClick:()=>f("bulk_approve"),children:"Aprovar"}),(0,n.jsx)("button",{className:"btn btn-danger btn-small",onClick:()=>f("bulk_reject"),children:"Rejeitar"})]})]}),e?(0,n.jsx)("div",{className:"loading",children:"Carregando..."}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"photos-header",children:(0,n.jsxs)("label",{className:"checkbox-label",children:[(0,n.jsx)("input",{type:"checkbox",checked:m.length===t.length&&t.length>0,onChange:()=>{m.length===t.length?p([]):p(t.map(e=>e.id))}}),"Selecionar todas"]})}),(0,n.jsx)("div",{className:"photos-grid",children:t.map(e=>(0,n.jsxs)("div",{className:"photo-card ".concat(m.includes(e.id)?"selected":""),children:[(0,n.jsx)("div",{className:"photo-checkbox",children:(0,n.jsx)("input",{type:"checkbox",checked:m.includes(e.id),onChange:()=>N(e.id)})}),(0,n.jsx)("div",{className:"photo-image",onClick:()=>g(e),children:(0,n.jsx)("img",{src:e.photo_url,alt:""})}),(0,n.jsxs)("div",{className:"photo-info",children:[(0,n.jsxs)("div",{className:"photo-meta",children:[(0,n.jsx)("span",{className:"customer-name",children:e.customer_name}),(0,n.jsx)("span",{className:"partner-name",children:e.partner_name})]}),e.caption&&(0,n.jsx)("p",{className:"photo-caption",children:e.caption}),(0,n.jsx)("div",{className:"photo-date",children:new Date(e.created_at).toLocaleDateString("pt-BR")}),(0,n.jsx)("div",{className:"photo-status",children:b(e.status)})]}),(0,n.jsx)("div",{className:"photo-actions",children:"pending"===e.status&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:"btn btn-success btn-small",onClick:()=>x("approve",e.id),children:"Aprovar"}),(0,n.jsx)("button",{className:"btn btn-danger btn-small",onClick:()=>{let a=prompt("Motivo da rejeicao:");a&&x("reject",e.id,{reason:a.replace(/<[^>]*>/g,"").trim()})},children:"Rejeitar"})]})})]},e.id))})]}),l&&(0,n.jsxs)("div",{className:"pagination",children:[(0,n.jsx)("button",{disabled:1===u.page,onClick:()=>h({...u,page:u.page-1}),children:"Anterior"}),(0,n.jsxs)("span",{children:["Pagina ",u.page," de ",l.pages]}),(0,n.jsx)("button",{disabled:u.page>=l.pages,onClick:()=>h({...u,page:u.page+1}),children:"Proxima"})]}),j&&(0,n.jsx)("div",{className:"modal-overlay",onClick:()=>g(null),children:(0,n.jsxs)("div",{className:"modal-content photo-preview",onClick:e=>e.stopPropagation(),children:[(0,n.jsx)("button",{className:"modal-close",onClick:()=>g(null),children:"\xd7"}),(0,n.jsx)("img",{src:j.photo_url,alt:"",className:"photo-preview-image"}),(0,n.jsxs)("div",{className:"photo-preview-info",children:[(0,n.jsx)("h3",{children:j.customer_name}),(0,n.jsxs)("p",{children:["Pedido #",j.order_id," - ",j.partner_name]}),j.caption&&(0,n.jsx)("p",{className:"caption",children:j.caption})]})]})})]})}function i(){return(0,n.jsx)(c.Z,{children:(0,n.jsx)(r,{})})}},9376:function(e,a,t){"use strict";var n=t(5475);t.o(n,"usePathname")&&t.d(a,{usePathname:function(){return n.usePathname}}),t.o(n,"useRouter")&&t.d(a,{useRouter:function(){return n.useRouter}}),t.o(n,"useSearchParams")&&t.d(a,{useSearchParams:function(){return n.useSearchParams}})}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=6048)}),_N_E=e.O()}]);