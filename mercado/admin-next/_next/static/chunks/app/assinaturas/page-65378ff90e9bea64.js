(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[263],{6845:function(e,a,s){Promise.resolve().then(s.bind(s,8434))},6428:function(e,a,s){"use strict";s.d(a,{$V:function(){return c},LP:function(){return l},QW:function(){return u},SC:function(){return r},o4:function(){return i},pE:function(){return d},sg:function(){return o}});let t="/api/mercado/admin",n="admin_token";function l(){try{return localStorage.getItem(n)}catch(e){return null}}function i(e){try{e?localStorage.setItem(n,e):localStorage.removeItem(n)}catch(e){}}function c(){let e=l(),a={"Content-Type":"application/json"};return e&&(a.Authorization="Bearer ".concat(e)),a}async function r(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="".concat(t).concat(e),n=Object.entries(a).filter(e=>{let[,a]=e;return null!=a&&""!==a}).map(e=>{let[a,s]=e;return"".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(s))}).join("&");n&&(s+="?".concat(n));let l=await fetch(s,{headers:c()});if(!l.ok)throw Error((await l.json().catch(()=>({message:"Erro de rede"}))).message||"HTTP ".concat(l.status));let i=await l.json();if(!1===i.success)throw Error(i.message||"Erro desconhecido");return void 0!==i.data?i.data:i}async function o(e,a){let s=await fetch("".concat(t).concat(e),{method:"POST",headers:c(),body:JSON.stringify(a)}),n=await s.json().catch(()=>null);if(!s.ok||n&&!1===n.success)throw Error((null==n?void 0:n.message)||"HTTP ".concat(s.status));return(null==n?void 0:n.data)!==void 0?n.data:n}async function d(e,a){let s=await fetch("".concat(t).concat(e),{method:"PUT",headers:c(),body:JSON.stringify(a)}),n=await s.json().catch(()=>null);if(!s.ok||n&&!1===n.success)throw Error((null==n?void 0:n.message)||"HTTP ".concat(s.status));return(null==n?void 0:n.data)!==void 0?n.data:n}async function u(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="".concat(t).concat(e),n=Object.entries(a).filter(e=>{let[,a]=e;return null!=a&&""!==a}).map(e=>{let[a,s]=e;return"".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(s))}).join("&");n&&(s+="?".concat(n));let l=await fetch(s,{method:"DELETE",headers:c()}),i=await l.json().catch(()=>null);if(!l.ok||i&&!1===i.success)throw Error((null==i?void 0:i.message)||"HTTP ".concat(l.status));return(null==i?void 0:i.data)!==void 0?i.data:i}},8434:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return o}});var t=s(7437),n=s(2265),l=s(8779),i=s(6428);function c(){var e,a,s,l,c;let[o,d]=(0,n.useState)("subscriptions"),[u,h]=(0,n.useState)(!0),[p,m]=(0,n.useState)({subscriptions:[],plans:[],stats:null}),[x,v]=(0,n.useState)({status:"",plan_id:0,page:1}),[j,b]=(0,n.useState)(null),[g,f]=(0,n.useState)(!1),N=(0,n.useCallback)(async()=>{h(!0);try{let e={view:o};x.status&&(e.status=x.status),x.plan_id&&(e.plan_id=x.plan_id),e.page=x.page;let a=await (0,i.SC)("/subscriptions.php",e);"subscriptions"===o&&m(e=>({...e,subscriptions:a.subscriptions,pagination:a.pagination})),"plans"===o&&m(e=>({...e,plans:a.plans})),"stats"===o&&m(e=>({...e,stats:a.stats}))}catch(e){console.error("Erro:",e)}finally{h(!1)}},[o,x]);(0,n.useEffect)(()=>{N()},[N]),(0,n.useEffect)(()=>{0===p.plans.length&&(0,i.SC)("/subscriptions.php",{view:"plans"}).then(e=>{m(a=>({...a,plans:e.plans}))}).catch(()=>{})},[p.plans.length]);let y=async function(e,a){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(confirm("Confirma ".concat(e," esta assinatura?")))try{let t=await (0,i.sg)("/subscriptions.php",{action:e,subscription_id:a,...s});alert(t.message||"Sucesso!"),N()}catch(e){alert(e.message||"Erro ao executar acao")}},_=async e=>{try{let a=await (0,i.sg)("/subscriptions.php",{action:e.id?"update_plan":"create_plan",plan_id:e.id,...e});alert(a.message||"Plano salvo!"),f(!1),b(null),N()}catch(e){alert(e.message||"Erro ao salvar plano")}},C=e=>(0,t.jsx)("span",{className:"badge",style:{backgroundColor:{active:"#22c55e",cancelled:"#ef4444",expired:"#6b7280",pending:"#f59e0b"}[e]||"#6b7280"},children:e});return(0,t.jsxs)("div",{className:"page-container",children:[(0,t.jsxs)("div",{className:"page-header",children:[(0,t.jsx)("h1",{children:"SuperBora Club - Assinaturas"}),(0,t.jsxs)("div",{className:"header-actions",children:[(0,t.jsx)("button",{className:"tab-btn ".concat("subscriptions"===o?"active":""),onClick:()=>d("subscriptions"),children:"Assinaturas"}),(0,t.jsx)("button",{className:"tab-btn ".concat("plans"===o?"active":""),onClick:()=>d("plans"),children:"Planos"}),(0,t.jsx)("button",{className:"tab-btn ".concat("stats"===o?"active":""),onClick:()=>d("stats"),children:"Estatisticas"})]})]}),"stats"===o&&p.stats&&(0,t.jsxs)("div",{className:"stats-grid",children:[(0,t.jsxs)("div",{className:"stat-card",children:[(0,t.jsx)("div",{className:"stat-value",children:(null===(e=p.stats.subscriptions)||void 0===e?void 0:e.total)||0}),(0,t.jsx)("div",{className:"stat-label",children:"Total Assinaturas"})]}),(0,t.jsxs)("div",{className:"stat-card success",children:[(0,t.jsx)("div",{className:"stat-value",children:(null===(a=p.stats.subscriptions)||void 0===a?void 0:a.active)||0}),(0,t.jsx)("div",{className:"stat-label",children:"Ativas"})]}),(0,t.jsxs)("div",{className:"stat-card warning",children:[(0,t.jsx)("div",{className:"stat-value",children:(null===(s=p.stats.subscriptions)||void 0===s?void 0:s.cancelled)||0}),(0,t.jsx)("div",{className:"stat-label",children:"Canceladas"})]}),(0,t.jsxs)("div",{className:"stat-card info",children:[(0,t.jsxs)("div",{className:"stat-value",children:["R$ ",parseFloat((null===(l=p.stats.revenue)||void 0===l?void 0:l.total_revenue)||0).toFixed(2)]}),(0,t.jsx)("div",{className:"stat-label",children:"Receita Total"})]}),(0,t.jsxs)("div",{className:"stat-card",children:[(0,t.jsxs)("div",{className:"stat-value",children:["R$ ",parseFloat((null===(c=p.stats.revenue)||void 0===c?void 0:c.month_revenue)||0).toFixed(2)]}),(0,t.jsx)("div",{className:"stat-label",children:"Receita Mes"})]})]}),"plans"===o&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"section-header",children:[(0,t.jsx)("h2",{children:"Planos Disponiveis"}),(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>{b({}),f(!0)},children:"+ Novo Plano"})]}),(0,t.jsx)("div",{className:"plans-grid",children:p.plans.map(e=>(0,t.jsxs)("div",{className:"plan-card",children:[(0,t.jsxs)("div",{className:"plan-header",children:[(0,t.jsx)("h3",{children:e.name}),(0,t.jsxs)("span",{className:"plan-price",children:["R$ ",parseFloat(e.price).toFixed(2),"/","monthly"===e.billing_cycle?"mes":"ano"]})]}),(0,t.jsxs)("div",{className:"plan-stats",children:[(0,t.jsxs)("span",{children:[e.active_count||0," ativos"]}),(0,t.jsxs)("span",{children:[e.total_count||0," total"]})]}),(0,t.jsxs)("ul",{className:"plan-features",children:[e.free_delivery?(0,t.jsx)("li",{children:"Frete gratis"}):null,e.cashback_percent>0?(0,t.jsxs)("li",{children:[e.cashback_percent,"% cashback"]}):null,e.priority_support?(0,t.jsx)("li",{children:"Suporte prioritario"}):null,e.exclusive_offers?(0,t.jsx)("li",{children:"Ofertas exclusivas"}):null]}),(0,t.jsx)("div",{className:"plan-actions",children:(0,t.jsx)("button",{className:"btn btn-small",onClick:()=>{b(e),f(!0)},children:"Editar"})})]},e.id))})]}),"subscriptions"===o&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"filters-bar",children:[(0,t.jsxs)("select",{value:x.status,onChange:e=>v({...x,status:e.target.value,page:1}),children:[(0,t.jsx)("option",{value:"",children:"Todos Status"}),(0,t.jsx)("option",{value:"active",children:"Ativas"}),(0,t.jsx)("option",{value:"cancelled",children:"Canceladas"}),(0,t.jsx)("option",{value:"expired",children:"Expiradas"})]}),(0,t.jsxs)("select",{value:x.plan_id,onChange:e=>v({...x,plan_id:e.target.value,page:1}),children:[(0,t.jsx)("option",{value:"0",children:"Todos Planos"}),p.plans.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),u?(0,t.jsx)("div",{className:"loading",children:"Carregando..."}):(0,t.jsxs)("table",{className:"data-table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"ID"}),(0,t.jsx)("th",{children:"Cliente"}),(0,t.jsx)("th",{children:"Plano"}),(0,t.jsx)("th",{children:"Status"}),(0,t.jsx)("th",{children:"Inicio"}),(0,t.jsx)("th",{children:"Fim"}),(0,t.jsx)("th",{children:"Acoes"})]})}),(0,t.jsx)("tbody",{children:p.subscriptions.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:e.id}),(0,t.jsxs)("td",{children:[(0,t.jsx)("div",{children:e.customer_name}),(0,t.jsx)("small",{children:e.customer_email})]}),(0,t.jsx)("td",{children:e.plan_name}),(0,t.jsx)("td",{children:C(e.status)}),(0,t.jsx)("td",{children:new Date(e.starts_at).toLocaleDateString("pt-BR")}),(0,t.jsx)("td",{children:e.ends_at?new Date(e.ends_at).toLocaleDateString("pt-BR"):"-"}),(0,t.jsx)("td",{children:"active"===e.status&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{className:"btn btn-small btn-danger",onClick:()=>y("cancel_subscription",e.id),children:"Cancelar"}),(0,t.jsx)("button",{className:"btn btn-small",onClick:()=>{let a=prompt("Quantos dias estender?","30");a&&y("extend_subscription",e.id,{days:parseInt(a)})},children:"Estender"})]})})]},e.id))})]}),p.pagination&&(0,t.jsxs)("div",{className:"pagination",children:[(0,t.jsx)("button",{disabled:1===x.page,onClick:()=>v({...x,page:x.page-1}),children:"Anterior"}),(0,t.jsxs)("span",{children:["Pagina ",x.page," de ",p.pagination.pages]}),(0,t.jsx)("button",{disabled:x.page>=p.pagination.pages,onClick:()=>v({...x,page:x.page+1}),children:"Proxima"})]})]}),g&&(0,t.jsx)(r,{plan:j,onClose:()=>{f(!1),b(null)},onSave:_})]})}function r(e){let{plan:a,onClose:s,onSave:l}=e,i=(()=>{try{return(null==a?void 0:a.features)?JSON.parse(a.features):[]}catch(e){return[]}})(),[c,r]=(0,n.useState)({id:(null==a?void 0:a.id)||0,name:(null==a?void 0:a.name)||"",slug:(null==a?void 0:a.slug)||"",price:(null==a?void 0:a.price)||0,billing_cycle:(null==a?void 0:a.billing_cycle)||"monthly",free_delivery:(null==a?void 0:a.free_delivery)||0,cashback_percent:(null==a?void 0:a.cashback_percent)||0,priority_support:(null==a?void 0:a.priority_support)||0,exclusive_offers:(null==a?void 0:a.exclusive_offers)||0,features:i});return(0,t.jsx)("div",{className:"modal-overlay",onClick:s,children:(0,t.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h2",{children:c.id?"Editar Plano":"Novo Plano"}),(0,t.jsx)("button",{className:"modal-close",onClick:s,children:"\xd7"})]}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l(c)},children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Nome"}),(0,t.jsx)("input",{type:"text",value:c.name,onChange:e=>r({...c,name:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Slug"}),(0,t.jsx)("input",{type:"text",value:c.slug,onChange:e=>r({...c,slug:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"form-row",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Preco (R$)"}),(0,t.jsx)("input",{type:"number",step:"0.01",value:c.price,onChange:e=>r({...c,price:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Ciclo"}),(0,t.jsxs)("select",{value:c.billing_cycle,onChange:e=>r({...c,billing_cycle:e.target.value}),children:[(0,t.jsx)("option",{value:"monthly",children:"Mensal"}),(0,t.jsx)("option",{value:"yearly",children:"Anual"})]})]})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Cashback (%)"}),(0,t.jsx)("input",{type:"number",step:"0.1",value:c.cashback_percent,onChange:e=>r({...c,cashback_percent:e.target.value})})]}),(0,t.jsx)("div",{className:"form-group",children:(0,t.jsxs)("label",{className:"checkbox-label",children:[(0,t.jsx)("input",{type:"checkbox",checked:c.free_delivery,onChange:e=>r({...c,free_delivery:e.target.checked?1:0})}),"Frete Gratis"]})}),(0,t.jsx)("div",{className:"form-group",children:(0,t.jsxs)("label",{className:"checkbox-label",children:[(0,t.jsx)("input",{type:"checkbox",checked:c.priority_support,onChange:e=>r({...c,priority_support:e.target.checked?1:0})}),"Suporte Prioritario"]})}),(0,t.jsx)("div",{className:"form-group",children:(0,t.jsxs)("label",{className:"checkbox-label",children:[(0,t.jsx)("input",{type:"checkbox",checked:c.exclusive_offers,onChange:e=>r({...c,exclusive_offers:e.target.checked?1:0})}),"Ofertas Exclusivas"]})}),(0,t.jsxs)("div",{className:"form-actions",children:[(0,t.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:s,children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Salvar"})]})]})]})})}function o(){return(0,t.jsx)(l.Z,{children:(0,t.jsx)(c,{})})}},8779:function(e,a,s){"use strict";s.d(a,{Z:function(){return c}});var t=s(7437),n=s(2265),l=s(7128),i=s(9376);function c(e){let{children:a}=e,{isAuthenticated:s,loading:c}=(0,l.a)(),r=(0,i.useRouter)();return((0,n.useEffect)(()=>{c||s||r.push("/login/")},[c,s,r]),c)?(0,t.jsxs)("div",{className:"auth-loading",children:[(0,t.jsx)("div",{className:"auth-loading-spinner"}),(0,t.jsx)("p",{children:"Carregando..."})]}):s?(0,t.jsx)(t.Fragment,{children:a}):null}},7128:function(e,a,s){"use strict";s.d(a,{H:function(){return c},a:function(){return r}});var t=s(7437),n=s(2265),l=s(6428);let i=(0,n.createContext)(null);function c(e){let{children:a}=e,[s,c]=(0,n.useState)(null),[r,o]=(0,n.useState)(!0),d=(0,n.useCallback)(async()=>{if(!(0,l.LP)()){o(!1);return}try{let e=await (0,l.SC)("/auth/session.php");e.admin?c({...e.admin,name:e.admin.nome||e.admin.name,admin_id:e.admin.admin_id||e.admin.id}):((0,l.o4)(null),c(null))}catch(e){(0,l.o4)(null),c(null)}finally{o(!1)}},[]);(0,n.useEffect)(()=>{d()},[d]);let u=async(e,a)=>{let s=await (0,l.sg)("/auth/login.php",{email:e,senha:a});if(s.token)return(0,l.o4)(s.token),c({admin_id:s.admin_id,name:s.nome||s.name,email:s.email,role:s.role}),s;throw Error(s.message||"Erro ao fazer login")};return(0,t.jsx)(i.Provider,{value:{admin:s,loading:r,isAuthenticated:!!s,login:u,logout:()=>{(0,l.o4)(null),c(null)},checkSession:d},children:a})}function r(){let e=(0,n.useContext)(i);if(!e)throw Error("useAuth must be inside AuthProvider");return e}},9376:function(e,a,s){"use strict";var t=s(5475);s.o(t,"usePathname")&&s.d(a,{usePathname:function(){return t.usePathname}}),s.o(t,"useRouter")&&s.d(a,{useRouter:function(){return t.useRouter}}),s.o(t,"useSearchParams")&&s.d(a,{useSearchParams:function(){return t.useSearchParams}})}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=6845)}),_N_E=e.O()}]);