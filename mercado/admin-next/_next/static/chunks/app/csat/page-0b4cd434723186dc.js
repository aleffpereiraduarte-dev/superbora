(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5994],{8239:function(e,a,t){Promise.resolve().then(t.bind(t,535))},4445:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});var n=t(7437),s=t(8253);function r(e){let{section:a,children:t}=e,{hasPermission:r}=(0,s.q)();return r(a)?(0,n.jsx)(n.Fragment,{children:t}):(0,n.jsxs)("div",{className:"role-denied",children:[(0,n.jsx)("div",{className:"role-denied-icon",children:"\uD83D\uDD12"}),(0,n.jsx)("h2",{children:"Acesso Negado"}),(0,n.jsx)("p",{children:"Voce nao tem permissao para acessar esta secao."}),(0,n.jsx)("p",{className:"role-denied-hint",children:"Contate o administrador para solicitar acesso."})]})}},1656:function(e,a,t){"use strict";t.d(a,{X:function(){return i},Z:function(){return r}});var n=t(7437);let s={success:"badge-success",warning:"badge-warning",danger:"badge-danger",info:"badge-info",neutral:"badge-neutral"};function r(e){let{label:a,variant:t="neutral"}=e;return(0,n.jsx)("span",{className:"badge ".concat(s[t]||s.neutral),children:a})}function i(e){return({pendente:"warning",confirmado:"info",preparando:"info",pronto:"info",coletado:"info",em_entrega:"warning",entregue:"success",cancelado:"danger",recusado:"danger",ativo:"success",inativo:"neutral",bloqueado:"danger",online:"success",offline:"neutral",aprovado:"success",reprovado:"danger",pago:"success",pendente_pagamento:"warning",processando:"info",aberto:"warning",resolvido:"success",fechado:"neutral"})[e]||"neutral"}},9246:function(e,a,t){"use strict";t.d(a,{Z:function(){return l}});var n=t(7437),s=t(2265);function r(e){let{value:a,onChange:t,placeholder:r="Buscar...",delay:i=300}=e,[l,c]=(0,s.useState)(a||""),o=(0,s.useRef)(null);return(0,s.useEffect)(()=>{c(a||"")},[a]),(0,n.jsxs)("div",{className:"search-input-wrapper",children:[(0,n.jsx)("span",{className:"search-input-icon",children:"\uD83D\uDD0D"}),(0,n.jsx)("input",{type:"text",className:"search-input",value:l,onChange:e=>{let a=e.target.value;c(a),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{null==t||t(a)},i)},placeholder:r}),l&&(0,n.jsx)("button",{className:"search-input-clear",onClick:()=>{c(""),null==t||t("")},children:"✕"})]})}var i=t(4420);function l(e){let{columns:a=[],data:t=[],loading:l=!1,searchable:c=!0,pageSize:o=15,emptyMessage:d="Nenhum registro encontrado",onRowClick:u}=e,[h,m]=(0,s.useState)(""),[g,p]=(0,s.useState)(null),[x,v]=(0,s.useState)("asc"),[j,f]=(0,s.useState)(1),b=(0,s.useMemo)(()=>{if(!h)return t;let e=h.toLowerCase();return t.filter(t=>a.some(a=>{let n=t[a.key];return null!=n&&String(n).toLowerCase().includes(e)}))},[t,h,a]),y=(0,s.useMemo)(()=>g?[...b].sort((e,a)=>{var t,n;let s=null!==(t=e[g])&&void 0!==t?t:"",r=null!==(n=a[g])&&void 0!==n?n:"";if("number"==typeof s&&"number"==typeof r)return"asc"===x?s-r:r-s;let i=String(s).localeCompare(String(r));return"asc"===x?i:-i}):b,[b,g,x]),N=Math.max(1,Math.ceil(y.length/o)),k=y.slice((j-1)*o,j*o);(0,s.useEffect)(()=>{j>N&&f(1)},[j,N]);let S=e=>{g===e?v(e=>"asc"===e?"desc":"asc"):(p(e),v("asc"))};return l?(0,n.jsxs)("div",{className:"datatable",children:[c&&(0,n.jsx)("div",{className:"datatable-toolbar",children:(0,n.jsx)(r,{value:"",onChange:()=>{},placeholder:"Buscar..."})}),(0,n.jsx)("div",{className:"datatable-skeleton",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsx)("div",{className:"skeleton-row",children:a.map((e,a)=>(0,n.jsx)("div",{className:"skeleton-cell"},a))},t))})]}):(0,n.jsxs)("div",{className:"datatable",children:[c&&(0,n.jsxs)("div",{className:"datatable-toolbar",children:[(0,n.jsx)(r,{value:h,onChange:e=>{m(e),f(1)},placeholder:"Buscar na tabela..."}),(0,n.jsxs)("span",{className:"datatable-count",children:[b.length," registro(s)"]})]}),(0,n.jsx)("div",{className:"datatable-wrapper",children:(0,n.jsxs)("table",{className:"datatable-table",children:[(0,n.jsx)("thead",{children:(0,n.jsx)("tr",{children:a.map(e=>(0,n.jsxs)("th",{onClick:()=>!1!==e.sortable&&S(e.key),className:!1!==e.sortable?"sortable":"",style:e.width?{width:e.width}:void 0,children:[e.label,g===e.key&&(0,n.jsx)("span",{className:"sort-indicator",children:"asc"===x?" ▲":" ▼"})]},e.key))})}),(0,n.jsx)("tbody",{children:0===k.length?(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:a.length,className:"datatable-empty",children:d})}):k.map((e,t)=>(0,n.jsx)("tr",{onClick:()=>null==u?void 0:u(e),className:u?"clickable-row":"",children:a.map(a=>{var t;return(0,n.jsx)("td",{children:a.render?a.render(e[a.key],e):null!==(t=e[a.key])&&void 0!==t?t:"-"},a.key)})},e.id||t))})]})}),N>1&&(0,n.jsx)(i.Z,{page:j,totalPages:N,onPageChange:f})]})}},4420:function(e,a,t){"use strict";t.d(a,{Z:function(){return s}});var n=t(7437);function s(e){let{page:a,totalPages:t,onPageChange:s}=e,r=[],i=Math.max(1,a-Math.floor(2.5)),l=Math.min(t,i+5-1);l-i<4&&(i=Math.max(1,l-5+1));for(let e=i;e<=l;e++)r.push(e);return(0,n.jsxs)("div",{className:"pagination",children:[(0,n.jsx)("button",{className:"pagination-btn",disabled:a<=1,onClick:()=>s(a-1),children:"‹ Anterior"}),i>1&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:"pagination-btn",onClick:()=>s(1),children:"1"}),i>2&&(0,n.jsx)("span",{className:"pagination-dots",children:"..."})]}),r.map(e=>(0,n.jsx)("button",{className:"pagination-btn ".concat(e===a?"pagination-active":""),onClick:()=>s(e),children:e},e)),l<t&&(0,n.jsxs)(n.Fragment,{children:[l<t-1&&(0,n.jsx)("span",{className:"pagination-dots",children:"..."}),(0,n.jsx)("button",{className:"pagination-btn",onClick:()=>s(t),children:t})]}),(0,n.jsx)("button",{className:"pagination-btn",disabled:a>=t,onClick:()=>s(a+1),children:"Proximo ›"})]})}},3197:function(e,a,t){"use strict";t.d(a,{Z:function(){return s}});var n=t(7437);function s(e){let{icon:a,label:t,value:s,change:r,color:i="var(--accent)"}=e,l=r&&parseFloat(r)>=0;return(0,n.jsxs)("div",{className:"stats-card",style:{borderTopColor:i},children:[(0,n.jsxs)("div",{className:"stats-card-header",children:[(0,n.jsx)("span",{className:"stats-card-icon",style:{color:i},dangerouslySetInnerHTML:{__html:a||"&#128202;"}}),(0,n.jsx)("span",{className:"stats-card-label",children:t})]}),(0,n.jsx)("div",{className:"stats-card-value",children:null!=s?s:"-"}),null!=r&&(0,n.jsxs)("div",{className:"stats-card-change ".concat(l?"change-positive":"change-negative"),children:[l?"&#9650;":"&#9660;"," ",r,"%"]})]})}},535:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return N}});var n=t(7437),s=t(2265),r=t(8779),i=t(4477),l=t(4445),c=t(9246),o=t(1656),d=t(3197),u=t(4420),h=t(6939),m=t(8789),g=t(6971),p=t(6428);let x={5:"var(--success)",4:"var(--success)",3:"var(--warning)",2:"var(--accent)",1:"var(--danger)"},v={ticket:"Ticket",dispute:"Disputa"};function j(e){let a=Math.min(5,Math.max(0,Math.round(Number(e)||0)));return"★".repeat(a)+"☆".repeat(5-a)}function f(e){let a=Number(e)||0;return a>=4?"var(--success)":a>=3?"var(--warning)":"var(--danger)"}function b(e){return e?new Date(e).toLocaleDateString("pt-BR"):"-"}function y(){var e,a,t;let{collapsed:r}=(0,m.A)(),{error:l}=(0,g.l)(),[y,N]=(0,s.useState)(null),[k,S]=(0,s.useState)(!0),[C,w]=(0,s.useState)([]),[_,Z]=(0,s.useState)(!0),[T,D]=(0,s.useState)({page:1,pages:0,total:0}),[M,W]=(0,s.useState)(1),A=(0,s.useCallback)(async()=>{S(!0);try{let e=await (0,p.SC)("/csat.php?view=stats");N(e.stats||e)}catch(e){console.warn("Erro ao carregar stats CSAT:",e.message)}finally{S(!1)}},[]),B=(0,s.useCallback)(async()=>{Z(!0);try{let e=await (0,p.SC)("/csat.php?view=list&page=".concat(M));w(e.ratings||[]),D(e.pagination||{page:1,pages:0,total:0})}catch(e){l("Erro ao carregar avaliacoes CSAT")}finally{Z(!1)}},[M,l]);(0,s.useEffect)(()=>{A()},[A]),(0,s.useEffect)(()=>{B()},[B]);let E=(null==y?void 0:y.distribution)||[],z=(null==y?void 0:y.by_type)||[],R=(null==y?void 0:y.recent_low)||[],F=Math.max(1,...E.map(e=>Number(e.total)||0)),P=[{key:"id",label:"ID",render:e=>(0,n.jsxs)("strong",{children:["#",e]})},{key:"customer_name",label:"Cliente",render:e=>e||"-"},{key:"referencia_tipo",label:"Tipo",render:e=>(0,n.jsx)(o.Z,{label:v[e]||e||"-",variant:"dispute"===e?"danger":"info"})},{key:"rating",label:"Rating",render:e=>(0,n.jsx)("span",{style:{color:f(e),letterSpacing:2,fontWeight:600},children:j(e)})},{key:"comentario",label:"Comentario",render:e=>(0,n.jsx)("span",{className:"truncate",style:{maxWidth:220,display:"inline-block"},children:e||"-"})},{key:"created_at",label:"Data",render:e=>b(e)}];return(0,n.jsxs)("div",{className:"admin-layout",children:[(0,n.jsx)(i.Z,{}),(0,n.jsxs)("main",{className:"admin-main ".concat(r?"main-collapsed":""),children:[(0,n.jsxs)("div",{className:"page-header",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"page-title",children:"CSAT - Satisfacao do Cliente"}),(0,n.jsx)("p",{className:"page-subtitle",children:"Pesquisas de satisfacao de tickets e disputas"})]}),(0,n.jsx)("div",{className:"page-actions",children:(0,n.jsx)("button",{className:"btn btn-secondary",onClick:()=>{A(),B()},children:"Atualizar"})})]}),(0,n.jsxs)("div",{className:"stats-grid",style:{marginBottom:"1.5rem"},children:[(0,n.jsx)(d.Z,{icon:"★",label:"Total Avaliacoes",value:k?"...":null!==(e=null==y?void 0:y.total)&&void 0!==e?e:0,color:"var(--purple)"}),(0,n.jsx)(d.Z,{icon:"★",label:"Media CSAT",value:k?"...":"".concat(Number((null==y?void 0:y.avg_rating)||0).toFixed(1),"/5"),color:f(null==y?void 0:y.avg_rating)}),(0,n.jsx)(d.Z,{icon:"✓",label:"Satisfeitos (4-5)",value:k?"...":null!==(a=null==y?void 0:y.satisfied)&&void 0!==a?a:0,color:"var(--success)"}),(0,n.jsx)(d.Z,{icon:"✗",label:"Insatisfeitos (1-2)",value:k?"...":null!==(t=null==y?void 0:y.unsatisfied)&&void 0!==t?t:0,color:"var(--danger)"}),(0,n.jsx)(d.Z,{icon:"%",label:"% Satisfacao",value:k?"...":"".concat(Number((null==y?void 0:y.satisfaction_pct)||0).toFixed(1),"%"),color:function(e){let a=Number(e)||0;return a>=80?"var(--success)":a>=60?"var(--warning)":"var(--danger)"}(null==y?void 0:y.satisfaction_pct)})]}),!k&&E.length>0&&(0,n.jsxs)("div",{className:"card",style:{marginBottom:"1.5rem",padding:"1.25rem"},children:[(0,n.jsx)("h3",{style:{marginBottom:"1rem",fontSize:"1rem",fontWeight:600},children:"Distribuicao por Estrelas"}),(0,n.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[5,4,3,2,1].map(e=>{let a=E.find(a=>Number(a.rating)===e),t=Number(null==a?void 0:a.total)||0,s=F>0?t/F*100:0;return(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,n.jsxs)("span",{style:{minWidth:60,fontWeight:500,color:x[e],letterSpacing:1},children:[e," ","★".repeat(e)]}),(0,n.jsx)("div",{style:{flex:1,height:20,background:"var(--bg)",borderRadius:4,overflow:"hidden"},children:(0,n.jsx)("div",{style:{width:"".concat(s,"%"),height:"100%",background:x[e],borderRadius:4,transition:"width 0.3s ease",minWidth:t>0?4:0}})}),(0,n.jsx)("span",{style:{minWidth:40,textAlign:"right",fontWeight:500,fontSize:"0.875rem"},children:t})]},e)})})]}),!k&&z.length>0&&(0,n.jsxs)("div",{className:"card",style:{marginBottom:"1.5rem",padding:"1.25rem"},children:[(0,n.jsx)("h3",{style:{marginBottom:"1rem",fontSize:"1rem",fontWeight:600},children:"Media por Tipo"}),(0,n.jsx)("div",{style:{display:"flex",gap:"1.5rem",flexWrap:"wrap"},children:z.map(e=>{let a=Number(e.avg)||0;return(0,n.jsxs)("div",{style:{padding:"1rem 1.5rem",background:"var(--bg)",borderRadius:"var(--radius)",border:"1px solid var(--border)",minWidth:160,textAlign:"center"},children:[(0,n.jsx)("div",{style:{fontSize:"0.75rem",textTransform:"uppercase",color:"var(--text-muted)",marginBottom:4},children:v[e.type]||e.type}),(0,n.jsx)("div",{style:{fontSize:"1.5rem",fontWeight:700,color:f(a)},children:a.toFixed(1)}),(0,n.jsx)("div",{style:{color:f(a),letterSpacing:2},children:j(Math.round(a))}),(0,n.jsxs)("div",{style:{fontSize:"0.75rem",color:"var(--text-muted)",marginTop:4},children:[e.total," avaliacao(es)"]})]},e.type)})})]}),!k&&R.length>0&&(0,n.jsxs)("div",{className:"card",style:{marginBottom:"1.5rem",padding:"1.25rem"},children:[(0,n.jsx)("h3",{style:{marginBottom:"1rem",fontSize:"1rem",fontWeight:600,color:"var(--danger)"},children:"Avaliacoes Baixas Recentes (1-2 estrelas)"}),(0,n.jsx)("div",{className:"table-responsive",children:(0,n.jsxs)("table",{className:"table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Cliente"}),(0,n.jsx)("th",{children:"Rating"}),(0,n.jsx)("th",{children:"Tipo"}),(0,n.jsx)("th",{children:"Comentario"}),(0,n.jsx)("th",{children:"Data"})]})}),(0,n.jsx)("tbody",{children:R.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:e.customer_name||"-"}),(0,n.jsx)("td",{children:(0,n.jsx)("span",{style:{color:"var(--danger)",letterSpacing:2,fontWeight:600},children:j(e.rating)})}),(0,n.jsx)("td",{children:(0,n.jsx)(o.Z,{label:v[e.referencia_tipo]||e.referencia_tipo||"-",variant:"dispute"===e.referencia_tipo?"danger":"info"})}),(0,n.jsx)("td",{style:{maxWidth:300},children:e.comentario||"-"}),(0,n.jsx)("td",{children:b(e.created_at)})]},e.id))})]})})]}),(0,n.jsxs)("div",{className:"card",style:{padding:"1.25rem"},children:[(0,n.jsx)("h3",{style:{marginBottom:"1rem",fontSize:"1rem",fontWeight:600},children:"Todas as Avaliacoes"}),(0,n.jsx)(c.Z,{columns:P,data:C,loading:_,searchable:!1,emptyMessage:"Nenhuma avaliacao CSAT encontrada"}),T.pages>1&&(0,n.jsx)("div",{style:{marginTop:"1rem"},children:(0,n.jsx)(u.Z,{page:T.page||M,totalPages:T.pages,onPageChange:W})})]})]}),(0,n.jsx)(h.Z,{})]})}function N(){return(0,n.jsx)(r.Z,{children:(0,n.jsx)(l.Z,{section:"support",children:(0,n.jsx)(y,{})})})}}},function(e){e.O(0,[3448,5783,2971,2117,1744],function(){return e(e.s=8239)}),_N_E=e.O()}]);