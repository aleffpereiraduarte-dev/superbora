(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4025],{731:function(e,a,s){Promise.resolve().then(s.bind(s,2800))},4445:function(e,a,s){"use strict";s.d(a,{Z:function(){return i}});var n=s(7437),l=s(8253);function i(e){let{section:a,children:s}=e,{hasPermission:i}=(0,l.q)();return i(a)?(0,n.jsx)(n.Fragment,{children:s}):(0,n.jsxs)("div",{className:"role-denied",children:[(0,n.jsx)("div",{className:"role-denied-icon",children:"\uD83D\uDD12"}),(0,n.jsx)("h2",{children:"Acesso Negado"}),(0,n.jsx)("p",{children:"Voce nao tem permissao para acessar esta secao."}),(0,n.jsx)("p",{className:"role-denied-hint",children:"Contate o administrador para solicitar acesso."})]})}},1656:function(e,a,s){"use strict";s.d(a,{X:function(){return t},Z:function(){return i}});var n=s(7437);let l={success:"badge-success",warning:"badge-warning",danger:"badge-danger",info:"badge-info",neutral:"badge-neutral"};function i(e){let{label:a,variant:s="neutral"}=e;return(0,n.jsx)("span",{className:"badge ".concat(l[s]||l.neutral),children:a})}function t(e){return({pendente:"warning",confirmado:"info",preparando:"info",pronto:"info",coletado:"info",em_entrega:"warning",entregue:"success",cancelado:"danger",recusado:"danger",ativo:"success",inativo:"neutral",bloqueado:"danger",online:"success",offline:"neutral",aprovado:"success",reprovado:"danger",pago:"success",pendente_pagamento:"warning",processando:"info",aberto:"warning",resolvido:"success",fechado:"neutral"})[e]||"neutral"}},2800:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return v}});var n=s(7437),l=s(2265),i=s(9376),t=s(8779),r=s(4477),d=s(4445),c=s(1656),o=s(6939),u=s(8789),m=s(6971),h=s(6428);function x(){let e=(0,i.useSearchParams)(),a=(0,i.useRouter)(),s=e.get("id"),{collapsed:t}=(0,u.A)(),{success:d,error:x}=(0,m.l)(),p=(0,l.useRef)(null),[v,j]=(0,l.useState)(null),[g,N]=(0,l.useState)([]),[b,f]=(0,l.useState)(!0),[y,_]=(0,l.useState)(""),[w,k]=(0,l.useState)(!1),[C,S]=(0,l.useState)("");(0,l.useEffect)(()=>{s&&E()},[s]),(0,l.useEffect)(()=>{var e;null===(e=p.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[g]);let E=async()=>{f(!0);try{let[e,a]=await Promise.allSettled([(0,h.SC)("/tickets.php?id=".concat(s)),(0,h.SC)("/chat-central.php?ticket_id=".concat(s))]);if("fulfilled"===e.status){let a=e.value.ticket||e.value;j(a),S(a.status||"aberto")}"fulfilled"===a.status&&N(a.value.messages||a.value.mensagens||a.value.data||[])}catch(e){x("Erro ao carregar ticket")}finally{f(!1)}},Z=async()=>{if(y.trim()){k(!0);try{await (0,h.sg)("/chat-central.php",{ticket_id:s,message:y,sender_type:"admin"}),d("Resposta enviada"),_(""),E()}catch(e){x("Erro: "+e.message)}finally{k(!1)}}},R=async e=>{try{await (0,h.sg)("/tickets.php",{ticket_id:s,action:"update_status",status:e}),d("Status atualizado"),S(e),E()}catch(e){x("Erro: "+e.message)}};return s?(0,n.jsxs)("div",{className:"admin-layout",children:[(0,n.jsx)(r.Z,{}),(0,n.jsxs)("main",{className:"admin-main ".concat(t?"main-collapsed":""),children:[(0,n.jsxs)("div",{className:"page-header",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("h1",{className:"page-title",children:["Ticket #",s," ",v&&(0,n.jsx)(c.Z,{label:v.status||"aberto",variant:(0,c.X)(v.status||"aberto")})]}),(0,n.jsx)("p",{className:"page-subtitle",children:(null==v?void 0:v.subject)||(null==v?void 0:v.assunto)||"Carregando..."})]}),(0,n.jsx)("div",{className:"page-actions",children:(0,n.jsx)("button",{className:"btn btn-secondary",onClick:()=>a.push("/suporte/"),children:"Voltar"})})]}),b?(0,n.jsx)("div",{className:"loading-spinner"}):(0,n.jsxs)("div",{className:"grid-2 gap-4",children:[(0,n.jsx)("div",{children:(0,n.jsxs)("div",{className:"card mb-4",children:[(0,n.jsx)("h3",{className:"card-title mb-4",children:"Mensagens"}),(0,n.jsxs)("div",{style:{maxHeight:500,overflowY:"auto",padding:"0 4px"},children:[0===g.length?(0,n.jsx)("p",{className:"text-muted text-sm",children:"Nenhuma mensagem ainda"}):g.map((e,a)=>{let s="admin"===e.sender_type||"admin"===e.tipo_remetente;return(0,n.jsxs)("div",{style:{marginBottom:12,padding:12,borderRadius:"var(--radius)",background:s?"rgba(59, 130, 246, 0.1)":"var(--bg)",border:"1px solid var(--border)",marginLeft:s?24:0,marginRight:s?0:24},children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,n.jsx)("strong",{className:"text-sm",style:{color:s?"var(--primary)":"var(--text)"},children:s?"Admin":e.sender_name||e.remetente||"Cliente"}),(0,n.jsx)("span",{className:"text-xs text-muted",children:e.created_at||e.data||""})]}),(0,n.jsx)("p",{className:"text-sm",style:{margin:0,whiteSpace:"pre-wrap"},children:e.message||e.mensagem||""})]},e.id||a)}),(0,n.jsx)("div",{ref:p})]}),(0,n.jsxs)("div",{style:{marginTop:16,borderTop:"1px solid var(--border)",paddingTop:16},children:[(0,n.jsx)("div",{className:"form-group",children:(0,n.jsx)("textarea",{className:"form-textarea",value:y,onChange:e=>_(e.target.value),placeholder:"Escreva sua resposta...",rows:3,onKeyDown:e=>{"Enter"===e.key&&e.ctrlKey&&Z()}})}),(0,n.jsxs)("div",{className:"flex gap-2",style:{justifyContent:"flex-end"},children:[(0,n.jsx)("span",{className:"text-xs text-muted",style:{alignSelf:"center"},children:"Ctrl+Enter para enviar"}),(0,n.jsx)("button",{className:"btn btn-primary",onClick:Z,disabled:w||!y.trim(),children:w?"Enviando...":"Enviar Resposta"})]})]})]})}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"card mb-4",children:[(0,n.jsx)("h3",{className:"card-title mb-4",children:"Detalhes do Ticket"}),(0,n.jsxs)("div",{className:"detail-grid",children:[(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"detail-label",children:"Assunto"}),(0,n.jsx)("span",{className:"detail-value",children:(null==v?void 0:v.subject)||(null==v?void 0:v.assunto)||"-"})]}),(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"detail-label",children:"Cliente"}),(0,n.jsx)("span",{className:"detail-value",children:(null==v?void 0:v.customer_name)||(null==v?void 0:v.cliente_nome)||"-"})]}),(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"detail-label",children:"Email"}),(0,n.jsx)("span",{className:"detail-value",children:(null==v?void 0:v.customer_email)||(null==v?void 0:v.email)||"-"})]}),(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"detail-label",children:"Categoria"}),(0,n.jsx)("span",{className:"detail-value",children:(null==v?void 0:v.category)||(null==v?void 0:v.categoria)||"-"})]}),(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"detail-label",children:"Prioridade"}),(0,n.jsx)(c.Z,{label:(null==v?void 0:v.priority)||(null==v?void 0:v.prioridade)||"media",variant:{alta:"danger",high:"danger",media:"warning",medium:"warning",baixa:"info",low:"info"}[(null==v?void 0:v.priority)||(null==v?void 0:v.prioridade)]||"neutral"})]}),(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"detail-label",children:"Pedido"}),(0,n.jsx)("span",{className:"detail-value",children:(null==v?void 0:v.order_id)||(null==v?void 0:v.pedido_id)?"#".concat(v.order_id||v.pedido_id):"-"})]}),(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"detail-label",children:"Aberto em"}),(0,n.jsx)("span",{className:"detail-value",children:(null==v?void 0:v.created_at)||(null==v?void 0:v.data)||"-"})]}),(0,n.jsxs)("div",{className:"detail-item",children:[(0,n.jsx)("span",{className:"detail-label",children:"Responsavel"}),(0,n.jsx)("span",{className:"detail-value",children:(null==v?void 0:v.assigned_to)||(null==v?void 0:v.responsavel)||"Nao atribuido"})]})]})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("h3",{className:"card-title mb-4",children:"Alterar Status"}),(0,n.jsx)("div",{className:"flex gap-2",style:{flexWrap:"wrap"},children:["aberto","em_andamento","resolvido","fechado"].map(e=>(0,n.jsx)("button",{className:"btn btn-sm ".concat(C===e?"btn-primary":"btn-secondary"),onClick:()=>R(e),children:e.replace("_"," ")},e))})]})]})]})]}),(0,n.jsx)(o.Z,{})]}):(0,n.jsxs)("div",{className:"admin-layout",children:[(0,n.jsx)(r.Z,{}),(0,n.jsx)("main",{className:"admin-main ".concat(t?"main-collapsed":""),children:(0,n.jsxs)("div",{className:"role-denied",children:[(0,n.jsx)("h2",{children:"Ticket nao encontrado"}),(0,n.jsx)("button",{className:"btn btn-primary mt-4",onClick:()=>a.push("/suporte/"),children:"Voltar"})]})})]})}function p(){return(0,n.jsx)(l.Suspense,{fallback:(0,n.jsxs)("div",{className:"auth-loading",children:[(0,n.jsx)("div",{className:"auth-loading-spinner"}),(0,n.jsx)("p",{children:"Carregando..."})]}),children:(0,n.jsx)(x,{})})}function v(){return(0,n.jsx)(t.Z,{children:(0,n.jsx)(d.Z,{section:"support",children:(0,n.jsx)(p,{})})})}}},function(e){e.O(0,[3448,5783,2971,2117,1744],function(){return e(e.s=731)}),_N_E=e.O()}]);