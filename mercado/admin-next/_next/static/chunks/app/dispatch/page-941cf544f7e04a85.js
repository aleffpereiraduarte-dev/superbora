(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[249],{3795:function(e,s,a){Promise.resolve().then(a.bind(a,1690))},4445:function(e,s,a){"use strict";a.d(s,{Z:function(){return r}});var n=a(7437),t=a(8253);function r(e){let{section:s,children:a}=e,{hasPermission:r}=(0,t.q)();return r(s)?(0,n.jsx)(n.Fragment,{children:a}):(0,n.jsxs)("div",{className:"role-denied",children:[(0,n.jsx)("div",{className:"role-denied-icon",children:"\uD83D\uDD12"}),(0,n.jsx)("h2",{children:"Acesso Negado"}),(0,n.jsx)("p",{children:"Voce nao tem permissao para acessar esta secao."}),(0,n.jsx)("p",{className:"role-denied-hint",children:"Contate o administrador para solicitar acesso."})]})}},1656:function(e,s,a){"use strict";a.d(s,{X:function(){return i},Z:function(){return r}});var n=a(7437);let t={success:"badge-success",warning:"badge-warning",danger:"badge-danger",info:"badge-info",neutral:"badge-neutral"};function r(e){let{label:s,variant:a="neutral"}=e;return(0,n.jsx)("span",{className:"badge ".concat(t[a]||t.neutral),children:s})}function i(e){return({pendente:"warning",confirmado:"info",preparando:"info",pronto:"info",coletado:"info",em_entrega:"warning",entregue:"success",cancelado:"danger",recusado:"danger",ativo:"success",inativo:"neutral",bloqueado:"danger",online:"success",offline:"neutral",aprovado:"success",reprovado:"danger",pago:"success",pendente_pagamento:"warning",processando:"info",aberto:"warning",resolvido:"success",fechado:"neutral"})[e]||"neutral"}},6939:function(e,s,a){"use strict";a.d(s,{Z:function(){return i}});var n=a(7437),t=a(6971);let r={success:"&#10003;",error:"&#10007;",warning:"&#9888;",info:"&#8505;"};function i(){let{toasts:e,removeToast:s}=(0,t.l)();return 0===e.length?null:(0,n.jsx)("div",{className:"toast-container",children:e.map(e=>(0,n.jsxs)("div",{className:"toast toast-".concat(e.type),children:[(0,n.jsx)("span",{className:"toast-icon",dangerouslySetInnerHTML:{__html:r[e.type]||r.info}}),(0,n.jsx)("span",{className:"toast-message",children:e.message}),(0,n.jsx)("button",{className:"toast-close",onClick:()=>s(e.id),children:"✕"})]},e.id))})}},1690:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return h}});var n=a(7437),t=a(2265),r=a(8779),i=a(4477),c=a(4445),d=a(1656),o=a(6939),l=a(8789),u=a(6971),p=a(6428);function m(){let{collapsed:e}=(0,l.A)(),{success:s,error:a}=(0,u.l)(),[r,c]=(0,t.useState)([]),[m,h]=(0,t.useState)([]),[x,g]=(0,t.useState)(!0),[j,v]=(0,t.useState)(null),[f,b]=(0,t.useState)(null),[N,_]=(0,t.useState)(!1);(0,t.useEffect)(()=>{y()},[]);let y=async()=>{g(!0);try{let[e,s]=await Promise.allSettled([(0,p.SC)("/dispatch.php"),(0,p.SC)("/shoppers.php?status=online")]);"fulfilled"===e.status&&c(e.value.orders||e.value.data||[]),"fulfilled"===s.status&&h(s.value.shoppers||s.value.data||[])}catch(e){a("Erro ao carregar dados")}finally{g(!1)}},w=async()=>{if(!j||!f){a("Selecione um pedido e um shopper");return}_(!0);try{await (0,p.sg)("/dispatch.php",{order_id:j.id||j.order_id,shopper_id:f.id||f.shopper_id}),s("Pedido #".concat(j.id||j.order_id," atribuido para ").concat(f.name||f.nome)),v(null),b(null),y()}catch(e){a("Erro ao atribuir: "+e.message)}finally{_(!1)}},S=async e=>{try{await (0,p.sg)("/dispatch.php",{order_id:e.id||e.order_id,auto:!0}),s("Pedido #".concat(e.id||e.order_id," atribuido automaticamente")),y()}catch(e){a("Erro na atribuicao automatica: "+e.message)}},k=e=>null!=e?"R$ ".concat(Number(e).toLocaleString("pt-BR",{minimumFractionDigits:2})):"R$ 0,00";return(0,n.jsxs)("div",{className:"admin-layout",children:[(0,n.jsx)(i.Z,{}),(0,n.jsxs)("main",{className:"admin-main ".concat(e?"main-collapsed":""),children:[(0,n.jsxs)("div",{className:"page-header",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"page-title",children:"Despacho"}),(0,n.jsx)("p",{className:"page-subtitle",children:"Atribuir pedidos a shoppers disponiveis"})]}),(0,n.jsxs)("div",{className:"page-actions",children:[j&&f&&(0,n.jsx)("button",{className:"btn btn-primary",onClick:w,disabled:N,children:N?"Atribuindo...":"Atribuir #".concat(j.id||j.order_id," → ").concat(f.name||f.nome)}),(0,n.jsx)("button",{className:"btn btn-secondary",onClick:y,children:"Atualizar"})]})]}),x?(0,n.jsxs)("div",{className:"auth-loading",children:[(0,n.jsx)("div",{className:"auth-loading-spinner"}),(0,n.jsx)("p",{children:"Carregando..."})]}):(0,n.jsxs)("div",{className:"grid-2 gap-4",children:[(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("div",{className:"card-header",children:(0,n.jsxs)("h3",{className:"card-title",children:["Pedidos sem Shopper (",r.length,")"]})}),0===r.length?(0,n.jsx)("p",{className:"text-muted p-4",children:"Todos os pedidos estao atribuidos"}):(0,n.jsx)("div",{style:{maxHeight:"calc(100vh - 250px)",overflowY:"auto"},children:r.map(e=>{let s=e.id||e.order_id,a=j&&(j.id||j.order_id)===s;return(0,n.jsxs)("div",{onClick:()=>v(e),style:{padding:"14px 16px",borderBottom:"1px solid var(--border)",cursor:"pointer",background:a?"var(--accent-light)":"transparent",borderLeft:a?"3px solid var(--accent)":"3px solid transparent",transition:"all 0.15s ease"},children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsxs)("strong",{children:["#",s]}),(0,n.jsx)(d.Z,{label:e.status||"pendente",variant:(0,d.X)(e.status)})]}),(0,n.jsx)("p",{className:"text-sm",children:e.cliente_nome||e.customer_name||"-"}),(0,n.jsxs)("p",{className:"text-xs text-dim",children:[e.parceiro_nome||e.partner_name||"-"," | ",k(e.total)]}),(0,n.jsx)("div",{className:"flex gap-2 mt-2",children:(0,n.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:s=>{s.stopPropagation(),S(e)},children:"Auto-atribuir"})})]},s)})})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("div",{className:"card-header",children:(0,n.jsxs)("h3",{className:"card-title",children:["Shoppers Disponiveis (",m.length,")"]})}),0===m.length?(0,n.jsx)("p",{className:"text-muted p-4",children:"Nenhum shopper online"}):(0,n.jsx)("div",{style:{maxHeight:"calc(100vh - 250px)",overflowY:"auto"},children:m.map(e=>{let s=e.id||e.shopper_id,a=f&&(f.id||f.shopper_id)===s;return(0,n.jsxs)("div",{onClick:()=>b(e),style:{padding:"14px 16px",borderBottom:"1px solid var(--border)",cursor:"pointer",background:a?"var(--accent-light)":"transparent",borderLeft:a?"3px solid var(--accent)":"3px solid transparent",transition:"all 0.15s ease"},children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)("strong",{className:"text-sm",children:e.name||e.nome}),(0,n.jsx)(d.Z,{label:"online",variant:"success"})]}),(0,n.jsx)("p",{className:"text-xs text-dim",children:e.phone||e.telefone||""}),null!=e.active_orders&&(0,n.jsxs)("p",{className:"text-xs text-muted mt-1",children:[e.active_orders," pedido(s) ativo(s)",e.distance&&" | ".concat(e.distance)]}),e.rating&&(0,n.jsxs)("p",{className:"text-xs",style:{color:"var(--warning)"},children:["⭐ ",e.rating]})]},s)})})]})]})]}),(0,n.jsx)(o.Z,{})]})}function h(){return(0,n.jsx)(r.Z,{children:(0,n.jsx)(c.Z,{section:"dispatch",children:(0,n.jsx)(m,{})})})}}},function(e){e.O(0,[3448,1006,2971,2117,1744],function(){return e(e.s=3795)}),_N_E=e.O()}]);