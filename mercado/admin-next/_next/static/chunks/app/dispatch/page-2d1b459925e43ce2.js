(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[249],{3795:function(e,a,s){Promise.resolve().then(s.bind(s,1690))},4445:function(e,a,s){"use strict";s.d(a,{Z:function(){return t}});var n=s(7437),r=s(8253);function t(e){let{section:a,children:s}=e,{hasPermission:t}=(0,r.q)();return t(a)?(0,n.jsx)(n.Fragment,{children:s}):(0,n.jsxs)("div",{className:"role-denied",children:[(0,n.jsx)("div",{className:"role-denied-icon",children:"\uD83D\uDD12"}),(0,n.jsx)("h2",{children:"Acesso Negado"}),(0,n.jsx)("p",{children:"Voce nao tem permissao para acessar esta secao."}),(0,n.jsx)("p",{className:"role-denied-hint",children:"Contate o administrador para solicitar acesso."})]})}},1656:function(e,a,s){"use strict";s.d(a,{X:function(){return i},Z:function(){return t}});var n=s(7437);let r={success:"badge-success",warning:"badge-warning",danger:"badge-danger",info:"badge-info",neutral:"badge-neutral"};function t(e){let{label:a,variant:s="neutral"}=e;return(0,n.jsx)("span",{className:"badge ".concat(r[s]||r.neutral),children:a})}function i(e){return({pendente:"warning",confirmado:"info",preparando:"info",pronto:"info",coletado:"info",em_entrega:"warning",entregue:"success",cancelado:"danger",recusado:"danger",ativo:"success",inativo:"neutral",bloqueado:"danger",online:"success",offline:"neutral",aprovado:"success",reprovado:"danger",pago:"success",pendente_pagamento:"warning",processando:"info",aberto:"warning",resolvido:"success",fechado:"neutral"})[e]||"neutral"}},1690:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return m}});var n=s(7437),r=s(2265),t=s(8779),i=s(4477),d=s(4445),c=s(1656),o=s(6939),l=s(8789),u=s(6971),p=s(6428);function h(){let{collapsed:e}=(0,l.A)(),{success:a,error:s}=(0,u.l)(),[t,d]=(0,r.useState)([]),[h,m]=(0,r.useState)([]),[x,g]=(0,r.useState)(!0),[j,v]=(0,r.useState)(null),[f,b]=(0,r.useState)(null),[N,_]=(0,r.useState)(!1);(0,r.useEffect)(()=>{y()},[]);let y=async()=>{g(!0);try{let[e,a]=await Promise.allSettled([(0,p.SC)("/dispatch.php"),(0,p.SC)("/shoppers.php?status=online")]);"fulfilled"===e.status&&d(e.value.orders||e.value.data||[]),"fulfilled"===a.status&&m(a.value.shoppers||a.value.data||[])}catch(e){s("Erro ao carregar dados")}finally{g(!1)}},w=async()=>{if(!j||!f){s("Selecione um pedido e um shopper");return}_(!0);try{await (0,p.sg)("/dispatch.php",{order_id:j.id||j.order_id,shopper_id:f.id||f.shopper_id}),a("Pedido #".concat(j.id||j.order_id," atribuido para ").concat(f.name||f.nome)),v(null),b(null),y()}catch(e){s("Erro ao atribuir: "+e.message)}finally{_(!1)}},S=async e=>{try{await (0,p.sg)("/dispatch.php",{order_id:e.id||e.order_id,auto:!0}),a("Pedido #".concat(e.id||e.order_id," atribuido automaticamente")),y()}catch(e){s("Erro na atribuicao automatica: "+e.message)}},k=e=>null!=e?"R$ ".concat(Number(e).toLocaleString("pt-BR",{minimumFractionDigits:2})):"R$ 0,00";return(0,n.jsxs)("div",{className:"admin-layout",children:[(0,n.jsx)(i.Z,{}),(0,n.jsxs)("main",{className:"admin-main ".concat(e?"main-collapsed":""),children:[(0,n.jsxs)("div",{className:"page-header",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"page-title",children:"Despacho"}),(0,n.jsx)("p",{className:"page-subtitle",children:"Atribuir pedidos a shoppers disponiveis"})]}),(0,n.jsxs)("div",{className:"page-actions",children:[j&&f&&(0,n.jsx)("button",{className:"btn btn-primary",onClick:w,disabled:N,children:N?"Atribuindo...":"Atribuir #".concat(j.id||j.order_id," → ").concat(f.name||f.nome)}),(0,n.jsx)("button",{className:"btn btn-secondary",onClick:y,children:"Atualizar"})]})]}),x?(0,n.jsxs)("div",{className:"auth-loading",children:[(0,n.jsx)("div",{className:"auth-loading-spinner"}),(0,n.jsx)("p",{children:"Carregando..."})]}):(0,n.jsxs)("div",{className:"grid-2 gap-4",children:[(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("div",{className:"card-header",children:(0,n.jsxs)("h3",{className:"card-title",children:["Pedidos sem Shopper (",t.length,")"]})}),0===t.length?(0,n.jsx)("p",{className:"text-muted p-4",children:"Todos os pedidos estao atribuidos"}):(0,n.jsx)("div",{style:{maxHeight:"calc(100vh - 250px)",overflowY:"auto"},children:t.map(e=>{let a=e.id||e.order_id,s=j&&(j.id||j.order_id)===a;return(0,n.jsxs)("div",{onClick:()=>v(e),style:{padding:"14px 16px",borderBottom:"1px solid var(--border)",cursor:"pointer",background:s?"var(--accent-light)":"transparent",borderLeft:s?"3px solid var(--accent)":"3px solid transparent",transition:"all 0.15s ease"},children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsxs)("strong",{children:["#",a]}),(0,n.jsx)(c.Z,{label:e.status||"pendente",variant:(0,c.X)(e.status)})]}),(0,n.jsx)("p",{className:"text-sm",children:e.cliente_nome||e.customer_name||"-"}),(0,n.jsxs)("p",{className:"text-xs text-dim",children:[e.parceiro_nome||e.partner_name||"-"," | ",k(e.total)]}),(0,n.jsx)("div",{className:"flex gap-2 mt-2",children:(0,n.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:a=>{a.stopPropagation(),S(e)},children:"Auto-atribuir"})})]},a)})})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("div",{className:"card-header",children:(0,n.jsxs)("h3",{className:"card-title",children:["Shoppers Disponiveis (",h.length,")"]})}),0===h.length?(0,n.jsx)("p",{className:"text-muted p-4",children:"Nenhum shopper online"}):(0,n.jsx)("div",{style:{maxHeight:"calc(100vh - 250px)",overflowY:"auto"},children:h.map(e=>{let a=e.id||e.shopper_id,s=f&&(f.id||f.shopper_id)===a;return(0,n.jsxs)("div",{onClick:()=>b(e),style:{padding:"14px 16px",borderBottom:"1px solid var(--border)",cursor:"pointer",background:s?"var(--accent-light)":"transparent",borderLeft:s?"3px solid var(--accent)":"3px solid transparent",transition:"all 0.15s ease"},children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)("strong",{className:"text-sm",children:e.name||e.nome}),(0,n.jsx)(c.Z,{label:"online",variant:"success"})]}),(0,n.jsx)("p",{className:"text-xs text-dim",children:e.phone||e.telefone||""}),null!=e.active_orders&&(0,n.jsxs)("p",{className:"text-xs text-muted mt-1",children:[e.active_orders," pedido(s) ativo(s)",e.distance&&" | ".concat(e.distance)]}),e.rating&&(0,n.jsxs)("p",{className:"text-xs",style:{color:"var(--warning)"},children:["⭐ ",e.rating]})]},a)})})]})]})]}),(0,n.jsx)(o.Z,{})]})}function m(){return(0,n.jsx)(t.Z,{children:(0,n.jsx)(d.Z,{section:"dispatch",children:(0,n.jsx)(h,{})})})}}},function(e){e.O(0,[3448,5783,2971,2117,1744],function(){return e(e.s=3795)}),_N_E=e.O()}]);