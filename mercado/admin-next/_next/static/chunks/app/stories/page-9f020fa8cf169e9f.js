(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2747],{920:function(e,a,t){Promise.resolve().then(t.bind(t,6816))},6428:function(e,a,t){"use strict";t.d(a,{LP:function(){return r},QW:function(){return u},SC:function(){return l},o4:function(){return i},pE:function(){return d},sg:function(){return o}});let s="/api/mercado/admin",n="admin_token";function r(){try{return localStorage.getItem(n)}catch(e){return null}}function i(e){try{e?localStorage.setItem(n,e):localStorage.removeItem(n)}catch(e){}}function c(){let e=r(),a={"Content-Type":"application/json"};return e&&(a.Authorization="Bearer ".concat(e)),a}async function l(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t="".concat(s).concat(e),n=Object.entries(a).filter(e=>{let[,a]=e;return null!=a&&""!==a}).map(e=>{let[a,t]=e;return"".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(t))}).join("&");n&&(t+="?".concat(n));let r=await fetch(t,{headers:c()});if(!r.ok)throw Error((await r.json().catch(()=>({message:"Erro de rede"}))).message||"HTTP ".concat(r.status));let i=await r.json();if(!1===i.success)throw Error(i.message||"Erro desconhecido");return void 0!==i.data?i.data:i}async function o(e,a){let t=await fetch("".concat(s).concat(e),{method:"POST",headers:c(),body:JSON.stringify(a)}),n=await t.json().catch(()=>null);if(!t.ok||n&&!1===n.success)throw Error((null==n?void 0:n.message)||"HTTP ".concat(t.status));return(null==n?void 0:n.data)!==void 0?n.data:n}async function d(e,a){let t=await fetch("".concat(s).concat(e),{method:"PUT",headers:c(),body:JSON.stringify(a)}),n=await t.json().catch(()=>null);if(!t.ok||n&&!1===n.success)throw Error((null==n?void 0:n.message)||"HTTP ".concat(t.status));return(null==n?void 0:n.data)!==void 0?n.data:n}async function u(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t="".concat(s).concat(e),n=Object.entries(a).filter(e=>{let[,a]=e;return null!=a&&""!==a}).map(e=>{let[a,t]=e;return"".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(t))}).join("&");n&&(t+="?".concat(n));let r=await fetch(t,{method:"DELETE",headers:c()}),i=await r.json().catch(()=>null);if(!r.ok||i&&!1===i.success)throw Error((null==i?void 0:i.message)||"HTTP ".concat(r.status));return(null==i?void 0:i.data)!==void 0?i.data:i}},8779:function(e,a,t){"use strict";t.d(a,{Z:function(){return c}});var s=t(7437),n=t(2265),r=t(7128),i=t(9376);function c(e){let{children:a}=e,{isAuthenticated:t,loading:c}=(0,r.a)(),l=(0,i.useRouter)();return((0,n.useEffect)(()=>{c||t||l.push("/login/")},[c,t,l]),c)?(0,s.jsxs)("div",{className:"auth-loading",children:[(0,s.jsx)("div",{className:"auth-loading-spinner"}),(0,s.jsx)("p",{children:"Carregando..."})]}):t?(0,s.jsx)(s.Fragment,{children:a}):null}},7128:function(e,a,t){"use strict";t.d(a,{H:function(){return c},a:function(){return l}});var s=t(7437),n=t(2265),r=t(6428);let i=(0,n.createContext)(null);function c(e){let{children:a}=e,[t,c]=(0,n.useState)(null),[l,o]=(0,n.useState)(!0),d=(0,n.useCallback)(async()=>{if(!(0,r.LP)()){o(!1);return}try{let e=await (0,r.SC)("/auth/session.php");e.admin?c({...e.admin,name:e.admin.nome||e.admin.name,admin_id:e.admin.admin_id||e.admin.id}):((0,r.o4)(null),c(null))}catch(e){(0,r.o4)(null),c(null)}finally{o(!1)}},[]);(0,n.useEffect)(()=>{d()},[d]);let u=async(e,a)=>{let t=await (0,r.sg)("/auth/login.php",{email:e,senha:a});if(t.token)return(0,r.o4)(t.token),c({admin_id:t.admin_id,name:t.nome||t.name,email:t.email,role:t.role}),t;throw Error(t.message||"Erro ao fazer login")};return(0,s.jsx)(i.Provider,{value:{admin:t,loading:l,isAuthenticated:!!t,login:u,logout:()=>{(0,r.o4)(null),c(null)},checkSession:d},children:a})}function l(){let e=(0,n.useContext)(i);if(!e)throw Error("useAuth must be inside AuthProvider");return e}},6816:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return l}});var s=t(7437),n=t(2265),r=t(8779),i=t(6428);function c(){let[e,a]=(0,n.useState)(!0),[t,r]=(0,n.useState)([]),[c,l]=(0,n.useState)(null),[o,d]=(0,n.useState)(null),[u,h]=(0,n.useState)({status:"pending",page:1}),[m,p]=(0,n.useState)([]),[j,v]=(0,n.useState)(null),g=(0,n.useCallback)(async()=>{a(!0);try{let e=await (0,i.SC)("/stories.php",{status:u.status,page:u.page});r(e.stories),l(e.stats),d(e.pagination)}catch(e){console.error("Erro:",e)}finally{a(!1)}},[u]);(0,n.useEffect)(()=>{g()},[g]);let x=async function(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{await (0,i.sg)("/stories.php",{action:e,story_id:a,...t}),g(),p([])}catch(e){alert(e.message||"Erro ao executar acao")}},f=async e=>{if(0===m.length){alert("Selecione ao menos um story");return}let a="bulk_reject"===e?prompt("Motivo da rejeicao:"):null,t=a?a.replace(/<[^>]*>/g,"").trim():null;try{let a=await (0,i.sg)("/stories.php",{action:e,story_ids:m,reason:t});alert(a.message||"Sucesso!"),g(),p([])}catch(e){alert(e.message||"Erro ao executar acao em lote")}},b=e=>{p(a=>a.includes(e)?a.filter(a=>a!==e):[...a,e])},N=e=>(0,s.jsx)("span",{className:"badge",style:{backgroundColor:{active:"#22c55e",pending:"#f59e0b",rejected:"#ef4444",expired:"#6b7280"}[e]},children:e});return(0,s.jsxs)("div",{className:"page-container",children:[(0,s.jsx)("div",{className:"page-header",children:(0,s.jsx)("h1",{children:"Moderacao de Stories"})}),c&&(0,s.jsxs)("div",{className:"stats-grid",children:[(0,s.jsxs)("div",{className:"stat-card warning",children:[(0,s.jsx)("div",{className:"stat-value",children:c.pending}),(0,s.jsx)("div",{className:"stat-label",children:"Pendentes"})]}),(0,s.jsxs)("div",{className:"stat-card success",children:[(0,s.jsx)("div",{className:"stat-value",children:c.active}),(0,s.jsx)("div",{className:"stat-label",children:"Ativos"})]}),(0,s.jsxs)("div",{className:"stat-card danger",children:[(0,s.jsx)("div",{className:"stat-value",children:c.rejected}),(0,s.jsx)("div",{className:"stat-label",children:"Rejeitados"})]}),(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsx)("div",{className:"stat-value",children:c.expired}),(0,s.jsx)("div",{className:"stat-label",children:"Expirados"})]})]}),(0,s.jsxs)("div",{className:"filters-bar",children:[(0,s.jsxs)("select",{value:u.status,onChange:e=>h({...u,status:e.target.value,page:1}),children:[(0,s.jsx)("option",{value:"all",children:"Todos"}),(0,s.jsx)("option",{value:"pending",children:"Pendentes"}),(0,s.jsx)("option",{value:"active",children:"Ativos"}),(0,s.jsx)("option",{value:"rejected",children:"Rejeitados"}),(0,s.jsx)("option",{value:"expired",children:"Expirados"})]}),m.length>0&&(0,s.jsxs)("div",{className:"bulk-actions",children:[(0,s.jsxs)("span",{children:[m.length," selecionados"]}),(0,s.jsx)("button",{className:"btn btn-success btn-small",onClick:()=>f("bulk_approve"),children:"Aprovar"}),(0,s.jsx)("button",{className:"btn btn-danger btn-small",onClick:()=>f("bulk_reject"),children:"Rejeitar"})]})]}),e?(0,s.jsx)("div",{className:"loading",children:"Carregando..."}):(0,s.jsxs)("div",{className:"stories-grid",children:[(0,s.jsx)("div",{className:"stories-header",children:(0,s.jsxs)("label",{className:"checkbox-label",children:[(0,s.jsx)("input",{type:"checkbox",checked:m.length===t.length&&t.length>0,onChange:()=>{m.length===t.length?p([]):p(t.map(e=>e.id))}}),"Selecionar todos"]})}),t.map(e=>(0,s.jsxs)("div",{className:"story-card ".concat(m.includes(e.id)?"selected":""),children:[(0,s.jsx)("div",{className:"story-checkbox",children:(0,s.jsx)("input",{type:"checkbox",checked:m.includes(e.id),onChange:()=>b(e.id)})}),(0,s.jsxs)("div",{className:"story-media",onClick:()=>v(e),children:["video"===e.media_type?(0,s.jsx)("video",{src:e.media_url}):(0,s.jsx)("img",{src:e.thumbnail_url||e.media_url,alt:""}),(0,s.jsx)("div",{className:"story-overlay",children:(0,s.jsx)("span",{className:"play-icon",children:"video"===e.media_type?"â–¶":"\uD83D\uDD0D"})})]}),(0,s.jsxs)("div",{className:"story-info",children:[(0,s.jsxs)("div",{className:"story-partner",children:[e.partner_logo&&(0,s.jsx)("img",{src:e.partner_logo,alt:"",className:"partner-logo-small"}),(0,s.jsx)("span",{children:e.partner_name})]}),e.caption&&(0,s.jsx)("p",{className:"story-caption",children:e.caption}),(0,s.jsxs)("div",{className:"story-meta",children:[(0,s.jsxs)("span",{children:[e.view_count||0," views"]}),(0,s.jsx)("span",{children:new Date(e.created_at).toLocaleDateString("pt-BR")})]}),(0,s.jsx)("div",{className:"story-status",children:N(e.status)})]}),(0,s.jsxs)("div",{className:"story-actions",children:["pending"===e.status&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{className:"btn btn-success btn-small",onClick:()=>x("approve",e.id),children:"Aprovar"}),(0,s.jsx)("button",{className:"btn btn-danger btn-small",onClick:()=>{let a=prompt("Motivo da rejeicao:");a&&x("reject",e.id,{reason:a.replace(/<[^>]*>/g,"").trim()})},children:"Rejeitar"})]}),"active"===e.status&&(0,s.jsx)("button",{className:"btn btn-danger btn-small",onClick:()=>{confirm("Remover este story?")&&x("delete",e.id)},children:"Remover"})]})]},e.id))]}),o&&(0,s.jsxs)("div",{className:"pagination",children:[(0,s.jsx)("button",{disabled:1===u.page,onClick:()=>h({...u,page:u.page-1}),children:"Anterior"}),(0,s.jsxs)("span",{children:["Pagina ",u.page," de ",o.pages]}),(0,s.jsx)("button",{disabled:u.page>=o.pages,onClick:()=>h({...u,page:u.page+1}),children:"Proxima"})]}),j&&(0,s.jsx)("div",{className:"modal-overlay",onClick:()=>v(null),children:(0,s.jsxs)("div",{className:"modal-content story-preview",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("button",{className:"modal-close",onClick:()=>v(null),children:"\xd7"}),"video"===j.media_type?(0,s.jsx)("video",{src:j.media_url,controls:!0,autoPlay:!0,className:"story-preview-media"}):(0,s.jsx)("img",{src:j.media_url,alt:"",className:"story-preview-media"}),(0,s.jsxs)("div",{className:"story-preview-info",children:[(0,s.jsx)("h3",{children:j.partner_name}),j.caption&&(0,s.jsx)("p",{children:j.caption})]})]})})]})}function l(){return(0,s.jsx)(r.Z,{children:(0,s.jsx)(c,{})})}},9376:function(e,a,t){"use strict";var s=t(5475);t.o(s,"usePathname")&&t.d(a,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(a,{useRouter:function(){return s.useRouter}}),t.o(s,"useSearchParams")&&t.d(a,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=920)}),_N_E=e.O()}]);