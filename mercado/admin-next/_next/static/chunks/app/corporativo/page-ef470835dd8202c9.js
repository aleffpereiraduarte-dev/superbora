(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5234],{9504:function(e,t,n){Promise.resolve().then(n.bind(n,7584))},6428:function(e,t,n){"use strict";n.d(t,{LP:function(){return c},QW:function(){return u},SC:function(){return l},o4:function(){return i},pE:function(){return d},sg:function(){return o}});let a="/api/mercado/admin",s="admin_token";function c(){try{return localStorage.getItem(s)}catch(e){return null}}function i(e){try{e?localStorage.setItem(s,e):localStorage.removeItem(s)}catch(e){}}function r(){let e=c(),t={"Content-Type":"application/json"};return e&&(t.Authorization="Bearer ".concat(e)),t}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),s=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");s&&(n+="?".concat(s));let c=await fetch(n,{headers:r()});if(!c.ok)throw Error((await c.json().catch(()=>({message:"Erro de rede"}))).message||"HTTP ".concat(c.status));let i=await c.json();if(!1===i.success)throw Error(i.message||"Erro desconhecido");return void 0!==i.data?i.data:i}async function o(e,t){let n=await fetch("".concat(a).concat(e),{method:"POST",headers:r(),body:JSON.stringify(t)}),s=await n.json().catch(()=>null);if(!n.ok||s&&!1===s.success)throw Error((null==s?void 0:s.message)||"HTTP ".concat(n.status));return(null==s?void 0:s.data)!==void 0?s.data:s}async function d(e,t){let n=await fetch("".concat(a).concat(e),{method:"PUT",headers:r(),body:JSON.stringify(t)}),s=await n.json().catch(()=>null);if(!n.ok||s&&!1===s.success)throw Error((null==s?void 0:s.message)||"HTTP ".concat(n.status));return(null==s?void 0:s.data)!==void 0?s.data:s}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),s=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");s&&(n+="?".concat(s));let c=await fetch(n,{method:"DELETE",headers:r()}),i=await c.json().catch(()=>null);if(!c.ok||i&&!1===i.success)throw Error((null==i?void 0:i.message)||"HTTP ".concat(c.status));return(null==i?void 0:i.data)!==void 0?i.data:i}},8779:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var a=n(7437),s=n(2265),c=n(7128),i=n(9376);function r(e){let{children:t}=e,{isAuthenticated:n,loading:r}=(0,c.a)(),l=(0,i.useRouter)();return((0,s.useEffect)(()=>{r||n||l.push("/login/")},[r,n,l]),r)?(0,a.jsxs)("div",{className:"auth-loading",children:[(0,a.jsx)("div",{className:"auth-loading-spinner"}),(0,a.jsx)("p",{children:"Carregando..."})]}):n?(0,a.jsx)(a.Fragment,{children:t}):null}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return r},a:function(){return l}});var a=n(7437),s=n(2265),c=n(6428);let i=(0,s.createContext)(null);function r(e){let{children:t}=e,[n,r]=(0,s.useState)(null),[l,o]=(0,s.useState)(!0),d=(0,s.useCallback)(async()=>{if(!(0,c.LP)()){o(!1);return}try{let e=await (0,c.SC)("/auth/session.php");e.admin?r({...e.admin,name:e.admin.nome||e.admin.name,admin_id:e.admin.admin_id||e.admin.id}):((0,c.o4)(null),r(null))}catch(e){(0,c.o4)(null),r(null)}finally{o(!1)}},[]);(0,s.useEffect)(()=>{d()},[d]);let u=async(e,t)=>{let n=await (0,c.sg)("/auth/login.php",{email:e,senha:t});if(n.token)return(0,c.o4)(n.token),r({admin_id:n.admin_id,name:n.nome||n.name,email:n.email,role:n.role}),n;throw Error(n.message||"Erro ao fazer login")};return(0,a.jsx)(i.Provider,{value:{admin:n,loading:l,isAuthenticated:!!n,login:u,logout:()=>{(0,c.o4)(null),r(null)},checkSession:d},children:t})}function l(){let e=(0,s.useContext)(i);if(!e)throw Error("useAuth must be inside AuthProvider");return e}},7584:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var a=n(7437),s=n(2265),c=n(8779),i=n(6428);function r(){let[e,t]=(0,s.useState)(!0),[n,c]=(0,s.useState)([]),[r,l]=(0,s.useState)(null),[o,d]=(0,s.useState)(null),[u,h]=(0,s.useState)(null),[m,j]=(0,s.useState)("all"),x=(0,s.useCallback)(async()=>{t(!0);try{let e="all"!==m?{status:m}:{},t=await (0,i.SC)("/corporate.php",e);c(t.accounts),l(t.stats)}catch(e){console.error("Erro:",e)}finally{t(!1)}},[m]),p=async e=>{try{let t=await (0,i.SC)("/corporate.php",{id:e});h(t)}catch(e){console.error("Erro:",e)}};(0,s.useEffect)(()=>{x()},[x]),(0,s.useEffect)(()=>{o&&p(o)},[o]);let v=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(confirm({approve:"Aprovar esta conta corporativa?",suspend:"Suspender esta conta?",generate_invoice:"Gerar fatura para esta conta?"}[e]||"Confirma esta acao?"))try{let a=await (0,i.sg)("/corporate.php",{action:e,corporate_id:t,...n});alert(a.message||"Sucesso!"),x(),o===t&&p(t)}catch(e){alert(e.message||"Erro ao executar acao")}},f=e=>(0,a.jsx)("span",{className:"badge",style:{backgroundColor:{active:"#22c55e",pending:"#f59e0b",suspended:"#ef4444"}[e]},children:{active:"Ativa",pending:"Pendente",suspended:"Suspensa"}[e]||e});return(0,a.jsxs)("div",{className:"page-container",children:[(0,a.jsx)("div",{className:"page-header",children:(0,a.jsx)("h1",{children:"Contas Corporativas"})}),r&&(0,a.jsxs)("div",{className:"stats-grid",children:[(0,a.jsxs)("div",{className:"stat-card",children:[(0,a.jsx)("div",{className:"stat-value",children:r.total}),(0,a.jsx)("div",{className:"stat-label",children:"Total"})]}),(0,a.jsxs)("div",{className:"stat-card warning",children:[(0,a.jsx)("div",{className:"stat-value",children:r.pending}),(0,a.jsx)("div",{className:"stat-label",children:"Pendentes"})]}),(0,a.jsxs)("div",{className:"stat-card success",children:[(0,a.jsx)("div",{className:"stat-value",children:r.active}),(0,a.jsx)("div",{className:"stat-label",children:"Ativas"})]}),(0,a.jsxs)("div",{className:"stat-card danger",children:[(0,a.jsx)("div",{className:"stat-value",children:r.suspended}),(0,a.jsx)("div",{className:"stat-label",children:"Suspensas"})]})]}),(0,a.jsxs)("div",{className:"content-split",children:[(0,a.jsxs)("div",{className:"list-panel",children:[(0,a.jsx)("div",{className:"filters-bar",children:(0,a.jsxs)("select",{value:m,onChange:e=>j(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"Todos Status"}),(0,a.jsx)("option",{value:"pending",children:"Pendentes"}),(0,a.jsx)("option",{value:"active",children:"Ativas"}),(0,a.jsx)("option",{value:"suspended",children:"Suspensas"})]})}),e?(0,a.jsx)("div",{className:"loading",children:"Carregando..."}):(0,a.jsx)("div",{className:"account-list",children:n.map(e=>(0,a.jsxs)("div",{className:"account-item ".concat(o===e.id?"selected":""),onClick:()=>d(e.id),children:[(0,a.jsxs)("div",{className:"account-item-header",children:[(0,a.jsx)("strong",{children:e.company_name}),f(e.status)]}),(0,a.jsxs)("div",{className:"account-item-meta",children:[(0,a.jsxs)("span",{children:["CNPJ: ",e.cnpj]}),(0,a.jsxs)("span",{children:[e.employee_count||0," funcionarios"]})]}),e.month_spent>0&&(0,a.jsxs)("div",{className:"account-item-spent",children:["Gasto mes: R$ ",parseFloat(e.month_spent).toFixed(2)]})]},e.id))})]}),(0,a.jsx)("div",{className:"detail-panel",children:u?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"detail-header",children:[(0,a.jsx)("h2",{children:u.account.company_name}),f(u.account.status)]}),(0,a.jsxs)("div",{className:"detail-section",children:[(0,a.jsx)("h3",{children:"Informacoes"}),(0,a.jsxs)("div",{className:"info-grid",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"CNPJ:"})," ",u.account.cnpj]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"Contato:"})," ",u.account.contact_name]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"Email:"})," ",u.account.contact_email]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"Telefone:"})," ",u.account.contact_phone]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"Endereco:"})," ",u.account.address,", ",u.account.city,"/",u.account.state]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"Limite Mensal:"})," R$ ",parseFloat(u.account.monthly_limit).toFixed(2)]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"Limite/Func:"})," R$ ",parseFloat(u.account.per_employee_limit).toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"detail-actions",children:["pending"===u.account.status&&(0,a.jsx)("button",{className:"btn btn-success",onClick:()=>v("approve",u.account.id),children:"Aprovar Conta"}),"active"===u.account.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{className:"btn btn-danger",onClick:()=>v("suspend",u.account.id,{reason:prompt("Motivo da suspensao:")}),children:"Suspender"}),(0,a.jsx)("button",{className:"btn btn-primary",onClick:()=>v("generate_invoice",u.account.id,{reference_month:new Date().toISOString().slice(0,7)}),children:"Gerar Fatura"}),(0,a.jsx)("button",{className:"btn",onClick:()=>{let e=prompt("Novo limite mensal:",u.account.monthly_limit),t=prompt("Novo limite por funcionario:",u.account.per_employee_limit);e&&t&&v("update_limits",u.account.id,{monthly_limit:e,per_employee_limit:t})},children:"Alterar Limites"})]})]}),(0,a.jsxs)("div",{className:"detail-section",children:[(0,a.jsxs)("h3",{children:["Funcionarios (",u.employees.length,")"]}),(0,a.jsxs)("table",{className:"data-table compact",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Nome"}),(0,a.jsx)("th",{children:"Email"}),(0,a.jsx)("th",{children:"Depto"}),(0,a.jsx)("th",{children:"Gasto Mes"}),(0,a.jsx)("th",{children:"Status"})]})}),(0,a.jsx)("tbody",{children:u.employees.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.name}),(0,a.jsx)("td",{children:e.email}),(0,a.jsx)("td",{children:e.department||"-"}),(0,a.jsxs)("td",{children:["R$ ",parseFloat(e.current_month_spent).toFixed(2)]}),(0,a.jsx)("td",{children:(0,a.jsx)("span",{className:"status-dot ".concat("active"===e.status?"active":"")})})]},e.id))})]})]}),u.invoices.length>0&&(0,a.jsxs)("div",{className:"detail-section",children:[(0,a.jsx)("h3",{children:"Faturas"}),(0,a.jsxs)("table",{className:"data-table compact",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Ref"}),(0,a.jsx)("th",{children:"Valor"}),(0,a.jsx)("th",{children:"Vencimento"}),(0,a.jsx)("th",{children:"Status"}),(0,a.jsx)("th",{children:"Acoes"})]})}),(0,a.jsx)("tbody",{children:u.invoices.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.reference_month}),(0,a.jsxs)("td",{children:["R$ ",parseFloat(e.amount).toFixed(2)]}),(0,a.jsx)("td",{children:new Date(e.due_date).toLocaleDateString("pt-BR")}),(0,a.jsx)("td",{children:f(e.status)}),(0,a.jsx)("td",{children:"pending"===e.status&&(0,a.jsx)("button",{className:"btn btn-small btn-success",onClick:()=>v("mark_invoice_paid",u.account.id,{invoice_id:e.id}),children:"Pago"})})]},e.id))})]})]}),u.recent_orders.length>0&&(0,a.jsxs)("div",{className:"detail-section",children:[(0,a.jsx)("h3",{children:"Pedidos Recentes"}),(0,a.jsxs)("table",{className:"data-table compact",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Pedido"}),(0,a.jsx)("th",{children:"Funcionario"}),(0,a.jsx)("th",{children:"Valor"}),(0,a.jsx)("th",{children:"Status"})]})}),(0,a.jsx)("tbody",{children:u.recent_orders.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{children:["#",e.order_id]}),(0,a.jsx)("td",{children:e.employee_name}),(0,a.jsxs)("td",{children:["R$ ",parseFloat(e.amount).toFixed(2)]}),(0,a.jsx)("td",{children:e.order_status})]},e.id))})]})]})]}):(0,a.jsx)("div",{className:"empty-state",children:(0,a.jsx)("p",{children:"Selecione uma conta para ver detalhes"})})})]})]})}function l(){return(0,a.jsx)(c.Z,{children:(0,a.jsx)(r,{})})}},9376:function(e,t,n){"use strict";var a=n(5475);n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}}),n.o(a,"useSearchParams")&&n.d(t,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=9504)}),_N_E=e.O()}]);