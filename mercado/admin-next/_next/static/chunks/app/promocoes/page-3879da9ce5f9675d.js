(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2219],{8392:function(e,a,s){Promise.resolve().then(s.bind(s,1222))},4445:function(e,a,s){"use strict";s.d(a,{Z:function(){return l}});var t=s(7437),n=s(8253);function l(e){let{section:a,children:s}=e,{hasPermission:l}=(0,n.q)();return l(a)?(0,t.jsx)(t.Fragment,{children:s}):(0,t.jsxs)("div",{className:"role-denied",children:[(0,t.jsx)("div",{className:"role-denied-icon",children:"\uD83D\uDD12"}),(0,t.jsx)("h2",{children:"Acesso Negado"}),(0,t.jsx)("p",{children:"Voce nao tem permissao para acessar esta secao."}),(0,t.jsx)("p",{className:"role-denied-hint",children:"Contate o administrador para solicitar acesso."})]})}},1656:function(e,a,s){"use strict";s.d(a,{X:function(){return r},Z:function(){return l}});var t=s(7437);let n={success:"badge-success",warning:"badge-warning",danger:"badge-danger",info:"badge-info",neutral:"badge-neutral"};function l(e){let{label:a,variant:s="neutral"}=e;return(0,t.jsx)("span",{className:"badge ".concat(n[s]||n.neutral),children:a})}function r(e){return({pendente:"warning",confirmado:"info",preparando:"info",pronto:"info",coletado:"info",em_entrega:"warning",entregue:"success",cancelado:"danger",recusado:"danger",ativo:"success",inativo:"neutral",bloqueado:"danger",online:"success",offline:"neutral",aprovado:"success",reprovado:"danger",pago:"success",pendente_pagamento:"warning",processando:"info",aberto:"warning",resolvido:"success",fechado:"neutral"})[e]||"neutral"}},9531:function(e,a,s){"use strict";s.d(a,{Z:function(){return o}});var t=s(7437),n=s(2265);function l(e){let{value:a,onChange:s,placeholder:l="Buscar...",delay:r=300}=e,[o,i]=(0,n.useState)(a||""),c=(0,n.useRef)(null);return(0,n.useEffect)(()=>{i(a||"")},[a]),(0,t.jsxs)("div",{className:"search-input-wrapper",children:[(0,t.jsx)("span",{className:"search-input-icon",children:"\uD83D\uDD0D"}),(0,t.jsx)("input",{type:"text",className:"search-input",value:o,onChange:e=>{let a=e.target.value;i(a),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{null==s||s(a)},r)},placeholder:l}),o&&(0,t.jsx)("button",{className:"search-input-clear",onClick:()=>{i(""),null==s||s("")},children:"✕"})]})}function r(e){let{page:a,totalPages:s,onPageChange:n}=e,l=[],r=Math.max(1,a-Math.floor(2.5)),o=Math.min(s,r+5-1);o-r<4&&(r=Math.max(1,o-5+1));for(let e=r;e<=o;e++)l.push(e);return(0,t.jsxs)("div",{className:"pagination",children:[(0,t.jsx)("button",{className:"pagination-btn",disabled:a<=1,onClick:()=>n(a-1),children:"‹ Anterior"}),r>1&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{className:"pagination-btn",onClick:()=>n(1),children:"1"}),r>2&&(0,t.jsx)("span",{className:"pagination-dots",children:"..."})]}),l.map(e=>(0,t.jsx)("button",{className:"pagination-btn ".concat(e===a?"pagination-active":""),onClick:()=>n(e),children:e},e)),o<s&&(0,t.jsxs)(t.Fragment,{children:[o<s-1&&(0,t.jsx)("span",{className:"pagination-dots",children:"..."}),(0,t.jsx)("button",{className:"pagination-btn",onClick:()=>n(s),children:s})]}),(0,t.jsx)("button",{className:"pagination-btn",disabled:a>=s,onClick:()=>n(a+1),children:"Proximo ›"})]})}function o(e){let{columns:a=[],data:s=[],loading:o=!1,searchable:i=!0,pageSize:c=15,emptyMessage:d="Nenhum registro encontrado",onRowClick:u}=e,[m,h]=(0,n.useState)(""),[p,x]=(0,n.useState)(null),[g,j]=(0,n.useState)("asc"),[v,b]=(0,n.useState)(1),f=(0,n.useMemo)(()=>{if(!m)return s;let e=m.toLowerCase();return s.filter(s=>a.some(a=>{let t=s[a.key];return null!=t&&String(t).toLowerCase().includes(e)}))},[s,m,a]),N=(0,n.useMemo)(()=>p?[...f].sort((e,a)=>{var s,t;let n=null!==(s=e[p])&&void 0!==s?s:"",l=null!==(t=a[p])&&void 0!==t?t:"";if("number"==typeof n&&"number"==typeof l)return"asc"===g?n-l:l-n;let r=String(n).localeCompare(String(l));return"asc"===g?r:-r}):f,[f,p,g]),y=Math.max(1,Math.ceil(N.length/c)),k=N.slice((v-1)*c,v*c),C=e=>{p===e?j(e=>"asc"===e?"desc":"asc"):(x(e),j("asc"))};return o?(0,t.jsxs)("div",{className:"datatable",children:[i&&(0,t.jsx)("div",{className:"datatable-toolbar",children:(0,t.jsx)(l,{value:"",onChange:()=>{},placeholder:"Buscar..."})}),(0,t.jsx)("div",{className:"datatable-skeleton",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,t.jsx)("div",{className:"skeleton-row",children:a.map((e,a)=>(0,t.jsx)("div",{className:"skeleton-cell"},a))},s))})]}):(0,t.jsxs)("div",{className:"datatable",children:[i&&(0,t.jsxs)("div",{className:"datatable-toolbar",children:[(0,t.jsx)(l,{value:m,onChange:e=>{h(e),b(1)},placeholder:"Buscar na tabela..."}),(0,t.jsxs)("span",{className:"datatable-count",children:[f.length," registro(s)"]})]}),(0,t.jsx)("div",{className:"datatable-wrapper",children:(0,t.jsxs)("table",{className:"datatable-table",children:[(0,t.jsx)("thead",{children:(0,t.jsx)("tr",{children:a.map(e=>(0,t.jsxs)("th",{onClick:()=>!1!==e.sortable&&C(e.key),className:!1!==e.sortable?"sortable":"",style:e.width?{width:e.width}:void 0,children:[e.label,p===e.key&&(0,t.jsx)("span",{className:"sort-indicator",children:"asc"===g?" ▲":" ▼"})]},e.key))})}),(0,t.jsx)("tbody",{children:0===k.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:a.length,className:"datatable-empty",children:d})}):k.map((e,s)=>(0,t.jsx)("tr",{onClick:()=>null==u?void 0:u(e),className:u?"clickable-row":"",children:a.map(a=>{var s;return(0,t.jsx)("td",{children:a.render?a.render(e[a.key],e):null!==(s=e[a.key])&&void 0!==s?s:"-"},a.key)})},e.id||s))})]})}),y>1&&(0,t.jsx)(r,{page:v,totalPages:y,onPageChange:b})]})}},7714:function(e,a,s){"use strict";s.d(a,{Z:function(){return r}});var t=s(7437),n=s(2265);let l={sm:"400px",md:"560px",lg:"720px",xl:"960px"};function r(e){let{isOpen:a,onClose:s,title:r,children:o,size:i="md"}=e;return((0,n.useEffect)(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[a]),(0,n.useEffect)(()=>{let e=e=>{"Escape"===e.key&&a&&(null==s||s())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a,s]),a)?(0,t.jsx)("div",{className:"modal-overlay",onClick:s,children:(0,t.jsxs)("div",{className:"modal-container",style:{maxWidth:l[i]||l.md},onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h3",{className:"modal-title",children:r}),(0,t.jsx)("button",{className:"modal-close",onClick:s,children:"✕"})]}),(0,t.jsx)("div",{className:"modal-body",children:o})]})}):null}},6939:function(e,a,s){"use strict";s.d(a,{Z:function(){return r}});var t=s(7437),n=s(6971);let l={success:"&#10003;",error:"&#10007;",warning:"&#9888;",info:"&#8505;"};function r(){let{toasts:e,removeToast:a}=(0,n.l)();return 0===e.length?null:(0,t.jsx)("div",{className:"toast-container",children:e.map(e=>(0,t.jsxs)("div",{className:"toast toast-".concat(e.type),children:[(0,t.jsx)("span",{className:"toast-icon",dangerouslySetInnerHTML:{__html:l[e.type]||l.info}}),(0,t.jsx)("span",{className:"toast-message",children:e.message}),(0,t.jsx)("button",{className:"toast-close",onClick:()=>a(e.id),children:"✕"})]},e.id))})}},1222:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return g}});var t=s(7437),n=s(2265),l=s(8779),r=s(4477),o=s(4445),i=s(9531),c=s(1656),d=s(7714),u=s(6939),m=s(8789),h=s(6971),p=s(6428);function x(){let{collapsed:e}=(0,m.A)(),{success:a,error:s}=(0,h.l)(),[l,o]=(0,n.useState)([]),[x,g]=(0,n.useState)(!0),[j,v]=(0,n.useState)(!1),[b,f]=(0,n.useState)(!1),[N,y]=(0,n.useState)([]),[k,C]=(0,n.useState)({title:"",description:"",type:"banner",discount:"",start_date:"",end_date:"",target:"all",image_url:""});(0,n.useEffect)(()=>{w(),_()},[]);let _=async()=>{try{let e=await (0,p.SC)("/segments.php");y(e.segments||[])}catch(e){console.warn("Erro ao carregar segmentos:",e.message)}},w=async()=>{g(!0);try{let e=await (0,p.SC)("/promocoes.php");o(e.promotions||e.promocoes||e.data||[])}catch(e){s("Erro ao carregar promocoes")}finally{g(!1)}},S=()=>{C({title:"",description:"",type:"banner",discount:"",start_date:"",end_date:"",target:"all",image_url:""})},D=async()=>{if(!k.title.trim()){s("Informe o titulo da promocao");return}f(!0);try{await (0,p.sg)("/promocoes.php",{title:k.title,description:k.description,type:k.type,discount:k.discount?Number(k.discount):null,start_date:k.start_date||null,end_date:k.end_date||null,target:k.target,image_url:k.image_url||null}),a("Promocao criada com sucesso"),v(!1),S(),w()}catch(e){s("Erro: "+e.message)}finally{f(!1)}},E=async e=>{try{await (0,p.sg)("/promocoes.php",{promotion_id:e.id||e.promotion_id,action:"toggle"}),a("Status atualizado"),w()}catch(e){s("Erro: "+e.message)}},P=async e=>{if(confirm("Deseja excluir esta promocao?"))try{await (0,p.QW)("/promocoes.php?id=".concat(e.id||e.promotion_id)),a("Promocao excluida"),w()}catch(e){s("Erro: "+e.message)}},Z={banner:"Banner",flash:"Flash Sale",combo:"Combo",frete_gratis:"Frete Gratis",cashback:"Cashback"};return(0,t.jsxs)("div",{className:"admin-layout",children:[(0,t.jsx)(r.Z,{}),(0,t.jsxs)("main",{className:"admin-main ".concat(e?"main-collapsed":""),children:[(0,t.jsxs)("div",{className:"page-header",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"page-title",children:"Promocoes"}),(0,t.jsx)("p",{className:"page-subtitle",children:"Gerenciar campanhas promocionais"})]}),(0,t.jsxs)("div",{className:"page-actions",children:[(0,t.jsx)("button",{className:"btn btn-secondary",onClick:w,children:"Atualizar"}),(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>{S(),v(!0)},children:"Nova Promocao"})]})]}),(0,t.jsx)(i.Z,{columns:[{key:"id",label:"ID",render:(e,a)=>(0,t.jsxs)("strong",{children:["#",e||a.promotion_id]})},{key:"title",label:"Titulo",render:(e,a)=>e||a.titulo||"-"},{key:"type",label:"Tipo",render:(e,a)=>(0,t.jsx)(c.Z,{label:Z[e||a.tipo]||e||a.tipo||"banner",variant:"info"})},{key:"discount",label:"Desconto",render:(e,a)=>e||a.desconto?"".concat(e||a.desconto,"%"):"-"},{key:"target",label:"Alvo",render:(e,a)=>(0,t.jsx)(c.Z,{label:"all"===e||"todos"===a.alvo?"Todos":e||a.alvo||"Todos",variant:"neutral"})},{key:"start_date",label:"Inicio",render:(e,a)=>e||a.data_inicio||"-"},{key:"end_date",label:"Fim",render:(e,a)=>e||a.data_fim||"-"},{key:"active",label:"Status",render:(e,a)=>(0,t.jsx)(c.Z,{label:e||a.ativo?"Ativa":"Inativa",variant:e||a.ativo?"success":"neutral"})},{key:"actions",label:"Acoes",sortable:!1,render:(e,a)=>(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:e=>{e.stopPropagation(),E(a)},children:a.active||a.ativo?"Desativar":"Ativar"}),(0,t.jsx)("button",{className:"btn btn-sm btn-danger",onClick:e=>{e.stopPropagation(),P(a)},children:"Excluir"})]})}],data:l,loading:x,emptyMessage:"Nenhuma promocao cadastrada"}),(0,t.jsxs)(d.Z,{isOpen:j,onClose:()=>v(!1),title:"Criar Promocao",size:"lg",children:[(0,t.jsxs)("div",{className:"grid-2 gap-4",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Titulo"}),(0,t.jsx)("input",{className:"form-input",value:k.title,onChange:e=>C({...k,title:e.target.value}),placeholder:"Titulo da promocao"})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Tipo"}),(0,t.jsxs)("select",{className:"form-select",value:k.type,onChange:e=>C({...k,type:e.target.value}),children:[(0,t.jsx)("option",{value:"banner",children:"Banner"}),(0,t.jsx)("option",{value:"flash",children:"Flash Sale"}),(0,t.jsx)("option",{value:"combo",children:"Combo"}),(0,t.jsx)("option",{value:"frete_gratis",children:"Frete Gratis"}),(0,t.jsx)("option",{value:"cashback",children:"Cashback"})]})]})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Descricao"}),(0,t.jsx)("textarea",{className:"form-textarea",value:k.description,onChange:e=>C({...k,description:e.target.value}),placeholder:"Descricao da campanha...",rows:3})]}),(0,t.jsxs)("div",{className:"grid-2 gap-4",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Desconto (%)"}),(0,t.jsx)("input",{className:"form-input",type:"number",value:k.discount,onChange:e=>C({...k,discount:e.target.value}),placeholder:"Ex: 15"})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Segmento Alvo"}),(0,t.jsxs)("select",{className:"form-select",value:k.target,onChange:e=>C({...k,target:e.target.value}),children:[(0,t.jsx)("option",{value:"all",children:"Todos os Clientes"}),N.length>0?N.map(e=>(0,t.jsxs)("option",{value:e.key,children:[e.label," (",e.count," clientes)"]},e.key)):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("option",{value:"new_users",children:"Novos Usuarios"}),(0,t.jsx)("option",{value:"first_order",children:"Primeiro Pedido"}),(0,t.jsx)("option",{value:"regular",children:"Regulares"}),(0,t.jsx)("option",{value:"inactive",children:"Inativos"}),(0,t.jsx)("option",{value:"vip",children:"VIP"}),(0,t.jsx)("option",{value:"at_risk",children:"Em Risco"})]})]}),N.length>0&&"all"!==k.target&&(()=>{let e=N.find(e=>e.key===k.target);return e?(0,t.jsxs)("div",{style:{fontSize:12,color:"#6b7280",marginTop:4},children:[e.description," - ",e.count," clientes"]}):null})()]})]}),(0,t.jsxs)("div",{className:"grid-2 gap-4",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Data Inicio"}),(0,t.jsx)("input",{className:"form-input",type:"date",value:k.start_date,onChange:e=>C({...k,start_date:e.target.value})})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Data Fim"}),(0,t.jsx)("input",{className:"form-input",type:"date",value:k.end_date,onChange:e=>C({...k,end_date:e.target.value})})]})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"URL da Imagem"}),(0,t.jsx)("input",{className:"form-input",value:k.image_url,onChange:e=>C({...k,image_url:e.target.value}),placeholder:"https://..."})]}),(0,t.jsxs)("div",{className:"flex gap-2",style:{justifyContent:"flex-end"},children:[(0,t.jsx)("button",{className:"btn btn-secondary",onClick:()=>v(!1),children:"Cancelar"}),(0,t.jsx)("button",{className:"btn btn-primary",onClick:D,disabled:b,children:b?"Criando...":"Criar Promocao"})]})]})]}),(0,t.jsx)(u.Z,{})]})}function g(){return(0,t.jsx)(l.Z,{children:(0,t.jsx)(o.Z,{section:"promotions",children:(0,t.jsx)(x,{})})})}}},function(e){e.O(0,[3448,1006,2971,2117,1744],function(){return e(e.s=8392)}),_N_E=e.O()}]);