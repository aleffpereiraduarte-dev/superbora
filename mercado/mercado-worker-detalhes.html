<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lise de Cadastro - OneMundo RH</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #f1f5f9;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            padding: 20px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .header a {
            color: #fff;
            text-decoration: none;
            font-size: 1.2rem;
        }
        
        .header h1 {
            font-size: 1.2rem;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .worker-header {
            background: #fff;
            border-radius: 20px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .worker-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
        }
        
        .worker-avatar.shopper { background: rgba(16, 185, 129, 0.15); }
        .worker-avatar.driver { background: rgba(249, 115, 22, 0.15); }
        .worker-avatar.fullservice { background: rgba(139, 92, 246, 0.15); }
        
        .worker-info h2 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .worker-info .type {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .worker-info .type.shopper { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .worker-info .type.driver { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .worker-info .type.fullservice { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; }
        
        .worker-actions {
            margin-left: auto;
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s;
        }
        
        .btn-aprovar {
            background: #10b981;
            color: #fff;
        }
        
        .btn-rejeitar {
            background: #ef4444;
            color: #fff;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        .card {
            background: #fff;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .card h3 {
            font-size: 1.1rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-row .label {
            color: #64748b;
            font-size: 0.9rem;
        }
        
        .info-row .value {
            font-weight: 500;
        }
        
        .docs-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .doc-item {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .doc-item:hover {
            border-color: #6366f1;
        }
        
        .doc-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            cursor: pointer;
        }
        
        .doc-item .doc-info {
            padding: 12px;
            background: #f8fafc;
        }
        
        .doc-item .doc-name {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .doc-item .doc-status {
            font-size: 0.8rem;
            margin-top: 5px;
        }
        
        .doc-item .doc-status.pendente { color: #f59e0b; }
        .doc-item .doc-status.aprovado { color: #10b981; }
        .doc-item .doc-status.rejeitado { color: #ef4444; }
        
        .vehicle-info {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
        }
        
        .vehicle-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .timeline {
            position: relative;
            padding-left: 25px;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 5px;
            bottom: 5px;
            width: 2px;
            background: #e2e8f0;
        }
        
        .timeline-item {
            position: relative;
            padding-bottom: 15px;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -21px;
            top: 5px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #6366f1;
        }
        
        .timeline-item .time {
            font-size: 0.8rem;
            color: #64748b;
        }
        
        .timeline-item .event {
            font-weight: 500;
        }
        
        .fullwidth {
            grid-column: span 2;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
        }
        
        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #fff;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
            .fullwidth { grid-column: span 1; }
            .worker-header { flex-direction: column; text-align: center; }
            .worker-actions { margin-left: 0; margin-top: 15px; }
        }
    </style>
</head>
<body>
    <header class="header">
        <a href="dashboard.html">‚Üê</a>
        <h1>An√°lise de Cadastro - MEI Mercado</h1>
    </header>
    
    <div class="container">
        <div id="workerContent">
            <p style="text-align: center; padding: 50px; color: #64748b;">Carregando...</p>
        </div>
    </div>
    
    <!-- Modal para visualizar documentos -->
    <div class="modal" id="docModal" onclick="closeModal()">
        <button class="modal-close" onclick="closeModal()">√ó</button>
        <img id="modalImg" src="" alt="Documento">
    </div>
    
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const workerId = urlParams.get('id');
        
        const tipoConfig = {
            'shopper': { icon: 'üõí', label: 'Shopper', cor: '#10b981' },
            'driver': { icon: 'üö¥', label: 'Entregador', cor: '#f97316' },
            'fullservice': { icon: '‚≠ê', label: 'Full Service', cor: '#8b5cf6' }
        };
        
        const docLabels = {
            'rg_frente': 'RG/CNH (Frente)',
            'rg_verso': 'RG/CNH (Verso)',
            'selfie': 'Selfie com Documento',
            'comprovante_residencia': 'Comprovante de Resid√™ncia',
            'crlv': 'CRLV do Ve√≠culo'
        };
        
        const vehicleIcons = {
            'bike': 'üö≤',
            'moto': 'üèçÔ∏è',
            'carro': 'üöó',
            'van': 'üöê'
        };
        
        async function loadWorker() {
            try {
                // Buscar dados do worker
                const response = await fetch(`/rh/api/worker-details.php?id=${workerId}`);
                const data = await response.json();
                
                if (!data.success) {
                    document.getElementById('workerContent').innerHTML = '<p style="text-align: center; color: #ef4444;">Worker n√£o encontrado</p>';
                    return;
                }
                
                const worker = data.worker;
                const docs = data.documents || [];
                const vehicle = data.vehicle;
                const tipo = tipoConfig[worker.worker_type] || tipoConfig.shopper;
                
                let html = `
                    <div class="worker-header">
                        <div class="worker-avatar ${worker.worker_type}">${tipo.icon}</div>
                        <div class="worker-info">
                            <h2>${worker.name}</h2>
                            <span class="type ${worker.worker_type}">${tipo.label}</span>
                        </div>
                        <div class="worker-actions">
                            <button class="btn btn-aprovar" onclick="aprovar()">‚úì Aprovar</button>
                            <button class="btn btn-rejeitar" onclick="rejeitar()">‚úó Rejeitar</button>
                        </div>
                    </div>
                    
                    <div class="grid">
                        <div class="card">
                            <h3>üë§ Dados Pessoais</h3>
                            <div class="info-row"><span class="label">Nome</span><span class="value">${worker.name}</span></div>
                            <div class="info-row"><span class="label">E-mail</span><span class="value">${worker.email}</span></div>
                            <div class="info-row"><span class="label">Telefone</span><span class="value">${worker.phone}</span></div>
                            <div class="info-row"><span class="label">CPF</span><span class="value">${formatCPF(worker.cpf)}</span></div>
                            <div class="info-row"><span class="label">Nascimento</span><span class="value">${formatDate(worker.birth_date)}</span></div>
                            <div class="info-row"><span class="label">MEI</span><span class="value">${worker.is_mei ? '‚úÖ Sim' : '‚ùå N√£o'}</span></div>
                        </div>
                        
                        <div class="card">
                            <h3>üìç Endere√ßo</h3>
                            <div class="info-row"><span class="label">CEP</span><span class="value">${formatCEP(worker.cep)}</span></div>
                            <div class="info-row"><span class="label">Endere√ßo</span><span class="value">${worker.address}</span></div>
                        </div>
                `;
                
                // Ve√≠culo (se tiver)
                if (vehicle) {
                    html += `
                        <div class="card">
                            <h3>üöó Ve√≠culo</h3>
                            <div class="vehicle-info">
                                <div class="vehicle-icon">${vehicleIcons[vehicle.vehicle_type] || 'üöó'}</div>
                                <div class="info-row"><span class="label">Tipo</span><span class="value">${vehicle.vehicle_type}</span></div>
                                ${vehicle.plate ? `<div class="info-row"><span class="label">Placa</span><span class="value">${vehicle.plate}</span></div>` : ''}
                                ${vehicle.model ? `<div class="info-row"><span class="label">Modelo</span><span class="value">${vehicle.model}</span></div>` : ''}
                            </div>
                        </div>
                    `;
                }
                
                // Timeline
                html += `
                    <div class="card">
                        <h3>üìÖ Hist√≥rico</h3>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="time">${formatDateTime(worker.created_at)}</div>
                                <div class="event">Cadastro realizado</div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Documentos
                html += `
                    <div class="card fullwidth">
                        <h3>üìÑ Documentos</h3>
                        <div class="docs-grid">
                `;
                
                docs.forEach(doc => {
                    html += `
                        <div class="doc-item">
                            <img src="${doc.file_url}" alt="${docLabels[doc.doc_type]}" onclick="openModal('${doc.file_url}')">
                            <div class="doc-info">
                                <div class="doc-name">${docLabels[doc.doc_type] || doc.doc_type}</div>
                                <div class="doc-status ${doc.status}">${doc.status.toUpperCase()}</div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div></div></div>';
                
                document.getElementById('workerContent').innerHTML = html;
                
            } catch (error) {
                console.error(error);
                document.getElementById('workerContent').innerHTML = '<p style="text-align: center; color: #ef4444;">Erro ao carregar dados</p>';
            }
        }
        
        function formatCPF(cpf) {
            if (!cpf) return '';
            return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
        }
        
        function formatCEP(cep) {
            if (!cep) return '';
            return cep.replace(/(\d{5})(\d{3})/, '$1-$2');
        }
        
        function formatDate(date) {
            if (!date) return '';
            return new Date(date).toLocaleDateString('pt-BR');
        }
        
        function formatDateTime(date) {
            if (!date) return '';
            return new Date(date).toLocaleString('pt-BR');
        }
        
        function openModal(src) {
            document.getElementById('modalImg').src = src;
            document.getElementById('docModal').classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('docModal').classList.remove('active');
        }
        
        async function aprovar() {
            if (!confirm('Aprovar este cadastro?')) return;
            
            const response = await fetch('/rh/api/worker-approval.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ worker_id: workerId, action: 'approve' })
            });
            
            const data = await response.json();
            if (data.success) {
                alert('Worker aprovado com sucesso!');
                window.location.href = 'dashboard.html';
            } else {
                alert('Erro: ' + data.message);
            }
        }
        
        async function rejeitar() {
            const motivo = prompt('Motivo da rejei√ß√£o:');
            if (!motivo) return;
            
            const response = await fetch('/rh/api/worker-approval.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ worker_id: workerId, action: 'reject', reason: motivo })
            });
            
            const data = await response.json();
            if (data.success) {
                alert('Worker rejeitado.');
                window.location.href = 'dashboard.html';
            } else {
                alert('Erro: ' + data.message);
            }
        }
        
        // Carregar ao iniciar
        loadWorker();
    </script>
</body>
</html>
