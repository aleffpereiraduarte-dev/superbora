(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[367],{7686:function(e,t,n){Promise.resolve().then(n.bind(n,8763))},6428:function(e,t,n){"use strict";n.d(t,{B9:function(){return d},LP:function(){return s},SC:function(){return o},o4:function(){return l},pE:function(){return u},sg:function(){return c}});let a="/api/mercado/shopper",r="shopper_token";function s(){try{return localStorage.getItem(r)}catch(e){return null}}function l(e){try{e?localStorage.setItem(r,e):localStorage.removeItem(r)}catch(e){}}function i(){let e=s();return e?{Authorization:"Bearer ".concat(e)}:{}}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),r=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");r&&(n+="?".concat(r));let s=await fetch(n,{credentials:"include",headers:i()});if(!s.ok){let e=await s.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(s.status," ").concat(s.statusText))}let l=await s.json();if(!l.success)throw Error(l.message||"Erro desconhecido na API");return l.data}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...i()},body:JSON.stringify(t)}),r=await n.json().catch(()=>null);if(!n.ok||!(null==r?void 0:r.success))throw Error((null==r?void 0:r.message)||"API error: ".concat(n.status));return r.data}async function d(e,t){let n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:i(),body:t}),r=await n.json().catch(()=>null);if(!n.ok||!(null==r?void 0:r.success))throw Error((null==r?void 0:r.message)||"API error: ".concat(n.status));return r.data}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...i()},body:JSON.stringify(t)}),r=await n.json().catch(()=>null);if(!n.ok||!(null==r?void 0:r.success))throw Error((null==r?void 0:r.message)||"API error: ".concat(n.status));return r.data}},8779:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var a=n(7437),r=n(2265),s=n(9376),l=n(7128);function i(e){let{children:t}=e,{isAuthenticated:n,loading:i}=(0,l.a)(),o=(0,s.useRouter)();return((0,r.useEffect)(()=>{if(!i&&!n){let e=window.location.pathname;o.push("/login?return=".concat(encodeURIComponent(e)))}},[i,n,o]),i)?(0,a.jsxs)("div",{className:"loading-screen",children:[(0,a.jsx)("div",{className:"spinner"}),(0,a.jsx)("p",{className:"loading-text",children:"Carregando..."})]}):n?t:null}},2277:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var a=n(7437),r=n(9376),s=n(7648),l=n(6971);let i=[{href:"/",label:"Home",icon:(0,a.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),(0,a.jsx)("polyline",{points:"9 22 9 12 15 12 15 22"})]})},{href:"/pedidos",label:"Pedidos",icon:(0,a.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,a.jsx)("polyline",{points:"14 2 14 8 20 8"}),(0,a.jsx)("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),(0,a.jsx)("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]})},{href:"/ganhos",label:"Ganhos",icon:(0,a.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),(0,a.jsx)("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]})},{href:"/chat",label:"Chat",icon:(0,a.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,a.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})},{href:"/perfil",label:"Perfil",icon:(0,a.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),(0,a.jsx)("circle",{cx:"12",cy:"7",r:"4"})]})}];function o(){let e=(0,r.usePathname)(),{unreadCount:t}=(0,l.l)();return(0,a.jsx)("nav",{className:"bottom-nav",children:i.map(n=>{var r;return(0,a.jsxs)(s.default,{href:n.href,className:"bottom-nav-item ".concat(("/"===(r=n.href)?"/"===e||""===e:e.startsWith(r))?"active":""),children:[(0,a.jsxs)("span",{className:"bottom-nav-icon",children:[n.icon,"/"===n.href&&t>0&&(0,a.jsx)("span",{className:"bottom-nav-badge",children:t>99?"99+":t})]}),(0,a.jsx)("span",{className:"bottom-nav-label",children:n.label})]},n.href)})})}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return i},a:function(){return o}});var a=n(7437),r=n(2265),s=n(6428);let l=(0,r.createContext)(null);function i(e){let{children:t}=e,[n,i]=(0,r.useState)(null),[o,c]=(0,r.useState)(!0),d=(0,r.useCallback)(async()=>{if(!(0,s.LP)()){i(null),c(!1);return}try{let e=await (0,s.SC)("/auth/session.php");e.authenticated&&e.shopper?i(e.shopper):((0,s.o4)(null),i(null))}catch(e){(0,s.o4)(null),i(null)}finally{c(!1)}},[]);(0,r.useEffect)(()=>{d()},[d]);let u=(0,r.useCallback)(async(e,t)=>{let n=await (0,s.sg)("/auth/login.php",{email:e,senha:t});(0,s.o4)(n.token);let a=n.shopper||{id:n.shopper_id,nome:n.nome,email:n.email,telefone:n.telefone,foto:n.foto,saldo:n.saldo,status:n.status};return i(a),a},[]),h=(0,r.useCallback)(()=>{(0,s.o4)(null),i(null)},[]);return(0,a.jsx)(l.Provider,{value:{shopper:n,loading:o,isAuthenticated:!!n,login:u,logout:h,refreshSession:d},children:t})}function o(){let e=(0,r.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},6971:function(e,t,n){"use strict";n.d(t,{J:function(){return c},l:function(){return d}});var a=n(7437),r=n(2265),s=n(7128),l=n(6428);let i=(0,r.createContext)(null),o=0;function c(e){let{children:t}=e,[n,c]=(0,r.useState)([]),[d,u]=(0,r.useState)(0),h=(0,r.useRef)(0),f=(0,r.useRef)({}),{isAuthenticated:v}=(0,s.a)(),x=(0,r.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3,a=++o;return c(n=>[...n,{id:a,message:e,type:t}]),n>0&&(f.current[a]=setTimeout(()=>{c(e=>e.filter(e=>e.id!==a)),delete f.current[a]},n)),a},[]),p=(0,r.useCallback)(e=>{c(t=>t.filter(t=>t.id!==e)),f.current[e]&&(clearTimeout(f.current[e]),delete f.current[e])},[]),m=(0,r.useCallback)(e=>x(e,"success"),[x]),g=(0,r.useCallback)(e=>x(e,"error"),[x]),j=(0,r.useCallback)(e=>x(e,"warning"),[x]),y=(0,r.useCallback)(e=>x(e,"info"),[x]);return(0,r.useEffect)(()=>{if(!v){u(0),h.current=0;return}let e=!1;async function t(){try{var t,n;let a=(0,l.LP)();if(!a)return;let r=await fetch("/api/mercado/notifications/list.php?unread=1",{credentials:"include",headers:{Authorization:"Bearer ".concat(a)}});if(!r.ok)return;let s=await r.json();if(!s.success)return;let i=null!==(n=null===(t=s.data)||void 0===t?void 0:t.unread_count)&&void 0!==n?n:0;e||(u(i),i>h.current&&x("Nova notificacao","info"),h.current=i)}catch(e){}}t();let n=setInterval(t,3e4);return()=>{e=!0,clearInterval(n)}},[v,x]),(0,r.useEffect)(()=>()=>{Object.values(f.current).forEach(e=>clearTimeout(e))},[]),(0,a.jsxs)(i.Provider,{value:{notifications:n,addNotification:x,removeNotification:p,success:m,error:g,warning:j,info:y,unreadCount:d},children:[t,n.length>0&&(0,a.jsx)("div",{className:"toast-container",children:n.map(e=>(0,a.jsxs)("div",{className:"toast toast-".concat(e.type),onClick:()=>p(e.id),children:[(0,a.jsxs)("span",{className:"toast-icon",children:["success"===e.type&&"✓","error"===e.type&&"✗","warning"===e.type&&"⚠","info"===e.type&&"ℹ"]}),(0,a.jsx)("span",{className:"toast-message",children:e.message})]},e.id))})]})}function d(){let e=(0,r.useContext)(i);if(!e)throw Error("useNotification must be used within NotificationProvider");return e}},8763:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var a=n(7437),r=n(2265),s=n(6428),l=n(8779),i=n(2277);function o(){var e,t,n,l,i,o,c,d,u,h,f,v,x,p,m,g;let[j,y]=(0,r.useState)(null),[k,w]=(0,r.useState)(!0);function b(e,t,n){let r=2*Math.PI*40;return(0,a.jsxs)("div",{className:"stat-card",style:{padding:16},children:[(0,a.jsxs)("div",{className:"progress-ring-wrapper",style:{width:96,height:96,margin:"0 auto 8px"},children:[(0,a.jsxs)("svg",{className:"progress-ring",width:"96",height:"96",children:[(0,a.jsx)("circle",{className:"progress-ring-bg",cx:"48",cy:"48",r:40}),(0,a.jsx)("circle",{className:"progress-ring-fill",cx:"48",cy:"48",r:40,style:{stroke:n,strokeDasharray:r,strokeDashoffset:r-e/100*r}})]}),(0,a.jsxs)("span",{className:"progress-ring-text",children:[e,"%"]})]}),(0,a.jsx)("div",{className:"stat-label",style:{fontSize:12},children:t})]})}if((0,r.useEffect)(()=>{!async function(){try{let e=await (0,s.SC)("/performance.php");y(e)}catch(e){console.error("Load performance error:",e)}finally{w(!1)}}()},[]),k)return(0,a.jsxs)("div",{className:"page",children:[(0,a.jsx)("div",{className:"page-header",children:(0,a.jsx)("h1",{children:"Performance"})}),(0,a.jsxs)("div",{className:"stats-grid",style:{marginBottom:16},children:[(0,a.jsx)("div",{className:"skeleton",style:{height:140}}),(0,a.jsx)("div",{className:"skeleton",style:{height:140}}),(0,a.jsx)("div",{className:"skeleton",style:{height:140}})]}),(0,a.jsx)("div",{className:"skeleton-card"}),(0,a.jsx)("div",{className:"skeleton-card"})]});let N=null!==(t=null!==(e=null==j?void 0:j.taxa_aceitacao)&&void 0!==e?e:null==j?void 0:j.acceptance_rate)&&void 0!==t?t:0,C=null!==(l=null!==(n=null==j?void 0:j.taxa_conclusao)&&void 0!==n?n:null==j?void 0:j.completion_rate)&&void 0!==l?l:0,S=null!==(o=null!==(i=null==j?void 0:j.tempo_medio)&&void 0!==i?i:null==j?void 0:j.avg_delivery_time)&&void 0!==o?o:0,P=null!==(d=null!==(c=null==j?void 0:j.avaliacao_media)&&void 0!==c?c:null==j?void 0:j.rating_avg)&&void 0!==d?d:0,z=null!==(h=null!==(u=null==j?void 0:j.rating_breakdown)&&void 0!==u?u:null==j?void 0:j.avaliacao_breakdown)&&void 0!==h?h:{5:0,4:0,3:0,2:0,1:0},_=Object.values(z).reduce((e,t)=>e+t,0),I=Math.max(...Object.values(z),1),E=null!==(v=null!==(f=null==j?void 0:j.ranking)&&void 0!==f?f:null==j?void 0:j.posicao)&&void 0!==v?v:null,A=null!==(p=null!==(x=null==j?void 0:j.total_shoppers)&&void 0!==x?x:null==j?void 0:j.total)&&void 0!==p?p:null,B=null!==(g=null!==(m=null==j?void 0:j.dicas)&&void 0!==m?m:null==j?void 0:j.tips)&&void 0!==g?g:["Mantenha uma taxa de aceitacao acima de 85% para receber mais pedidos.","Responda rapido no chat para melhorar sua avaliacao.","Confira todos os itens antes de sair do mercado.","Entregue com um sorriso - faz diferenca na gorjeta!"];return(0,a.jsxs)("div",{className:"page",children:[(0,a.jsx)("div",{className:"page-header",children:(0,a.jsx)("h1",{children:"Performance"})}),(0,a.jsxs)("div",{className:"stats-grid",style:{marginBottom:16},children:[b(Math.round(N),"Taxa Aceitacao",N>=85?"var(--color-primary)":"var(--color-warning)"),b(Math.round(C),"Taxa Conclusao",C>=90?"var(--color-primary)":"var(--color-warning)"),(0,a.jsxs)("div",{className:"stat-card",style:{padding:16,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,a.jsx)("div",{style:{fontSize:28,fontWeight:700,color:"var(--color-text)",marginBottom:4},children:S}),(0,a.jsx)("div",{style:{fontSize:13,color:"var(--color-text-secondary)"},children:"min"}),(0,a.jsx)("div",{className:"stat-label",style:{fontSize:12,marginTop:4},children:"Tempo Medio"})]})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"card-header",children:[(0,a.jsx)("span",{className:"card-title",children:"Avaliacoes"}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},children:[(0,a.jsx)("span",{className:"star filled",style:{fontSize:16},children:"★"}),(0,a.jsx)("span",{style:{fontSize:16,fontWeight:700},children:P.toFixed(1)}),(0,a.jsxs)("span",{style:{fontSize:12,color:"var(--color-text-secondary)"},children:["(",_,")"]})]})]}),(0,a.jsx)("div",{style:{padding:"4px 0"},children:[5,4,3,2,1].map(e=>(function(e,t,n){let r=n>0?t/n*100:0;return(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[(0,a.jsx)("span",{style:{fontSize:13,fontWeight:500,width:20,textAlign:"right"},children:e}),(0,a.jsx)("span",{className:"star filled",style:{fontSize:14},children:"★"}),(0,a.jsx)("div",{style:{flex:1,height:8,background:"var(--color-border)",borderRadius:4,overflow:"hidden"},children:(0,a.jsx)("div",{style:{height:"100%",width:"".concat(r,"%"),background:e>=4?"var(--color-primary)":3===e?"var(--color-warning)":"var(--color-danger)",borderRadius:4,transition:"width 0.5s ease"}})}),(0,a.jsx)("span",{style:{fontSize:12,color:"var(--color-text-secondary)",width:30,textAlign:"right"},children:t})]},e)})(e,z[e]||0,I))})]}),null!==E&&(0,a.jsxs)("div",{className:"card",style:{textAlign:"center"},children:[(0,a.jsx)("div",{style:{fontSize:13,color:"var(--color-text-secondary)",marginBottom:8},children:"Seu Ranking"}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"center",gap:4},children:[(0,a.jsxs)("span",{style:{fontSize:36,fontWeight:700,color:"var(--color-primary-dark)"},children:["#",E]}),A&&(0,a.jsxs)("span",{style:{fontSize:14,color:"var(--color-text-secondary)"},children:["de ",A," shoppers"]})]}),E<=10&&(0,a.jsx)("div",{className:"badge badge-success",style:{margin:"8px auto 0",display:"inline-flex"},children:"Top 10"})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"card-title",style:{marginBottom:12},children:"Dicas para Melhorar"}),(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:(Array.isArray(B)?B:[]).map((e,t)=>(0,a.jsxs)("div",{style:{display:"flex",gap:10,alignItems:"flex-start"},children:[(0,a.jsx)("div",{style:{width:24,height:24,borderRadius:"50%",background:"rgba(0, 230, 118, 0.12)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,fontSize:12,fontWeight:700,color:"var(--color-primary-dark)"},children:t+1}),(0,a.jsx)("span",{style:{fontSize:13,color:"var(--color-text-secondary)",lineHeight:1.5},children:"string"==typeof e?e:e.text||e.dica})]},t))})]})]})}function c(){return(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(o,{}),(0,a.jsx)(i.Z,{})]})}}},function(e){e.O(0,[448,971,117,744],function(){return e(e.s=7686)}),_N_E=e.O()}]);