(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[451],{2447:function(e,t,r){Promise.resolve().then(r.bind(r,9988))},6428:function(e,t,r){"use strict";r.d(t,{B9:function(){return d},LP:function(){return o},SC:function(){return l},o4:function(){return s},pE:function(){return u},sg:function(){return c}});let n="/api/mercado/shopper",a="shopper_token";function o(){try{return localStorage.getItem(a)}catch(e){return null}}function s(e){try{e?localStorage.setItem(a,e):localStorage.removeItem(a)}catch(e){}}function i(){let e=o();return e?{Authorization:"Bearer ".concat(e)}:{}}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="".concat(n).concat(e),a=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,r]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(r))}).join("&");a&&(r+="?".concat(a));let o=await fetch(r,{credentials:"include",headers:i()});if(!o.ok){let e=await o.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(o.status," ").concat(o.statusText))}let s=await o.json();if(!s.success)throw Error(s.message||"Erro desconhecido na API");return s.data}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=await fetch("".concat(n).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...i()},body:JSON.stringify(t)}),a=await r.json().catch(()=>null);if(!r.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(r.status));return a.data}async function d(e,t){let r=await fetch("".concat(n).concat(e),{method:"POST",credentials:"include",headers:i(),body:t}),a=await r.json().catch(()=>null);if(!r.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(r.status));return a.data}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=await fetch("".concat(n).concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...i()},body:JSON.stringify(t)}),a=await r.json().catch(()=>null);if(!r.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(r.status));return a.data}},8779:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(7437),a=r(2265),o=r(9376),s=r(7128);function i(e){let{children:t}=e,{isAuthenticated:r,loading:i}=(0,s.a)(),l=(0,o.useRouter)();return((0,a.useEffect)(()=>{if(!i&&!r){let e=window.location.pathname;l.push("/login?return=".concat(encodeURIComponent(e)))}},[i,r,l]),i)?(0,n.jsxs)("div",{className:"loading-screen",children:[(0,n.jsx)("div",{className:"spinner"}),(0,n.jsx)("p",{className:"loading-text",children:"Carregando..."})]}):r?t:null}},2277:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var n=r(7437),a=r(9376),o=r(7648),s=r(6971);let i=[{href:"/",label:"Home",icon:(0,n.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),(0,n.jsx)("polyline",{points:"9 22 9 12 15 12 15 22"})]})},{href:"/pedidos",label:"Pedidos",icon:(0,n.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,n.jsx)("polyline",{points:"14 2 14 8 20 8"}),(0,n.jsx)("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),(0,n.jsx)("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]})},{href:"/ganhos",label:"Ganhos",icon:(0,n.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),(0,n.jsx)("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]})},{href:"/chat",label:"Chat",icon:(0,n.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,n.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})},{href:"/perfil",label:"Perfil",icon:(0,n.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),(0,n.jsx)("circle",{cx:"12",cy:"7",r:"4"})]})}];function l(){let e=(0,a.usePathname)(),{unreadCount:t}=(0,s.l)();return(0,n.jsx)("nav",{className:"bottom-nav",children:i.map(r=>{var a;return(0,n.jsxs)(o.default,{href:r.href,className:"bottom-nav-item ".concat(("/"===(a=r.href)?"/"===e||""===e:e.startsWith(a))?"active":""),children:[(0,n.jsxs)("span",{className:"bottom-nav-icon",children:[r.icon,"/"===r.href&&t>0&&(0,n.jsx)("span",{className:"bottom-nav-badge",children:t>99?"99+":t})]}),(0,n.jsx)("span",{className:"bottom-nav-label",children:r.label})]},r.href)})})}},7128:function(e,t,r){"use strict";r.d(t,{H:function(){return i},a:function(){return l}});var n=r(7437),a=r(2265),o=r(6428);let s=(0,a.createContext)(null);function i(e){let{children:t}=e,[r,i]=(0,a.useState)(null),[l,c]=(0,a.useState)(!0),d=(0,a.useCallback)(async()=>{if(!(0,o.LP)()){i(null),c(!1);return}try{let e=await (0,o.SC)("/auth/session.php");e.authenticated&&e.shopper?i(e.shopper):((0,o.o4)(null),i(null))}catch(e){(0,o.o4)(null),i(null)}finally{c(!1)}},[]);(0,a.useEffect)(()=>{d()},[d]);let u=(0,a.useCallback)(async(e,t)=>{let r=await (0,o.sg)("/auth/login.php",{email:e,senha:t});(0,o.o4)(r.token);let n=r.shopper||{id:r.shopper_id,nome:r.nome,email:r.email,telefone:r.telefone,foto:r.foto,saldo:r.saldo,status:r.status};return i(n),n},[]),h=(0,a.useCallback)(()=>{(0,o.o4)(null),i(null)},[]);return(0,n.jsx)(s.Provider,{value:{shopper:r,loading:l,isAuthenticated:!!r,login:u,logout:h,refreshSession:d},children:t})}function l(){let e=(0,a.useContext)(s);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},6971:function(e,t,r){"use strict";r.d(t,{J:function(){return c},l:function(){return d}});var n=r(7437),a=r(2265),o=r(7128),s=r(6428);let i=(0,a.createContext)(null),l=0;function c(e){let{children:t}=e,[r,c]=(0,a.useState)([]),[d,u]=(0,a.useState)(0),h=(0,a.useRef)(0),p=(0,a.useRef)({}),{isAuthenticated:f}=(0,o.a)(),m=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3,n=++l;return c(r=>[...r,{id:n,message:e,type:t}]),r>0&&(p.current[n]=setTimeout(()=>{c(e=>e.filter(e=>e.id!==n)),delete p.current[n]},r)),n},[]),v=(0,a.useCallback)(e=>{c(t=>t.filter(t=>t.id!==e)),p.current[e]&&(clearTimeout(p.current[e]),delete p.current[e])},[]),x=(0,a.useCallback)(e=>m(e,"success"),[m]),j=(0,a.useCallback)(e=>m(e,"error"),[m]),g=(0,a.useCallback)(e=>m(e,"warning"),[m]),b=(0,a.useCallback)(e=>m(e,"info"),[m]);return(0,a.useEffect)(()=>{if(!f){u(0),h.current=0;return}let e=!1;async function t(){try{var t,r;let n=(0,s.LP)();if(!n)return;let a=await fetch("/api/mercado/notifications/list.php?unread=1",{credentials:"include",headers:{Authorization:"Bearer ".concat(n)}});if(!a.ok)return;let o=await a.json();if(!o.success)return;let i=null!==(r=null===(t=o.data)||void 0===t?void 0:t.unread_count)&&void 0!==r?r:0;e||(u(i),i>h.current&&m("Nova notificacao","info"),h.current=i)}catch(e){}}t();let r=setInterval(t,3e4);return()=>{e=!0,clearInterval(r)}},[f,m]),(0,a.useEffect)(()=>()=>{Object.values(p.current).forEach(e=>clearTimeout(e))},[]),(0,n.jsxs)(i.Provider,{value:{notifications:r,addNotification:m,removeNotification:v,success:x,error:j,warning:g,info:b,unreadCount:d},children:[t,r.length>0&&(0,n.jsx)("div",{className:"toast-container",children:r.map(e=>(0,n.jsxs)("div",{className:"toast toast-".concat(e.type),onClick:()=>v(e.id),children:[(0,n.jsxs)("span",{className:"toast-icon",children:["success"===e.type&&"✓","error"===e.type&&"✗","warning"===e.type&&"⚠","info"===e.type&&"ℹ"]}),(0,n.jsx)("span",{className:"toast-message",children:e.message})]},e.id))})]})}function d(){let e=(0,a.useContext)(i);if(!e)throw Error("useNotification must be used within NotificationProvider");return e}},9988:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var n=r(7437),a=r(2265),o=r(9376),s=r(6428),i=r(6971),l=r(8779),c=r(2277);let d=[{value:"",label:"Selecione o tipo do problema"},{value:"item_faltando",label:"Item faltando"},{value:"item_danificado",label:"Item danificado"},{value:"item_errado",label:"Item errado"},{value:"endereco_incorreto",label:"Endereco incorreto"},{value:"cliente_ausente",label:"Cliente ausente"},{value:"outro",label:"Outro"}];function u(){let e=(0,o.useSearchParams)().get("order_id")||"",{success:t,error:r}=(0,i.l)(),l=(0,a.useRef)(null),[c,u]=(0,a.useState)("reportar"),[h,p]=(0,a.useState)(!1),[f,m]=(0,a.useState)(!1),[v,x]=(0,a.useState)([]),[j,g]=(0,a.useState)({order_id:e,type:"",description:""}),[b,y]=(0,a.useState)(null),[k,w]=(0,a.useState)(null);async function N(){m(!0);try{let e=await (0,s.SC)("/problemas.php");x(e.reports||e.problemas||[])}catch(e){console.error("Load reports error:",e)}finally{m(!1)}}function C(e,t){g(r=>({...r,[e]:t}))}function S(){y(null),w(null),l.current&&(l.current.value="")}async function P(){if(!j.type){r("Selecione o tipo do problema");return}if(!j.description.trim()){r("Descreva o problema");return}p(!0);try{let r=new FormData;r.append("order_id",j.order_id),r.append("type",j.type),r.append("description",j.description),b&&r.append("photo",b),await (0,s.B9)("/problemas.php",r),t("Problema reportado com sucesso!"),g({order_id:e,type:"",description:""}),S()}catch(e){r("Erro: "+e.message)}finally{p(!1)}}return(0,a.useEffect)(()=>{"historico"===c&&N()},[c]),(0,n.jsxs)("div",{className:"page",children:[(0,n.jsx)("div",{className:"page-header",children:(0,n.jsx)("h1",{children:"Problemas"})}),(0,n.jsx)("div",{className:"tabs",children:[{key:"reportar",label:"Reportar"},{key:"historico",label:"Meus Reportes"}].map(e=>(0,n.jsx)("button",{className:"tab ".concat(c===e.key?"active":""),onClick:()=>u(e.key),children:e.label},e.key))}),"reportar"===c?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("div",{className:"card-title",style:{marginBottom:16},children:"Reportar Problema"}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"form-label",children:"Pedido (opcional)"}),(0,n.jsx)("input",{type:"text",className:"form-input",placeholder:"ID do pedido",value:j.order_id,onChange:e=>C("order_id",e.target.value)})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"form-label",children:"Tipo do Problema *"}),(0,n.jsx)("select",{className:"form-select",value:j.type,onChange:e=>C("type",e.target.value),children:d.map(e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"form-label",children:"Descricao *"}),(0,n.jsx)("textarea",{className:"form-textarea",placeholder:"Descreva o problema com detalhes...",value:j.description,onChange:e=>C("description",e.target.value),rows:4})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"form-label",children:"Foto (opcional)"}),(0,n.jsxs)("div",{className:"photo-upload",onClick:()=>{var e;return null===(e=l.current)||void 0===e?void 0:e.click()},children:[k?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("img",{src:k,alt:"Preview"}),(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),S()},style:{position:"absolute",top:8,right:8,zIndex:2,width:28,height:28,borderRadius:"50%",background:"rgba(0,0,0,0.6)",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16},children:"X"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"photo-upload-icon",children:(0,n.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[(0,n.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,n.jsx)("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),(0,n.jsx)("polyline",{points:"21 15 16 10 5 21"})]})}),(0,n.jsx)("div",{className:"photo-upload-text",children:"Toque para adicionar foto"})]}),(0,n.jsx)("input",{ref:l,type:"file",accept:"image/*",capture:"environment",onChange:function(e){var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){y(r);let e=new FileReader;e.onloadend=()=>{w(e.result),e.onloadend=null,e.onerror=null},e.onerror=()=>{e.onloadend=null,e.onerror=null},e.readAsDataURL(r)}}})]})]})]}),(0,n.jsx)("button",{className:"btn btn-primary",onClick:P,disabled:h,children:h?"Enviando...":"Enviar Reporte"})]}):(0,n.jsx)(n.Fragment,{children:f?(0,n.jsx)("div",{children:[1,2,3].map(e=>(0,n.jsx)("div",{className:"skeleton-card"},e))}):0===v.length?(0,n.jsxs)("div",{className:"empty-state",children:[(0,n.jsx)("div",{className:"empty-icon",children:(0,n.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.3",children:[(0,n.jsx)("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),(0,n.jsx)("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),(0,n.jsx)("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]})}),(0,n.jsx)("div",{className:"empty-title",children:"Nenhum reporte"}),(0,n.jsx)("div",{className:"empty-desc",children:"Seus reportes de problemas aparecer\xe3o aqui"})]}):v.map((e,t)=>(0,n.jsxs)("div",{className:"card",children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontSize:14,fontWeight:600},children:function(e){let t=d.find(t=>t.value===e);return t?t.label:e}(e.type||e.tipo)}),(0,n.jsx)("div",{style:{fontSize:12,color:"var(--color-text-secondary)"},children:function(e){if(!e)return"--";try{return new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return e}}(e.created_at||e.data)})]}),(0,n.jsx)("span",{className:"badge ".concat(function(e){switch(e){case"resolvido":case"resolved":return"badge-success";case"em_analise":case"pending":return"badge-warning";case"aberto":case"open":return"badge-info";default:return"badge-neutral"}}(e.status)),children:function(e){switch(e){case"resolvido":case"resolved":return"Resolvido";case"em_analise":case"pending":return"Em Analise";case"aberto":case"open":return"Aberto";default:return e||"Aberto"}}(e.status)})]}),(0,n.jsx)("p",{style:{fontSize:13,color:"var(--color-text-secondary)",lineHeight:1.5},children:e.description||e.descricao}),e.order_id&&(0,n.jsxs)("div",{style:{fontSize:12,color:"var(--color-text-muted)",marginTop:6},children:["Pedido #",e.order_id]}),e.response&&(0,n.jsxs)("div",{style:{marginTop:8,padding:"8px 12px",background:"var(--color-bg-page)",borderRadius:"var(--radius-sm)",fontSize:13,borderLeft:"3px solid var(--color-primary)"},children:[(0,n.jsx)("div",{style:{fontSize:11,fontWeight:600,color:"var(--color-primary-dark)",marginBottom:4},children:"Resposta do Suporte"}),e.response]})]},e.id||t))})]})}function h(){return(0,n.jsxs)(l.Z,{children:[(0,n.jsx)(a.Suspense,{fallback:(0,n.jsx)("div",{className:"loading-screen",children:(0,n.jsx)("div",{className:"spinner"})}),children:(0,n.jsx)(u,{})}),(0,n.jsx)(c.Z,{})]})}}},function(e){e.O(0,[448,971,117,744],function(){return e(e.s=2447)}),_N_E=e.O()}]);