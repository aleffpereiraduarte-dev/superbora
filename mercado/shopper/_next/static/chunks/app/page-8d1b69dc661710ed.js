(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3825:function(e,t,n){Promise.resolve().then(n.bind(n,6410))},6428:function(e,t,n){"use strict";n.d(t,{B9:function(){return d},LP:function(){return r},SC:function(){return o},o4:function(){return i},pE:function(){return u},sg:function(){return c}});let a="/api/mercado/shopper",s="shopper_token";function r(){try{return localStorage.getItem(s)}catch(e){return null}}function i(e){try{e?localStorage.setItem(s,e):localStorage.removeItem(s)}catch(e){}}function l(){let e=r();return e?{Authorization:"Bearer ".concat(e)}:{}}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),s=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");s&&(n+="?".concat(s));let r=await fetch(n,{credentials:"include",headers:l()});if(!r.ok){let e=await r.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(r.status," ").concat(r.statusText))}let i=await r.json();if(!i.success)throw Error(i.message||"Erro desconhecido na API");return i.data}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...l()},body:JSON.stringify(t)}),s=await n.json().catch(()=>null);if(!n.ok||!(null==s?void 0:s.success))throw Error((null==s?void 0:s.message)||"API error: ".concat(n.status));return s.data}async function d(e,t){let n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:l(),body:t}),s=await n.json().catch(()=>null);if(!n.ok||!(null==s?void 0:s.success))throw Error((null==s?void 0:s.message)||"API error: ".concat(n.status));return s.data}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...l()},body:JSON.stringify(t)}),s=await n.json().catch(()=>null);if(!n.ok||!(null==s?void 0:s.success))throw Error((null==s?void 0:s.message)||"API error: ".concat(n.status));return s.data}},8779:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var a=n(7437),s=n(2265),r=n(9376),i=n(7128);function l(e){let{children:t}=e,{isAuthenticated:n,loading:l}=(0,i.a)(),o=(0,r.useRouter)();return((0,s.useEffect)(()=>{if(!l&&!n){let e=window.location.pathname;o.push("/login?return=".concat(encodeURIComponent(e)))}},[l,n,o]),l)?(0,a.jsxs)("div",{className:"loading-screen",children:[(0,a.jsx)("div",{className:"spinner"}),(0,a.jsx)("p",{className:"loading-text",children:"Carregando..."})]}):n?t:null}},2277:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var a=n(7437),s=n(9376),r=n(7648),i=n(6971);let l=[{href:"/",label:"Home",icon:(0,a.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),(0,a.jsx)("polyline",{points:"9 22 9 12 15 12 15 22"})]})},{href:"/pedidos",label:"Pedidos",icon:(0,a.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,a.jsx)("polyline",{points:"14 2 14 8 20 8"}),(0,a.jsx)("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),(0,a.jsx)("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]})},{href:"/ganhos",label:"Ganhos",icon:(0,a.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),(0,a.jsx)("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]})},{href:"/chat",label:"Chat",icon:(0,a.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,a.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})},{href:"/perfil",label:"Perfil",icon:(0,a.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),(0,a.jsx)("circle",{cx:"12",cy:"7",r:"4"})]})}];function o(){let e=(0,s.usePathname)(),{unreadCount:t}=(0,i.l)();return(0,a.jsx)("nav",{className:"bottom-nav",children:l.map(n=>{var s;return(0,a.jsxs)(r.default,{href:n.href,className:"bottom-nav-item ".concat(("/"===(s=n.href)?"/"===e||""===e:e.startsWith(s))?"active":""),children:[(0,a.jsxs)("span",{className:"bottom-nav-icon",children:[n.icon,"/"===n.href&&t>0&&(0,a.jsx)("span",{className:"bottom-nav-badge",children:t>99?"99+":t})]}),(0,a.jsx)("span",{className:"bottom-nav-label",children:n.label})]},n.href)})})}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return l},a:function(){return o}});var a=n(7437),s=n(2265),r=n(6428);let i=(0,s.createContext)(null);function l(e){let{children:t}=e,[n,l]=(0,s.useState)(null),[o,c]=(0,s.useState)(!0),d=(0,s.useCallback)(async()=>{if(!(0,r.LP)()){l(null),c(!1);return}try{let e=await (0,r.SC)("/auth/session.php");e.authenticated&&e.shopper?l(e.shopper):((0,r.o4)(null),l(null))}catch(e){(0,r.o4)(null),l(null)}finally{c(!1)}},[]);(0,s.useEffect)(()=>{d()},[d]);let u=(0,s.useCallback)(async(e,t)=>{let n=await (0,r.sg)("/auth/login.php",{email:e,senha:t});(0,r.o4)(n.token);let a=n.shopper||{id:n.shopper_id,nome:n.nome,email:n.email,telefone:n.telefone,foto:n.foto,saldo:n.saldo,status:n.status};return l(a),a},[]),h=(0,s.useCallback)(()=>{(0,r.o4)(null),l(null)},[]);return(0,a.jsx)(i.Provider,{value:{shopper:n,loading:o,isAuthenticated:!!n,login:u,logout:h,refreshSession:d},children:t})}function o(){let e=(0,s.useContext)(i);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},6971:function(e,t,n){"use strict";n.d(t,{J:function(){return c},l:function(){return d}});var a=n(7437),s=n(2265),r=n(7128),i=n(6428);let l=(0,s.createContext)(null),o=0;function c(e){let{children:t}=e,[n,c]=(0,s.useState)([]),[d,u]=(0,s.useState)(0),h=(0,s.useRef)(0),v=(0,s.useRef)({}),{isAuthenticated:f}=(0,r.a)(),x=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3,a=++o;return c(n=>[...n,{id:a,message:e,type:t}]),n>0&&(v.current[a]=setTimeout(()=>{c(e=>e.filter(e=>e.id!==a)),delete v.current[a]},n)),a},[]),m=(0,s.useCallback)(e=>{c(t=>t.filter(t=>t.id!==e)),v.current[e]&&(clearTimeout(v.current[e]),delete v.current[e])},[]),p=(0,s.useCallback)(e=>x(e,"success"),[x]),j=(0,s.useCallback)(e=>x(e,"error"),[x]),g=(0,s.useCallback)(e=>x(e,"warning"),[x]),k=(0,s.useCallback)(e=>x(e,"info"),[x]);return(0,s.useEffect)(()=>{if(!f){u(0),h.current=0;return}let e=!1;async function t(){try{var t,n;let a=(0,i.LP)();if(!a)return;let s=await fetch("/api/mercado/notifications/list.php?unread=1",{credentials:"include",headers:{Authorization:"Bearer ".concat(a)}});if(!s.ok)return;let r=await s.json();if(!r.success)return;let l=null!==(n=null===(t=r.data)||void 0===t?void 0:t.unread_count)&&void 0!==n?n:0;e||(u(l),l>h.current&&x("Nova notificacao","info"),h.current=l)}catch(e){}}t();let n=setInterval(t,3e4);return()=>{e=!0,clearInterval(n)}},[f,x]),(0,s.useEffect)(()=>()=>{Object.values(v.current).forEach(e=>clearTimeout(e))},[]),(0,a.jsxs)(l.Provider,{value:{notifications:n,addNotification:x,removeNotification:m,success:p,error:j,warning:g,info:k,unreadCount:d},children:[t,n.length>0&&(0,a.jsx)("div",{className:"toast-container",children:n.map(e=>(0,a.jsxs)("div",{className:"toast toast-".concat(e.type),onClick:()=>m(e.id),children:[(0,a.jsxs)("span",{className:"toast-icon",children:["success"===e.type&&"✓","error"===e.type&&"✗","warning"===e.type&&"⚠","info"===e.type&&"ℹ"]}),(0,a.jsx)("span",{className:"toast-message",children:e.message})]},e.id))})]})}function d(){let e=(0,s.useContext)(l);if(!e)throw Error("useNotification must be used within NotificationProvider");return e}},4755:function(e,t,n){"use strict";n.d(t,{A:function(){return o},u:function(){return l}});var a=n(7437),s=n(2265),r=n(6428);let i=(0,s.createContext)(null);function l(e){let{children:t}=e,[n,l]=(0,s.useState)(null),[o,c]=(0,s.useState)([]),[d,u]=(0,s.useState)({collected:0,total:0}),[h,v]=(0,s.useState)(!1),f=(0,s.useCallback)(async()=>{v(!0);try{let e=await (0,r.SC)("/dashboard.php");if(e.active_order&&(l(e.active_order),e.active_order.items)){c(e.active_order.items);let t=e.active_order.items.filter(e=>"collected"===e.status).length;u({collected:t,total:e.active_order.items.length})}return e}catch(e){return console.error("Failed to fetch active order:",e),null}finally{v(!1)}},[]),x=(0,s.useCallback)(async e=>{try{let t=await (0,r.SC)("/order-items.php",{order_id:e});c(t.items||[]);let n=(t.items||[]).filter(e=>"collected"===e.status).length;return u({collected:n,total:(t.items||[]).length}),t.items||[]}catch(e){return console.error("Failed to fetch order items:",e),[]}},[]),m=(0,s.useCallback)(async(e,t)=>{try{await (0,r.sg)("/item-coletado.php",{item_id:e,status:t}),c(n=>{let a=n.map(n=>n.id===e?{...n,status:t}:n),s=a.filter(e=>"collected"===e.status).length;return u({collected:s,total:a.length}),a})}catch(e){throw console.error("Failed to update item status:",e),e}},[]),p=(0,s.useCallback)(()=>{l(null),c([]),u({collected:0,total:0})},[]);return(0,a.jsx)(i.Provider,{value:{activeOrder:n,items:o,progress:d,loading:h,fetchActiveOrder:f,fetchOrderItems:x,updateItemStatus:m,setActiveOrder:l,clearOrder:p},children:t})}function o(){let e=(0,s.useContext)(i);if(!e)throw Error("useOrder must be used within OrderProvider");return e}},6410:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var a=n(7437),s=n(2265),r=n(9376),i=n(6428),l=n(7128),o=n(4755),c=n(8779),d=n(2277),u=n(6971);function h(e){let{initialOnline:t=!1}=e,[n,r]=(0,s.useState)(t),[l,o]=(0,s.useState)(!1),{success:c,error:d}=(0,u.l)(),h=(0,s.useCallback)(async()=>{o(!0);try{let e=!n;await (0,i.sg)("/toggle-online.php",{online:e}),r(e),c(e?"Voce esta online!":"Voce esta offline")}catch(e){d("Erro ao alterar status: "+e.message)}finally{o(!1)}},[n,c,d]);return(0,a.jsxs)("div",{className:"online-toggle-wrapper",children:[(0,a.jsx)("span",{className:"online-toggle-label",children:n?"Online":"Offline"}),(0,a.jsx)("button",{className:"online-toggle ".concat(n?"online":"offline"),onClick:h,disabled:l,"aria-label":n?"Ficar offline":"Ficar online",children:(0,a.jsx)("span",{className:"online-toggle-knob"})})]})}function v(){var e,t,n;let c=(0,r.useRouter)(),{shopper:d}=(0,l.a)(),{activeOrder:u,fetchActiveOrder:v}=(0,o.A)(),[f,x]=(0,s.useState)(null),[m,p]=(0,s.useState)(!0);if((0,s.useEffect)(()=>{let e=!1;return async function(){try{let t=await (0,i.SC)("/dashboard.php");!e&&(x(t),t.active_order&&v())}catch(e){console.error("Dashboard load error:",e)}finally{e||p(!1)}}(),()=>{e=!0}},[v]),m)return(0,a.jsxs)("div",{className:"page",children:[(0,a.jsx)("div",{className:"skeleton-card"}),(0,a.jsx)("div",{className:"skeleton-card"}),(0,a.jsxs)("div",{className:"stats-grid",children:[(0,a.jsx)("div",{className:"skeleton",style:{height:80}}),(0,a.jsx)("div",{className:"skeleton",style:{height:80}}),(0,a.jsx)("div",{className:"skeleton",style:{height:80}})]})]});let j=(null==f?void 0:f.stats)||{},g=(null==f?void 0:f.earnings)||{},k=(null==f?void 0:f.streak)||{current:0,target:7},y=(null==f?void 0:f.xp)||{current:0,total:1e3};return(0,a.jsxs)("div",{className:"page",children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{style:{fontSize:20,fontWeight:700},children:["Ola, ",(null==d?void 0:null===(e=d.nome)||void 0===e?void 0:e.split(" ")[0])||"Shopper"]}),(0,a.jsx)("p",{style:{fontSize:13,color:"var(--color-text-secondary)"},children:"Bom trabalho hoje!"})]}),(0,a.jsx)(h,{initialOnline:(null==f?void 0:f.online)||!1})]}),(u||(null==f?void 0:f.active_order))&&(0,a.jsxs)("div",{className:"active-order-card",onClick:()=>{var e;return c.push("/compras?order_id=".concat((null===(e=u||(null==f?void 0:f.active_order))||void 0===e?void 0:e.id)||""))},children:[(0,a.jsx)("h3",{children:"Pedido em andamento"}),(0,a.jsxs)("p",{children:[(null===(t=u||(null==f?void 0:f.active_order))||void 0===t?void 0:t.store_name)||"Loja"," - ",(null===(n=u||(null==f?void 0:f.active_order))||void 0===n?void 0:n.items_count)||"?"," itens"]}),(0,a.jsx)("button",{className:"btn btn-sm",style:{background:"rgba(0,0,0,0.2)",color:"white",width:"auto"},children:"Continuar"})]}),(0,a.jsxs)("div",{className:"balance-card",children:[(0,a.jsx)("div",{className:"balance-label",children:"Ganhos hoje"}),(0,a.jsxs)("div",{className:"balance-value",children:["R$ ",(g.today||0).toFixed(2).replace(".",",")]}),(0,a.jsxs)("div",{className:"balance-sub",children:["Meta diaria: R$ ",(g.daily_goal||200).toFixed(2).replace(".",",")]})]}),(0,a.jsxs)("div",{className:"stats-grid",style:{marginBottom:16},children:[(0,a.jsxs)("div",{className:"stat-card",children:[(0,a.jsx)("div",{className:"stat-value",children:j.pedidos_hoje||0}),(0,a.jsx)("div",{className:"stat-label",children:"Pedidos"})]}),(0,a.jsxs)("div",{className:"stat-card",children:[(0,a.jsxs)("div",{className:"stat-value",style:{color:"var(--color-primary-dark)"},children:["R$ ",(j.ganho_hoje||0).toFixed(0)]}),(0,a.jsx)("div",{className:"stat-label",children:"Ganho"})]}),(0,a.jsxs)("div",{className:"stat-card",children:[(0,a.jsx)("div",{className:"stat-value",style:{color:"var(--color-star)"},children:j.avaliacao_media?j.avaliacao_media.toFixed(1):"--"}),(0,a.jsx)("div",{className:"stat-label",children:"Avaliacao"})]})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"card-header",children:[(0,a.jsx)("span",{className:"card-title",children:"Sequencia Semanal"}),(0,a.jsxs)("span",{style:{fontSize:13,color:"var(--color-primary-dark)",fontWeight:600},children:[k.current,"/",k.target," dias"]})]}),(0,a.jsx)("div",{className:"xp-bar",children:(0,a.jsx)("div",{className:"xp-bar-fill",style:{width:"".concat(Math.min(k.current/k.target*100,100),"%")}})})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"card-header",children:[(0,a.jsx)("span",{className:"card-title",children:"Experiencia"}),(0,a.jsxs)("span",{style:{fontSize:13,color:"var(--color-text-secondary)"},children:[y.current," / ",y.total," XP"]})]}),(0,a.jsx)("div",{className:"xp-bar",children:(0,a.jsx)("div",{className:"xp-bar-fill",style:{width:"".concat(Math.min(y.current/y.total*100,100),"%")}})})]}),(0,a.jsxs)("div",{className:"quick-actions",children:[(0,a.jsxs)("button",{className:"quick-action",onClick:()=>c.push("/pedidos"),children:[(0,a.jsx)("span",{className:"quick-action-icon",children:(0,a.jsxs)("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,a.jsx)("polyline",{points:"14 2 14 8 20 8"})]})}),"Ver Pedidos"]}),(0,a.jsxs)("button",{className:"quick-action",onClick:()=>c.push("/scanner"),children:[(0,a.jsx)("span",{className:"quick-action-icon",children:(0,a.jsxs)("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("rect",{x:"3",y:"3",width:"7",height:"7"}),(0,a.jsx)("rect",{x:"14",y:"3",width:"7",height:"7"}),(0,a.jsx)("rect",{x:"3",y:"14",width:"7",height:"7"}),(0,a.jsx)("rect",{x:"14",y:"14",width:"7",height:"7"})]})}),"Scanner"]}),(0,a.jsxs)("button",{className:"quick-action",onClick:()=>c.push("/checklist"),children:[(0,a.jsx)("span",{className:"quick-action-icon",children:(0,a.jsxs)("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("polyline",{points:"9 11 12 14 22 4"}),(0,a.jsx)("path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"})]})}),"Checklist"]}),(0,a.jsxs)("button",{className:"quick-action",onClick:()=>c.push("/performance"),children:[(0,a.jsx)("span",{className:"quick-action-icon",children:(0,a.jsx)("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"})})}),"Performance"]})]})]})}function f(){return(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(v,{}),(0,a.jsx)(d.Z,{})]})}}},function(e){e.O(0,[448,971,117,744],function(){return e(e.s=3825)}),_N_E=e.O()}]);