(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[429],{5259:function(e,t,n){Promise.resolve().then(n.bind(n,8725))},6428:function(e,t,n){"use strict";n.d(t,{B9:function(){return d},LP:function(){return o},SC:function(){return c},o4:function(){return i},pE:function(){return u},sg:function(){return l}});let s="/api/mercado/shopper",a="shopper_token";function o(){try{return localStorage.getItem(a)}catch(e){return null}}function i(e){try{e?localStorage.setItem(a,e):localStorage.removeItem(a)}catch(e){}}function r(){let e=o();return e?{Authorization:"Bearer ".concat(e)}:{}}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(s).concat(e),a=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");a&&(n+="?".concat(a));let o=await fetch(n,{credentials:"include",headers:r()});if(!o.ok){let e=await o.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(o.status," ").concat(o.statusText))}let i=await o.json();if(!i.success)throw Error(i.message||"Erro desconhecido na API");return i.data}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(s).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...r()},body:JSON.stringify(t)}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function d(e,t){let n=await fetch("".concat(s).concat(e),{method:"POST",credentials:"include",headers:r(),body:t}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(s).concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...r()},body:JSON.stringify(t)}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}},8779:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var s=n(7437),a=n(2265),o=n(9376),i=n(7128);function r(e){let{children:t}=e,{isAuthenticated:n,loading:r}=(0,i.a)(),c=(0,o.useRouter)();return((0,a.useEffect)(()=>{if(!r&&!n){let e=window.location.pathname;c.push("/login?return=".concat(encodeURIComponent(e)))}},[r,n,c]),r)?(0,s.jsxs)("div",{className:"loading-screen",children:[(0,s.jsx)("div",{className:"spinner"}),(0,s.jsx)("p",{className:"loading-text",children:"Carregando..."})]}):n?t:null}},2277:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var s=n(7437),a=n(9376),o=n(7648),i=n(6971);let r=[{href:"/",label:"Home",icon:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),(0,s.jsx)("polyline",{points:"9 22 9 12 15 12 15 22"})]})},{href:"/pedidos",label:"Pedidos",icon:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,s.jsx)("polyline",{points:"14 2 14 8 20 8"}),(0,s.jsx)("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),(0,s.jsx)("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]})},{href:"/ganhos",label:"Ganhos",icon:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),(0,s.jsx)("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]})},{href:"/chat",label:"Chat",icon:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})},{href:"/perfil",label:"Perfil",icon:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),(0,s.jsx)("circle",{cx:"12",cy:"7",r:"4"})]})}];function c(){let e=(0,a.usePathname)(),{unreadCount:t}=(0,i.l)();return(0,s.jsx)("nav",{className:"bottom-nav",children:r.map(n=>{var a;return(0,s.jsxs)(o.default,{href:n.href,className:"bottom-nav-item ".concat(("/"===(a=n.href)?"/"===e||""===e:e.startsWith(a))?"active":""),children:[(0,s.jsxs)("span",{className:"bottom-nav-icon",children:[n.icon,"/"===n.href&&t>0&&(0,s.jsx)("span",{className:"bottom-nav-badge",children:t>99?"99+":t})]}),(0,s.jsx)("span",{className:"bottom-nav-label",children:n.label})]},n.href)})})}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return r},a:function(){return c}});var s=n(7437),a=n(2265),o=n(6428);let i=(0,a.createContext)(null);function r(e){let{children:t}=e,[n,r]=(0,a.useState)(null),[c,l]=(0,a.useState)(!0),d=(0,a.useCallback)(async()=>{if(!(0,o.LP)()){r(null),l(!1);return}try{let e=await (0,o.SC)("/auth/session.php");e.authenticated&&e.shopper?r(e.shopper):((0,o.o4)(null),r(null))}catch(e){(0,o.o4)(null),r(null)}finally{l(!1)}},[]);(0,a.useEffect)(()=>{d()},[d]);let u=(0,a.useCallback)(async(e,t)=>{let n=await (0,o.sg)("/auth/login.php",{email:e,senha:t});(0,o.o4)(n.token);let s=n.shopper||{id:n.shopper_id,nome:n.nome,email:n.email,telefone:n.telefone,foto:n.foto,saldo:n.saldo,status:n.status};return r(s),s},[]),h=(0,a.useCallback)(()=>{(0,o.o4)(null),r(null)},[]);return(0,s.jsx)(i.Provider,{value:{shopper:n,loading:c,isAuthenticated:!!n,login:u,logout:h,refreshSession:d},children:t})}function c(){let e=(0,a.useContext)(i);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},6971:function(e,t,n){"use strict";n.d(t,{J:function(){return l},l:function(){return d}});var s=n(7437),a=n(2265),o=n(7128),i=n(6428);let r=(0,a.createContext)(null),c=0;function l(e){let{children:t}=e,[n,l]=(0,a.useState)([]),[d,u]=(0,a.useState)(0),h=(0,a.useRef)(0),p=(0,a.useRef)({}),{isAuthenticated:f}=(0,o.a)(),m=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3,s=++c;return l(n=>[...n,{id:s,message:e,type:t}]),n>0&&(p.current[s]=setTimeout(()=>{l(e=>e.filter(e=>e.id!==s)),delete p.current[s]},n)),s},[]),x=(0,a.useCallback)(e=>{l(t=>t.filter(t=>t.id!==e)),p.current[e]&&(clearTimeout(p.current[e]),delete p.current[e])},[]),v=(0,a.useCallback)(e=>m(e,"success"),[m]),j=(0,a.useCallback)(e=>m(e,"error"),[m]),g=(0,a.useCallback)(e=>m(e,"warning"),[m]),y=(0,a.useCallback)(e=>m(e,"info"),[m]);return(0,a.useEffect)(()=>{if(!f){u(0),h.current=0;return}let e=!1;async function t(){try{var t,n;let s=(0,i.LP)();if(!s)return;let a=await fetch("/api/mercado/notifications/list.php?unread=1",{credentials:"include",headers:{Authorization:"Bearer ".concat(s)}});if(!a.ok)return;let o=await a.json();if(!o.success)return;let r=null!==(n=null===(t=o.data)||void 0===t?void 0:t.unread_count)&&void 0!==n?n:0;e||(u(r),r>h.current&&m("Nova notificacao","info"),h.current=r)}catch(e){}}t();let n=setInterval(t,3e4);return()=>{e=!0,clearInterval(n)}},[f,m]),(0,a.useEffect)(()=>()=>{Object.values(p.current).forEach(e=>clearTimeout(e))},[]),(0,s.jsxs)(r.Provider,{value:{notifications:n,addNotification:m,removeNotification:x,success:v,error:j,warning:g,info:y,unreadCount:d},children:[t,n.length>0&&(0,s.jsx)("div",{className:"toast-container",children:n.map(e=>(0,s.jsxs)("div",{className:"toast toast-".concat(e.type),onClick:()=>x(e.id),children:[(0,s.jsxs)("span",{className:"toast-icon",children:["success"===e.type&&"✓","error"===e.type&&"✗","warning"===e.type&&"⚠","info"===e.type&&"ℹ"]}),(0,s.jsx)("span",{className:"toast-message",children:e.message})]},e.id))})]})}function d(){let e=(0,a.useContext)(r);if(!e)throw Error("useNotification must be used within NotificationProvider");return e}},8725:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var s=n(7437),a=n(2265),o=n(9376),i=n(6428),r=n(6971),c=n(8779),l=n(2277);function d(){let e=(0,o.useRouter)(),{success:t,error:n}=(0,r.l)(),[c,l]=(0,a.useState)("disponiveis"),[d,u]=(0,a.useState)([]),[h,p]=(0,a.useState)([]),[f,m]=(0,a.useState)(!0),[x,v]=(0,a.useState)(null),[j,g]=(0,a.useState)(null),y=(0,a.useCallback)(async()=>{m(!0);try{let e="disponiveis"===c?"/pedidos-disponiveis.php":"aceitos"===c?"/pedidos-disponiveis.php?status=aceito":"/pedidos-disponiveis.php?status=em_andamento",t=await (0,i.SC)(e);if(u(t.orders||t.pedidos||[]),"disponiveis"===c)try{let e=await (0,i.SC)("/batch.php");p(e.batches||[])}catch(e){p([])}}catch(e){console.error("Load orders error:",e),u([])}finally{m(!1)}},[c]);async function b(e){v(e);try{await (0,i.sg)("/aceitar-pedido.php",{order_id:e}),t("Pedido aceito com sucesso!"),y()}catch(e){n("Erro ao aceitar pedido: "+e.message)}finally{v(null)}}async function k(e){g(e.join(","));try{await (0,i.sg)("/batch.php",{order_ids:e}),t("Lote de ".concat(e.length," pedidos aceito!")),y()}catch(e){n("Erro ao aceitar lote: "+e.message)}finally{g(null)}}return(0,a.useEffect)(()=>{y()},[y]),(0,s.jsxs)("div",{className:"page",children:[(0,s.jsx)("div",{className:"page-header",children:(0,s.jsx)("h1",{children:"Pedidos"})}),(0,s.jsx)("div",{className:"tabs",children:[{key:"disponiveis",label:"Disponiveis"},{key:"aceitos",label:"Aceitos"},{key:"andamento",label:"Em Andamento"}].map(e=>(0,s.jsx)("button",{className:"tab ".concat(c===e.key?"active":""),onClick:()=>l(e.key),children:e.label},e.key))}),f?(0,s.jsx)("div",{children:[1,2,3].map(e=>(0,s.jsx)("div",{className:"skeleton-card"},e))}):0===d.length&&0===h.length?(0,s.jsxs)("div",{className:"empty-state",children:[(0,s.jsx)("div",{className:"empty-icon",children:(0,s.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.3",children:[(0,s.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,s.jsx)("polyline",{points:"14 2 14 8 20 8"})]})}),(0,s.jsx)("div",{className:"empty-title",children:"Nenhum pedido"}),(0,s.jsx)("div",{className:"empty-desc",children:"disponiveis"===c?"Novos pedidos aparecer\xe3o aqui":"Voce nao tem pedidos nessa categoria"})]}):(0,s.jsxs)("div",{children:["disponiveis"===c&&h.length>0&&(0,s.jsxs)("div",{style:{marginBottom:16},children:[(0,s.jsxs)("div",{style:{fontSize:14,fontWeight:600,color:"#7c3aed",marginBottom:8,display:"flex",alignItems:"center",gap:6},children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2",ry:"2"}),(0,s.jsx)("path",{d:"M16 7V5a4 4 0 0 0-8 0v2"})]}),"Entregas em Lote (bonus extra!)"]}),h.map((e,t)=>(0,s.jsxs)("div",{className:"order-card",style:{borderLeft:"4px solid #7c3aed"},children:[(0,s.jsxs)("div",{className:"order-card-header",children:[(0,s.jsxs)("span",{style:{fontWeight:600,color:"#7c3aed"},children:["Lote: ",e.order_count," pedidos"]}),(0,s.jsxs)("span",{className:"badge",style:{background:"#ede9fe",color:"#7c3aed"},children:["+",(e.batch_bonus||0).toFixed(2).replace(".",",")," bonus"]})]}),e.orders.map(e=>(0,s.jsxs)("div",{style:{padding:"6px 0",borderBottom:"1px solid #f3f4f6",fontSize:13},children:[(0,s.jsx)("div",{style:{fontWeight:500},children:e.store_name}),(0,s.jsxs)("div",{style:{color:"#6b7280",fontSize:12},children:[e.items_count," itens - R$ ",(e.total||0).toFixed(2).replace(".",",")]})]},e.order_id)),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:8},children:[(0,s.jsxs)("span",{className:"order-earnings",style:{color:"#7c3aed"},children:["R$ ",(e.total_earnings||0).toFixed(2).replace(".",",")]}),(0,s.jsx)("button",{className:"btn btn-primary btn-sm",style:{width:"auto",background:"#7c3aed"},disabled:j===e.order_ids.join(","),onClick:t=>{t.stopPropagation(),k(e.order_ids)},children:j===e.order_ids.join(",")?"Aceitando...":"Aceitar Lote"})]})]},t))]}),d.map(t=>{let n=t.batch_id&&""!==t.batch_id;return(0,s.jsxs)("div",{className:"order-card",onClick:()=>{("em_andamento"===t.status||"aceito"===t.status)&&e.push("/compras?order_id=".concat(t.id))},style:{cursor:"em_andamento"===t.status||"aceito"===t.status?"pointer":"default",borderLeft:n?"4px solid #7c3aed":void 0},children:[(0,s.jsxs)("div",{className:"order-card-header",children:[(0,s.jsx)("span",{className:"order-store",children:t.store_name||t.loja}),(0,s.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[n&&(0,s.jsx)("span",{className:"badge",style:{background:"#ede9fe",color:"#7c3aed",fontSize:11},children:"Lote"}),(0,s.jsx)("span",{className:"badge ".concat("disponivel"===t.status?"badge-info":"aceito"===t.status?"badge-warning":"badge-success"),children:"disponivel"===t.status?"Novo":"aceito"===t.status?"Aceito":"Andamento"})]})]}),(0,s.jsxs)("div",{className:"order-meta",children:[(0,s.jsxs)("span",{children:[t.items_count||t.qtd_itens||"?"," itens"]}),(0,s.jsxs)("span",{children:[t.distance||"--"," km"]}),(0,s.jsxs)("span",{children:[t.estimated_time||"--"," min"]})]}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsxs)("span",{className:"order-earnings",children:["R$ ",(t.earnings||t.valor_shopper||0).toFixed(2).replace(".",",")]}),"disponiveis"===c&&(0,s.jsx)("button",{className:"btn btn-primary btn-sm",style:{width:"auto"},disabled:x===(t.id||t.order_id),onClick:e=>{e.stopPropagation(),b(t.id||t.order_id)},children:x===(t.id||t.order_id)?"Aceitando...":"Aceitar"}),("aceito"===t.status||"em_andamento"===t.status)&&(0,s.jsx)("button",{className:"btn btn-primary btn-sm",style:{width:"auto"},onClick:n=>{n.stopPropagation(),e.push("/compras?order_id=".concat(t.id||t.order_id))},children:"Iniciar"})]})]},t.id||t.order_id)})]})]})}function u(){return(0,s.jsxs)(c.Z,{children:[(0,s.jsx)(d,{}),(0,s.jsx)(l.Z,{})]})}}},function(e){e.O(0,[448,971,117,744],function(){return e(e.s=5259)}),_N_E=e.O()}]);