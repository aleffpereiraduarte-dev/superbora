(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[805],{7887:function(e,t,n){Promise.resolve().then(n.bind(n,3197))},6428:function(e,t,n){"use strict";n.d(t,{B9:function(){return d},LP:function(){return o},SC:function(){return l},o4:function(){return i},pE:function(){return u},sg:function(){return c}});let r="/api/mercado/shopper",s="shopper_token";function o(){try{return localStorage.getItem(s)}catch(e){return null}}function i(e){try{e?localStorage.setItem(s,e):localStorage.removeItem(s)}catch(e){}}function a(){let e=o();return e?{Authorization:"Bearer ".concat(e)}:{}}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(r).concat(e),s=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");s&&(n+="?".concat(s));let o=await fetch(n,{credentials:"include",headers:a()});if(!o.ok){let e=await o.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(o.status," ").concat(o.statusText))}let i=await o.json();if(!i.success)throw Error(i.message||"Erro desconhecido na API");return i.data}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(r).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...a()},body:JSON.stringify(t)}),s=await n.json().catch(()=>null);if(!n.ok||!(null==s?void 0:s.success))throw Error((null==s?void 0:s.message)||"API error: ".concat(n.status));return s.data}async function d(e,t){let n=await fetch("".concat(r).concat(e),{method:"POST",credentials:"include",headers:a(),body:t}),s=await n.json().catch(()=>null);if(!n.ok||!(null==s?void 0:s.success))throw Error((null==s?void 0:s.message)||"API error: ".concat(n.status));return s.data}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(r).concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...a()},body:JSON.stringify(t)}),s=await n.json().catch(()=>null);if(!n.ok||!(null==s?void 0:s.success))throw Error((null==s?void 0:s.message)||"API error: ".concat(n.status));return s.data}},8779:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(7437),s=n(2265),o=n(9376),i=n(7128);function a(e){let{children:t}=e,{isAuthenticated:n,loading:a}=(0,i.a)(),l=(0,o.useRouter)();return((0,s.useEffect)(()=>{if(!a&&!n){let e=window.location.pathname;l.push("/login?return=".concat(encodeURIComponent(e)))}},[a,n,l]),a)?(0,r.jsxs)("div",{className:"loading-screen",children:[(0,r.jsx)("div",{className:"spinner"}),(0,r.jsx)("p",{className:"loading-text",children:"Carregando..."})]}):n?t:null}},2277:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(7437),s=n(9376),o=n(7648),i=n(6971);let a=[{href:"/",label:"Home",icon:(0,r.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),(0,r.jsx)("polyline",{points:"9 22 9 12 15 12 15 22"})]})},{href:"/pedidos",label:"Pedidos",icon:(0,r.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,r.jsx)("polyline",{points:"14 2 14 8 20 8"}),(0,r.jsx)("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),(0,r.jsx)("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]})},{href:"/ganhos",label:"Ganhos",icon:(0,r.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),(0,r.jsx)("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]})},{href:"/chat",label:"Chat",icon:(0,r.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,r.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})},{href:"/perfil",label:"Perfil",icon:(0,r.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),(0,r.jsx)("circle",{cx:"12",cy:"7",r:"4"})]})}];function l(){let e=(0,s.usePathname)(),{unreadCount:t}=(0,i.l)();return(0,r.jsx)("nav",{className:"bottom-nav",children:a.map(n=>{var s;return(0,r.jsxs)(o.default,{href:n.href,className:"bottom-nav-item ".concat(("/"===(s=n.href)?"/"===e||""===e:e.startsWith(s))?"active":""),children:[(0,r.jsxs)("span",{className:"bottom-nav-icon",children:[n.icon,"/"===n.href&&t>0&&(0,r.jsx)("span",{className:"bottom-nav-badge",children:t>99?"99+":t})]}),(0,r.jsx)("span",{className:"bottom-nav-label",children:n.label})]},n.href)})})}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return a},a:function(){return l}});var r=n(7437),s=n(2265),o=n(6428);let i=(0,s.createContext)(null);function a(e){let{children:t}=e,[n,a]=(0,s.useState)(null),[l,c]=(0,s.useState)(!0),d=(0,s.useCallback)(async()=>{if(!(0,o.LP)()){a(null),c(!1);return}try{let e=await (0,o.SC)("/auth/session.php");e.authenticated&&e.shopper?a(e.shopper):((0,o.o4)(null),a(null))}catch(e){(0,o.o4)(null),a(null)}finally{c(!1)}},[]);(0,s.useEffect)(()=>{d()},[d]);let u=(0,s.useCallback)(async(e,t)=>{let n=await (0,o.sg)("/auth/login.php",{email:e,senha:t});(0,o.o4)(n.token);let r=n.shopper||{id:n.shopper_id,nome:n.nome,email:n.email,telefone:n.telefone,foto:n.foto,saldo:n.saldo,status:n.status};return a(r),r},[]),h=(0,s.useCallback)(()=>{(0,o.o4)(null),a(null)},[]);return(0,r.jsx)(i.Provider,{value:{shopper:n,loading:l,isAuthenticated:!!n,login:u,logout:h,refreshSession:d},children:t})}function l(){let e=(0,s.useContext)(i);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},6971:function(e,t,n){"use strict";n.d(t,{J:function(){return c},l:function(){return d}});var r=n(7437),s=n(2265),o=n(7128),i=n(6428);let a=(0,s.createContext)(null),l=0;function c(e){let{children:t}=e,[n,c]=(0,s.useState)([]),[d,u]=(0,s.useState)(0),h=(0,s.useRef)(0),f=(0,s.useRef)({}),{isAuthenticated:p}=(0,o.a)(),x=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3,r=++l;return c(n=>[...n,{id:r,message:e,type:t}]),n>0&&(f.current[r]=setTimeout(()=>{c(e=>e.filter(e=>e.id!==r)),delete f.current[r]},n)),r},[]),m=(0,s.useCallback)(e=>{c(t=>t.filter(t=>t.id!==e)),f.current[e]&&(clearTimeout(f.current[e]),delete f.current[e])},[]),v=(0,s.useCallback)(e=>x(e,"success"),[x]),y=(0,s.useCallback)(e=>x(e,"error"),[x]),j=(0,s.useCallback)(e=>x(e,"warning"),[x]),g=(0,s.useCallback)(e=>x(e,"info"),[x]);return(0,s.useEffect)(()=>{if(!p){u(0),h.current=0;return}let e=!1;async function t(){try{var t,n;let r=(0,i.LP)();if(!r)return;let s=await fetch("/api/mercado/notifications/list.php?unread=1",{credentials:"include",headers:{Authorization:"Bearer ".concat(r)}});if(!s.ok)return;let o=await s.json();if(!o.success)return;let a=null!==(n=null===(t=o.data)||void 0===t?void 0:t.unread_count)&&void 0!==n?n:0;e||(u(a),a>h.current&&x("Nova notificacao","info"),h.current=a)}catch(e){}}t();let n=setInterval(t,3e4);return()=>{e=!0,clearInterval(n)}},[p,x]),(0,s.useEffect)(()=>()=>{Object.values(f.current).forEach(e=>clearTimeout(e))},[]),(0,r.jsxs)(a.Provider,{value:{notifications:n,addNotification:x,removeNotification:m,success:v,error:y,warning:j,info:g,unreadCount:d},children:[t,n.length>0&&(0,r.jsx)("div",{className:"toast-container",children:n.map(e=>(0,r.jsxs)("div",{className:"toast toast-".concat(e.type),onClick:()=>m(e.id),children:[(0,r.jsxs)("span",{className:"toast-icon",children:["success"===e.type&&"✓","error"===e.type&&"✗","warning"===e.type&&"⚠","info"===e.type&&"ℹ"]}),(0,r.jsx)("span",{className:"toast-message",children:e.message})]},e.id))})]})}function d(){let e=(0,s.useContext)(a);if(!e)throw Error("useNotification must be used within NotificationProvider");return e}},3197:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var r=n(7437),s=n(2265),o=n(6428),i=n(8779),a=n(2277);function l(){let[e,t]=(0,s.useState)([]),[n,i]=(0,s.useState)(!0),[a,l]=(0,s.useState)(!1),[c,d]=(0,s.useState)(1),[u,h]=(0,s.useState)(!0),[f,p]=(0,s.useState)(null),x=(0,s.useCallback)(async function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n?l(!0):i(!0);try{let r=await (0,o.SC)("/historico.php",{page:e}),s=r.orders||r.pedidos||[];n?t(e=>[...e,...s]):t(s),h(s.length>=(r.per_page||10))}catch(e){console.error("Load history error:",e)}finally{i(!1),l(!1)}},[]);return(0,s.useEffect)(()=>{x(1)},[x]),(0,r.jsxs)("div",{className:"page",children:[(0,r.jsx)("div",{className:"page-header",children:(0,r.jsx)("h1",{children:"Historico"})}),n?(0,r.jsx)("div",{children:[1,2,3,4].map(e=>(0,r.jsx)("div",{className:"skeleton-card"},e))}):0===e.length?(0,r.jsxs)("div",{className:"empty-state",children:[(0,r.jsx)("div",{className:"empty-icon",children:(0,r.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.3",children:[(0,r.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,r.jsx)("polyline",{points:"12 6 12 12 16 14"})]})}),(0,r.jsx)("div",{className:"empty-title",children:"Nenhum pedido no historico"}),(0,r.jsx)("div",{className:"empty-desc",children:"Seus pedidos concluidos aparecer\xe3o aqui"})]}):(0,r.jsxs)(r.Fragment,{children:[e.map(e=>{let t=f===e.id;return(0,r.jsxs)("div",{className:"card",style:{cursor:"pointer"},onClick:()=>{var t;return t=e.id,void p(e=>e===t?null:t)},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,r.jsxs)("div",{style:{flex:1},children:[(0,r.jsx)("div",{style:{fontSize:14,fontWeight:600,marginBottom:4},children:e.store_name||e.loja||"Pedido"}),(0,r.jsx)("div",{style:{fontSize:12,color:"var(--color-text-secondary)",marginBottom:6},children:function(e){if(!e)return"--";try{return new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return e}}(e.completed_at||e.data||e.created_at)}),(0,r.jsx)("div",{className:"stars",style:{marginBottom:4},children:function(e){let t=[],n=e||0;for(let e=1;e<=5;e++)t.push((0,r.jsx)("span",{className:"star ".concat(e<=n?"filled":""),children:e<=n?"★":"☆"},e));return t}(e.rating||e.avaliacao)})]}),(0,r.jsxs)("div",{style:{textAlign:"right"},children:[(0,r.jsxs)("div",{style:{fontSize:15,fontWeight:700,color:"var(--color-primary-dark)"},children:["R$ ",(e.earned||e.ganho||e.valor_shopper||0).toFixed(2).replace(".",",")]}),(0,r.jsxs)("div",{style:{fontSize:12,color:"var(--color-text-secondary)"},children:[e.items_count||e.qtd_itens||"?"," itens"]}),(0,r.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"var(--color-text-muted)",strokeWidth:"2",style:{marginTop:8,transform:t?"rotate(180deg)":"rotate(0)",transition:"transform 0.2s"},children:(0,r.jsx)("polyline",{points:"6 9 12 15 18 9"})})]})]}),t&&(0,r.jsx)("div",{style:{marginTop:12,paddingTop:12,borderTop:"1px solid var(--color-border)",animation:"fadeIn 0.2s ease"},children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13},children:[(0,r.jsx)("span",{style:{color:"var(--color-text-secondary)"},children:"Pedido"}),(0,r.jsxs)("span",{style:{fontWeight:500},children:["#",e.id]})]}),e.customer_name&&(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13},children:[(0,r.jsx)("span",{style:{color:"var(--color-text-secondary)"},children:"Cliente"}),(0,r.jsx)("span",{style:{fontWeight:500},children:e.customer_name})]}),e.distance&&(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13},children:[(0,r.jsx)("span",{style:{color:"var(--color-text-secondary)"},children:"Distancia"}),(0,r.jsxs)("span",{style:{fontWeight:500},children:[e.distance," km"]})]}),e.delivery_time&&(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13},children:[(0,r.jsx)("span",{style:{color:"var(--color-text-secondary)"},children:"Tempo de entrega"}),(0,r.jsxs)("span",{style:{fontWeight:500},children:[e.delivery_time," min"]})]}),(e.tip||e.gorjeta)>0&&(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13},children:[(0,r.jsx)("span",{style:{color:"var(--color-text-secondary)"},children:"Gorjeta"}),(0,r.jsxs)("span",{style:{fontWeight:500,color:"var(--color-primary-dark)"},children:["R$ ",(e.tip||e.gorjeta||0).toFixed(2).replace(".",",")]})]}),e.rating_comment&&(0,r.jsxs)("div",{style:{marginTop:4,padding:"8px 12px",background:"var(--color-bg-page)",borderRadius:"var(--radius-sm)",fontSize:13,color:"var(--color-text-secondary)",fontStyle:"italic"},children:["“",e.rating_comment,"”"]}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13},children:[(0,r.jsx)("span",{style:{color:"var(--color-text-secondary)"},children:"Status"}),(0,r.jsx)("span",{className:"badge badge-success",style:{fontSize:11},children:"concluido"===e.status||"completed"===e.status?"Concluido":e.status||"Concluido"})]})]})})]},e.id)}),u&&(0,r.jsx)("button",{className:"btn btn-outline",onClick:function(){let e=c+1;d(e),x(e,!0)},disabled:a,style:{marginTop:8},children:a?"Carregando...":"Carregar Mais"})]})]})}function c(){return(0,r.jsxs)(i.Z,{children:[(0,r.jsx)(l,{}),(0,r.jsx)(a.Z,{})]})}}},function(e){e.O(0,[448,971,117,744],function(){return e(e.s=7887)}),_N_E=e.O()}]);