(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[550],{3789:function(e,t,n){Promise.resolve().then(n.bind(n,6814))},6428:function(e,t,n){"use strict";n.d(t,{B9:function(){return u},LP:function(){return r},SC:function(){return i},o4:function(){return l},pE:function(){return d},sg:function(){return c}});let a="/api/mercado/shopper",o="shopper_token";function r(){try{return localStorage.getItem(o)}catch(e){return null}}function l(e){try{e?localStorage.setItem(o,e):localStorage.removeItem(o)}catch(e){}}function s(){let e=r();return e?{Authorization:"Bearer ".concat(e)}:{}}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),o=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");o&&(n+="?".concat(o));let r=await fetch(n,{credentials:"include",headers:s()});if(!r.ok){let e=await r.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(r.status," ").concat(r.statusText))}let l=await r.json();if(!l.success)throw Error(l.message||"Erro desconhecido na API");return l.data}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...s()},body:JSON.stringify(t)}),o=await n.json().catch(()=>null);if(!n.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(n.status));return o.data}async function u(e,t){let n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:s(),body:t}),o=await n.json().catch(()=>null);if(!n.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(n.status));return o.data}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...s()},body:JSON.stringify(t)}),o=await n.json().catch(()=>null);if(!n.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(n.status));return o.data}},8779:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var a=n(7437),o=n(2265),r=n(9376),l=n(7128);function s(e){let{children:t}=e,{isAuthenticated:n,loading:s}=(0,l.a)(),i=(0,r.useRouter)();return((0,o.useEffect)(()=>{if(!s&&!n){let e=window.location.pathname;i.push("/login?return=".concat(encodeURIComponent(e)))}},[s,n,i]),s)?(0,a.jsxs)("div",{className:"loading-screen",children:[(0,a.jsx)("div",{className:"spinner"}),(0,a.jsx)("p",{className:"loading-text",children:"Carregando..."})]}):n?t:null}},2277:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var a=n(7437),o=n(9376),r=n(7648),l=n(6971);let s=[{href:"/",label:"Home",icon:(0,a.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),(0,a.jsx)("polyline",{points:"9 22 9 12 15 12 15 22"})]})},{href:"/pedidos",label:"Pedidos",icon:(0,a.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,a.jsx)("polyline",{points:"14 2 14 8 20 8"}),(0,a.jsx)("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),(0,a.jsx)("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]})},{href:"/ganhos",label:"Ganhos",icon:(0,a.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),(0,a.jsx)("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]})},{href:"/chat",label:"Chat",icon:(0,a.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,a.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})},{href:"/perfil",label:"Perfil",icon:(0,a.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),(0,a.jsx)("circle",{cx:"12",cy:"7",r:"4"})]})}];function i(){let e=(0,o.usePathname)(),{unreadCount:t}=(0,l.l)();return(0,a.jsx)("nav",{className:"bottom-nav",children:s.map(n=>{var o;return(0,a.jsxs)(r.default,{href:n.href,className:"bottom-nav-item ".concat(("/"===(o=n.href)?"/"===e||""===e:e.startsWith(o))?"active":""),children:[(0,a.jsxs)("span",{className:"bottom-nav-icon",children:[n.icon,"/"===n.href&&t>0&&(0,a.jsx)("span",{className:"bottom-nav-badge",children:t>99?"99+":t})]}),(0,a.jsx)("span",{className:"bottom-nav-label",children:n.label})]},n.href)})})}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return s},a:function(){return i}});var a=n(7437),o=n(2265),r=n(6428);let l=(0,o.createContext)(null);function s(e){let{children:t}=e,[n,s]=(0,o.useState)(null),[i,c]=(0,o.useState)(!0),u=(0,o.useCallback)(async()=>{if(!(0,r.LP)()){s(null),c(!1);return}try{let e=await (0,r.SC)("/auth/session.php");e.authenticated&&e.shopper?s(e.shopper):((0,r.o4)(null),s(null))}catch(e){(0,r.o4)(null),s(null)}finally{c(!1)}},[]);(0,o.useEffect)(()=>{u()},[u]);let d=(0,o.useCallback)(async(e,t)=>{let n=await (0,r.sg)("/auth/login.php",{email:e,senha:t});(0,r.o4)(n.token);let a=n.shopper||{id:n.shopper_id,nome:n.nome,email:n.email,telefone:n.telefone,foto:n.foto,saldo:n.saldo,status:n.status};return s(a),a},[]),h=(0,o.useCallback)(()=>{(0,r.o4)(null),s(null)},[]);return(0,a.jsx)(l.Provider,{value:{shopper:n,loading:i,isAuthenticated:!!n,login:d,logout:h,refreshSession:u},children:t})}function i(){let e=(0,o.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},6971:function(e,t,n){"use strict";n.d(t,{J:function(){return c},l:function(){return u}});var a=n(7437),o=n(2265),r=n(7128),l=n(6428);let s=(0,o.createContext)(null),i=0;function c(e){let{children:t}=e,[n,c]=(0,o.useState)([]),[u,d]=(0,o.useState)(0),h=(0,o.useRef)(0),f=(0,o.useRef)({}),{isAuthenticated:m}=(0,r.a)(),p=(0,o.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3,a=++i;return c(n=>[...n,{id:a,message:e,type:t}]),n>0&&(f.current[a]=setTimeout(()=>{c(e=>e.filter(e=>e.id!==a)),delete f.current[a]},n)),a},[]),x=(0,o.useCallback)(e=>{c(t=>t.filter(t=>t.id!==e)),f.current[e]&&(clearTimeout(f.current[e]),delete f.current[e])},[]),v=(0,o.useCallback)(e=>p(e,"success"),[p]),j=(0,o.useCallback)(e=>p(e,"error"),[p]),g=(0,o.useCallback)(e=>p(e,"warning"),[p]),y=(0,o.useCallback)(e=>p(e,"info"),[p]);return(0,o.useEffect)(()=>{if(!m){d(0),h.current=0;return}let e=!1;async function t(){try{var t,n;let a=(0,l.LP)();if(!a)return;let o=await fetch("/api/mercado/notifications/list.php?unread=1",{credentials:"include",headers:{Authorization:"Bearer ".concat(a)}});if(!o.ok)return;let r=await o.json();if(!r.success)return;let s=null!==(n=null===(t=r.data)||void 0===t?void 0:t.unread_count)&&void 0!==n?n:0;e||(d(s),s>h.current&&p("Nova notificacao","info"),h.current=s)}catch(e){}}t();let n=setInterval(t,3e4);return()=>{e=!0,clearInterval(n)}},[m,p]),(0,o.useEffect)(()=>()=>{Object.values(f.current).forEach(e=>clearTimeout(e))},[]),(0,a.jsxs)(s.Provider,{value:{notifications:n,addNotification:p,removeNotification:x,success:v,error:j,warning:g,info:y,unreadCount:u},children:[t,n.length>0&&(0,a.jsx)("div",{className:"toast-container",children:n.map(e=>(0,a.jsxs)("div",{className:"toast toast-".concat(e.type),onClick:()=>x(e.id),children:[(0,a.jsxs)("span",{className:"toast-icon",children:["success"===e.type&&"✓","error"===e.type&&"✗","warning"===e.type&&"⚠","info"===e.type&&"ℹ"]}),(0,a.jsx)("span",{className:"toast-message",children:e.message})]},e.id))})]})}function u(){let e=(0,o.useContext)(s);if(!e)throw Error("useNotification must be used within NotificationProvider");return e}},6814:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var a=n(7437),o=n(2265),r=n(9376),l=n(6428),s=n(7128),i=n(6971),c=n(8779),u=n(2277);function d(){let e=(0,r.useRouter)(),{shopper:t,logout:n}=(0,s.a)(),{success:c,error:u}=(0,i.l)(),[d,h]=(0,o.useState)(!0),[f,m]=(0,o.useState)(!1),[p,x]=(0,o.useState)(null),[v,j]=(0,o.useState)({nome:"",telefone:"",foto_url:"",pix_key:"",bank_name:"",bank_agency:"",bank_account:""});function g(e,t){j(n=>({...n,[e]:t}))}async function y(){if(!v.nome.trim()){u("Nome e obrigatorio");return}m(!0);try{await (0,l.pE)("/perfil.php",v),c("Perfil atualizado com sucesso!")}catch(e){u("Erro ao salvar: "+e.message)}finally{m(!1)}}return((0,o.useEffect)(()=>{(async function(){try{let e=await (0,l.SC)("/perfil.php");x(e),j({nome:e.nome||"",telefone:e.telefone||"",foto_url:e.foto_url||"",pix_key:e.pix_key||"",bank_name:e.bank_name||"",bank_agency:e.bank_agency||"",bank_account:e.bank_account||""})}catch(e){console.error("Load profile error:",e)}finally{h(!1)}})()},[]),d)?(0,a.jsxs)("div",{className:"page",children:[(0,a.jsx)("div",{className:"page-header",children:(0,a.jsx)("h1",{children:"Perfil"})}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12,marginBottom:24},children:[(0,a.jsx)("div",{className:"skeleton skeleton-circle",style:{width:80,height:80}}),(0,a.jsx)("div",{className:"skeleton skeleton-line",style:{width:150}})]}),(0,a.jsx)("div",{className:"skeleton-card"}),(0,a.jsx)("div",{className:"skeleton-card"})]}):(0,a.jsxs)("div",{className:"page",children:[(0,a.jsx)("div",{className:"page-header",children:(0,a.jsx)("h1",{children:"Perfil"})}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:24},children:[(0,a.jsx)("div",{style:{width:80,height:80,borderRadius:"50%",background:"var(--color-primary)",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",marginBottom:12,boxShadow:"var(--shadow-md)"},children:v.foto_url?(0,a.jsx)("img",{src:v.foto_url,alt:"Foto",style:{width:"100%",height:"100%",objectFit:"cover"},onError:e=>{e.target.style.display="none"}}):(0,a.jsxs)("svg",{width:"36",height:"36",viewBox:"0 0 24 24",fill:"none",stroke:"#1a1a2e",strokeWidth:"2",children:[(0,a.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),(0,a.jsx)("circle",{cx:"12",cy:"7",r:"4"})]})}),(0,a.jsx)("div",{style:{fontSize:18,fontWeight:700},children:(null==p?void 0:p.nome)||(null==t?void 0:t.nome)||"Shopper"}),(0,a.jsx)("div",{style:{fontSize:13,color:"var(--color-text-secondary)"},children:(null==p?void 0:p.email)||(null==t?void 0:t.email)||""})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"card-title",style:{marginBottom:16},children:"Dados Pessoais"}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{className:"form-label",children:"Nome Completo"}),(0,a.jsx)("input",{type:"text",className:"form-input",value:v.nome,onChange:e=>g("nome",e.target.value),placeholder:"Seu nome completo"})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{className:"form-label",children:"Telefone"}),(0,a.jsx)("input",{type:"tel",className:"form-input",value:v.telefone,onChange:e=>g("telefone",e.target.value),placeholder:"(11) 99999-9999"})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{className:"form-label",children:"URL da Foto"}),(0,a.jsx)("input",{type:"url",className:"form-input",value:v.foto_url,onChange:e=>g("foto_url",e.target.value),placeholder:"https://exemplo.com/foto.jpg"})]})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"card-title",style:{marginBottom:16},children:"Dados Bancarios"}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{className:"form-label",children:"Chave PIX"}),(0,a.jsx)("input",{type:"text",className:"form-input",value:v.pix_key,onChange:e=>g("pix_key",e.target.value),placeholder:"CPF, email, telefone ou chave aleatoria"})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{className:"form-label",children:"Banco"}),(0,a.jsx)("input",{type:"text",className:"form-input",value:v.bank_name,onChange:e=>g("bank_name",e.target.value),placeholder:"Nome do banco"})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,a.jsxs)("div",{className:"form-group",style:{flex:1},children:[(0,a.jsx)("label",{className:"form-label",children:"Agencia"}),(0,a.jsx)("input",{type:"text",className:"form-input",value:v.bank_agency,onChange:e=>g("bank_agency",e.target.value),placeholder:"0001"})]}),(0,a.jsxs)("div",{className:"form-group",style:{flex:1},children:[(0,a.jsx)("label",{className:"form-label",children:"Conta"}),(0,a.jsx)("input",{type:"text",className:"form-input",value:v.bank_account,onChange:e=>g("bank_account",e.target.value),placeholder:"12345-6"})]})]})]}),(0,a.jsx)("button",{className:"btn btn-primary",onClick:y,disabled:f,style:{marginBottom:12},children:f?"Salvando...":"Salvar Alteracoes"}),(0,a.jsx)("button",{className:"btn btn-danger",onClick:function(){n(),e.push("/login")},style:{marginBottom:16},children:"Sair da Conta"}),(0,a.jsx)("div",{style:{textAlign:"center",padding:16,color:"var(--color-text-muted)",fontSize:12},children:"SuperBora Shopper v1.0.0"})]})}function h(){return(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(d,{}),(0,a.jsx)(u.Z,{})]})}}},function(e){e.O(0,[448,971,117,744],function(){return e(e.s=3789)}),_N_E=e.O()}]);