"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9938],{6428:function(e,t,r){r.d(t,{LP:function(){return o},QW:function(){return f},SC:function(){return u},o4:function(){return l},pE:function(){return d},sg:function(){return c}}),r(257);let n="/api/mercado",a="superbora_token";function s(){return window.location.origin}function o(){try{return localStorage.getItem(a)}catch(e){return null}}function l(e){try{e?localStorage.setItem(a,e):localStorage.removeItem(a)}catch(e){}}function i(){let e=o();return e?{Authorization:"Bearer ".concat(e)}:{}}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{signal:a}=r,o=new URL(n+e,s());Object.entries(t).forEach(e=>{let[t,r]=e;null!=r&&""!==r&&o.searchParams.set(t,r)});let l=await fetch(o.toString(),{credentials:"include",headers:i(),signal:a});if(!l.ok){let e=await l.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(l.status))}let u=await l.json().catch(()=>null);if(!u||!u.success)throw Error((null==u?void 0:u.message)||"Erro desconhecido na API");return void 0!==u.data?u.data:null}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{signal:a}=r,o=new URL(n+e,s()),l=await fetch(o.toString(),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...i()},body:JSON.stringify(t),signal:a}),u=await l.json().catch(()=>null);if(!l.ok||!(null==u?void 0:u.success))throw Error((null==u?void 0:u.message)||"API error: ".concat(l.status));return void 0!==u.data?u.data:null}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{signal:a}=r,o=new URL(n+e,s()),l=await fetch(o.toString(),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...i()},body:JSON.stringify(t),signal:a}),u=await l.json().catch(()=>null);if(!l.ok||!(null==u?void 0:u.success))throw Error((null==u?void 0:u.message)||"API error: ".concat(l.status));return void 0!==u.data?u.data:null}async function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{signal:a}=r,o=new URL(n+e,s());Object.entries(t).forEach(e=>{let[t,r]=e;null!=r&&""!==r&&o.searchParams.set(t,r)});let l=await fetch(o.toString(),{method:"DELETE",credentials:"include",headers:i(),signal:a}),u=await l.json().catch(()=>null);if(!l.ok||!(null==u?void 0:u.success))throw Error((null==u?void 0:u.message)||"API error: ".concat(l.status));return void 0!==u.data?u.data:null}},7128:function(e,t,r){r.d(t,{H:function(){return l},a:function(){return i}});var n=r(7437),a=r(2265),s=r(6428);let o=(0,a.createContext)(null);function l(e){let{children:t}=e,[r,l]=(0,a.useState)(null),[i,u]=(0,a.useState)(!0),c=(0,a.useRef)(!0);(0,a.useEffect)(()=>(c.current=!0,()=>{c.current=!1}),[]);let d=(0,a.useCallback)(async()=>{if(!(0,s.LP)()){c.current&&(l(null),u(!1));return}try{let e=await (0,s.SC)("/auth/session.php");if(!c.current)return;e.authenticated&&e.customer?l(e.customer):((0,s.o4)(null),l(null))}catch(e){if(!c.current)return;"AbortError"!==e.name&&console.warn("[Auth] Session check failed"),(0,s.o4)(null),l(null)}finally{c.current&&u(!1)}},[]);(0,a.useEffect)(()=>{d()},[d]);let f=(0,a.useCallback)(async(e,t)=>{try{let r=await (0,s.sg)("/auth/login.php",{email:e,senha:t});if(!c.current)return null;return(0,s.o4)(r.token),l(r.customer),r.customer}catch(e){throw console.warn("[AuthContext] Login failed:",e.message),e}},[]),h=(0,a.useCallback)(async e=>{try{let t=await (0,s.sg)("/auth/register.php",e);if(!c.current)return null;return(0,s.o4)(t.token),l(t.customer),t.customer}catch(e){throw console.warn("[AuthContext] Register failed:",e.message),e}},[]),m=(0,a.useCallback)(async e=>{try{let t=await (0,s.sg)("/auth/google.php",{credential:e});if(!c.current)return null;return(0,s.o4)(t.token),l(t.customer),t}catch(e){throw console.warn("[AuthContext] Google login failed:",e.message),e}},[]),p=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"whatsapp";try{let r={channel:t};return"email"===t?r.email=e:r.phone=e,await (0,s.sg)("/auth/send-code.php",r)}catch(e){throw console.warn("[AuthContext] Send OTP failed:",e.message),e}},[]),g=(0,a.useCallback)(async(e,t,r)=>{try{let n={phone:e,code:t};r&&(n.name=r);let a=await (0,s.sg)("/auth/verify-code.php",n);if(!c.current)return null;return(0,s.o4)(a.token),l(a.customer),a}catch(e){throw console.warn("[AuthContext] Verify OTP failed:",e.message),e}},[]),y=(0,a.useCallback)(()=>{(0,s.o4)(null),l(null)},[]),b=(0,a.useCallback)(e=>{l(t=>t?{...t,...e}:t)},[]),C=(0,a.useMemo)(()=>({customer:r,loading:i,isAuthenticated:!!r,login:f,loginWithGoogle:m,register:h,sendOtp:p,verifyOtp:g,logout:y,updateCustomer:b,refreshSession:d}),[r,i,f,m,h,p,g,y,b,d]);return(0,n.jsx)(o.Provider,{value:C,children:t})}function i(){let e=(0,a.useContext)(o);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},9146:function(e,t,r){r.d(t,{Zl:function(){return d},iQ:function(){return h}});var n=r(7437),a=r(2265),s=r(6428),o=r(4609);let l=(0,a.createContext)(null),i=(0,a.createContext)(null),u="superbora_cart";function c(e,t){let r;switch(t.type){case"ADD_ITEM":{let n;let{product:a,partnerId:s,partnerName:o}=t.payload,l=String(s),i=e.stores[l]||{partnerName:o,items:[]},u=a.selectedOptions&&a.selectedOptions.length>0?a.selectedOptions.map(e=>e.id).sort().join(","):"",c=a.cartKey||"".concat(a.id,":").concat(u),d=i.items.findIndex(e=>(e.cartKey||String(e.id))===c);n=d>=0?i.items.map((e,t)=>t===d?{...e,quantity:e.quantity+1}:e):[...i.items,{...a,cartKey:c,quantity:1}],r={stores:{...e.stores,[l]:{partnerName:o,items:n}}};break}case"REMOVE_ITEM":{let n;let{productId:a,partnerId:s}=t.payload,o={...e.stores},l=s?String(s):Object.keys(o).find(e=>o[e].items.some(e=>e.id===a));if(!l||!o[l])return e;let i=o[l],u=i.items.findIndex(e=>e.id===a);if(u<0)return e;0===(n=i.items[u].quantity>1?i.items.map((e,t)=>t===u?{...e,quantity:e.quantity-1}:e):i.items.filter((e,t)=>t!==u)).length?delete o[l]:o[l]={...i,items:n},r={stores:o};break}case"SET_ITEM_QTY":{let{productId:n,quantity:a,partnerId:s}=t.payload,o={...e.stores},l=s?String(s):Object.keys(o).find(e=>o[e].items.some(e=>e.id===n));if(!l||!o[l])return e;let i=o[l];if(a<=0){let e=i.items.filter(e=>e.id!==n);0===e.length?delete o[l]:o[l]={...i,items:e}}else{let e=i.items.map(e=>e.id===n?{...e,quantity:a}:e);o[l]={...i,items:e}}r={stores:o};break}case"SET_ITEM_NOTE":{let{productId:n,notes:a,partnerId:s}=t.payload,o={...e.stores},l=s?String(s):Object.keys(o).find(e=>o[e].items.some(e=>e.id===n));if(!l||!o[l])return e;let i=o[l],u=i.items.map(e=>e.id===n?{...e,notes:a}:e);o[l]={...i,items:u},r={stores:o};break}case"CLEAR_STORE":{let{partnerId:n}=t.payload,a={...e.stores};delete a[String(n)],r={stores:a};break}case"CLEAR":r={stores:{}};break;case"HYDRATE":return t.payload;default:return e}return!function(e){try{localStorage.setItem(u,JSON.stringify(e))}catch(e){console.warn("[Cart] Failed to save cart:",e.message)}}(r),r}function d(e){var t;let{children:r}=e,[d,h]=(0,a.useReducer)(c,{stores:{}}),m=(0,a.useRef)(null),[p,g]=(0,a.useState)([]),[y,b]=(0,a.useState)(!1),[C,v]=(0,a.useState)({type:null,count:0}),w=(0,a.useRef)(null),k=(0,a.useRef)(0),E=(0,a.useRef)(new Map),S=(0,a.useRef)(!0),T=(0,a.useRef)(null);(0,a.useEffect)(()=>{h({type:"HYDRATE",payload:function(){try{let e=localStorage.getItem(u);if(e){let t=JSON.parse(e);if(t.items&&!t.stores){if(t.items.length>0&&t.partnerId)return{stores:{[t.partnerId]:{partnerName:t.partnerName||"",items:t.items}}};return{stores:{}}}return t}}catch(e){console.warn("[Cart] Failed to load cart from storage:",e.message)}return{stores:{}}}()})},[]),(0,a.useEffect)(()=>{let e=Object.keys(d.stores);if(0===e.length||!(0,s.LP)())return;let t=new AbortController;return m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{e.forEach(e=>{let r=d.stores[e];r&&r.items&&(0,s.sg)("/cart/sync.php",{items:r.items,partner_id:parseInt(e)},{signal:t.signal}).catch(t=>{"AbortError"!==t.name&&console.warn("[Cart] Sync failed for store",e,t)})})},2e3),()=>{m.current&&clearTimeout(m.current),t.abort()}},[d.stores]);let x=(0,a.useCallback)(()=>{b(!0),T.current&&clearTimeout(T.current),T.current=setTimeout(()=>{S.current&&b(!1)},400)},[]),A=(0,a.useCallback)(e=>{var t;let r=++k.current,n=null===(t=w.current)||void 0===t?void 0:t.getBoundingClientRect(),a=n?n.left+n.width/2:window.innerWidth-60,s=n?n.top+n.height/2:window.innerHeight-40,o={id:r,...e,targetX:a,targetY:s};g(e=>[...e,o]);let l=setTimeout(()=>{S.current&&(g(e=>e.filter(e=>e.id!==r)),E.current.delete(r),x())},600);return E.current.set(r,l),r},[x]);(0,a.useEffect)(()=>{S.current=!0;let e=E.current;return()=>{S.current=!1,T.current&&clearTimeout(T.current),e.forEach(e=>clearTimeout(e)),e.clear()}},[]);let j=(0,a.useCallback)(e=>{w.current=e},[]),O=(0,a.useCallback)((e,t)=>{if(!t)return;let r=t.getBoundingClientRect();A({image:e.imagem_url||e.image,name:e.nome||e.name,startX:r.left+r.width/2,startY:r.top+r.height/2})},[A]),I=(0,a.useCallback)((e,t,r,n)=>{h({type:"ADD_ITEM",payload:{product:e,partnerId:t,partnerName:r}}),v({type:"add",count:1,timestamp:Date.now()}),(0,o.q8)("addToCart"),n?O(e,n):x()},[O,x]),R=(0,a.useCallback)((e,t)=>{h({type:"REMOVE_ITEM",payload:{productId:e,partnerId:t}}),v({type:"remove",count:-1,timestamp:Date.now()}),(0,o.q8)("light")},[]),_=(0,a.useCallback)((e,t,r)=>{h({type:"SET_ITEM_QTY",payload:{productId:e,quantity:t,partnerId:r}})},[]),M=(0,a.useCallback)(()=>{h({type:"CLEAR"})},[]),P=(0,a.useCallback)(e=>{h({type:"CLEAR_STORE",payload:{partnerId:e}})},[]),q=(0,a.useCallback)((e,t,r)=>{h({type:"SET_ITEM_NOTE",payload:{productId:e,notes:t,partnerId:r}})},[]),N=(0,a.useCallback)(e=>{let t=e.preco;return e.preco_promo&&e.preco_promo>0&&e.preco_promo<e.preco&&(t=e.preco_promo),e.selectedOptions&&Array.isArray(e.selectedOptions)&&(t+=e.selectedOptions.reduce((e,t)=>e+(t.price_extra||0),0)),t},[]),L=(0,a.useMemo)(()=>Object.values(d.stores).flatMap(e=>e.items),[d.stores]),D=(0,a.useMemo)(()=>L.reduce((e,t)=>e+N(t)*t.quantity,0),[L,N]),Y=(0,a.useMemo)(()=>L.reduce((e,t)=>e+t.quantity,0),[L]),H=(0,a.useMemo)(()=>Object.keys(d.stores).length,[d.stores]),U=(0,a.useCallback)((e,t)=>{for(let r of Object.values(d.stores))if(t){let e=r.items.find(e=>e.cartKey===t);if(e)return e.quantity}else{let t=r.items.filter(t=>t.id===e).reduce((e,t)=>e+t.quantity,0);if(t>0)return t}return 0},[d.stores]),z=(0,a.useCallback)(e=>{let t=d.stores[String(e)];return t?t.items.reduce((e,t)=>e+N(t)*t.quantity,0):0},[d.stores,N]),B=(0,a.useCallback)(e=>{let t=d.stores[String(e)];return t?t.items.reduce((e,t)=>e+t.quantity,0):0},[d.stores]),F=Object.keys(d.stores)[0],J=F?parseInt(F,10):NaN,Q=1!==H||isNaN(J)?null:J,X=1===H&&F?null===(t=d.stores[F])||void 0===t?void 0:t.partnerName:"",K=(0,a.useMemo)(()=>({flyingItems:p,cartBounce:y,lastChange:C,flyToCart:O,triggerCartBounce:x,setCartIconRef:j}),[p,y,C,O,x,j]),V=(0,a.useMemo)(()=>({stores:d.stores,items:L,partnerId:Q,partnerName:X,subtotal:D,count:Y,storeCount:H,addItem:I,removeItem:R,setItemQty:_,updateItemNote:q,clearCart:M,clearStore:P,getItemQuantity:U,getItemPrice:N,getStoreSubtotal:z,getStoreCount:B,flyToCart:O,triggerCartBounce:x,setCartIconRef:j}),[d.stores,L,Q,X,D,Y,H,I,R,_,q,M,P,U,N,z,B,O,x,j]);return(0,n.jsx)(l.Provider,{value:V,children:(0,n.jsxs)(i.Provider,{value:K,children:[r,p.length>0&&(0,n.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:2e3,overflow:"hidden"},"aria-hidden":"true",children:p.map(e=>(0,n.jsx)(f,{item:e},e.id))})]})})}function f(e){let{item:t}=e,[r,s]=(0,a.useState)("start");(0,a.useEffect)(()=>{requestAnimationFrame(()=>{s("flying")})},[]);let o={position:"fixed",width:60,height:60,borderRadius:"50%",background:"var(--color-card)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.15), 0 0 30px rgba(0, 168, 104, 0.3)",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",zIndex:1e4,pointerEvents:"none",willChange:"transform, left, top, opacity"},l={...o,left:t.startX,top:t.startY,transform:"translate(-50%, -50%) scale(1)",opacity:1,transition:"none"},i={...o,left:t.targetX,top:t.targetY,transform:"translate(-50%, -50%) scale(0.2)",opacity:.8,transition:"all 500ms cubic-bezier(0.25, 0.46, 0.45, 0.94)"};return(0,n.jsx)("div",{style:"start"===r?l:i,children:t.image?(0,n.jsx)("img",{src:t.image,alt:t.name||"Produto adicionado ao carrinho",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"50%"}}):(0,n.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"var(--color-accent)",strokeWidth:"2",children:[(0,n.jsx)("circle",{cx:"9",cy:"21",r:"1"}),(0,n.jsx)("circle",{cx:"20",cy:"21",r:"1"}),(0,n.jsx)("path",{d:"M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"})]})})}function h(){let e=(0,a.useContext)(l);if(!e)throw Error("useCartContext must be used within CartProvider");return e}},4609:function(e,t,r){r.d(t,{Cv:function(){return o},q8:function(){return l}});var n=r(2265);let a={light:[10],medium:[20],heavy:[30],double:[10,50,10],success:[10,30,15,30,20],error:[30,50,30],warning:[15,50,15,50,15],selection:[5],impact:[40],notification:[20,100,20,100,40],pullTrigger:[15,20,25],addToCart:[10,40,15],remove:[20,30,10],orderConfirmed:[15,50,15,50,30,100,50]};function s(){return"undefined"!=typeof navigator&&"vibrate"in navigator}function o(){let e=(0,n.useCallback)(e=>{if(s())try{let t=Array.isArray(e)?e:[e];navigator.vibrate(t)}catch(e){}},[]),t=(0,n.useCallback)(()=>{if(s())try{navigator.vibrate(0)}catch(e){}},[]),r=(0,n.useCallback)(()=>e(a.light),[e]),o=(0,n.useCallback)(()=>e(a.medium),[e]),l=(0,n.useCallback)(()=>e(a.heavy),[e]),i=(0,n.useCallback)(()=>e(a.double),[e]),u=(0,n.useCallback)(()=>e(a.success),[e]),c=(0,n.useCallback)(()=>e(a.error),[e]),d=(0,n.useCallback)(()=>e(a.warning),[e]),f=(0,n.useCallback)(()=>e(a.selection),[e]),h=(0,n.useCallback)(()=>e(a.impact),[e]),m=(0,n.useCallback)(()=>e(a.notification),[e]),p=(0,n.useCallback)(()=>e(a.pullTrigger),[e]),g=(0,n.useCallback)(()=>e(a.addToCart),[e]),y=(0,n.useCallback)(()=>e(a.remove),[e]),b=(0,n.useCallback)(()=>e(a.orderConfirmed),[e]);return{haptic:e,cancel:t,isSupported:(0,n.useMemo)(()=>s(),[]),light:r,medium:o,heavy:l,double:i,success:u,error:c,warning:d,selection:f,impact:h,notification:m,pullTrigger:p,addToCart:g,remove:y,orderConfirmed:b,patterns:a}}function l(e){if(s())try{let t="string"==typeof e?a[e]||a.light:Array.isArray(e)?e:[e];navigator.vibrate(t)}catch(e){}}}}]);