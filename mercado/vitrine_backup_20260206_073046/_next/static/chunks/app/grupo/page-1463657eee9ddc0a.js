(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6652],{8130:function(e,a,t){Promise.resolve().then(t.bind(t,4921))},4921:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return u}});var i=t(7437),r=t(2265),s=t(9376),n=t(7648),o=t(6428),c=t(7650),l=t(7122),d=t(5600),p=t(7128),_=t(9859),m=t.n(_);function h(){let e=(0,s.useSearchParams)(),a=(0,s.useRouter)(),t=e.get("code"),{customer:_}=(0,p.a)(),[h,u]=(0,r.useState)(!1),[g,x]=(0,r.useState)(""),[j,v]=(0,r.useState)(null),[N,f]=(0,r.useState)(null),[b,y]=(0,r.useState)(!1),[w,k]=(0,r.useState)([]),[C,B]=(0,r.useState)(!0),[S,I]=(0,r.useState)(""),[E,A]=(0,r.useState)(null),[M,T]=(0,r.useState)("");(0,r.useEffect)(()=>{T(window.location.origin)},[]);let L=(0,r.useCallback)(async()=>{if(t){if(!_&&!g.trim()){I("Informe seu nome para participar");return}u(!0),I("");try{let e=await (0,o.sg)("/group-order/join.php",{share_code:t,customer_name:g.trim()});f(e.participant_id),y(e.is_creator),await R(),await W(e.partner_id)}catch(e){I(e.message)}finally{u(!1),B(!1)}}},[t,_,g,R,W]);(0,r.useEffect)(()=>{t&&_?L():t&&!_&&B(!1)},[t,_,L]);let R=(0,r.useCallback)(async()=>{if(t)try{let e=await (0,o.SC)("/group-order/status.php",{code:t});v(e)}catch(e){I(e.message)}},[t]);(0,r.useEffect)(()=>{if(!j||"active"!==j.status)return;let e=!0,a=setInterval(()=>{e&&R()},1e4);return()=>{e=!1,clearInterval(a)}},[j,R]);let W=(0,r.useCallback)(async e=>{try{var a;let t=await (0,o.SC)("/parceiros/mini-loja.php",{id:e});k((null===(a=t.produtos)||void 0===a?void 0:a.items)||t.products||[])}catch(e){"AbortError"!==e.name&&console.warn("[Group] Failed to load products"),k([])}},[]),z=(0,r.useCallback)(async e=>{if(j&&N){I("");try{await (0,o.sg)("/group-order/items.php",{group_order_id:j.group_order_id,participant_id:N,product_id:e.id,product_name:e.nome||e.name,quantity:1,price:e.preco_promo>0?e.preco_promo:e.preco,notes:""}),await R()}catch(e){I(e.message)}}},[j,N,R]),G=(0,r.useCallback)(async e=>{try{await (0,o.QW)("/group-order/items.php",{item_id:e,participant_id:N}),await R()}catch(e){I(e.message)}},[N,R]),P=(0,r.useCallback)(()=>{if(!j)return;let e=j.items.map(e=>({id:e.product_id,nome:e.product_name,preco:e.price,preco_promo:0,quantity:e.quantity,notes:e.notes||""}));try{localStorage.setItem("superbora_group_checkout",JSON.stringify({partner_id:j.partner.id,partner_name:j.partner.nome,items:e,group_order_id:j.group_order_id}))}catch(e){console.warn("[GroupOrder] Failed to save checkout data")}a.push("/carrinho")},[j,a]),F=(0,r.useCallback)(()=>{if(!j||!M)return;let e=M+"/mercado/vitrine/grupo/?code="+j.share_code;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).catch(()=>{O(e)}):O(e)},[j,M]);function O(e){try{let a=document.createElement("textarea");a.value=e,a.style.position="fixed",a.style.left="-9999px",document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a)}catch(e){console.warn("[GroupOrder] Fallback copy failed:",e.message)}}let H=(0,r.useCallback)(()=>{if(!j||!M)return;let e=M+"/mercado/vitrine/grupo/?code="+j.share_code,a="Vem fazer pedido comigo no ".concat(j.partner.nome,"! Acesse: ").concat(e);window.open("https://wa.me/?text=".concat(encodeURIComponent(a)),"_blank")},[j,M]);if(!t)return(0,i.jsxs)("div",{className:m().joinCard,children:[(0,i.jsx)("div",{className:m().joinTitle,children:"Pedido em Grupo"}),(0,i.jsx)("div",{className:m().joinSubtitle,children:"Voce precisa de um link de convite para participar."}),(0,i.jsx)(n.default,{href:"/",className:m().joinBtn,style:{display:"block",textDecoration:"none",textAlign:"center"},children:"Voltar ao inicio"})]});if(!j&&!C)return(0,i.jsx)("div",{className:m().page,children:(0,i.jsxs)("div",{className:m().joinCard,children:[(0,i.jsx)("div",{className:m().joinTitle,children:"Pedido em Grupo"}),(0,i.jsx)("div",{className:m().joinSubtitle,children:"Informe seu nome para participar"}),S&&(0,i.jsx)("div",{className:m().error,children:S}),(0,i.jsx)("input",{type:"text",value:g,onChange:e=>x(e.target.value),placeholder:"Seu nome",className:m().joinInput}),(0,i.jsx)("button",{className:m().joinBtn,onClick:L,disabled:h||!g.trim(),children:h?"Entrando...":"Entrar no pedido"})]})});if(C)return(0,i.jsx)("div",{className:m().page,children:(0,i.jsxs)("div",{className:m().loading,children:[(0,i.jsx)("div",{className:m().spinner}),"Carregando pedido em grupo..."]})});if(!j)return null;let V="expired"===j.status,q="active"===j.status,D=new Date(j.expires_at),J=new Date;return(0,i.jsxs)("div",{className:m().page,children:[(0,i.jsxs)("div",{className:m().header,children:[(0,i.jsx)("button",{className:m().backBtn,onClick:()=>a.push("/"),type:"button","aria-label":"Voltar",children:(0,i.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,i.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),(0,i.jsx)("div",{className:m().title,children:"Pedido em Grupo"}),(0,i.jsx)("span",{className:"".concat(m().badge," ").concat(V?m().badgeExpired:""),children:q?"Ativo":V?"Expirado":j.status})]}),S&&(0,i.jsx)("div",{className:m().error,children:S}),j.partner&&(0,i.jsxs)("div",{className:m().storeInfo,children:[j.partner.logo&&(0,i.jsx)("img",{src:j.partner.logo,alt:j.partner.nome||"Logo da loja",className:m().storeLogo}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:m().storeName,children:j.partner.nome}),(0,i.jsx)("div",{className:m().storeCategory,children:j.partner.categoria||"Estabelecimento"})]})]}),q&&(0,i.jsxs)("div",{className:m().timer,children:["Expira em ",Math.max(0,Math.round((D-J)/6e4))," minutos - Codigo: ",j.share_code]}),(0,i.jsxs)("div",{className:m().content,children:[(0,i.jsx)("div",{className:m().productsSection,children:q&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:m().sectionTitle,children:[(0,i.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,i.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Adicionar itens"]}),(0,i.jsx)("div",{className:m().productGrid,children:w.map(e=>(0,i.jsx)(l.I,{product:e,partnerId:j.partner.id,partnerName:j.partner.nome,storeOpen:!0,onAddOverride:()=>z(e)},e.id))}),0===w.length&&(0,i.jsx)("div",{className:m().emptyText,children:"Carregando produtos..."})]})}),(0,i.jsxs)("div",{className:m().sidebar,children:[(0,i.jsxs)("div",{className:m().card,children:[(0,i.jsxs)("div",{className:m().sectionTitle,children:[(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),(0,i.jsx)("circle",{cx:"9",cy:"7",r:"4"}),(0,i.jsx)("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),(0,i.jsx)("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),"Participantes (",j.participants.length,")"]}),(0,i.jsx)("div",{className:m().participantList,children:j.participants.map(e=>(0,i.jsxs)("div",{className:m().participant,children:[(0,i.jsx)("div",{className:m().participantAvatar,children:(e.name||"P").charAt(0).toUpperCase()}),(0,i.jsx)("div",{className:m().participantName,children:e.name}),e.is_creator&&(0,i.jsx)("span",{className:m().creatorBadge,children:"Organizador"})]},e.id))}),q&&(0,i.jsxs)("div",{className:m().shareSection,children:[(0,i.jsxs)("button",{className:m().shareBtn,onClick:F,children:[(0,i.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),(0,i.jsx)("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),"Copiar link"]}),(0,i.jsxs)("button",{className:"".concat(m().shareBtn," ").concat(m().shareBtnWa),onClick:H,children:[(0,i.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,i.jsx)("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"}),(0,i.jsx)("path",{d:"M12 0C5.373 0 0 5.373 0 12c0 2.625.846 5.059 2.284 7.034L.789 23.492l4.614-1.21A11.95 11.95 0 0 0 12 24c6.627 0 12-5.373 12-12S18.627 0 12 0zm0 21.75c-2.115 0-4.142-.67-5.835-1.935l-.419-.312-2.735.717.73-2.668-.343-.544A9.72 9.72 0 0 1 2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75z"})]}),"WhatsApp"]})]})]}),(0,i.jsxs)("div",{className:m().card,children:[(0,i.jsxs)("div",{className:m().sectionTitle,children:[(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("circle",{cx:"9",cy:"21",r:"1"}),(0,i.jsx)("circle",{cx:"20",cy:"21",r:"1"}),(0,i.jsx)("path",{d:"M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"})]}),"Itens (",j.item_count,")"]}),0===j.items.length?(0,i.jsx)("div",{className:m().emptyText,children:"Nenhum item adicionado ainda"}):(0,i.jsx)("div",{className:m().itemsList,children:j.items.map(e=>(0,i.jsxs)("div",{className:m().itemRow,children:[(0,i.jsxs)("div",{className:m().itemInfo,children:[(0,i.jsx)("div",{className:m().itemName,children:e.product_name}),(0,i.jsxs)("div",{className:m().itemMeta,children:[e.participant_name," - ",e.quantity,"x"]})]}),(0,i.jsx)("div",{className:m().itemPrice,children:(0,c.o_)(e.total)}),q&&e.participant_id===N&&(0,i.jsx)("button",{className:m().itemRemove,onClick:()=>G(e.id),title:"Remover",children:"\xd7"})]},e.id))}),(0,i.jsxs)("div",{className:m().totalRow,children:[(0,i.jsx)("span",{children:"Total"}),(0,i.jsx)("span",{children:(0,c.o_)(j.total)})]}),b&&q&&j.items.length>0&&(0,i.jsx)("button",{className:m().checkoutBtn,onClick:P,children:"Finalizar e ir para checkout"})]})]})]}),E&&(0,i.jsx)(d.B,{product:E,partnerId:j.partner.id,partnerName:j.partner.nome,onClose:()=>A(null)})]})}function u(){return(0,i.jsx)(r.Suspense,{fallback:(0,i.jsx)("div",{style:{padding:40,textAlign:"center",color:"#999"},children:"Carregando..."}),children:(0,i.jsx)(h,{})})}},9859:function(e){e.exports={page:"page_page__hMbxw",header:"page_header__L3GnM",backBtn:"page_backBtn__g_2vY",title:"page_title__En28K",badge:"page_badge__lbLyp",badgeExpired:"page_badgeExpired__MQhSl",joinCard:"page_joinCard__0p3ni",joinTitle:"page_joinTitle__F2jWt",joinSubtitle:"page_joinSubtitle__bFFa6",joinInput:"page_joinInput__fbHQq",joinBtn:"page_joinBtn__avuiR",storeInfo:"page_storeInfo__xt_1N",storeLogo:"page_storeLogo__cJ78f",storeName:"page_storeName___uHgz",storeCategory:"page_storeCategory__jSibr",content:"page_content__9HY7N",productsSection:"page_productsSection__rEzvB",sectionTitle:"page_sectionTitle__FRfK_",productGrid:"page_productGrid__QXAwa",sidebar:"page_sidebar__Wz4Ac",card:"page_card__Av2ej",participantList:"page_participantList__z6Mew",participant:"page_participant__xi2gb",participantAvatar:"page_participantAvatar__qaVlj",participantName:"page_participantName__g3n_B",creatorBadge:"page_creatorBadge__a1Bc1",itemsList:"page_itemsList__tRLDA",itemRow:"page_itemRow__Mbk_c",itemInfo:"page_itemInfo__p6jop",itemName:"page_itemName__sJmye",itemMeta:"page_itemMeta__CPf9u",itemPrice:"page_itemPrice__Ia0SV",itemRemove:"page_itemRemove__p8_tj",totalRow:"page_totalRow__xzzkJ",checkoutBtn:"page_checkoutBtn__3uipN",shareSection:"page_shareSection__NvXCp",shareBtn:"page_shareBtn__da_Tt",shareBtnWa:"page_shareBtnWa__LvOGm",error:"page_error__5Fflo",loading:"page_loading__m66aw",spinner:"page_spinner__4WGha",spin:"page_spin__H4BK1",emptyText:"page_emptyText__E4jvZ",timer:"page_timer__kwp8H"}}},function(e){e.O(0,[3498,5026,7584,7648,9938,9617,6964,7633,2971,2117,1744],function(){return e(e.s=8130)}),_N_E=e.O()}]);