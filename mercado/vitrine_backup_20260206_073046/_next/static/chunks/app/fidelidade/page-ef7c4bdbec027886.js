(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3774],{2752:function(e,t,n){Promise.resolve().then(n.bind(n,5156))},6428:function(e,t,n){"use strict";n.d(t,{LP:function(){return a},QW:function(){return h},SC:function(){return c},o4:function(){return l},pE:function(){return d},sg:function(){return u}}),n(257);let r="/api/mercado",i="superbora_token";function o(){return window.location.origin}function a(){try{return localStorage.getItem(i)}catch(e){return null}}function l(e){try{e?localStorage.setItem(i,e):localStorage.removeItem(i)}catch(e){}}function s(){let e=a();return e?{Authorization:"Bearer ".concat(e)}:{}}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{signal:i}=n,a=new URL(r+e,o());Object.entries(t).forEach(e=>{let[t,n]=e;null!=n&&""!==n&&a.searchParams.set(t,n)});let l=await fetch(a.toString(),{credentials:"include",headers:s(),signal:i});if(!l.ok){let e=await l.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(l.status))}let c=await l.json().catch(()=>null);if(!c||!c.success)throw Error((null==c?void 0:c.message)||"Erro desconhecido na API");return void 0!==c.data?c.data:null}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{signal:i}=n,a=new URL(r+e,o()),l=await fetch(a.toString(),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...s()},body:JSON.stringify(t),signal:i}),c=await l.json().catch(()=>null);if(!l.ok||!(null==c?void 0:c.success))throw Error((null==c?void 0:c.message)||"API error: ".concat(l.status));return void 0!==c.data?c.data:null}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{signal:i}=n,a=new URL(r+e,o()),l=await fetch(a.toString(),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...s()},body:JSON.stringify(t),signal:i}),c=await l.json().catch(()=>null);if(!l.ok||!(null==c?void 0:c.success))throw Error((null==c?void 0:c.message)||"API error: ".concat(l.status));return void 0!==c.data?c.data:null}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{signal:i}=n,a=new URL(r+e,o());Object.entries(t).forEach(e=>{let[t,n]=e;null!=n&&""!==n&&a.searchParams.set(t,n)});let l=await fetch(a.toString(),{method:"DELETE",credentials:"include",headers:s(),signal:i}),c=await l.json().catch(()=>null);if(!l.ok||!(null==c?void 0:c.success))throw Error((null==c?void 0:c.message)||"API error: ".concat(l.status));return void 0!==c.data?c.data:null}},8779:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(7437),i=n(2265),o=n(9376),a=n(7128);function l(e){let{children:t}=e,{isAuthenticated:n,loading:l}=(0,a.a)(),s=(0,o.useRouter)();return((0,i.useEffect)(()=>{if(!l&&!n){let e=window.location.pathname;s.push("/login?return=".concat(encodeURIComponent(e)))}},[l,n,s]),l)?(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:(0,r.jsx)("div",{style:{width:32,height:32,border:"3px solid var(--color-border)",borderTopColor:"var(--color-accent)",borderRadius:"50%",animation:"spin 0.8s linear infinite"}})}):n?t:null}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return l},a:function(){return s}});var r=n(7437),i=n(2265),o=n(6428);let a=(0,i.createContext)(null);function l(e){let{children:t}=e,[n,l]=(0,i.useState)(null),[s,c]=(0,i.useState)(!0),u=(0,i.useRef)(!0);(0,i.useEffect)(()=>(u.current=!0,()=>{u.current=!1}),[]);let d=(0,i.useCallback)(async()=>{if(!(0,o.LP)()){u.current&&(l(null),c(!1));return}try{let e=await (0,o.SC)("/auth/session.php");if(!u.current)return;e.authenticated&&e.customer?l(e.customer):((0,o.o4)(null),l(null))}catch(e){if(!u.current)return;"AbortError"!==e.name&&console.warn("[Auth] Session check failed"),(0,o.o4)(null),l(null)}finally{u.current&&c(!1)}},[]);(0,i.useEffect)(()=>{d()},[d]);let h=(0,i.useCallback)(async(e,t)=>{try{let n=await (0,o.sg)("/auth/login.php",{email:e,senha:t});if(!u.current)return null;return(0,o.o4)(n.token),l(n.customer),n.customer}catch(e){throw console.warn("[AuthContext] Login failed:",e.message),e}},[]),f=(0,i.useCallback)(async e=>{try{let t=await (0,o.sg)("/auth/register.php",e);if(!u.current)return null;return(0,o.o4)(t.token),l(t.customer),t.customer}catch(e){throw console.warn("[AuthContext] Register failed:",e.message),e}},[]),g=(0,i.useCallback)(async e=>{try{let t=await (0,o.sg)("/auth/google.php",{credential:e});if(!u.current)return null;return(0,o.o4)(t.token),l(t.customer),t}catch(e){throw console.warn("[AuthContext] Google login failed:",e.message),e}},[]),m=(0,i.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"whatsapp";try{let n={channel:t};return"email"===t?n.email=e:n.phone=e,await (0,o.sg)("/auth/send-code.php",n)}catch(e){throw console.warn("[AuthContext] Send OTP failed:",e.message),e}},[]),v=(0,i.useCallback)(async(e,t,n)=>{try{let r={phone:e,code:t};n&&(r.name=n);let i=await (0,o.sg)("/auth/verify-code.php",r);if(!u.current)return null;return(0,o.o4)(i.token),l(i.customer),i}catch(e){throw console.warn("[AuthContext] Verify OTP failed:",e.message),e}},[]),p=(0,i.useCallback)(()=>{(0,o.o4)(null),l(null)},[]),y=(0,i.useCallback)(e=>{l(t=>t?{...t,...e}:t)},[]),x=(0,i.useMemo)(()=>({customer:n,loading:s,isAuthenticated:!!n,login:h,loginWithGoogle:g,register:f,sendOtp:m,verifyOtp:v,logout:p,updateCustomer:y,refreshSession:d}),[n,s,h,g,f,m,v,p,y,d]);return(0,r.jsx)(a.Provider,{value:x,children:t})}function s(){let e=(0,i.useContext)(a);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},5156:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var r=n(7437),i=n(2265),o=n(9376),a=n(8779),l=n(6428),s=n(7650);function c(){return(0,r.jsx)(a.Z,{children:(0,r.jsx)(u,{})})}function u(){var e,t,n,a,c;let u=(0,o.useRouter)(),[d,h]=(0,i.useState)(null),[f,g]=(0,i.useState)(!0);if((0,i.useEffect)(()=>{(0,l.SC)("/customer/loyalty.php").then(h).catch(e=>{"AbortError"!==e.name&&console.warn("[Loyalty] Failed to load loyalty data")}).finally(()=>g(!1))},[]),f)return(0,r.jsx)("div",{style:{maxWidth:600,margin:"0 auto",padding:16,textAlign:"center",paddingTop:60},children:(0,r.jsx)("div",{style:{width:24,height:24,border:"3px solid #e5e7eb",borderTopColor:"var(--color-accent)",borderRadius:"50%",animation:"spin 0.8s linear infinite",margin:"0 auto"}})});if(!d)return(0,r.jsx)("div",{style:{maxWidth:600,margin:"0 auto",padding:16,textAlign:"center",paddingTop:60},children:(0,r.jsx)("p",{children:"Nao foi possivel carregar dados de fidelidade."})});let m=(()=>{var e,t;if(!d.next_tier)return 100;let n=d.next_tier.min_points-((null===(e=d.tier)||void 0===e?void 0:e.min_points)||0);return n<=0?100:Math.min(100,(d.points_balance-((null===(t=d.tier)||void 0===t?void 0:t.min_points)||0))/n*100)})();return(0,r.jsxs)("div",{style:{maxWidth:600,margin:"0 auto",padding:16,minHeight:"calc(100dvh - 60px)"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:20},children:[(0,r.jsx)("button",{type:"button","aria-label":"Voltar",onClick:()=>u.back(),style:{display:"flex",alignItems:"center",justifyContent:"center",width:36,height:36,borderRadius:"50%",border:"1px solid var(--color-border)"},children:(0,r.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,r.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),(0,r.jsx)("div",{style:{fontSize:20,fontWeight:700},children:"Meus Pontos"})]}),(0,r.jsxs)("div",{style:{background:"linear-gradient(135deg, #00A868, #008854)",borderRadius:16,padding:24,color:"#fff",marginBottom:16,textAlign:"center"},children:[(0,r.jsx)("div",{style:{fontSize:13,opacity:.9,marginBottom:4},children:"Saldo de pontos"}),(0,r.jsx)("div",{style:{fontSize:42,fontWeight:800,lineHeight:1.1},children:null===(e=d.points_balance)||void 0===e?void 0:e.toLocaleString("pt-BR")}),(0,r.jsxs)("div",{style:{fontSize:14,opacity:.85,marginTop:4},children:["= ",(0,s.o_)(d.points_value||0)]}),(0,r.jsxs)("div",{style:{display:"inline-block",background:"rgba(255,255,255,0.2)",borderRadius:20,padding:"6px 16px",fontSize:13,fontWeight:600,marginTop:12},children:[(null===(t=d.tier)||void 0===t?void 0:t.icon)||""," ",(null===(n=d.tier)||void 0===n?void 0:n.name)||"Bronze"]})]}),d.next_tier&&(0,r.jsxs)("div",{style:{background:"var(--color-bg)",borderRadius:"var(--radius-card)",boxShadow:"var(--shadow-card)",padding:16,marginBottom:16},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13,marginBottom:8},children:[(0,r.jsx)("span",{style:{fontWeight:600},children:(null===(a=d.tier)||void 0===a?void 0:a.name)||"Bronze"}),(0,r.jsx)("span",{style:{color:"var(--color-text-muted)"},children:d.next_tier.name})]}),(0,r.jsx)("div",{style:{height:8,background:"var(--color-bg-muted)",borderRadius:4,overflow:"hidden"},children:(0,r.jsx)("div",{style:{height:"100%",background:"var(--color-accent)",borderRadius:4,width:"".concat(m,"%"),transition:"width 0.5s"}})}),(0,r.jsxs)("div",{style:{fontSize:12,color:"var(--color-text-muted)",marginTop:6},children:["Faltam ",null===(c=d.next_tier.points_needed)||void 0===c?void 0:c.toLocaleString("pt-BR")," pontos para ",d.next_tier.name]})]}),(0,r.jsxs)("div",{style:{background:"var(--color-bg)",borderRadius:"var(--radius-card)",boxShadow:"var(--shadow-card)",padding:16,marginBottom:16},children:[(0,r.jsx)("div",{style:{fontSize:16,fontWeight:600,marginBottom:12},children:"Como funciona"}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,r.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"flex-start"},children:[(0,r.jsx)("div",{style:{width:32,height:32,borderRadius:"50%",background:"#f0fdf4",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,flexShrink:0},children:"1"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{fontWeight:500,fontSize:14},children:"Compre normalmente"}),(0,r.jsx)("div",{style:{fontSize:12,color:"var(--color-text-muted)"},children:"A cada R$ 1 gasto, ganhe 1 ponto"})]})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"flex-start"},children:[(0,r.jsx)("div",{style:{width:32,height:32,borderRadius:"50%",background:"#f0fdf4",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,flexShrink:0},children:"2"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{fontWeight:500,fontSize:14},children:"Acumule pontos"}),(0,r.jsx)("div",{style:{fontSize:12,color:"var(--color-text-muted)"},children:"Suba de nivel e ganhe mais beneficios"})]})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"flex-start"},children:[(0,r.jsx)("div",{style:{width:32,height:32,borderRadius:"50%",background:"#f0fdf4",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,flexShrink:0},children:"3"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{fontWeight:500,fontSize:14},children:"Use como desconto"}),(0,r.jsx)("div",{style:{fontSize:12,color:"var(--color-text-muted)"},children:"100 pontos = R$ 1,00 de desconto"})]})]})]})]}),(0,r.jsxs)("div",{style:{background:"var(--color-bg)",borderRadius:"var(--radius-card)",boxShadow:"var(--shadow-card)",padding:16,marginBottom:80},children:[(0,r.jsx)("div",{style:{fontSize:16,fontWeight:600,marginBottom:12},children:"Historico"}),d.recent_transactions&&0!==d.recent_transactions.length?d.recent_transactions.map((e,t)=>(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderBottom:t<d.recent_transactions.length-1?"1px solid var(--color-bg-muted)":"none"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{fontSize:14,fontWeight:500},children:e.description}),(0,r.jsx)("div",{style:{fontSize:12,color:"var(--color-text-muted)"},children:e.created_at?new Date(e.created_at).toLocaleDateString("pt-BR"):""})]}),(0,r.jsxs)("div",{style:{fontWeight:700,fontSize:15,color:"earn"===e.type?"var(--color-accent)":"var(--color-danger)"},children:["earn"===e.type?"+":"",e.points]})]},e.id||t)):(0,r.jsx)("div",{style:{textAlign:"center",padding:20,color:"var(--color-text-muted)",fontSize:14},children:"Nenhuma transacao ainda"})]})]})}},7650:function(e,t,n){"use strict";function r(e){return null!=e&&"number"==typeof e&&Number.isFinite(e)?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e):"R$ 0,00"}function i(e){if(!e)return"";let t=String(e);if(t.length>20)return"";let n=t.replace(/\D/g,"");return 8===n.length&&/^\d{8}$/.test(n)?"".concat(n.slice(0,5),"-").concat(n.slice(5)):""}function o(e){if(null==e||"number"!=typeof e||!Number.isFinite(e)||e<0)return"";let t=Math.round(e);if(0===t)return"";if(t<60)return"".concat(t," min");let n=Math.floor(t/60),r=t%60;return r>0?"".concat(n,"h").concat(r,"min"):"".concat(n,"h")}function a(e){if(null==e)return"0.0";let t=Number(e);return Number.isFinite(t)?t.toFixed(1):"0.0"}function l(e){if(null==e)return"";let t=Number(e);return isNaN(t)?r(0):0===t?"Gratis":r(t)}n.d(t,{A6:function(){return a},ci:function(){return l},gN:function(){return o},hR:function(){return i},o_:function(){return r}})},9376:function(e,t,n){"use strict";var r=n(5475);n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},257:function(e,t,n){"use strict";var r,i;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(i=n.g.process)?void 0:i.env)?n.g.process:n(4227)},4227:function(e){!function(){var t={229:function(e){var t,n,r,i=e.exports={};function o(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var s=[],c=!1,u=-1;function d(){c&&r&&(c=!1,r.length?s=r.concat(s):u=-1,s.length&&h())}function h(){if(!c){var e=l(d);c=!0;for(var t=s.length;t;){for(r=s,s=[];++u<t;)r&&r[u].run();u=-1,t=s.length}r=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.push(new f(e,t)),1!==s.length||c||l(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var o=n[e]={exports:{}},a=!0;try{t[e](o,o.exports,r),a=!1}finally{a&&delete n[e]}return o.exports}r.ab="//";var i=r(229);e.exports=i}()}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=2752)}),_N_E=e.O()}]);