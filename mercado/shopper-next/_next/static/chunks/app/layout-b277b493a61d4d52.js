(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{8176:function(e,t,n){Promise.resolve().then(n.t.bind(n,7960,23)),Promise.resolve().then(n.bind(n,4180))},6428:function(e,t,n){"use strict";n.d(t,{B9:function(){return s},LP:function(){return a},SC:function(){return u},o4:function(){return c},pE:function(){return d},sg:function(){return i}});let r="/api/mercado/shopper",o="shopper_token";function a(){return localStorage.getItem(o)}function c(e){e?localStorage.setItem(o,e):localStorage.removeItem(o)}function l(){let e=a();return e?{Authorization:"Bearer ".concat(e)}:{}}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(r).concat(e),o=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");o&&(n+="?".concat(o));let a=await fetch(n,{credentials:"include",headers:l()});if(!a.ok){let e=await a.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(a.status," ").concat(a.statusText))}let c=await a.json();if(!c.success)throw Error(c.message||"Erro desconhecido na API");return c.data}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(r).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...l()},body:JSON.stringify(t)}),o=await n.json().catch(()=>null);if(!n.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(n.status));return o.data}async function s(e,t){let n=await fetch("".concat(r).concat(e),{method:"POST",credentials:"include",headers:l(),body:t}),o=await n.json().catch(()=>null);if(!n.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(n.status));return o.data}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(r).concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...l()},body:JSON.stringify(t)}),o=await n.json().catch(()=>null);if(!n.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(n.status));return o.data}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return l},a:function(){return u}});var r=n(7437),o=n(2265),a=n(6428);let c=(0,o.createContext)(null);function l(e){let{children:t}=e,[n,l]=(0,o.useState)(null),[u,i]=(0,o.useState)(!0),s=(0,o.useCallback)(async()=>{if(!(0,a.LP)()){l(null),i(!1);return}try{let e=await (0,a.SC)("/auth/session.php");e.authenticated&&e.shopper?l(e.shopper):((0,a.o4)(null),l(null))}catch(e){(0,a.o4)(null),l(null)}finally{i(!1)}},[]);(0,o.useEffect)(()=>{s()},[s]);let d=(0,o.useCallback)(async(e,t)=>{let n=await (0,a.sg)("/auth/login.php",{email:e,senha:t});(0,a.o4)(n.token);let r=n.shopper||{id:n.shopper_id,nome:n.nome,email:n.email,telefone:n.telefone,foto:n.foto,saldo:n.saldo,status:n.status};return l(r),r},[]),f=(0,o.useCallback)(()=>{(0,a.o4)(null),l(null)},[]);return(0,r.jsx)(c.Provider,{value:{shopper:n,loading:u,isAuthenticated:!!n,login:d,logout:f,refreshSession:s},children:t})}function u(){let e=(0,o.useContext)(c);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},495:function(e,t,n){"use strict";n.d(t,{T:function(){return u},v:function(){return l}});var r=n(7437),o=n(2265),a=n(6428);let c=(0,o.createContext)(null);function l(e){let{children:t}=e,[n,l]=(0,o.useState)(null),[u,i]=(0,o.useState)(!1),[s,d]=(0,o.useState)(null),f=(0,o.useRef)(null),h=(0,o.useRef)(null),v=(0,o.useRef)(null),m=(0,o.useCallback)(async(e,t)=>{try{await (0,a.sg)("/localizacao.php",{lat:e,lng:t})}catch(e){console.error("Failed to send location:",e)}},[]),p=(0,o.useCallback)(()=>{if(!navigator.geolocation){d("Geolocaliza\xe7\xe3o n\xe3o suportada");return}i(!0),d(null),f.current=navigator.geolocation.watchPosition(e=>{let{latitude:t,longitude:n}=e.coords,r={lat:t,lng:n};l(r),v.current=r},e=>{d(e.message),console.error("Geolocation error:",e)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:5e3}),h.current=setInterval(()=>{v.current&&m(v.current.lat,v.current.lng)},3e4)},[m]),g=(0,o.useCallback)(()=>{null!==f.current&&(navigator.geolocation.clearWatch(f.current),f.current=null),h.current&&(clearInterval(h.current),h.current=null),i(!1)},[]);return(0,r.jsx)(c.Provider,{value:{position:n,tracking:u,error:s,startTracking:p,stopTracking:g,sendLocation:m},children:t})}function u(){let e=(0,o.useContext)(c);if(!e)throw Error("useLocation must be used within LocationProvider");return e}},6971:function(e,t,n){"use strict";n.d(t,{J:function(){return i},l:function(){return s}});var r=n(7437),o=n(2265),a=n(7128),c=n(6428);let l=(0,o.createContext)(null),u=0;function i(e){let{children:t}=e,[n,i]=(0,o.useState)([]),[s,d]=(0,o.useState)(0),f=(0,o.useRef)(0),h=(0,o.useRef)({}),{isAuthenticated:v}=(0,a.a)(),m=(0,o.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3,r=++u;return i(n=>[...n,{id:r,message:e,type:t}]),n>0&&(h.current[r]=setTimeout(()=>{i(e=>e.filter(e=>e.id!==r)),delete h.current[r]},n)),r},[]),p=(0,o.useCallback)(e=>{i(t=>t.filter(t=>t.id!==e)),h.current[e]&&(clearTimeout(h.current[e]),delete h.current[e])},[]),g=(0,o.useCallback)(e=>m(e,"success"),[m]),w=(0,o.useCallback)(e=>m(e,"error"),[m]),C=(0,o.useCallback)(e=>m(e,"warning"),[m]),y=(0,o.useCallback)(e=>m(e,"info"),[m]);return(0,o.useEffect)(()=>{if(!v){d(0),f.current=0;return}let e=!1;async function t(){try{var t,n;let r=(0,c.LP)();if(!r)return;let o=await fetch("/api/mercado/notifications/list.php?unread=1",{credentials:"include",headers:{Authorization:"Bearer ".concat(r)}});if(!o.ok)return;let a=await o.json();if(!a.success)return;let l=null!==(n=null===(t=a.data)||void 0===t?void 0:t.unread_count)&&void 0!==n?n:0;e||(d(l),l>f.current&&m("Nova notificacao","info"),f.current=l)}catch(e){}}t();let n=setInterval(t,3e4);return()=>{e=!0,clearInterval(n)}},[v,m]),(0,r.jsxs)(l.Provider,{value:{notifications:n,addNotification:m,removeNotification:p,success:g,error:w,warning:C,info:y,unreadCount:s},children:[t,n.length>0&&(0,r.jsx)("div",{className:"toast-container",children:n.map(e=>(0,r.jsxs)("div",{className:"toast toast-".concat(e.type),onClick:()=>p(e.id),children:[(0,r.jsxs)("span",{className:"toast-icon",children:["success"===e.type&&"✓","error"===e.type&&"✗","warning"===e.type&&"⚠","info"===e.type&&"ℹ"]}),(0,r.jsx)("span",{className:"toast-message",children:e.message})]},e.id))})]})}function s(){let e=(0,o.useContext)(l);if(!e)throw Error("useNotification must be used within NotificationProvider");return e}},4755:function(e,t,n){"use strict";n.d(t,{A:function(){return u},u:function(){return l}});var r=n(7437),o=n(2265),a=n(6428);let c=(0,o.createContext)(null);function l(e){let{children:t}=e,[n,l]=(0,o.useState)(null),[u,i]=(0,o.useState)([]),[s,d]=(0,o.useState)({collected:0,total:0}),[f,h]=(0,o.useState)(!1),v=(0,o.useCallback)(async()=>{h(!0);try{let e=await (0,a.SC)("/dashboard.php");if(e.active_order&&(l(e.active_order),e.active_order.items)){i(e.active_order.items);let t=e.active_order.items.filter(e=>"collected"===e.status).length;d({collected:t,total:e.active_order.items.length})}return e}catch(e){return console.error("Failed to fetch active order:",e),null}finally{h(!1)}},[]),m=(0,o.useCallback)(async e=>{try{let t=await (0,a.SC)("/order-items.php",{order_id:e});i(t.items||[]);let n=(t.items||[]).filter(e=>"collected"===e.status).length;return d({collected:n,total:(t.items||[]).length}),t.items||[]}catch(e){return console.error("Failed to fetch order items:",e),[]}},[]),p=(0,o.useCallback)(async(e,t)=>{try{await (0,a.sg)("/item-coletado.php",{item_id:e,status:t}),i(n=>{let r=n.map(n=>n.id===e?{...n,status:t}:n),o=r.filter(e=>"collected"===e.status).length;return d({collected:o,total:r.length}),r})}catch(e){throw console.error("Failed to update item status:",e),e}},[]),g=(0,o.useCallback)(()=>{l(null),i([]),d({collected:0,total:0})},[]);return(0,r.jsx)(c.Provider,{value:{activeOrder:n,items:u,progress:s,loading:f,fetchActiveOrder:v,fetchOrderItems:m,updateItemStatus:p,setActiveOrder:l,clearOrder:g},children:t})}function u(){let e=(0,o.useContext)(c);if(!e)throw Error("useOrder must be used within OrderProvider");return e}},4180:function(e,t,n){"use strict";n.d(t,{Providers:function(){return u}});var r=n(7437),o=n(7128),a=n(6971),c=n(4755),l=n(495);function u(e){let{children:t}=e;return(0,r.jsx)(o.H,{children:(0,r.jsx)(a.J,{children:(0,r.jsx)(c.u,{children:(0,r.jsx)(l.v,{children:t})})})})}},7960:function(){}},function(e){e.O(0,[587,971,117,744],function(){return e(e.s=8176)}),_N_E=e.O()}]);