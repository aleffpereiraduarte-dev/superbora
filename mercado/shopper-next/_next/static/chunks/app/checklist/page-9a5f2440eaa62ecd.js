(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[701],{8246:function(e,t,n){Promise.resolve().then(n.bind(n,3185))},6428:function(e,t,n){"use strict";n.d(t,{B9:function(){return u},LP:function(){return a},SC:function(){return c},o4:function(){return s},pE:function(){return d},sg:function(){return l}});let r="/api/mercado/shopper",o="shopper_token";function a(){return localStorage.getItem(o)}function s(e){e?localStorage.setItem(o,e):localStorage.removeItem(o)}function i(){let e=a();return e?{Authorization:"Bearer ".concat(e)}:{}}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(r).concat(e),o=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");o&&(n+="?".concat(o));let a=await fetch(n,{credentials:"include",headers:i()});if(!a.ok){let e=await a.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(a.status," ").concat(a.statusText))}let s=await a.json();if(!s.success)throw Error(s.message||"Erro desconhecido na API");return s.data}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(r).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...i()},body:JSON.stringify(t)}),o=await n.json().catch(()=>null);if(!n.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(n.status));return o.data}async function u(e,t){let n=await fetch("".concat(r).concat(e),{method:"POST",credentials:"include",headers:i(),body:t}),o=await n.json().catch(()=>null);if(!n.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(n.status));return o.data}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(r).concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...i()},body:JSON.stringify(t)}),o=await n.json().catch(()=>null);if(!n.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(n.status));return o.data}},3185:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n(7437),o=n(2265),a=n(9376),s=n(6428),i=n(6971),c=n(8779);let l=[{id:"sacolas",label:"Sacolas termicas"},{id:"celular",label:"Celular carregado"},{id:"documento",label:"Documento com foto"},{id:"uniforme",label:"Uniforme"},{id:"alcool",label:"Alcool gel"}];function u(){let e=(0,a.useRouter)(),{success:t,error:n}=(0,i.l)(),[c,u]=(0,o.useState)([]),[d,h]=(0,o.useState)({}),[f,m]=(0,o.useState)(!0),[p,v]=(0,o.useState)(!1);(0,o.useEffect)(()=>{!async function(){try{let e=await (0,s.SC)("/checklist.php"),t=e.items||e.itens||[];t.length>0?u(t.map((e,t)=>({id:e.id||"item_".concat(t),label:e.label||e.nome||e.name||e}))):u(l)}catch(e){console.error("Load checklist error:",e),u(l)}finally{m(!1)}}()},[]);let g=c.length>0&&c.every(e=>d[e.id]),x=c.filter(e=>d[e.id]).length;async function y(){if(!g){n("Marque todos os itens antes de continuar");return}v(!0);try{let n=c.filter(e=>d[e.id]).map(e=>({id:e.id,label:e.label}));await (0,s.sg)("/checklist.php",{items:n}),t("Checklist concluido! Bom trabalho!"),e.push("/")}catch(e){n("Erro: "+e.message)}finally{v(!1)}}return(0,r.jsxs)("div",{className:"page",children:[(0,r.jsxs)("div",{className:"page-header",children:[(0,r.jsx)("button",{className:"back-btn",onClick:()=>e.back(),children:(0,r.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,r.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),(0,r.jsx)("h1",{children:"Checklist"})]}),(0,r.jsxs)("div",{style:{marginBottom:20},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[(0,r.jsx)("span",{style:{fontSize:13,color:"var(--color-text-secondary)"},children:"Progresso"}),(0,r.jsxs)("span",{style:{fontSize:13,fontWeight:600,color:"var(--color-primary-dark)"},children:[x,"/",c.length]})]}),(0,r.jsx)("div",{className:"xp-bar",children:(0,r.jsx)("div",{className:"xp-bar-fill",style:{width:c.length>0?"".concat(x/c.length*100,"%"):"0%"}})})]}),(0,r.jsx)("p",{style:{fontSize:14,color:"var(--color-text-secondary)",marginBottom:16},children:"Confirme que voce tem todos os itens necessarios antes de iniciar seu turno."}),f?(0,r.jsx)("div",{children:[1,2,3,4,5].map(e=>(0,r.jsx)("div",{className:"skeleton",style:{height:52,borderRadius:"var(--radius-sm)",marginBottom:8}},e))}):(0,r.jsx)("div",{children:c.map(e=>(0,r.jsxs)("div",{className:"checklist-item",onClick:()=>{var t;return t=e.id,void h(e=>({...e,[t]:!e[t]}))},style:{cursor:"pointer"},children:[(0,r.jsx)("div",{className:"checklist-toggle ".concat(d[e.id]?"checked":""),children:d[e.id]&&(0,r.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"3",children:(0,r.jsx)("polyline",{points:"20 6 9 17 4 12"})})}),(0,r.jsx)("span",{className:"checklist-label",style:{textDecoration:d[e.id]?"line-through":"none",color:d[e.id]?"var(--color-text-muted)":"var(--color-text)"},children:(e.label,e.label)})]},e.id))}),(0,r.jsx)("button",{className:"btn btn-primary btn-lg",onClick:y,disabled:!g||p,style:{marginTop:24},children:p?"Enviando...":g?"Iniciar Turno":"Marque todos os itens (".concat(x,"/").concat(c.length,")")})]})}function d(){return(0,r.jsx)(c.Z,{children:(0,r.jsx)(u,{})})}},8779:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(7437),o=n(2265),a=n(9376),s=n(7128);function i(e){let{children:t}=e,{isAuthenticated:n,loading:i}=(0,s.a)(),c=(0,a.useRouter)();return((0,o.useEffect)(()=>{if(!i&&!n){let e=window.location.pathname;c.push("/login?return=".concat(encodeURIComponent(e)))}},[i,n,c]),i)?(0,r.jsxs)("div",{className:"loading-screen",children:[(0,r.jsx)("div",{className:"spinner"}),(0,r.jsx)("p",{className:"loading-text",children:"Carregando..."})]}):n?t:null}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return i},a:function(){return c}});var r=n(7437),o=n(2265),a=n(6428);let s=(0,o.createContext)(null);function i(e){let{children:t}=e,[n,i]=(0,o.useState)(null),[c,l]=(0,o.useState)(!0),u=(0,o.useCallback)(async()=>{if(!(0,a.LP)()){i(null),l(!1);return}try{let e=await (0,a.SC)("/auth/session.php");e.authenticated&&e.shopper?i(e.shopper):((0,a.o4)(null),i(null))}catch(e){(0,a.o4)(null),i(null)}finally{l(!1)}},[]);(0,o.useEffect)(()=>{u()},[u]);let d=(0,o.useCallback)(async(e,t)=>{let n=await (0,a.sg)("/auth/login.php",{email:e,senha:t});(0,a.o4)(n.token);let r=n.shopper||{id:n.shopper_id,nome:n.nome,email:n.email,telefone:n.telefone,foto:n.foto,saldo:n.saldo,status:n.status};return i(r),r},[]),h=(0,o.useCallback)(()=>{(0,a.o4)(null),i(null)},[]);return(0,r.jsx)(s.Provider,{value:{shopper:n,loading:c,isAuthenticated:!!n,login:d,logout:h,refreshSession:u},children:t})}function c(){let e=(0,o.useContext)(s);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},6971:function(e,t,n){"use strict";n.d(t,{J:function(){return l},l:function(){return u}});var r=n(7437),o=n(2265),a=n(7128),s=n(6428);let i=(0,o.createContext)(null),c=0;function l(e){let{children:t}=e,[n,l]=(0,o.useState)([]),[u,d]=(0,o.useState)(0),h=(0,o.useRef)(0),f=(0,o.useRef)({}),{isAuthenticated:m}=(0,a.a)(),p=(0,o.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3,r=++c;return l(n=>[...n,{id:r,message:e,type:t}]),n>0&&(f.current[r]=setTimeout(()=>{l(e=>e.filter(e=>e.id!==r)),delete f.current[r]},n)),r},[]),v=(0,o.useCallback)(e=>{l(t=>t.filter(t=>t.id!==e)),f.current[e]&&(clearTimeout(f.current[e]),delete f.current[e])},[]),g=(0,o.useCallback)(e=>p(e,"success"),[p]),x=(0,o.useCallback)(e=>p(e,"error"),[p]),y=(0,o.useCallback)(e=>p(e,"warning"),[p]),b=(0,o.useCallback)(e=>p(e,"info"),[p]);return(0,o.useEffect)(()=>{if(!m){d(0),h.current=0;return}let e=!1;async function t(){try{var t,n;let r=(0,s.LP)();if(!r)return;let o=await fetch("/api/mercado/notifications/list.php?unread=1",{credentials:"include",headers:{Authorization:"Bearer ".concat(r)}});if(!o.ok)return;let a=await o.json();if(!a.success)return;let i=null!==(n=null===(t=a.data)||void 0===t?void 0:t.unread_count)&&void 0!==n?n:0;e||(d(i),i>h.current&&p("Nova notificacao","info"),h.current=i)}catch(e){}}t();let n=setInterval(t,3e4);return()=>{e=!0,clearInterval(n)}},[m,p]),(0,r.jsxs)(i.Provider,{value:{notifications:n,addNotification:p,removeNotification:v,success:g,error:x,warning:y,info:b,unreadCount:u},children:[t,n.length>0&&(0,r.jsx)("div",{className:"toast-container",children:n.map(e=>(0,r.jsxs)("div",{className:"toast toast-".concat(e.type),onClick:()=>v(e.id),children:[(0,r.jsxs)("span",{className:"toast-icon",children:["success"===e.type&&"✓","error"===e.type&&"✗","warning"===e.type&&"⚠","info"===e.type&&"ℹ"]}),(0,r.jsx)("span",{className:"toast-message",children:e.message})]},e.id))})]})}function u(){let e=(0,o.useContext)(i);if(!e)throw Error("useNotification must be used within NotificationProvider");return e}},9376:function(e,t,n){"use strict";var r=n(5475);n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=8246)}),_N_E=e.O()}]);