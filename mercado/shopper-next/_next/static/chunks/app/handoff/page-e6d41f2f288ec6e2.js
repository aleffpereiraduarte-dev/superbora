(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[159],{1375:function(e,t,n){Promise.resolve().then(n.bind(n,1401))},6428:function(e,t,n){"use strict";n.d(t,{B9:function(){return u},LP:function(){return o},SC:function(){return l},o4:function(){return s},pE:function(){return d},sg:function(){return c}});let r="/api/mercado/shopper",a="shopper_token";function o(){return localStorage.getItem(a)}function s(e){e?localStorage.setItem(a,e):localStorage.removeItem(a)}function i(){let e=o();return e?{Authorization:"Bearer ".concat(e)}:{}}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(r).concat(e),a=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");a&&(n+="?".concat(a));let o=await fetch(n,{credentials:"include",headers:i()});if(!o.ok){let e=await o.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(o.status," ").concat(o.statusText))}let s=await o.json();if(!s.success)throw Error(s.message||"Erro desconhecido na API");return s.data}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(r).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...i()},body:JSON.stringify(t)}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function u(e,t){let n=await fetch("".concat(r).concat(e),{method:"POST",credentials:"include",headers:i(),body:t}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(r).concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...i()},body:JSON.stringify(t)}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}},8779:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(7437),a=n(2265),o=n(9376),s=n(7128);function i(e){let{children:t}=e,{isAuthenticated:n,loading:i}=(0,s.a)(),l=(0,o.useRouter)();return((0,a.useEffect)(()=>{if(!i&&!n){let e=window.location.pathname;l.push("/login?return=".concat(encodeURIComponent(e)))}},[i,n,l]),i)?(0,r.jsxs)("div",{className:"loading-screen",children:[(0,r.jsx)("div",{className:"spinner"}),(0,r.jsx)("p",{className:"loading-text",children:"Carregando..."})]}):n?t:null}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return i},a:function(){return l}});var r=n(7437),a=n(2265),o=n(6428);let s=(0,a.createContext)(null);function i(e){let{children:t}=e,[n,i]=(0,a.useState)(null),[l,c]=(0,a.useState)(!0),u=(0,a.useCallback)(async()=>{if(!(0,o.LP)()){i(null),c(!1);return}try{let e=await (0,o.SC)("/auth/session.php");e.authenticated&&e.shopper?i(e.shopper):((0,o.o4)(null),i(null))}catch(e){(0,o.o4)(null),i(null)}finally{c(!1)}},[]);(0,a.useEffect)(()=>{u()},[u]);let d=(0,a.useCallback)(async(e,t)=>{let n=await (0,o.sg)("/auth/login.php",{email:e,senha:t});(0,o.o4)(n.token);let r=n.shopper||{id:n.shopper_id,nome:n.nome,email:n.email,telefone:n.telefone,foto:n.foto,saldo:n.saldo,status:n.status};return i(r),r},[]),f=(0,a.useCallback)(()=>{(0,o.o4)(null),i(null)},[]);return(0,r.jsx)(s.Provider,{value:{shopper:n,loading:l,isAuthenticated:!!n,login:d,logout:f,refreshSession:u},children:t})}function l(){let e=(0,a.useContext)(s);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},6971:function(e,t,n){"use strict";n.d(t,{J:function(){return c},l:function(){return u}});var r=n(7437),a=n(2265),o=n(7128),s=n(6428);let i=(0,a.createContext)(null),l=0;function c(e){let{children:t}=e,[n,c]=(0,a.useState)([]),[u,d]=(0,a.useState)(0),f=(0,a.useRef)(0),h=(0,a.useRef)({}),{isAuthenticated:p}=(0,o.a)(),m=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3,r=++l;return c(n=>[...n,{id:r,message:e,type:t}]),n>0&&(h.current[r]=setTimeout(()=>{c(e=>e.filter(e=>e.id!==r)),delete h.current[r]},n)),r},[]),g=(0,a.useCallback)(e=>{c(t=>t.filter(t=>t.id!==e)),h.current[e]&&(clearTimeout(h.current[e]),delete h.current[e])},[]),x=(0,a.useCallback)(e=>m(e,"success"),[m]),v=(0,a.useCallback)(e=>m(e,"error"),[m]),j=(0,a.useCallback)(e=>m(e,"warning"),[m]),y=(0,a.useCallback)(e=>m(e,"info"),[m]);return(0,a.useEffect)(()=>{if(!p){d(0),f.current=0;return}let e=!1;async function t(){try{var t,n;let r=(0,s.LP)();if(!r)return;let a=await fetch("/api/mercado/notifications/list.php?unread=1",{credentials:"include",headers:{Authorization:"Bearer ".concat(r)}});if(!a.ok)return;let o=await a.json();if(!o.success)return;let i=null!==(n=null===(t=o.data)||void 0===t?void 0:t.unread_count)&&void 0!==n?n:0;e||(d(i),i>f.current&&m("Nova notificacao","info"),f.current=i)}catch(e){}}t();let n=setInterval(t,3e4);return()=>{e=!0,clearInterval(n)}},[p,m]),(0,r.jsxs)(i.Provider,{value:{notifications:n,addNotification:m,removeNotification:g,success:x,error:v,warning:j,info:y,unreadCount:u},children:[t,n.length>0&&(0,r.jsx)("div",{className:"toast-container",children:n.map(e=>(0,r.jsxs)("div",{className:"toast toast-".concat(e.type),onClick:()=>g(e.id),children:[(0,r.jsxs)("span",{className:"toast-icon",children:["success"===e.type&&"✓","error"===e.type&&"✗","warning"===e.type&&"⚠","info"===e.type&&"ℹ"]}),(0,r.jsx)("span",{className:"toast-message",children:e.message})]},e.id))})]})}function u(){let e=(0,a.useContext)(i);if(!e)throw Error("useNotification must be used within NotificationProvider");return e}},1401:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var r=n(7437),a=n(2265),o=n(9376),s=n(6428),i=n(6971),l=n(8779);function c(){let e=(0,o.useRouter)(),t=(0,o.useSearchParams)().get("order_id"),{success:n,error:l}=(0,i.l)(),c=(0,a.useRef)(null),[u,d]=(0,a.useState)("waiting"),[f,h]=(0,a.useState)(null),[p,m]=(0,a.useState)(!1),g=(0,a.useRef)(null),x=(0,a.useCallback)(()=>{let e=c.current;if(!e||!t)return;let n=e.getContext("2d");e.width=200,e.height=200,n.fillStyle="#ffffff",n.fillRect(0,0,200,200),n.fillStyle="#1a1a2e";let r="ORDER:".concat(t),a=Math.floor(25);function o(e,t){n.fillRect(8*e,8*t,56,8),n.fillRect(8*e,(t+6)*8,56,8);for(let r=0;r<7;r++)n.fillRect(8*e,(t+r)*8,8,8),n.fillRect((e+6)*8,(t+r)*8,8,8);n.fillRect((e+2)*8,(t+2)*8,24,24)}o(1,1),o(a-9,1),o(1,a-9);let s=0;for(let e=0;e<r.length;e++)s=(s<<5)-s+r.charCodeAt(e)|0;for(let e=10;e<a-2;e++)for(let t=10;t<a-2;t++)Math.abs(s=(s<<5)-s+t*e|0)%3==0&&n.fillRect(8*t,8*e,8,8);n.fillStyle="#1a1a2e",n.font="bold 11px Inter, sans-serif",n.textAlign="center",n.fillText("Pedido #".concat(t),100,196)},[t]);async function v(){m(!0);try{let e=new FormData;e.append("order_id",t),f&&e.append("photo",f.file),await (0,s.B9)("/handoff.php",e),d("handed_off"),n("Handoff confirmado!")}catch(e){l("Erro: "+e.message)}finally{m(!1)}}return(0,a.useEffect)(()=>{x()},[x]),t?(0,r.jsxs)("div",{className:"page",children:[(0,r.jsxs)("div",{className:"page-header",children:[(0,r.jsx)("button",{className:"back-btn",onClick:()=>e.back(),children:(0,r.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,r.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),(0,r.jsx)("h1",{children:"Handoff"})]}),"waiting"===u?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"qr-display",style:{marginBottom:20},children:[(0,r.jsx)("p",{style:{fontSize:14,fontWeight:600,marginBottom:12},children:"QR Code para o entregador escanear"}),(0,r.jsx)("canvas",{ref:c,className:"qr-canvas"}),(0,r.jsxs)("p",{className:"qr-label",children:["Pedido #",t]})]}),(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("div",{className:"card-title",style:{marginBottom:12},children:"Foto das sacolas seladas"}),f?(0,r.jsxs)("div",{style:{position:"relative",borderRadius:8,overflow:"hidden",marginBottom:12},children:[(0,r.jsx)("img",{src:f.preview,alt:"Foto sacolas",style:{width:"100%",borderRadius:8}}),(0,r.jsx)("button",{onClick:()=>h(null),style:{position:"absolute",top:8,right:8,width:28,height:28,borderRadius:"50%",background:"rgba(0,0,0,0.6)",color:"white",display:"flex",alignItems:"center",justifyContent:"center"},children:"X"})]}):(0,r.jsxs)("div",{className:"photo-upload",onClick:()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.click()},children:[(0,r.jsx)("input",{ref:g,type:"file",accept:"image/*",capture:"environment",onChange:function(e){let t=e.target.files[0];if(!t)return;let n=new FileReader;n.onload=e=>{h({file:t,preview:e.target.result})},n.readAsDataURL(t)}}),(0,r.jsx)("span",{className:"photo-upload-icon",children:(0,r.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[(0,r.jsx)("path",{d:"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"}),(0,r.jsx)("circle",{cx:"12",cy:"13",r:"4"})]})}),(0,r.jsx)("span",{className:"photo-upload-text",children:"Tirar foto"})]})]}),(0,r.jsx)("button",{className:"btn btn-primary btn-lg",onClick:v,disabled:p,style:{marginTop:16},children:p?"Confirmando...":"Confirmar Handoff"}),(0,r.jsx)("div",{style:{textAlign:"center",padding:16},children:(0,r.jsx)("p",{style:{fontSize:13,color:"var(--color-text-secondary)"},children:"Aguardando o entregador escanear o QR code..."})})]}):(0,r.jsxs)("div",{style:{textAlign:"center",padding:40},children:[(0,r.jsx)("div",{style:{width:80,height:80,borderRadius:"50%",background:"var(--color-primary)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:(0,r.jsx)("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"#1a1a2e",strokeWidth:"2.5",children:(0,r.jsx)("polyline",{points:"20 6 9 17 4 12"})})}),(0,r.jsx)("h2",{style:{fontSize:20,fontWeight:700,marginBottom:8},children:"Handoff Concluido!"}),(0,r.jsx)("p",{style:{color:"var(--color-text-secondary)",marginBottom:24},children:"O entregador recebeu o pedido com sucesso."}),(0,r.jsx)("button",{className:"btn btn-primary",onClick:()=>e.push("/"),children:"Voltar ao Inicio"})]})]}):(0,r.jsx)("div",{className:"page",children:(0,r.jsx)("div",{className:"empty-state",children:(0,r.jsx)("div",{className:"empty-title",children:"Nenhum pedido selecionado"})})})}function u(){return(0,r.jsx)(l.Z,{children:(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("div",{className:"loading-screen",children:(0,r.jsx)("div",{className:"spinner"})}),children:(0,r.jsx)(c,{})})})}},9376:function(e,t,n){"use strict";var r=n(5475);n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=1375)}),_N_E=e.O()}]);