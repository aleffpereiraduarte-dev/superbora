(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[774],{5230:function(e,s,a){Promise.resolve().then(a.bind(a,5156))},5156:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return d}});var r=a(7437),t=a(2265),n=a(4565),i=a(4477),l=a(6428),c=a(6971);function d(){return(0,r.jsx)(n.Z,{children:(0,r.jsx)(i.Z,{children:(0,r.jsx)(o,{})})})}function o(){let{addNotification:e}=(0,c.l)(),[s,a]=(0,t.useState)(null),[n,i]=(0,t.useState)(!0),[d,o]=(0,t.useState)(!1),[m,h]=(0,t.useState)(!1),[u,p]=(0,t.useState)({name:"",description:"",points_required:100,reward_type:"discount_percent",reward_value:10}),x=e=>{let s=parseFloat(e);return isNaN(s)?"R$ 0,00":s.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})};async function j(){try{let e=await (0,l.SC)("/loyalty.php");a(e)}catch(e){console.error(e)}i(!1)}async function v(){try{await (0,l.sg)("/loyalty.php",{action:"update_settings",enabled:s.settings.enabled?0:1}),e(s.settings.enabled?"Programa desativado":"Programa ativado!","success"),await j()}catch(s){e("Erro ao atualizar","error")}}async function g(s){s.preventDefault();try{await (0,l.sg)("/loyalty.php",{action:"update_settings",points_per_real:parseFloat(s.target.points_per_real.value),min_redeem:parseInt(s.target.min_redeem.value)}),e("Configuracoes salvas!","success"),await j()}catch(s){e("Erro ao salvar","error")}}async function b(s){if(s.preventDefault(),!u.name){e("Nome obrigatorio","error");return}h(!0);try{await (0,l.sg)("/loyalty.php",{action:"add_reward",...u}),e("Recompensa criada!","success"),o(!1),p({name:"",description:"",points_required:100,reward_type:"discount_percent",reward_value:10}),await j()}catch(s){e(s.message||"Erro ao criar recompensa","error")}h(!1)}async function N(s){if(confirm("Remover esta recompensa?"))try{await (0,l.sg)("/loyalty.php",{action:"delete_reward",reward_id:s}),e("Recompensa removida","success"),await j()}catch(s){e("Erro ao remover","error")}}if((0,t.useEffect)(()=>{j()},[]),n)return(0,r.jsx)("div",{style:{padding:60,textAlign:"center"},children:(0,r.jsx)("div",{className:"spinner"})});let f=(null==s?void 0:s.settings)||{},y=(null==s?void 0:s.stats)||{},_=(null==s?void 0:s.rewards)||[],w=(null==s?void 0:s.top_customers)||[],k={discount_percent:"Desconto %",discount_fixed:"Desconto R$",free_product:"Produto Gratis",free_delivery:"Frete Gratis"};return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"page-header",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"page-title",children:"Programa de Fidelidade"}),(0,r.jsx)("p",{className:"page-subtitle",children:"Recompense seus clientes mais fieis"})]}),(0,r.jsx)("button",{className:"btn ".concat(f.enabled?"btn-danger":"btn-success"),onClick:v,children:f.enabled?"Desativar Programa":"Ativar Programa"})]}),(0,r.jsxs)("div",{className:"loyalty-status-banner ".concat(f.enabled?"active":"inactive"),children:[(0,r.jsx)("div",{className:"loyalty-status-icon",children:f.enabled?"✅":"⏸️"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:f.enabled?"Programa Ativo":"Programa Inativo"}),(0,r.jsx)("p",{children:f.enabled?"Seus clientes estao acumulando pontos a cada compra!":"Ative o programa para comecar a fidelizar clientes."})]})]}),(0,r.jsxs)("div",{className:"stats-grid",style:{marginTop:24},children:[(0,r.jsxs)("div",{className:"stat-card",children:[(0,r.jsx)("div",{className:"stat-icon",style:{background:"#dbeafe"},children:(0,r.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#3b82f6",strokeWidth:"2",children:[(0,r.jsx)("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),(0,r.jsx)("circle",{cx:"9",cy:"7",r:"4"})]})}),(0,r.jsxs)("div",{className:"stat-content",children:[(0,r.jsx)("div",{className:"stat-value",children:y.total_members||0}),(0,r.jsx)("div",{className:"stat-label",children:"Membros"})]})]}),(0,r.jsxs)("div",{className:"stat-card",children:[(0,r.jsx)("div",{className:"stat-icon",style:{background:"#fef3c7"},children:(0,r.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#f59e0b",strokeWidth:"2",children:(0,r.jsx)("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})})}),(0,r.jsxs)("div",{className:"stat-content",children:[(0,r.jsx)("div",{className:"stat-value",children:y.total_points_outstanding||0}),(0,r.jsx)("div",{className:"stat-label",children:"Pontos em Circulacao"})]})]}),(0,r.jsxs)("div",{className:"stat-card",children:[(0,r.jsx)("div",{className:"stat-icon",style:{background:"#d1fae5"},children:(0,r.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#10b981",strokeWidth:"2",children:[(0,r.jsx)("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2",ry:"2"}),(0,r.jsx)("path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"})]})}),(0,r.jsxs)("div",{className:"stat-content",children:[(0,r.jsx)("div",{className:"stat-value",children:y.total_loyalty_orders||0}),(0,r.jsx)("div",{className:"stat-label",children:"Pedidos de Membros"})]})]}),(0,r.jsxs)("div",{className:"stat-card",children:[(0,r.jsx)("div",{className:"stat-icon",style:{background:"#ede9fe"},children:(0,r.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#8b5cf6",strokeWidth:"2",children:[(0,r.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),(0,r.jsx)("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]})}),(0,r.jsxs)("div",{className:"stat-content",children:[(0,r.jsx)("div",{className:"stat-value",children:x(y.total_loyalty_revenue)}),(0,r.jsx)("div",{className:"stat-label",children:"Receita de Membros"})]})]})]}),(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(350px, 1fr))",gap:24,marginTop:24},children:[(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("div",{className:"card-header",children:(0,r.jsx)("h2",{className:"card-title",children:"Configuracoes"})}),(0,r.jsxs)("form",{onSubmit:g,children:[(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{className:"form-label",children:"Pontos por R$ 1 gasto"}),(0,r.jsx)("input",{type:"number",name:"points_per_real",className:"form-input",defaultValue:f.points_per_real||1,min:"0.1",step:"0.1"}),(0,r.jsx)("small",{style:{color:"var(--color-text-secondary)"},children:"Ex: 1 = cliente ganha 1 ponto por R$1 gasto"})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{className:"form-label",children:"Minimo de pontos para resgate"}),(0,r.jsx)("input",{type:"number",name:"min_redeem",className:"form-input",defaultValue:f.min_redeem||50,min:"10"})]}),(0,r.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Salvar Configuracoes"})]})]}),(0,r.jsxs)("div",{className:"card",children:[(0,r.jsxs)("div",{className:"card-header",children:[(0,r.jsx)("h2",{className:"card-title",children:"Recompensas"}),(0,r.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>o(!d),children:d?"Cancelar":"+ Adicionar"})]}),d&&(0,r.jsxs)("form",{onSubmit:b,style:{marginBottom:16,paddingBottom:16,borderBottom:"1px solid var(--color-border)"},children:[(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{className:"form-label",children:"Nome da Recompensa"}),(0,r.jsx)("input",{type:"text",className:"form-input",value:u.name,onChange:e=>p(s=>({...s,name:e.target.value})),placeholder:"Ex: 10% de desconto"})]}),(0,r.jsxs)("div",{className:"form-row",children:[(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{className:"form-label",children:"Pontos Necessarios"}),(0,r.jsx)("input",{type:"number",className:"form-input",value:u.points_required,onChange:e=>p(s=>({...s,points_required:parseInt(e.target.value)})),min:"10"})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{className:"form-label",children:"Tipo"}),(0,r.jsx)("select",{className:"form-input",value:u.reward_type,onChange:e=>p(s=>({...s,reward_type:e.target.value})),children:Object.entries(k).map(e=>{let[s,a]=e;return(0,r.jsx)("option",{value:s,children:a},s)})})]})]}),("discount_percent"===u.reward_type||"discount_fixed"===u.reward_type)&&(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{className:"form-label",children:"Valor do Desconto"}),(0,r.jsx)("input",{type:"number",className:"form-input",value:u.reward_value,onChange:e=>p(s=>({...s,reward_value:parseFloat(e.target.value)})),min:"1"})]}),(0,r.jsx)("button",{type:"submit",className:"btn btn-success",disabled:m,children:m?"Salvando...":"Criar Recompensa"})]}),0===_.length?(0,r.jsx)("div",{className:"empty-state-small",children:"Nenhuma recompensa cadastrada"}):(0,r.jsx)("div",{className:"rewards-list",children:_.map(e=>(0,r.jsxs)("div",{className:"reward-item",children:[(0,r.jsxs)("div",{className:"reward-info",children:[(0,r.jsx)("strong",{children:e.name}),(0,r.jsxs)("span",{children:[e.points_required," pontos"]})]}),(0,r.jsxs)("div",{className:"reward-badge",children:[k[e.reward_type],("discount_percent"===e.reward_type||"discount_fixed"===e.reward_type)&&(0,r.jsxs)(r.Fragment,{children:[" - ","discount_percent"===e.reward_type?"".concat(e.reward_value,"%"):x(e.reward_value)]})]}),(0,r.jsx)("button",{className:"btn btn-danger btn-sm",onClick:()=>N(e.id),children:(0,r.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,r.jsx)("polyline",{points:"3 6 5 6 21 6"}),(0,r.jsx)("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]},e.id))})]})]}),w.length>0&&(0,r.jsxs)("div",{className:"card",style:{marginTop:24},children:[(0,r.jsx)("div",{className:"card-header",children:(0,r.jsx)("h2",{className:"card-title",children:"Top Clientes Fieis"})}),(0,r.jsx)("div",{className:"table-container",children:(0,r.jsxs)("table",{className:"data-table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"#"}),(0,r.jsx)("th",{children:"Cliente"}),(0,r.jsx)("th",{children:"Pontos"}),(0,r.jsx)("th",{children:"Pedidos"}),(0,r.jsx)("th",{children:"Total Gasto"})]})}),(0,r.jsx)("tbody",{children:w.map((e,s)=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:s+1}),(0,r.jsx)("td",{children:e.customer_name||e.customer_email||"Cliente"}),(0,r.jsx)("td",{children:(0,r.jsxs)("span",{className:"badge badge-warning",children:[e.points," pts"]})}),(0,r.jsx)("td",{children:e.total_orders}),(0,r.jsx)("td",{children:x(e.total_spent)})]},e.id))})]})})]})]})}}},function(e){e.O(0,[448,565,205,971,117,744],function(){return e(e.s=5230)}),_N_E=e.O()}]);