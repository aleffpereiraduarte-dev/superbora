(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[517],{4047:function(e,s,a){Promise.resolve().then(a.bind(a,9500))},9500:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return o}});var t=a(7437),n=a(2265),l=a(4565),i=a(4477),r=a(6428),c=a(6971);function o(){return(0,t.jsx)(l.Z,{children:(0,t.jsx)(i.Z,{children:(0,t.jsx)(d,{})})})}function d(){let{addNotification:e}=(0,c.l)(),[s,a]=(0,n.useState)([]),[l,i]=(0,n.useState)({}),[o,d]=(0,n.useState)(!0),[m,u]=(0,n.useState)(!1),[h,p]=(0,n.useState)(!1),[x,v]=(0,n.useState)("active"),[j,g]=(0,n.useState)({code:"",name:"",discount_type:"percent",discount_value:10,min_order_value:0,max_discount:"",target_segment:"all",usage_limit:"",per_customer_limit:1,valid_from:"",valid_until:""}),N=e=>{let s=parseFloat(e);return isNaN(s)?"R$ 0,00":s.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})};async function b(){try{let e=await (0,r.SC)("/smart-coupons.php?status=".concat(x));a(e.coupons||[]),i(e.segments||{})}catch(e){console.error(e)}d(!1)}async function f(s){if(s.preventDefault(),!j.code||!j.name){e("Codigo e nome obrigatorios","error");return}p(!0);try{await (0,r.sg)("/smart-coupons.php",{action:"create",...j}),e("Cupom criado!","success"),u(!1),g({code:"",name:"",discount_type:"percent",discount_value:10,min_order_value:0,max_discount:"",target_segment:"all",usage_limit:"",per_customer_limit:1,valid_from:"",valid_until:""}),await b()}catch(s){e(s.message||"Erro ao criar cupom","error")}p(!1)}async function _(s){try{await (0,r.sg)("/smart-coupons.php",{action:"toggle_status",id:s}),await b()}catch(s){e("Erro ao alterar status","error")}}async function C(s){if(confirm("Remover este cupom?"))try{await (0,r.apiDelete)("/smart-coupons.php?id=".concat(s)),e("Cupom removido","success"),a(e=>e.filter(e=>e.id!==s))}catch(s){e("Erro ao remover","error")}}async function y(s){try{let a=await (0,r.sg)("/smart-coupons.php",{action:"generate_smart",segment:s,budget:100});e("Cupom ".concat(a.code," criado com ").concat(a.discount,"% de desconto!"),"success"),await b()}catch(s){e("Erro ao gerar cupom","error")}}if((0,n.useEffect)(()=>{b()},[x]),o)return(0,t.jsx)("div",{style:{padding:60,textAlign:"center"},children:(0,t.jsx)("div",{className:"spinner"})});let D={all:"Todos",new:"Novos Clientes",returning:"Clientes Recorrentes",inactive:"Inativos (+30 dias)"};return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"page-header",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"page-title",children:"Cupons Inteligentes"}),(0,t.jsx)("p",{className:"page-subtitle",children:"Crie cupons segmentados para diferentes publicos"})]}),(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>u(!m),children:m?"Cancelar":"+ Novo Cupom"})]}),(0,t.jsxs)("div",{className:"smart-coupons-suggestions",children:[(0,t.jsx)("h3",{children:"Criar Cupom Inteligente"}),(0,t.jsx)("p",{children:"Gere cupons automaticamente baseados em segmentacao de clientes"}),(0,t.jsxs)("div",{className:"smart-coupon-buttons",children:[(0,t.jsxs)("button",{className:"smart-coupon-btn",onClick:()=>y("new"),children:[(0,t.jsx)("span",{className:"smart-coupon-icon",children:"\uD83D\uDC4B"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Novos Clientes"}),(0,t.jsxs)("small",{children:[l.new_customers||0," clientes"]})]})]}),(0,t.jsxs)("button",{className:"smart-coupon-btn",onClick:()=>y("returning"),children:[(0,t.jsx)("span",{className:"smart-coupon-icon",children:"\uD83D\uDD04"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Recorrentes"}),(0,t.jsxs)("small",{children:[l.returning_customers||0," clientes"]})]})]}),(0,t.jsxs)("button",{className:"smart-coupon-btn",onClick:()=>y("inactive"),children:[(0,t.jsx)("span",{className:"smart-coupon-icon",children:"\uD83D\uDE34"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Inativos"}),(0,t.jsxs)("small",{children:[l.inactive_customers||0," clientes"]})]})]})]})]}),m&&(0,t.jsxs)("div",{className:"card",style:{marginTop:24},children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h2",{className:"card-title",children:"Novo Cupom"})}),(0,t.jsxs)("form",{onSubmit:f,children:[(0,t.jsxs)("div",{className:"form-row",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Codigo do Cupom"}),(0,t.jsx)("input",{type:"text",className:"form-input",value:j.code,onChange:e=>g(s=>({...s,code:e.target.value.toUpperCase()})),placeholder:"PROMO10",maxLength:20})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Nome/Descricao"}),(0,t.jsx)("input",{type:"text",className:"form-input",value:j.name,onChange:e=>g(s=>({...s,name:e.target.value})),placeholder:"10% de desconto em qualquer pedido"})]})]}),(0,t.jsxs)("div",{className:"form-row",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Tipo de Desconto"}),(0,t.jsxs)("select",{className:"form-input",value:j.discount_type,onChange:e=>g(s=>({...s,discount_type:e.target.value})),children:[(0,t.jsx)("option",{value:"percent",children:"Porcentagem (%)"}),(0,t.jsx)("option",{value:"fixed",children:"Valor Fixo (R$)"})]})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Valor do Desconto"}),(0,t.jsx)("input",{type:"number",className:"form-input",value:j.discount_value,onChange:e=>g(s=>({...s,discount_value:parseFloat(e.target.value)})),min:"1"})]})]}),(0,t.jsxs)("div",{className:"form-row",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Valor Minimo do Pedido"}),(0,t.jsx)("input",{type:"number",className:"form-input",value:j.min_order_value,onChange:e=>g(s=>({...s,min_order_value:parseFloat(e.target.value)})),min:"0"})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Desconto Maximo (R$)"}),(0,t.jsx)("input",{type:"number",className:"form-input",value:j.max_discount,onChange:e=>g(s=>({...s,max_discount:e.target.value})),placeholder:"Sem limite"})]})]}),(0,t.jsxs)("div",{className:"form-row",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Publico Alvo"}),(0,t.jsxs)("select",{className:"form-input",value:j.target_segment,onChange:e=>g(s=>({...s,target_segment:e.target.value})),children:[(0,t.jsx)("option",{value:"all",children:"Todos os Clientes"}),(0,t.jsx)("option",{value:"new",children:"Novos Clientes"}),(0,t.jsx)("option",{value:"returning",children:"Clientes Recorrentes"}),(0,t.jsx)("option",{value:"inactive",children:"Clientes Inativos"})]})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Limite de Uso Total"}),(0,t.jsx)("input",{type:"number",className:"form-input",value:j.usage_limit,onChange:e=>g(s=>({...s,usage_limit:e.target.value})),placeholder:"Ilimitado"})]})]}),(0,t.jsxs)("div",{className:"form-row",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Valido De"}),(0,t.jsx)("input",{type:"date",className:"form-input",value:j.valid_from,onChange:e=>g(s=>({...s,valid_from:e.target.value}))})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Valido Ate"}),(0,t.jsx)("input",{type:"date",className:"form-input",value:j.valid_until,onChange:e=>g(s=>({...s,valid_until:e.target.value}))})]})]}),(0,t.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:h,children:h?"Criando...":"Criar Cupom"})]})]}),(0,t.jsxs)("div",{className:"card",style:{marginTop:24},children:[(0,t.jsxs)("div",{className:"card-header",children:[(0,t.jsxs)("h2",{className:"card-title",children:["Cupons (",s.length,")"]}),(0,t.jsxs)("div",{className:"filter-tabs",children:[(0,t.jsx)("button",{className:"filter-tab ".concat("active"===x?"active":""),onClick:()=>v("active"),children:"Ativos"}),(0,t.jsx)("button",{className:"filter-tab ".concat("expired"===x?"active":""),onClick:()=>v("expired"),children:"Expirados"}),(0,t.jsx)("button",{className:"filter-tab ".concat("all"===x?"active":""),onClick:()=>v("all"),children:"Todos"})]})]}),0===s.length?(0,t.jsxs)("div",{className:"empty-state",children:[(0,t.jsx)("div",{className:"empty-state-icon",children:(0,t.jsx)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:(0,t.jsx)("path",{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"})})}),(0,t.jsxs)("div",{className:"empty-state-text",children:["Nenhum cupom ","active"===x?"ativo":"expired"===x?"expirado":""]})]}):(0,t.jsx)("div",{className:"table-container",children:(0,t.jsxs)("table",{className:"data-table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Codigo"}),(0,t.jsx)("th",{children:"Nome"}),(0,t.jsx)("th",{children:"Desconto"}),(0,t.jsx)("th",{children:"Segmento"}),(0,t.jsx)("th",{children:"Uso"}),(0,t.jsx)("th",{children:"Validade"}),(0,t.jsx)("th",{children:"Status"}),(0,t.jsx)("th",{children:"Acoes"})]})}),(0,t.jsx)("tbody",{children:s.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:(0,t.jsx)("code",{className:"coupon-code",children:e.code})}),(0,t.jsx)("td",{children:e.name}),(0,t.jsxs)("td",{children:["percent"===e.discount_type?"".concat(e.discount_value,"%"):N(e.discount_value),e.min_order_value>0&&(0,t.jsxs)("small",{style:{display:"block",color:"var(--color-text-secondary)"},children:["min. ",N(e.min_order_value)]})]}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"badge badge-info",children:D[e.target_segment]||e.target_segment})}),(0,t.jsxs)("td",{children:[e.usage_count||0," / ",e.usage_limit||"∞"]}),(0,t.jsx)("td",{children:e.valid_until?new Date(e.valid_until).toLocaleDateString("pt-BR"):"Sem prazo"}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"badge ".concat(1==e.status?"badge-success":"badge-secondary"),children:1==e.status?"Ativo":"Inativo"})}),(0,t.jsx)("td",{children:(0,t.jsxs)("div",{className:"action-buttons",children:[(0,t.jsx)("button",{className:"btn btn-sm ".concat(1==e.status?"btn-secondary":"btn-success"),onClick:()=>_(e.id),title:1==e.status?"Desativar":"Ativar",children:1==e.status?"⏸️":"▶️"}),(0,t.jsx)("button",{className:"btn btn-danger btn-sm",onClick:()=>C(e.id),title:"Remover",children:"\uD83D\uDDD1️"})]})})]},e.id))})]})})]})]})}}},function(e){e.O(0,[448,565,205,971,117,744],function(){return e(e.s=4047)}),_N_E=e.O()}]);