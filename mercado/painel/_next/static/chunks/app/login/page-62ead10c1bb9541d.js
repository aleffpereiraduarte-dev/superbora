(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{2154:function(e,t,n){Promise.resolve().then(n.bind(n,2175))},6428:function(e,t,n){"use strict";n.d(t,{Fw:function(){return m},LP:function(){return o},SC:function(){return i},apiDelete:function(){return f},jn:function(){return p},o4:function(){return s},pE:function(){return h},sg:function(){return u},w9:function(){return g},zi:function(){return d}});let a="/api/mercado/partner",r="/api/mercado/parceiro",c="painel_partner_token";function o(){try{return localStorage.getItem(c)}catch(e){return null}}function s(e){try{e?localStorage.setItem(c,e):localStorage.removeItem(c)}catch(e){}}function l(){let e=o();return e?{Authorization:"Bearer ".concat(e)}:{}}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),r=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");r&&(n+="?".concat(r));let c=await fetch(n,{credentials:"include",headers:l()});if(!c.ok){let e=await c.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(c.status," ").concat(c.statusText))}let o=await c.json();if(!o.success)throw Error(o.message||"Erro desconhecido na API");return o.data}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...l()},body:JSON.stringify(t)}),r=await n.json().catch(()=>null);if(!n.ok||!(null==r?void 0:r.success))throw Error((null==r?void 0:r.message)||"API error: ".concat(n.status));return r.data}async function d(e,t){let n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:l(),body:t}),r=await n.json().catch(()=>null);if(!n.ok||!(null==r?void 0:r.success))throw Error((null==r?void 0:r.message)||"API error: ".concat(n.status));return r.data}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...l()},body:JSON.stringify(t)}),r=await n.json().catch(()=>null);if(!n.ok||!(null==r?void 0:r.success))throw Error((null==r?void 0:r.message)||"API error: ".concat(n.status));return r.data}async function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),r=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");r&&(n+="?".concat(r));let c=await fetch(n,{method:"DELETE",credentials:"include",headers:l()}),o=await c.json().catch(()=>null);if(!c.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(c.status));return o.data}async function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(r).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...l()},body:JSON.stringify(t)}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function p(e,t){let n=await fetch("".concat(r).concat(e),{method:"POST",credentials:"include",headers:l(),body:t}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return u(e,t)}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return s},a:function(){return l}});var a=n(7437),r=n(2265),c=n(6428);let o=(0,r.createContext)(null);function s(e){let{children:t}=e,[n,s]=(0,r.useState)(null),[l,i]=(0,r.useState)(!0),u=(0,r.useCallback)(async()=>{if(!(0,c.LP)()){s(null),i(!1);return}try{let e=await (0,c.SC)("/auth/session.php");e.authenticated&&e.partner?s(e.partner):((0,c.o4)(null),s(null))}catch(e){(0,c.o4)(null),s(null)}finally{i(!1)}},[]);(0,r.useEffect)(()=>{u()},[u]);let d=(0,r.useCallback)(async(e,t)=>{let n=await (0,c.sg)("/auth/login.php",{email:e,senha:t});(0,c.o4)(n.token);let a=n.partner||{id:n.partner_id,nome:n.nome,email:n.email,cnpj:n.cnpj,logo:n.logo,categoria:n.categoria,status:n.status};return s(a),a},[]),h=(0,r.useCallback)(e=>{s(t=>t?{...t,...e}:t)},[]),f=(0,r.useCallback)(()=>{(0,c.o4)(null),s(null)},[]);return(0,a.jsx)(o.Provider,{value:{partner:n,loading:l,isAuthenticated:!!n,login:d,logout:f,updatePartner:h,refreshSession:u},children:t})}function l(){let e=(0,r.useContext)(o);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},2175:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return s}});var a=n(7437),r=n(2265),c=n(9376),o=n(7128);function s(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{className:"loading-screen",children:(0,a.jsx)("div",{className:"spinner"})}),children:(0,a.jsx)(l,{})})}function l(){let{login:e,isAuthenticated:t,loading:n}=(0,o.a)(),s=(0,c.useRouter)(),l=(0,c.useSearchParams)(),[i,u]=(0,r.useState)(""),[d,h]=(0,r.useState)(""),[f,m]=(0,r.useState)(""),[p,g]=(0,r.useState)(!1);async function v(t){if(t.preventDefault(),m(""),!i.trim()||!d.trim()){m("Preencha email e senha.");return}g(!0);try{await e(i,d);let t=l.get("return")||"/";s.push(t)}catch(e){m(e.message||"Erro ao fazer login. Tente novamente.")}finally{g(!1)}}return((0,r.useEffect)(()=>{if(!n&&t){let e=l.get("return")||"/";s.push(e)}},[n,t,s,l]),n)?(0,a.jsx)("div",{className:"loading-screen",children:(0,a.jsx)("div",{className:"spinner"})}):t?null:(0,a.jsx)("div",{className:"login-page",children:(0,a.jsxs)("div",{className:"login-card",children:[(0,a.jsxs)("div",{className:"login-logo",children:[(0,a.jsx)("h1",{children:"SuperBora"}),(0,a.jsx)("p",{children:"Painel do Parceiro"})]}),f&&(0,a.jsx)("div",{className:"login-error",children:f}),(0,a.jsxs)("form",{onSubmit:v,children:[(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{className:"form-label",children:"Email"}),(0,a.jsx)("input",{type:"email",className:"form-input",placeholder:"seu@email.com",value:i,onChange:e=>u(e.target.value),autoComplete:"email",disabled:p})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{className:"form-label",children:"Senha"}),(0,a.jsx)("input",{type:"password",className:"form-input",placeholder:"Sua senha",value:d,onChange:e=>h(e.target.value),autoComplete:"current-password",disabled:p})]}),(0,a.jsx)("button",{type:"submit",className:"btn btn-primary btn-block btn-lg",disabled:p,style:{marginTop:8},children:p?(0,a.jsx)("span",{className:"spinner-sm"}):"Entrar"})]}),(0,a.jsxs)("div",{className:"login-cadastro-link",children:["Ainda nao tem cadastro? ",(0,a.jsx)("a",{href:"/cadastro",children:"Cadastre-se"})]})]})})}},9376:function(e,t,n){"use strict";var a=n(5475);n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}}),n.o(a,"useSearchParams")&&n.d(t,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=2154)}),_N_E=e.O()}]);