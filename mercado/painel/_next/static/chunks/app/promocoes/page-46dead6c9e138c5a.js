(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[219],{3279:function(e,a,t){Promise.resolve().then(t.bind(t,1222))},1222:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return l}});var s=t(7437),i=t(2265),n=t(4565),r=t(4477),c=t(6428),o=t(6971);function d(e){return e?new Date(e).toLocaleDateString("pt-BR"):""}function l(){return(0,s.jsx)(n.Z,{children:(0,s.jsx)(r.Z,{children:(0,s.jsx)(m,{})})})}function m(){let{addNotification:e}=(0,o.l)(),[a,t]=(0,i.useState)([]),[n,r]=(0,i.useState)(!0),[l,m]=(0,i.useState)(""),[u,p]=(0,i.useState)(!1),[h,x]=(0,i.useState)(null),[j,_]=(0,i.useState)({product_id:"",product_name:"",desconto_percentual:"",data_inicio:"",data_fim:""}),[f,N]=(0,i.useState)(!1),[b,v]=(0,i.useState)([]),g=(0,i.useCallback)(async()=>{r(!0),m("");try{let e=await (0,c.SC)("/promotions.php");t((null==e?void 0:e.promotions)||(Array.isArray(e)?e:[]))}catch(e){m(e.message)}finally{r(!1)}},[]);async function y(a){a.preventDefault(),N(!0);try{let a={product_id:j.product_id,desconto_percentual:parseFloat(j.desconto_percentual)||0,data_inicio:j.data_inicio,data_fim:j.data_fim};h&&(a.id=h.id||h.promotion_id),await (0,c.sg)("/promotions.php",a),e(h?"Promocao atualizada!":"Promocao criada!","success"),p(!1),x(null),g()}catch(a){e(a.message,"error")}finally{N(!1)}}async function C(a){if(confirm("Tem certeza que deseja excluir esta promocao?"))try{await (0,c.apiDelete)("/promotions.php",{id:a.id||a.promotion_id}),e("Promocao excluida!","success"),g()}catch(a){e(a.message,"error")}}function S(e){let a=new Date,t=e.data_inicio||e.start_date,s=e.data_fim||e.end_date;return!(t&&new Date(t)>a||s&&new Date(s)<a)}return(0,i.useEffect)(()=>{g(),(0,c.SC)("/products.php",{page:1,limit:1e3}).then(e=>v(e.products||[])).catch(()=>{})},[g]),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"page-header",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"page-title",children:"Promocoes"}),(0,s.jsx)("p",{className:"page-subtitle",children:"Gerencie descontos e ofertas especiais"})]}),(0,s.jsx)("button",{className:"btn btn-primary",onClick:function(){x(null),_({product_id:"",product_name:"",desconto_percentual:"",data_inicio:"",data_fim:""}),p(!0)},children:"+ Nova Promocao"})]}),n?(0,s.jsx)("div",{className:"loading-screen",children:(0,s.jsx)("div",{className:"spinner"})}):l?(0,s.jsxs)("div",{className:"empty-state",children:[(0,s.jsx)("div",{className:"empty-state-title",children:"Erro ao carregar promocoes"}),(0,s.jsx)("div",{className:"empty-state-text",children:l})]}):0===a.length?(0,s.jsxs)("div",{className:"empty-state",children:[(0,s.jsx)("div",{className:"empty-state-title",children:"Nenhuma promocao cadastrada"}),(0,s.jsx)("div",{className:"empty-state-text",children:"Crie sua primeira promocao para atrair mais clientes"})]}):(0,s.jsx)("div",{className:"table-wrapper",children:(0,s.jsxs)("table",{className:"table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Produto"}),(0,s.jsx)("th",{style:{textAlign:"right"},children:"Desconto"}),(0,s.jsx)("th",{children:"Inicio"}),(0,s.jsx)("th",{children:"Fim"}),(0,s.jsx)("th",{children:"Status"}),(0,s.jsx)("th",{style:{textAlign:"right",width:160},children:"Acoes"})]})}),(0,s.jsx)("tbody",{children:a.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{style:{fontWeight:500},children:e.product_name||e.produto_nome||"Produto #".concat(e.product_id||e.produto_id)}),(0,s.jsxs)("td",{style:{textAlign:"right",fontWeight:600,color:"var(--color-danger)"},children:[e.desconto_percentual||e.discount_percent,"%"]}),(0,s.jsx)("td",{children:d(e.data_inicio||e.start_date)}),(0,s.jsx)("td",{children:d(e.data_fim||e.end_date)}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{className:"badge ".concat(S(e)?"badge-success":"badge-neutral"),children:S(e)?"Ativa":"Inativa"})}),(0,s.jsx)("td",{style:{textAlign:"right"},children:(0,s.jsxs)("div",{style:{display:"flex",gap:4,justifyContent:"flex-end"},children:[(0,s.jsx)("button",{className:"btn btn-secondary btn-sm",onClick:()=>{x(e),_({product_id:e.product_id||e.produto_id||"",product_name:e.product_name||e.produto_nome||"",desconto_percentual:e.desconto_percentual||e.discount_percent||"",data_inicio:e.data_inicio||e.start_date||"",data_fim:e.data_fim||e.end_date||""}),p(!0)},children:"Editar"}),(0,s.jsx)("button",{className:"btn btn-danger btn-sm",onClick:()=>C(e),children:"Excluir"})]})})]},e.id||e.promotion_id))})]})}),u&&(0,s.jsx)("div",{className:"modal-overlay",onClick:e=>e.target===e.currentTarget&&p(!1),children:(0,s.jsxs)("div",{className:"modal",children:[(0,s.jsxs)("div",{className:"modal-header",children:[(0,s.jsx)("h3",{className:"modal-title",children:h?"Editar Promocao":"Nova Promocao"}),(0,s.jsx)("button",{className:"modal-close",onClick:()=>p(!1),children:"\xd7"})]}),(0,s.jsxs)("form",{onSubmit:y,children:[(0,s.jsxs)("div",{className:"modal-body",children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"form-label",children:"Produto"}),(0,s.jsxs)("select",{className:"form-select",value:j.product_id,onChange:e=>_({...j,product_id:e.target.value}),required:!0,children:[(0,s.jsx)("option",{value:"",children:"Selecione um produto"}),b.map(e=>(0,s.jsx)("option",{value:e.id||e.product_id,children:e.nome||e.name},e.id||e.product_id))]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"form-label",children:"Desconto (%)"}),(0,s.jsx)("input",{type:"number",step:"1",min:"1",max:"100",className:"form-input",value:j.desconto_percentual,onChange:e=>_({...j,desconto_percentual:e.target.value}),placeholder:"Ex: 20",required:!0})]}),(0,s.jsxs)("div",{className:"form-row",children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"form-label",children:"Data Inicio"}),(0,s.jsx)("input",{type:"date",className:"form-input",value:j.data_inicio,onChange:e=>_({...j,data_inicio:e.target.value}),required:!0})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"form-label",children:"Data Fim"}),(0,s.jsx)("input",{type:"date",className:"form-input",value:j.data_fim,onChange:e=>_({...j,data_fim:e.target.value}),required:!0})]})]})]}),(0,s.jsxs)("div",{className:"modal-footer",children:[(0,s.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>p(!1),children:"Cancelar"}),(0,s.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:f,children:f?(0,s.jsx)("span",{className:"spinner-sm"}):h?"Atualizar":"Criar"})]})]})]})})]})}}},function(e){e.O(0,[448,565,205,971,117,744],function(){return e(e.s=3279)}),_N_E=e.O()}]);