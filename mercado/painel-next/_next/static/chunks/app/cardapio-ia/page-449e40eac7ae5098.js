(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1157],{2132:function(e,t,n){Promise.resolve().then(n.bind(n,7290))},6428:function(e,t,n){"use strict";n.d(t,{Fw:function(){return f},LP:function(){return i},SC:function(){return l},apiDelete:function(){return h},jn:function(){return g},o4:function(){return s},pE:function(){return p},sg:function(){return d},w9:function(){return m},zi:function(){return u}});let a="/api/mercado/partner",o="/api/mercado/parceiro",r="painel_partner_token";function i(){try{return localStorage.getItem(r)}catch(e){return null}}function s(e){try{e?localStorage.setItem(r,e):localStorage.removeItem(r)}catch(e){}}function c(){let e=i();return e?{Authorization:"Bearer ".concat(e)}:{}}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),o=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");o&&(n+="?".concat(o));let r=await fetch(n,{credentials:"include",headers:c()});if(!r.ok){let e=await r.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(r.status," ").concat(r.statusText))}let i=await r.json();if(!i.success)throw Error(i.message||"Erro desconhecido na API");return i.data}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...c()},body:JSON.stringify(t)}),o=await n.json().catch(()=>null);if(!n.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(n.status));return o.data}async function u(e,t){let n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:c(),body:t}),o=await n.json().catch(()=>null);if(!n.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(n.status));return o.data}async function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...c()},body:JSON.stringify(t)}),o=await n.json().catch(()=>null);if(!n.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(n.status));return o.data}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),o=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");o&&(n+="?".concat(o));let r=await fetch(n,{method:"DELETE",credentials:"include",headers:c()}),i=await r.json().catch(()=>null);if(!r.ok||!(null==i?void 0:i.success))throw Error((null==i?void 0:i.message)||"API error: ".concat(r.status));return i.data}async function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(o).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...c()},body:JSON.stringify(t)}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function g(e,t){let n=await fetch("".concat(o).concat(e),{method:"POST",credentials:"include",headers:c(),body:t}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d(e,t)}},7290:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var a=n(7437),o=n(2265),r=n(7128),i=n(6428);let s={UPLOAD:"upload",PROCESSING:"processing",REVIEW:"review",IMPORTING:"importing",DONE:"done"};function c(){let{partner:e}=(0,r.a)(),t=(0,o.useRef)(null),[n,c]=(0,o.useState)(s.UPLOAD),[d,u]=(0,o.useState)(""),[p,h]=(0,o.useState)(!1),[f,g]=(0,o.useState)([]),[m,x]=(0,o.useState)(0),[y,j]=(0,o.useState)(null),[b,v]=(0,o.useState)({});async function w(e){if(e){if(!["image/jpeg","image/png","image/webp","image/gif"].includes(e.type)){u("Formato nao suportado. Use JPEG, PNG, WebP ou GIF.");return}if(e.size>10485760){u("Imagem muito grande. Maximo 10 MB.");return}u(""),c(s.PROCESSING);try{let t=new FormData;t.append("image",e);let n=await (0,i.zi)("/ai-menu.php",t),a=n.categories||[];g(a),x(n.total_products||0);let o={};a.forEach((e,t)=>{(e.products||[]).forEach((e,n)=>{o["".concat(t,"-").concat(n)]=!0})}),v(o),c(s.REVIEW)}catch(e){u(e.message||"Erro ao processar cardapio"),c(s.UPLOAD)}}}async function S(e){if(e.trim()){u(""),c(s.PROCESSING);try{let t=await (0,i.sg)("/ai-menu.php",{text:e}),n=t.categories||[];g(n),x(t.total_products||0);let a={};n.forEach((e,t)=>{(e.products||[]).forEach((e,n)=>{a["".concat(t,"-").concat(n)]=!0})}),v(a),c(s.REVIEW)}catch(e){u(e.message||"Erro ao processar cardapio"),c(s.UPLOAD)}}}function E(e,t,n,a){g(o=>{let r=[...o];return r[e]={...r[e],products:[...r[e].products]},r[e].products[t]={...r[e].products[t],[n]:a},r})}async function k(){u(""),c(s.IMPORTING);let e={categories:[]};if(f.forEach((t,n)=>{let a=(t.products||[]).filter((e,t)=>b["".concat(n,"-").concat(t)]);a.length>0&&e.categories.push({name:t.name,products:a})}),0===e.categories.length){u("Selecione pelo menos 1 produto para importar."),c(s.REVIEW);return}try{let t=await (0,i.sg)("/ai-menu-confirm.php",e);j(t),c(s.DONE)}catch(e){u(e.message||"Erro ao importar produtos"),c(s.REVIEW)}}function C(){c(s.UPLOAD),g([]),v({}),j(null),u("")}let I=Object.values(b).filter(Boolean).length;return(0,a.jsxs)("div",{className:"page-container",children:[(0,a.jsxs)("div",{className:"page-header",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"page-title",children:"Cardapio com IA"}),(0,a.jsx)("p",{className:"page-subtitle",children:"Envie uma foto do cardapio e a IA extrai os produtos automaticamente"})]}),n!==s.UPLOAD&&n!==s.PROCESSING&&(0,a.jsx)("button",{className:"btn btn-secondary",onClick:C,children:"Novo Envio"})]}),d&&(0,a.jsxs)("div",{className:"alert alert-error",style:{marginBottom:16},children:[d,(0,a.jsx)("button",{onClick:()=>u(""),style:{marginLeft:8,background:"none",border:"none",cursor:"pointer"},children:"x"})]}),n===s.UPLOAD&&(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{style:{border:"2px dashed ".concat(p?"#2563eb":"#cbd5e1"),borderRadius:12,padding:48,textAlign:"center",background:p?"#eff6ff":"#fafbfc",cursor:"pointer",transition:"all 0.2s"},onClick:()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.click()},onDragOver:e=>{e.preventDefault(),h(!0)},onDragLeave:()=>h(!1),onDrop:e=>{e.preventDefault(),h(!1),w(e.dataTransfer.files[0])},children:[(0,a.jsx)("input",{ref:t,type:"file",accept:"image/*",style:{display:"none"},onChange:e=>w(e.target.files[0])}),(0,a.jsx)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"#94a3b8",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",style:{margin:"0 auto 16px"},children:(0,a.jsx)("path",{d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,a.jsx)("p",{style:{fontSize:16,fontWeight:500,color:"#374151"},children:"Arraste uma foto do cardapio ou clique para selecionar"}),(0,a.jsx)("p",{style:{fontSize:13,color:"#94a3b8",marginTop:8},children:"JPEG, PNG, WebP ou GIF (max 10 MB)"})]}),(0,a.jsx)("div",{style:{textAlign:"center",margin:"24px 0",color:"#94a3b8",fontSize:13},children:"ou"}),(0,a.jsx)(l,{onSubmit:S})]}),n===s.PROCESSING&&(0,a.jsxs)("div",{className:"card",style:{textAlign:"center",padding:48},children:[(0,a.jsx)("div",{className:"spinner",style:{margin:"0 auto 16px"}}),(0,a.jsx)("h3",{style:{fontSize:18,fontWeight:600,marginBottom:8},children:"Analisando cardapio com IA..."}),(0,a.jsx)("p",{style:{color:"#64748b",fontSize:14},children:"A inteligencia artificial esta extraindo produtos, precos e categorias. Isso pode levar ate 30 segundos."})]}),n===s.REVIEW&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"card",style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{style:{fontSize:15,fontWeight:600},children:[m," produto(s) encontrado(s)"]}),(0,a.jsxs)("span",{style:{fontSize:13,color:"#64748b",marginLeft:8},children:[I," selecionado(s)"]})]}),(0,a.jsxs)("button",{className:"btn btn-primary",onClick:k,disabled:0===I,children:["Importar ",I," Produto(s)"]})]}),f.map((e,t)=>(0,a.jsxs)("div",{className:"card",style:{marginBottom:16,padding:0,overflow:"hidden"},children:[(0,a.jsxs)("div",{style:{padding:"12px 16px",background:"#f8fafc",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("input",{type:"checkbox",checked:(e.products||[]).every((e,n)=>b["".concat(t,"-").concat(n)]),onChange:()=>(function(e){let t=f[e],n=(t.products||[]).every((t,n)=>b["".concat(e,"-").concat(n)]),a={...b};(t.products||[]).forEach((t,o)=>{a["".concat(e,"-").concat(o)]=!n}),v(a)})(t),style:{accentColor:"#2563eb"}}),(0,a.jsx)("input",{className:"form-input",value:e.name,onChange:e=>{var n;return n=e.target.value,void g(e=>{let a=[...e];return a[t]={...a[t],name:n},a})},style:{fontWeight:600,fontSize:15,border:"none",background:"transparent",padding:0}})]}),(0,a.jsxs)("span",{style:{fontSize:12,color:"#94a3b8"},children:[(e.products||[]).length," produtos"]})]}),(0,a.jsx)("div",{style:{overflowX:"auto"},children:(0,a.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{style:{background:"#fafbfc",color:"#64748b",fontSize:12},children:[(0,a.jsx)("th",{style:{padding:"8px 12px",textAlign:"left",width:40}}),(0,a.jsx)("th",{style:{padding:"8px 12px",textAlign:"left"},children:"Produto"}),(0,a.jsx)("th",{style:{padding:"8px 12px",textAlign:"left"},children:"Descricao"}),(0,a.jsx)("th",{style:{padding:"8px 12px",textAlign:"right",width:120},children:"Preco"}),(0,a.jsx)("th",{style:{padding:"8px 12px",textAlign:"center",width:80},children:"Opcoes"})]})}),(0,a.jsx)("tbody",{children:(e.products||[]).map((e,n)=>(0,a.jsxs)("tr",{style:{borderBottom:"1px solid #f1f5f9",opacity:b["".concat(t,"-").concat(n)]?1:.4},children:[(0,a.jsx)("td",{style:{padding:"8px 12px"},children:(0,a.jsx)("input",{type:"checkbox",checked:!!b["".concat(t,"-").concat(n)],onChange:()=>(function(e,t){let n="".concat(e,"-").concat(t);v(e=>({...e,[n]:!e[n]}))})(t,n),style:{accentColor:"#2563eb"}})}),(0,a.jsx)("td",{style:{padding:"8px 12px"},children:(0,a.jsx)("input",{className:"form-input",value:e.name,onChange:e=>E(t,n,"name",e.target.value),style:{fontSize:13,padding:"4px 8px",border:"1px solid #e2e8f0",borderRadius:4}})}),(0,a.jsx)("td",{style:{padding:"8px 12px"},children:(0,a.jsx)("input",{className:"form-input",value:e.description||"",onChange:e=>E(t,n,"description",e.target.value),placeholder:"Descricao",style:{fontSize:13,padding:"4px 8px",border:"1px solid #e2e8f0",borderRadius:4}})}),(0,a.jsx)("td",{style:{padding:"8px 12px",textAlign:"right"},children:(0,a.jsx)("input",{type:"number",className:"form-input",value:e.price||0,onChange:e=>E(t,n,"price",parseFloat(e.target.value)||0),step:"0.01",min:"0",style:{fontSize:13,padding:"4px 8px",width:100,textAlign:"right",border:"1px solid #e2e8f0",borderRadius:4}})}),(0,a.jsx)("td",{style:{padding:"8px 12px",textAlign:"center",fontSize:12,color:"#64748b"},children:(e.options||[]).length>0?"".concat(e.options.length," grupo(s)"):"-"})]},n))})]})})]},t))]}),n===s.IMPORTING&&(0,a.jsxs)("div",{className:"card",style:{textAlign:"center",padding:48},children:[(0,a.jsx)("div",{className:"spinner",style:{margin:"0 auto 16px"}}),(0,a.jsx)("h3",{style:{fontSize:18,fontWeight:600},children:"Importando produtos..."})]}),n===s.DONE&&y&&(0,a.jsxs)("div",{className:"card",style:{textAlign:"center",padding:48},children:[(0,a.jsxs)("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"#16a34a",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{margin:"0 auto 16px"},children:[(0,a.jsx)("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),(0,a.jsx)("polyline",{points:"22 4 12 14.01 9 11.01"})]}),(0,a.jsx)("h3",{style:{fontSize:20,fontWeight:600,color:"#16a34a",marginBottom:8},children:"Importacao Concluida!"}),(0,a.jsxs)("div",{style:{color:"#64748b",fontSize:14,lineHeight:1.8},children:[(0,a.jsxs)("p",{children:[y.products_created," produto(s) criado(s)"]}),(0,a.jsxs)("p",{children:[y.categories_created," categoria(s) criada(s)"]}),y.option_groups_created>0&&(0,a.jsxs)("p",{children:[y.option_groups_created," grupo(s) de opcao criado(s)"]})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:12,justifyContent:"center",marginTop:24},children:[(0,a.jsx)("button",{className:"btn btn-primary",onClick:()=>window.location.href="/produtos",children:"Ver Produtos"}),(0,a.jsx)("button",{className:"btn btn-secondary",onClick:C,children:"Importar Outro"})]})]})]})}function l(e){let{onSubmit:t}=e,[n,r]=(0,o.useState)(""),[i,s]=(0,o.useState)(!1);async function c(e){if(e.preventDefault(),n.trim()){s(!0);try{await t(n)}finally{s(!1)}}}return(0,a.jsxs)("form",{onSubmit:c,children:[(0,a.jsx)("label",{className:"form-label",children:"Ou descreva seu cardapio em texto:"}),(0,a.jsx)("textarea",{className:"form-input",rows:4,placeholder:"Ex: Pizza Margherita R$29,90, Pizza Calabresa R$32,90...",value:n,onChange:e=>r(e.target.value),style:{resize:"vertical",marginBottom:12}}),(0,a.jsx)("button",{type:"submit",className:"btn btn-primary btn-block",disabled:i||!n.trim(),children:i?"Enviando...":"Analisar com IA"})]})}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return s},a:function(){return c}});var a=n(7437),o=n(2265),r=n(6428);let i=(0,o.createContext)(null);function s(e){let{children:t}=e,[n,s]=(0,o.useState)(null),[c,l]=(0,o.useState)(!0),[d,u]=(0,o.useState)(null),p=(0,o.useCallback)(async()=>{if(!(0,r.LP)()){s(null),l(!1);return}try{let e=await (0,r.SC)("/auth/session.php");e.authenticated&&e.partner?s(e.partner):((0,r.o4)(null),s(null))}catch(e){console.warn("Session check failed (network error), keeping session:",e)}finally{l(!1)}},[]);(0,o.useEffect)(()=>{p()},[p]);let h=(0,o.useCallback)(async(e,t)=>{let n=await (0,r.sg)("/auth/login.php",{email:e,senha:t});if(n.requires_2fa)return u({partner_id:n.partner_id,nome:n.nome,temp_token:n.temp_token}),{requires_2fa:!0};(0,r.o4)(n.token);let a=n.partner||{id:n.partner_id,nome:n.nome,email:n.email,cnpj:n.cnpj,logo:n.logo,categoria:n.categoria,status:n.status};return s(a),u(null),a},[]),f=(0,o.useCallback)(async e=>{if(!d)throw Error("Nenhuma verificacao 2FA pendente");let t=await (0,r.sg)("/auth/totp-verify.php",{temp_token:d.temp_token,code:e});(0,r.o4)(t.token);let n=t.partner||{id:t.partner_id,nome:t.nome,email:t.email,cnpj:t.cnpj,logo:t.logo,categoria:t.categoria,status:t.status};return s(n),u(null),n},[d]),g=(0,o.useCallback)(()=>{u(null)},[]),m=(0,o.useCallback)(e=>{s(t=>t?{...t,...e}:t)},[]),x=(0,o.useCallback)(()=>{(0,r.o4)(null),s(null),u(null)},[]);return(0,a.jsx)(i.Provider,{value:{partner:n,loading:c,isAuthenticated:!!n,twoFactorPending:d,login:h,verifyTotp:f,cancelTotp:g,logout:x,updatePartner:m,refreshSession:p},children:t})}function c(){let e=(0,o.useContext)(i);if(!e)throw Error("useAuth must be used within AuthProvider");return e}}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=2132)}),_N_E=e.O()}]);