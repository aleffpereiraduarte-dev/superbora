(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[918],{0:function(e,t,n){Promise.resolve().then(n.bind(n,3212))},6428:function(e,t,n){"use strict";n.d(t,{Fw:function(){return h},LP:function(){return o},SC:function(){return l},apiDelete:function(){return m},jn:function(){return f},o4:function(){return s},pE:function(){return p},sg:function(){return d},w9:function(){return g},zi:function(){return u}});let i="/api/mercado/partner",a="/api/mercado/parceiro",r="painel_partner_token";function o(){try{return localStorage.getItem(r)}catch(e){return null}}function s(e){try{e?localStorage.setItem(r,e):localStorage.removeItem(r)}catch(e){}}function c(){let e=o();return e?{Authorization:"Bearer ".concat(e)}:{}}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(i).concat(e),a=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");a&&(n+="?".concat(a));let r=await fetch(n,{credentials:"include",headers:c()});if(!r.ok){let e=await r.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(r.status," ").concat(r.statusText))}let o=await r.json();if(!o.success)throw Error(o.message||"Erro desconhecido na API");return o.data}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(i).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...c()},body:JSON.stringify(t)}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function u(e,t){let n=await fetch("".concat(i).concat(e),{method:"POST",credentials:"include",headers:c(),body:t}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(i).concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...c()},body:JSON.stringify(t)}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(i).concat(e),a=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");a&&(n+="?".concat(a));let r=await fetch(n,{method:"DELETE",credentials:"include",headers:c()}),o=await r.json().catch(()=>null);if(!r.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(r.status));return o.data}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...c()},body:JSON.stringify(t)}),i=await n.json().catch(()=>null);if(!n.ok||!(null==i?void 0:i.success))throw Error((null==i?void 0:i.message)||"API error: ".concat(n.status));return i.data}async function f(e,t){let n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:c(),body:t}),i=await n.json().catch(()=>null);if(!n.ok||!(null==i?void 0:i.success))throw Error((null==i?void 0:i.message)||"API error: ".concat(n.status));return i.data}async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d(e,t)}},3212:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var i=n(7437),a=n(2265),r=n(6428);function o(){let[e,t]=(0,a.useState)([]),[n,o]=(0,a.useState)(!0),[s,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(null),[u,p]=(0,a.useState)({name:"",description:"",price:"",image:"",items:[]}),[m,h]=(0,a.useState)([]),[f,g]=(0,a.useState)(""),[x,y]=(0,a.useState)(!1),b=(0,a.useCallback)(()=>{o(!0),(0,r.SC)("/partner/combos.php").then(e=>t(e.combos||[])).catch(()=>t([])).finally(()=>o(!1))},[]);function j(){p({name:"",description:"",price:"",image:"",items:[]}),d(null),c(!0)}async function v(e){if(confirm("Remover este combo?"))try{await (0,r.apiDelete)("/partner/combos.php",{id:e}),b()}catch(e){alert(e.message)}}async function N(e){try{var t;await (0,r.sg)("/partner/combos.php",{id:e.id,name:e.name,description:e.description,image:e.image,price:e.price,status:1===Number(e.status)?0:1,items:(null===(t=e.items)||void 0===t?void 0:t.map(e=>({product_id:e.product_id,quantity:e.quantity})))||[]}),b()}catch(e){alert(e.message)}}async function C(e){if(e.length<2){h([]);return}try{let t=await (0,r.SC)("/partner/products.php",{search:e,limit:10});h(t.products||[])}catch(e){h([])}}function w(e,t){p(n=>({...n,items:n.items.map(n=>n.product_id===e?{...n,quantity:Math.max(1,t)}:n)}))}async function S(){if(!u.name.trim()){alert("Nome obrigatorio");return}if(!u.price||0>=parseFloat(u.price)){alert("Preco obrigatorio");return}if(0===u.items.length){alert("Adicione pelo menos 1 produto");return}y(!0);try{await (0,r.sg)("/partner/combos.php",{id:l||void 0,name:u.name,description:u.description,image:u.image,price:parseFloat(u.price),items:u.items.map(e=>({product_id:e.product_id,quantity:e.quantity}))}),c(!1),b()}catch(e){alert(e.message)}finally{y(!1)}}(0,a.useEffect)(()=>{b()},[b]);let k=u.items.reduce((e,t)=>e+(t.price||0)*t.quantity,0),_=k>0&&parseFloat(u.price)>0?Math.round((1-parseFloat(u.price)/k)*100):0;return(0,i.jsxs)("div",{className:"page-container",children:[(0,i.jsxs)("div",{className:"page-header",children:[(0,i.jsx)("h1",{className:"page-title",children:"Combos"}),(0,i.jsx)("button",{className:"btn btn-primary",onClick:j,children:"+ Novo Combo"})]}),s&&(0,i.jsxs)("div",{className:"card",style:{marginBottom:20},children:[(0,i.jsx)("div",{className:"card-header",children:(0,i.jsx)("h3",{children:l?"Editar Combo":"Novo Combo"})}),(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,i.jsxs)("div",{className:"form-group",style:{gridColumn:"1/-1"},children:[(0,i.jsx)("label",{className:"form-label",children:"Nome do combo"}),(0,i.jsx)("input",{className:"form-input",value:u.name,onChange:e=>p(t=>({...t,name:e.target.value})),placeholder:"Ex: Combo Familia"})]}),(0,i.jsxs)("div",{className:"form-group",style:{gridColumn:"1/-1"},children:[(0,i.jsx)("label",{className:"form-label",children:"Descricao"}),(0,i.jsx)("textarea",{className:"form-input",rows:2,value:u.description,onChange:e=>p(t=>({...t,description:e.target.value})),placeholder:"Descricao opcional"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{className:"form-label",children:"Preco do combo (R$)"}),(0,i.jsx)("input",{className:"form-input",type:"number",step:"0.01",value:u.price,onChange:e=>p(t=>({...t,price:e.target.value})),placeholder:"0.00"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{className:"form-label",children:"URL da imagem"}),(0,i.jsx)("input",{className:"form-input",value:u.image,onChange:e=>p(t=>({...t,image:e.target.value})),placeholder:"https://..."})]})]}),(0,i.jsxs)("div",{style:{marginTop:16},children:[(0,i.jsx)("label",{className:"form-label",children:"Produtos do combo"}),(0,i.jsx)("input",{className:"form-input",value:f,onChange:e=>{g(e.target.value),C(e.target.value)},placeholder:"Buscar produto para adicionar..."}),m.length>0&&(0,i.jsx)("div",{style:{border:"1px solid var(--border)",borderRadius:8,maxHeight:200,overflow:"auto",marginTop:4},children:m.map(e=>(0,i.jsxs)("div",{onClick:()=>{u.items.some(t=>t.product_id===e.product_id)||(p(t=>({...t,items:[...t.items,{product_id:e.product_id,name:e.name,price:parseFloat(e.price),quantity:1}]})),g(""),h([]))},style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid #f0f0f0",display:"flex",justifyContent:"space-between",fontSize:14},children:[(0,i.jsx)("span",{children:e.name}),(0,i.jsxs)("span",{style:{color:"#666"},children:["R$ ",(parseFloat(e.price)||0).toFixed(2)]})]},e.product_id))}),u.items.length>0&&(0,i.jsxs)("div",{style:{marginTop:12},children:[u.items.map(e=>(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"8px 0",borderBottom:"1px solid #f0f0f0",fontSize:14},children:[(0,i.jsx)("span",{style:{flex:1},children:e.name}),(0,i.jsxs)("span",{style:{color:"#666"},children:["R$ ",(e.price*e.quantity).toFixed(2)]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},children:[(0,i.jsx)("button",{className:"btn btn-sm",onClick:()=>w(e.product_id,e.quantity-1),children:"-"}),(0,i.jsx)("span",{style:{minWidth:24,textAlign:"center"},children:e.quantity}),(0,i.jsx)("button",{className:"btn btn-sm",onClick:()=>w(e.product_id,e.quantity+1),children:"+"})]}),(0,i.jsx)("button",{onClick:()=>{var t;return t=e.product_id,void p(e=>({...e,items:e.items.filter(e=>e.product_id!==t)}))},style:{color:"#dc2626",cursor:"pointer",fontSize:18},children:"\xd7"})]},e.product_id)),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginTop:12,padding:12,background:"#f8f9fa",borderRadius:8},children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{fontSize:13,color:"#666"},children:["Preco original: ",(0,i.jsxs)("span",{style:{textDecoration:"line-through"},children:["R$ ",k.toFixed(2)]})]}),(0,i.jsxs)("div",{style:{fontSize:15,fontWeight:700},children:["Preco combo: R$ ",parseFloat(u.price||0).toFixed(2)]})]}),_>0&&(0,i.jsxs)("div",{style:{background:"#00A868",color:"#fff",borderRadius:8,padding:"4px 12px",fontWeight:700,fontSize:14,display:"flex",alignItems:"center"},children:["-",_,"%"]})]})]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:12,marginTop:16},children:[(0,i.jsx)("button",{className:"btn",onClick:()=>c(!1),children:"Cancelar"}),(0,i.jsx)("button",{className:"btn btn-primary",onClick:S,disabled:x,children:x?"Salvando...":"Salvar Combo"})]})]})]}),n?(0,i.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,i.jsx)("div",{className:"spinner"})}):0===e.length?(0,i.jsxs)("div",{className:"card",style:{textAlign:"center",padding:40},children:[(0,i.jsx)("p",{style:{color:"#666",marginBottom:16},children:"Nenhum combo criado ainda"}),(0,i.jsx)("button",{className:"btn btn-primary",onClick:j,children:"Criar primeiro combo"})]}):(0,i.jsx)("div",{style:{display:"grid",gap:12},children:e.map(e=>{var t;return(0,i.jsx)("div",{className:"card",children:(0,i.jsxs)("div",{className:"card-body",style:{display:"flex",gap:16,alignItems:"center"},children:[e.image?(0,i.jsx)("img",{src:e.image,alt:"",style:{width:80,height:80,borderRadius:8,objectFit:"cover"}}):(0,i.jsx)("div",{style:{width:80,height:80,borderRadius:8,background:"#f0f0f0",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,color:"#ccc"},children:"C"}),(0,i.jsxs)("div",{style:{flex:1},children:[(0,i.jsx)("div",{style:{fontWeight:600,fontSize:16},children:e.name}),e.description&&(0,i.jsx)("div",{style:{fontSize:13,color:"#666",marginTop:2},children:e.description}),(0,i.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center",marginTop:4},children:[(0,i.jsxs)("span",{style:{fontWeight:700,color:"#00A868"},children:["R$ ",(parseFloat(e.price)||0).toFixed(2)]}),e.original_price>e.price&&(0,i.jsxs)("span",{style:{textDecoration:"line-through",color:"#999",fontSize:13},children:["R$ ",(parseFloat(e.original_price)||0).toFixed(2)]})]}),(0,i.jsxs)("div",{style:{fontSize:12,color:"#888",marginTop:2},children:[(null===(t=e.items)||void 0===t?void 0:t.length)||0," produto(s)"]})]}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[(0,i.jsx)("button",{className:"toggle-switch ".concat(1===Number(e.status)?"toggle-on":""),onClick:()=>N(e),style:{width:44,height:24},children:(0,i.jsx)("span",{className:"toggle-knob"})}),(0,i.jsx)("button",{className:"btn btn-sm",onClick:()=>{var t;p({name:e.name,description:e.description||"",price:e.price,image:e.image||"",items:(null===(t=e.items)||void 0===t?void 0:t.map(e=>({product_id:e.product_id,name:e.name,price:e.price,quantity:e.quantity})))||[]}),d(e.id),c(!0)},style:{fontSize:12},children:"Editar"}),(0,i.jsx)("button",{className:"btn btn-sm",onClick:()=>v(e.id),style:{fontSize:12,color:"#dc2626"},children:"Excluir"})]})]})},e.id)})})]})}}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=0)}),_N_E=e.O()}]);