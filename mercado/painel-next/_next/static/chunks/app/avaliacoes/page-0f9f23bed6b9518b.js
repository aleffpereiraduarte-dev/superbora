(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[976],{9183:function(e,s,a){Promise.resolve().then(a.bind(a,6104))},6104:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return m}});var i=a(7437),t=a(2265),n=a(4565),r=a(4477),l=a(6428);let c=[{key:"all",label:"Todas"},{key:"positive",label:"Positivas (4-5)"},{key:"negative",label:"Negativas (1-3)"}],o=[{key:"newest",label:"Mais recentes"},{key:"oldest",label:"Mais antigas"},{key:"highest",label:"Maior nota"},{key:"lowest",label:"Menor nota"}];function d(e){return e?new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function v(e){let{rating:s,size:a=16}=e;return(0,i.jsx)("div",{className:"star-rating",style:{display:"inline-flex",gap:2},children:[1,2,3,4,5].map(e=>(0,i.jsx)("svg",{width:a,height:a,viewBox:"0 0 24 24",fill:e<=s?"#f59e0b":"none",stroke:e<=s?"#f59e0b":"#d1d5db",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,i.jsx)("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})},e))})}function h(e){let{stars:s,count:a,total:t}=e,n=t>0?Math.round(a/t*100):0;return(0,i.jsxs)("div",{className:"rating-bar-row",children:[(0,i.jsx)("span",{className:"rating-bar-label",children:s}),(0,i.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"#f59e0b",stroke:"#f59e0b",strokeWidth:"2",children:(0,i.jsx)("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})}),(0,i.jsx)("div",{className:"rating-bar-track",children:(0,i.jsx)("div",{className:"rating-bar-fill",style:{width:"".concat(n,"%")}})}),(0,i.jsx)("span",{className:"rating-bar-count",children:a}),(0,i.jsxs)("span",{className:"rating-bar-pct",children:[n,"%"]})]})}function m(){return(0,i.jsx)(n.Z,{children:(0,i.jsx)(r.Z,{children:(0,i.jsx)(p,{})})})}function p(){let[e,s]=(0,t.useState)([]),[a,n]=(0,t.useState)(null),[r,m]=(0,t.useState)("all"),[p,u]=(0,t.useState)("newest"),[x,j]=(0,t.useState)(1),[g,w]=(0,t.useState)(1),[N,b]=(0,t.useState)(!0),[k,y]=(0,t.useState)(""),[f,_]=(0,t.useState)(null),[C,S]=(0,t.useState)(""),[L,M]=(0,t.useState)(!1),E=(0,t.useCallback)(async()=>{b(!0),y("");try{var e;let a=await (0,l.SC)("/reviews.php",{filter:r,sort:p,page:x,limit:20});s(a.reviews||[]),n(a.stats||null),w((null===(e=a.pagination)||void 0===e?void 0:e.pages)||1)}catch(e){y(e.message)}finally{b(!1)}},[r,p,x]);async function B(e){if(C.trim()&&!L){M(!0);try{await (0,l.sg)("/reviews.php",{review_id:e,response:C.trim()}),s(s=>s.map(s=>s.review_id===e?{...s,partner_response:C.trim(),partner_response_at:new Date().toISOString()}:s)),_(null),S("")}catch(e){alert(e.message)}finally{M(!1)}}}return(0,t.useEffect)(()=>{E()},[E]),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"page-header",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"page-title",children:"Avaliacoes"}),(0,i.jsx)("p",{className:"page-subtitle",children:"Veja o que seus clientes estao dizendo e responda"})]})}),a&&(0,i.jsxs)("div",{className:"reviews-stats-grid",children:[(0,i.jsxs)("div",{className:"reviews-stats-summary",children:[(0,i.jsxs)("div",{className:"reviews-avg-rating",children:[(0,i.jsx)("span",{className:"reviews-avg-number",children:a.avg_rating.toFixed(1)}),(0,i.jsx)(v,{rating:Math.round(a.avg_rating),size:20}),(0,i.jsxs)("span",{className:"reviews-total-count",children:[a.total_reviews," avaliacao",1!==a.total_reviews?"es":""]})]}),(0,i.jsxs)("div",{className:"reviews-response-stats",children:[(0,i.jsxs)("div",{className:"reviews-stat-item",children:[(0,i.jsx)("span",{className:"reviews-stat-value",children:a.responded}),(0,i.jsx)("span",{className:"reviews-stat-label",children:"Respondidas"})]}),(0,i.jsxs)("div",{className:"reviews-stat-item",children:[(0,i.jsx)("span",{className:"reviews-stat-value reviews-stat-pending",children:a.pending_response}),(0,i.jsx)("span",{className:"reviews-stat-label",children:"Sem resposta"})]})]})]}),(0,i.jsxs)("div",{className:"reviews-distribution",children:[(0,i.jsx)("h3",{className:"reviews-dist-title",children:"Distribuicao de Notas"}),[5,4,3,2,1].map(e=>{var s;return(0,i.jsx)(h,{stars:e,count:(null===(s=a.distribution)||void 0===s?void 0:s[e])||0,total:a.total_reviews},e)})]})]}),(0,i.jsxs)("div",{className:"reviews-toolbar",children:[(0,i.jsx)("div",{className:"tabs",style:{marginBottom:0,flex:1},children:c.map(e=>(0,i.jsx)("button",{className:"tab ".concat(r===e.key?"tab-active":""),onClick:()=>{m(e.key),j(1)},children:e.label},e.key))}),(0,i.jsx)("select",{className:"form-select",style:{width:"auto",minWidth:160},value:p,onChange:e=>{u(e.target.value),j(1)},children:o.map(e=>(0,i.jsx)("option",{value:e.key,children:e.label},e.key))})]}),N?(0,i.jsx)("div",{className:"loading-screen",children:(0,i.jsx)("div",{className:"spinner"})}):k?(0,i.jsxs)("div",{className:"empty-state",children:[(0,i.jsx)("div",{className:"empty-state-title",children:"Erro ao carregar avaliacoes"}),(0,i.jsx)("div",{className:"empty-state-text",children:k})]}):0===e.length?(0,i.jsxs)("div",{className:"empty-state",children:[(0,i.jsx)("div",{className:"empty-state-icon",children:(0,i.jsx)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:(0,i.jsx)("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})})}),(0,i.jsx)("div",{className:"empty-state-title",children:"Nenhuma avaliacao encontrada"}),(0,i.jsx)("div",{className:"empty-state-text",children:"all"!==r?"Nao ha avaliacoes com o filtro selecionado":"Quando seus clientes avaliarem pedidos, as avaliacoes aparecerrao aqui"})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"reviews-list",children:e.map(e=>(0,i.jsxs)("div",{className:"review-card",children:[(0,i.jsxs)("div",{className:"review-card-header",children:[(0,i.jsxs)("div",{className:"review-customer",children:[(0,i.jsx)("div",{className:"review-avatar",children:e.customer_initials||"C"}),(0,i.jsxs)("div",{className:"review-customer-info",children:[(0,i.jsx)("div",{className:"review-customer-name",children:e.customer_name||"Cliente"}),(0,i.jsxs)("div",{className:"review-meta",children:["Pedido #",e.order_number," \xb7 ",d(e.created_at)]})]})]}),(0,i.jsx)(v,{rating:e.rating,size:16})]}),e.comment&&(0,i.jsx)("div",{className:"review-comment",children:e.comment}),e.partner_response?(0,i.jsxs)("div",{className:"review-response",children:[(0,i.jsxs)("div",{className:"review-response-header",children:[(0,i.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("polyline",{points:"9 17 4 12 9 7"}),(0,i.jsx)("path",{d:"M20 18v-2a4 4 0 00-4-4H4"})]}),(0,i.jsx)("span",{children:"Sua resposta"}),(0,i.jsx)("span",{className:"review-response-date",children:d(e.partner_response_at)})]}),(0,i.jsx)("div",{className:"review-response-text",children:e.partner_response})]}):f===e.review_id?(0,i.jsxs)("div",{className:"review-respond-form",children:[(0,i.jsx)("textarea",{className:"form-input",rows:3,placeholder:"Escreva sua resposta para o cliente...",value:C,onChange:e=>S(e.target.value),maxLength:1e3,autoFocus:!0}),(0,i.jsxs)("div",{className:"review-respond-actions",children:[(0,i.jsxs)("span",{className:"review-respond-chars",children:[C.length,"/1000"]}),(0,i.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:()=>{_(null),S("")},children:"Cancelar"}),(0,i.jsx)("button",{className:"btn btn-sm btn-primary",disabled:!C.trim()||L,onClick:()=>B(e.review_id),children:L?"Enviando...":"Enviar Resposta"})]})]}):(0,i.jsxs)("button",{className:"review-respond-btn",onClick:()=>{_(e.review_id),S("")},children:[(0,i.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("polyline",{points:"9 17 4 12 9 7"}),(0,i.jsx)("path",{d:"M20 18v-2a4 4 0 00-4-4H4"})]}),"Responder"]})]},e.review_id))}),g>1&&(0,i.jsxs)("div",{className:"pagination",children:[(0,i.jsx)("button",{className:"pagination-btn",disabled:x<=1,onClick:()=>j(e=>e-1),children:"Anterior"}),Array.from({length:Math.min(g,7)},(e,s)=>{let a;return a=g<=7?s+1:x<=4?s+1:x>=g-3?g-6+s:x-3+s,(0,i.jsx)("button",{className:"pagination-btn ".concat(x===a?"pagination-btn-active":""),onClick:()=>j(a),children:a},a)}),(0,i.jsx)("button",{className:"pagination-btn",disabled:x>=g,onClick:()=>j(e=>e+1),children:"Proximo"})]})]})]})}}},function(e){e.O(0,[448,565,205,971,117,744],function(){return e(e.s=9183)}),_N_E=e.O()}]);