(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2626],{2154:function(e,t,n){Promise.resolve().then(n.bind(n,2175))},6428:function(e,t,n){"use strict";n.d(t,{Fw:function(){return f},LP:function(){return s},SC:function(){return c},apiDelete:function(){return m},jn:function(){return p},o4:function(){return i},pE:function(){return h},sg:function(){return u},w9:function(){return g},zi:function(){return d}});let a="/api/mercado/partner",r="/api/mercado/parceiro",o="painel_partner_token";function s(){try{return localStorage.getItem(o)}catch(e){return null}}function i(e){try{e?localStorage.setItem(o,e):localStorage.removeItem(o)}catch(e){}}function l(){let e=s();return e?{Authorization:"Bearer ".concat(e)}:{}}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),r=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");r&&(n+="?".concat(r));let o=await fetch(n,{credentials:"include",headers:l()});if(!o.ok){let e=await o.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(o.status," ").concat(o.statusText))}let s=await o.json();if(!s.success)throw Error(s.message||"Erro desconhecido na API");return s.data}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...l()},body:JSON.stringify(t)}),r=await n.json().catch(()=>null);if(!n.ok||!(null==r?void 0:r.success))throw Error((null==r?void 0:r.message)||"API error: ".concat(n.status));return r.data}async function d(e,t){let n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:l(),body:t}),r=await n.json().catch(()=>null);if(!n.ok||!(null==r?void 0:r.success))throw Error((null==r?void 0:r.message)||"API error: ".concat(n.status));return r.data}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...l()},body:JSON.stringify(t)}),r=await n.json().catch(()=>null);if(!n.ok||!(null==r?void 0:r.success))throw Error((null==r?void 0:r.message)||"API error: ".concat(n.status));return r.data}async function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),r=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");r&&(n+="?".concat(r));let o=await fetch(n,{method:"DELETE",credentials:"include",headers:l()}),s=await o.json().catch(()=>null);if(!o.ok||!(null==s?void 0:s.success))throw Error((null==s?void 0:s.message)||"API error: ".concat(o.status));return s.data}async function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(r).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...l()},body:JSON.stringify(t)}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function p(e,t){let n=await fetch("".concat(r).concat(e),{method:"POST",credentials:"include",headers:l(),body:t}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return u(e,t)}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return i},a:function(){return l}});var a=n(7437),r=n(2265),o=n(6428);let s=(0,r.createContext)(null);function i(e){let{children:t}=e,[n,i]=(0,r.useState)(null),[l,c]=(0,r.useState)(!0),[u,d]=(0,r.useState)(null),h=(0,r.useCallback)(async()=>{if(!(0,o.LP)()){i(null),c(!1);return}try{let e=await (0,o.SC)("/auth/session.php");e.authenticated&&e.partner?i(e.partner):((0,o.o4)(null),i(null))}catch(e){console.warn("Session check failed (network error), keeping session:",e)}finally{c(!1)}},[]);(0,r.useEffect)(()=>{h()},[h]);let m=(0,r.useCallback)(async(e,t)=>{let n=await (0,o.sg)("/auth/login.php",{email:e,senha:t});if(n.requires_2fa)return d({partner_id:n.partner_id,nome:n.nome,temp_token:n.temp_token}),{requires_2fa:!0};(0,o.o4)(n.token);let a=n.partner||{id:n.partner_id,nome:n.nome,email:n.email,cnpj:n.cnpj,logo:n.logo,categoria:n.categoria,status:n.status};return i(a),d(null),a},[]),f=(0,r.useCallback)(async e=>{if(!u)throw Error("Nenhuma verificacao 2FA pendente");let t=await (0,o.sg)("/auth/totp-verify.php",{temp_token:u.temp_token,code:e});(0,o.o4)(t.token);let n=t.partner||{id:t.partner_id,nome:t.nome,email:t.email,cnpj:t.cnpj,logo:t.logo,categoria:t.categoria,status:t.status};return i(n),d(null),n},[u]),p=(0,r.useCallback)(()=>{d(null)},[]),g=(0,r.useCallback)(e=>{i(t=>t?{...t,...e}:t)},[]),v=(0,r.useCallback)(()=>{(0,o.o4)(null),i(null),d(null)},[]);return(0,a.jsx)(s.Provider,{value:{partner:n,loading:l,isAuthenticated:!!n,twoFactorPending:u,login:m,verifyTotp:f,cancelTotp:p,logout:v,updatePartner:g,refreshSession:h},children:t})}function l(){let e=(0,r.useContext)(s);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},2175:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var a=n(7437),r=n(2265),o=n(9376),s=n(7648),i=n(7128);function l(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{className:"loading-screen",children:(0,a.jsx)("div",{className:"spinner"})}),children:(0,a.jsx)(c,{})})}function c(){let{login:e,verifyTotp:t,cancelTotp:n,isAuthenticated:l,loading:c,twoFactorPending:d}=(0,i.a)(),h=(0,o.useRouter)(),m=(0,o.useSearchParams)(),[f,p]=(0,r.useState)(""),[g,v]=(0,r.useState)(""),[j,x]=(0,r.useState)(""),[y,b]=(0,r.useState)(!1),w=(()=>{let e=m.get("return")||"/";return e&&e.startsWith("/")&&!e.startsWith("//")?e:"/"})();async function k(t){if(t.preventDefault(),x(""),!f.trim()||!g.trim()){x("Preencha email e senha.");return}b(!0);try{let t=await e(f,g);t&&!t.requires_2fa&&h.push(w)}catch(e){x(e.message||"Erro ao fazer login. Tente novamente.")}finally{b(!1)}}return((0,r.useEffect)(()=>{!c&&l&&h.push(w)},[c,l,h,w]),c)?(0,a.jsx)("div",{className:"loading-screen",children:(0,a.jsx)("div",{className:"spinner"})}):l?null:d?(0,a.jsx)("div",{className:"login-page",children:(0,a.jsx)("div",{className:"login-card",children:(0,a.jsx)(u,{partnerName:d.nome,onVerify:async e=>{await t(e),h.push(w)},onCancel:n})})}):(0,a.jsx)("div",{className:"login-page",children:(0,a.jsxs)("div",{className:"login-card",children:[(0,a.jsxs)("div",{className:"login-logo",children:[(0,a.jsx)("h1",{children:"SuperBora"}),(0,a.jsx)("p",{children:"Painel do Parceiro"})]}),j&&(0,a.jsx)("div",{className:"login-error",children:j}),(0,a.jsxs)("form",{onSubmit:k,children:[(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{className:"form-label",children:"Email"}),(0,a.jsx)("input",{type:"email",className:"form-input",placeholder:"seu@email.com",value:f,onChange:e=>p(e.target.value),autoComplete:"email",disabled:y})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{className:"form-label",children:"Senha"}),(0,a.jsx)("input",{type:"password",className:"form-input",placeholder:"Sua senha",value:g,onChange:e=>v(e.target.value),autoComplete:"current-password",disabled:y})]}),(0,a.jsx)("button",{type:"submit",className:"btn btn-primary btn-block btn-lg",disabled:y,style:{marginTop:8},children:y?(0,a.jsx)("span",{className:"spinner-sm"}):"Entrar"})]}),(0,a.jsx)("div",{style:{textAlign:"center",marginTop:16,fontSize:14,color:"#64748b"},children:(0,a.jsx)("a",{href:"https://wa.me/5511999999999?text=Esqueci%20minha%20senha%20do%20painel",target:"_blank",rel:"noopener noreferrer",style:{color:"#2563eb",textDecoration:"none"},children:"Esqueci minha senha"})}),(0,a.jsxs)("div",{className:"login-cadastro-link",children:["Ainda nao tem cadastro? ",(0,a.jsx)(s.default,{href:"/cadastro",children:"Cadastre-se"})]})]})})}function u(e){let{partnerName:t,onVerify:n,onCancel:o}=e,[s,i]=(0,r.useState)(""),[l,c]=(0,r.useState)(""),[u,d]=(0,r.useState)(!1),h=(0,r.useRef)(null);async function m(e){if(e&&e.preventDefault(),6===s.length){c(""),d(!0);try{await n(s)}catch(e){var t;c(e.message||"Codigo invalido. Tente novamente."),i(""),null===(t=h.current)||void 0===t||t.focus()}finally{d(!1)}}}return(0,r.useEffect)(()=>{var e;null===(e=h.current)||void 0===e||e.focus()},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"login-logo",children:[(0,a.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"#2563eb",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),(0,a.jsx)("path",{d:"m7 11V7a5 5 0 0 1 10 0v4"})]}),(0,a.jsx)("h2",{style:{margin:"12px 0 4px",fontSize:20},children:"Verificacao em 2 etapas"}),(0,a.jsxs)("p",{style:{color:"#64748b",fontSize:14},children:["Ola, ",t,"! Digite o codigo do seu app autenticador."]})]}),l&&(0,a.jsx)("div",{className:"login-error",children:l}),(0,a.jsxs)("form",{onSubmit:m,children:[(0,a.jsx)("div",{className:"form-group",style:{textAlign:"center"},children:(0,a.jsx)("input",{ref:h,type:"text",inputMode:"numeric",autoComplete:"one-time-code",className:"form-input",placeholder:"000000",value:s,onChange:function(e){let t=e.target.value.replace(/\D/g,"").slice(0,6);i(t),6===t.length&&setTimeout(()=>{c(""),d(!0),n(t).catch(e=>{var t;c(e.message||"Codigo invalido. Tente novamente."),i(""),d(!1),null===(t=h.current)||void 0===t||t.focus()})},100)},disabled:u,maxLength:6,style:{textAlign:"center",fontSize:28,letterSpacing:12,fontFamily:"monospace",fontWeight:600,padding:"12px 16px"}})}),(0,a.jsx)("button",{type:"submit",className:"btn btn-primary btn-block btn-lg",disabled:u||6!==s.length,style:{marginTop:8},children:u?(0,a.jsx)("span",{className:"spinner-sm"}):"Verificar"})]}),(0,a.jsx)("div",{style:{textAlign:"center",marginTop:16},children:(0,a.jsx)("button",{onClick:o,style:{background:"none",border:"none",color:"#64748b",cursor:"pointer",fontSize:14,textDecoration:"underline"},children:"Voltar ao login"})})]})}}},function(e){e.O(0,[3448,2971,2117,1744],function(){return e(e.s=2154)}),_N_E=e.O()}]);