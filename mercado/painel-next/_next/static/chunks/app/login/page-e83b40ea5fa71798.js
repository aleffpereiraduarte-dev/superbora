(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{2154:function(e,t,n){Promise.resolve().then(n.bind(n,2175))},6428:function(e,t,n){"use strict";n.d(t,{Fw:function(){return m},LP:function(){return s},SC:function(){return i},apiDelete:function(){return f},jn:function(){return p},o4:function(){return o},pE:function(){return h},sg:function(){return u},w9:function(){return g},zi:function(){return d}});let a="/api/mercado/partner",r="/api/mercado/parceiro",c="painel_partner_token";function s(){try{return localStorage.getItem(c)}catch(e){return null}}function o(e){try{e?localStorage.setItem(c,e):localStorage.removeItem(c)}catch(e){}}function l(){let e=s();return e?{Authorization:"Bearer ".concat(e)}:{}}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),r=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");r&&(n+="?".concat(r));let c=await fetch(n,{credentials:"include",headers:l()});if(!c.ok){let e=await c.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(c.status," ").concat(c.statusText))}let s=await c.json();if(!s.success)throw Error(s.message||"Erro desconhecido na API");return s.data}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...l()},body:JSON.stringify(t)}),r=await n.json().catch(()=>null);if(!n.ok||!(null==r?void 0:r.success))throw Error((null==r?void 0:r.message)||"API error: ".concat(n.status));return r.data}async function d(e,t){let n=await fetch("".concat(a).concat(e),{method:"POST",credentials:"include",headers:l(),body:t}),r=await n.json().catch(()=>null);if(!n.ok||!(null==r?void 0:r.success))throw Error((null==r?void 0:r.message)||"API error: ".concat(n.status));return r.data}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(a).concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...l()},body:JSON.stringify(t)}),r=await n.json().catch(()=>null);if(!n.ok||!(null==r?void 0:r.success))throw Error((null==r?void 0:r.message)||"API error: ".concat(n.status));return r.data}async function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(a).concat(e),r=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,n]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}).join("&");r&&(n+="?".concat(r));let c=await fetch(n,{method:"DELETE",credentials:"include",headers:l()}),s=await c.json().catch(()=>null);if(!c.ok||!(null==s?void 0:s.success))throw Error((null==s?void 0:s.message)||"API error: ".concat(c.status));return s.data}async function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(r).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...l()},body:JSON.stringify(t)}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function p(e,t){let n=await fetch("".concat(r).concat(e),{method:"POST",credentials:"include",headers:l(),body:t}),a=await n.json().catch(()=>null);if(!n.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.message)||"API error: ".concat(n.status));return a.data}async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return u(e,t)}},7128:function(e,t,n){"use strict";n.d(t,{H:function(){return o},a:function(){return l}});var a=n(7437),r=n(2265),c=n(6428);let s=(0,r.createContext)(null);function o(e){let{children:t}=e,[n,o]=(0,r.useState)(null),[l,i]=(0,r.useState)(!0),u=(0,r.useCallback)(async()=>{if(!(0,c.LP)()){o(null),i(!1);return}try{let e=await (0,c.SC)("/auth/session.php");e.authenticated&&e.partner?o(e.partner):((0,c.o4)(null),o(null))}catch(e){console.warn("Session check failed (network error), keeping session:",e)}finally{i(!1)}},[]);(0,r.useEffect)(()=>{u()},[u]);let d=(0,r.useCallback)(async(e,t)=>{let n=await (0,c.sg)("/auth/login.php",{email:e,senha:t});(0,c.o4)(n.token);let a=n.partner||{id:n.partner_id,nome:n.nome,email:n.email,cnpj:n.cnpj,logo:n.logo,categoria:n.categoria,status:n.status};return o(a),a},[]),h=(0,r.useCallback)(e=>{o(t=>t?{...t,...e}:t)},[]),f=(0,r.useCallback)(()=>{(0,c.o4)(null),o(null)},[]);return(0,a.jsx)(s.Provider,{value:{partner:n,loading:l,isAuthenticated:!!n,login:d,logout:f,updatePartner:h,refreshSession:u},children:t})}function l(){let e=(0,r.useContext)(s);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},2175:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var a=n(7437),r=n(2265),c=n(9376),s=n(7648),o=n(7128);function l(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{className:"loading-screen",children:(0,a.jsx)("div",{className:"spinner"})}),children:(0,a.jsx)(i,{})})}function i(){let{login:e,isAuthenticated:t,loading:n}=(0,o.a)(),l=(0,c.useRouter)(),i=(0,c.useSearchParams)(),[u,d]=(0,r.useState)(""),[h,f]=(0,r.useState)(""),[m,p]=(0,r.useState)(""),[g,v]=(0,r.useState)(!1);async function j(t){if(t.preventDefault(),p(""),!u.trim()||!h.trim()){p("Preencha email e senha.");return}v(!0);try{await e(u,h);let t=i.get("return")||"/",n=t&&t.startsWith("/")&&!t.startsWith("//")?t:"/";l.push(n)}catch(e){p(e.message||"Erro ao fazer login. Tente novamente.")}finally{v(!1)}}return((0,r.useEffect)(()=>{if(!n&&t){let e=i.get("return")||"/",t=e&&e.startsWith("/")&&!e.startsWith("//")?e:"/";l.push(t)}},[n,t,l,i]),n)?(0,a.jsx)("div",{className:"loading-screen",children:(0,a.jsx)("div",{className:"spinner"})}):t?null:(0,a.jsx)("div",{className:"login-page",children:(0,a.jsxs)("div",{className:"login-card",children:[(0,a.jsxs)("div",{className:"login-logo",children:[(0,a.jsx)("h1",{children:"SuperBora"}),(0,a.jsx)("p",{children:"Painel do Parceiro"})]}),m&&(0,a.jsx)("div",{className:"login-error",children:m}),(0,a.jsxs)("form",{onSubmit:j,children:[(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{className:"form-label",children:"Email"}),(0,a.jsx)("input",{type:"email",className:"form-input",placeholder:"seu@email.com",value:u,onChange:e=>d(e.target.value),autoComplete:"email",disabled:g})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{className:"form-label",children:"Senha"}),(0,a.jsx)("input",{type:"password",className:"form-input",placeholder:"Sua senha",value:h,onChange:e=>f(e.target.value),autoComplete:"current-password",disabled:g})]}),(0,a.jsx)("button",{type:"submit",className:"btn btn-primary btn-block btn-lg",disabled:g,style:{marginTop:8},children:g?(0,a.jsx)("span",{className:"spinner-sm"}):"Entrar"})]}),(0,a.jsxs)("div",{className:"login-cadastro-link",children:["Ainda nao tem cadastro? ",(0,a.jsx)(s.default,{href:"/cadastro",children:"Cadastre-se"})]})]})})}}},function(e){e.O(0,[448,971,117,744],function(){return e(e.s=2154)}),_N_E=e.O()}]);