(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2747],{3405:function(e,a,c){Promise.resolve().then(c.bind(c,6816))},6428:function(e,a,c){"use strict";c.d(a,{Fw:function(){return p},LP:function(){return o},SC:function(){return l},apiDelete:function(){return u},jn:function(){return m},o4:function(){return i},pE:function(){return x},sg:function(){return d},w9:function(){return j},zi:function(){return f}});let s="/api/mercado/partner",t="/api/mercado/parceiro",r="painel_partner_token";function o(){try{return localStorage.getItem(r)}catch(e){return null}}function i(e){try{e?localStorage.setItem(r,e):localStorage.removeItem(r)}catch(e){}}function n(){let e=o();return e?{Authorization:"Bearer ".concat(e)}:{}}async function l(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c="".concat(s).concat(e),t=Object.entries(a).filter(e=>{let[,a]=e;return null!=a&&""!==a}).map(e=>{let[a,c]=e;return"".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(c))}).join("&");t&&(c+="?".concat(t));let r=await fetch(c,{credentials:"include",headers:n()});if(!r.ok){let e=await r.json().catch(()=>null);throw Error((null==e?void 0:e.message)||"API error: ".concat(r.status," ").concat(r.statusText))}let o=await r.json();if(!o.success)throw Error(o.message||"Erro desconhecido na API");return o.data}async function d(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=await fetch("".concat(s).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify(a)}),t=await c.json().catch(()=>null);if(!c.ok||!(null==t?void 0:t.success))throw Error((null==t?void 0:t.message)||"API error: ".concat(c.status));return t.data}async function f(e,a){let c=await fetch("".concat(s).concat(e),{method:"POST",credentials:"include",headers:n(),body:a}),t=await c.json().catch(()=>null);if(!c.ok||!(null==t?void 0:t.success))throw Error((null==t?void 0:t.message)||"API error: ".concat(c.status));return t.data}async function x(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=await fetch("".concat(s).concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify(a)}),t=await c.json().catch(()=>null);if(!c.ok||!(null==t?void 0:t.success))throw Error((null==t?void 0:t.message)||"API error: ".concat(c.status));return t.data}async function u(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c="".concat(s).concat(e),t=Object.entries(a).filter(e=>{let[,a]=e;return null!=a&&""!==a}).map(e=>{let[a,c]=e;return"".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(c))}).join("&");t&&(c+="?".concat(t));let r=await fetch(c,{method:"DELETE",credentials:"include",headers:n()}),o=await r.json().catch(()=>null);if(!r.ok||!(null==o?void 0:o.success))throw Error((null==o?void 0:o.message)||"API error: ".concat(r.status));return o.data}async function p(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=await fetch("".concat(t).concat(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify(a)}),s=await c.json().catch(()=>null);if(!c.ok||!(null==s?void 0:s.success))throw Error((null==s?void 0:s.message)||"API error: ".concat(c.status));return s.data}async function m(e,a){let c=await fetch("".concat(t).concat(e),{method:"POST",credentials:"include",headers:n(),body:a}),s=await c.json().catch(()=>null);if(!c.ok||!(null==s?void 0:s.success))throw Error((null==s?void 0:s.message)||"API error: ".concat(c.status));return s.data}async function j(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d(e,a)}},6816:function(e,a,c){"use strict";c.r(a),c.d(a,{default:function(){return n}});var s=c(7437),t=c(29),r=c.n(t),o=c(2265),i=c(6428);function n(){let[e,a]=(0,o.useState)(!0),[c,t]=(0,o.useState)([]),[n,l]=(0,o.useState)(!1),[d,f]=(0,o.useState)(!1),[x,u]=(0,o.useState)({media_type:"image",media_url:"",caption:"",link_type:null,link_id:null,link_url:"",duration_hours:24}),p=(0,o.useRef)(null),[m,j]=(0,o.useState)(""),h=(0,o.useCallback)(async()=>{a(!0);try{let e=await (0,i.SC)("/stories.php");t(e.stories||[])}catch(e){console.error("Erro ao carregar stories:",e)}finally{a(!1)}},[]);(0,o.useEffect)(()=>{h()},[h]);let b=async e=>{let a=e.target.files[0];if(!a)return;let c=new FileReader;c.onload=e=>{j(e.target.result)},c.readAsDataURL(a);let s=a.type.startsWith("video/");u(e=>({...e,media_type:s?"video":"image"})),f(!0);try{let e=new FormData;e.append("file",a),e.append("type","story");let c=await fetch("/api/mercado/partner/upload.php",{method:"POST",body:e,credentials:"include"}),s=await c.json();s.success?u(e=>({...e,media_url:s.data.url})):alert(s.error||"Erro no upload")}catch(e){alert("Erro no upload")}finally{f(!1)}},y=async e=>{if(e.preventDefault(),!x.media_url){alert("Selecione uma imagem ou video");return}try{let e=await (0,i.sg)("/stories.php",x);alert(e.message||"Story publicado!"),l(!1),u({media_type:"image",media_url:"",caption:"",link_type:null,link_id:null,link_url:"",duration_hours:24}),j(""),h()}catch(e){alert(e.message||"Erro ao publicar story")}},v=async e=>{if(confirm("Remover este story?"))try{await (0,i.SC)("/stories.php?id=".concat(e),{},"DELETE"),h()}catch(e){alert("Erro ao remover story")}},g=e=>(0,s.jsx)("span",{className:"story-status-badge",style:{background:{active:"#22c55e",pending:"#f59e0b",rejected:"#ef4444",expired:"#6b7280"}[e]},children:{active:"Ativo",pending:"Pendente",rejected:"Rejeitado",expired:"Expirado"}[e]||e}),w=e=>{if(!e)return"";let a=new Date,c=new Date(e)-a;if(c<=0)return"Expirado";let s=Math.floor(c/36e5);return s<1?"Menos de 1h":s<24?"".concat(s,"h restantes"):"".concat(Math.floor(s/24),"d restantes")};return(0,s.jsxs)("div",{className:"jsx-afce7f36ad9e097c page",children:[(0,s.jsxs)("div",{className:"jsx-afce7f36ad9e097c page-header",children:[(0,s.jsxs)("div",{className:"jsx-afce7f36ad9e097c",children:[(0,s.jsx)("h1",{className:"jsx-afce7f36ad9e097c",children:"Stories"}),(0,s.jsx)("p",{className:"jsx-afce7f36ad9e097c text-muted",children:"Compartilhe novidades e promocoes com seus clientes"})]}),(0,s.jsx)("button",{onClick:()=>l(!0),className:"jsx-afce7f36ad9e097c btn btn-primary",children:"+ Novo Story"})]}),(0,s.jsxs)("div",{style:{marginBottom:24},className:"jsx-afce7f36ad9e097c info-card",children:[(0,s.jsx)("div",{className:"jsx-afce7f36ad9e097c info-card-icon",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"jsx-afce7f36ad9e097c",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",className:"jsx-afce7f36ad9e097c"}),(0,s.jsx)("path",{d:"M12 16v-4M12 8h.01",className:"jsx-afce7f36ad9e097c"})]})}),(0,s.jsxs)("div",{className:"jsx-afce7f36ad9e097c",children:[(0,s.jsx)("strong",{className:"jsx-afce7f36ad9e097c",children:"Dica:"})," Stories aparecem no topo da vitrine do cliente e expiram automaticamente. Use para mostrar pratos do dia, promocoes relampago ou bastidores da sua cozinha."]})]}),e?(0,s.jsxs)("div",{className:"jsx-afce7f36ad9e097c loading-state",children:[(0,s.jsx)("div",{className:"jsx-afce7f36ad9e097c spinner"}),(0,s.jsx)("span",{className:"jsx-afce7f36ad9e097c",children:"Carregando stories..."})]}):0===c.length?(0,s.jsxs)("div",{className:"jsx-afce7f36ad9e097c empty-state",children:[(0,s.jsxs)("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"jsx-afce7f36ad9e097c",children:[(0,s.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2",className:"jsx-afce7f36ad9e097c"}),(0,s.jsx)("circle",{cx:"8.5",cy:"8.5",r:"1.5",className:"jsx-afce7f36ad9e097c"}),(0,s.jsx)("polyline",{points:"21 15 16 10 5 21",className:"jsx-afce7f36ad9e097c"})]}),(0,s.jsx)("h3",{className:"jsx-afce7f36ad9e097c",children:"Nenhum story publicado"}),(0,s.jsx)("p",{className:"jsx-afce7f36ad9e097c",children:"Crie seu primeiro story para engajar seus clientes"}),(0,s.jsx)("button",{onClick:()=>l(!0),className:"jsx-afce7f36ad9e097c btn btn-primary",children:"Criar Story"})]}):(0,s.jsx)("div",{className:"jsx-afce7f36ad9e097c stories-grid",children:c.map(e=>(0,s.jsxs)("div",{className:"jsx-afce7f36ad9e097c story-card",children:[(0,s.jsxs)("div",{className:"jsx-afce7f36ad9e097c story-media",children:["video"===e.media_type?(0,s.jsx)("video",{src:e.media_url,className:"jsx-afce7f36ad9e097c"}):(0,s.jsx)("img",{src:e.thumbnail_url||e.media_url,alt:"",className:"jsx-afce7f36ad9e097c"}),(0,s.jsx)("div",{className:"jsx-afce7f36ad9e097c story-badge-top",children:g(e.status)}),e.view_count>0&&(0,s.jsxs)("div",{className:"jsx-afce7f36ad9e097c story-views",children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"jsx-afce7f36ad9e097c",children:[(0,s.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",className:"jsx-afce7f36ad9e097c"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"3",className:"jsx-afce7f36ad9e097c"})]}),e.view_count]})]}),(0,s.jsxs)("div",{className:"jsx-afce7f36ad9e097c story-content",children:[e.caption&&(0,s.jsx)("p",{className:"jsx-afce7f36ad9e097c story-caption",children:e.caption}),(0,s.jsx)("div",{className:"jsx-afce7f36ad9e097c story-meta",children:(0,s.jsx)("span",{className:"jsx-afce7f36ad9e097c story-time",children:w(e.expires_at)})})]}),(0,s.jsx)("div",{className:"jsx-afce7f36ad9e097c story-actions",children:"active"===e.status&&(0,s.jsx)("button",{onClick:()=>v(e.id),className:"jsx-afce7f36ad9e097c btn btn-small btn-danger",children:"Remover"})})]},e.id))}),n&&(0,s.jsx)("div",{onClick:()=>l(!1),className:"jsx-afce7f36ad9e097c modal-overlay",children:(0,s.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"jsx-afce7f36ad9e097c modal",children:[(0,s.jsxs)("div",{className:"jsx-afce7f36ad9e097c modal-header",children:[(0,s.jsx)("h2",{className:"jsx-afce7f36ad9e097c",children:"Novo Story"}),(0,s.jsx)("button",{onClick:()=>l(!1),className:"jsx-afce7f36ad9e097c modal-close",children:"\xd7"})]}),(0,s.jsxs)("form",{onSubmit:y,className:"jsx-afce7f36ad9e097c",children:[(0,s.jsxs)("div",{className:"jsx-afce7f36ad9e097c modal-body",children:[(0,s.jsxs)("div",{onClick:()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.click()},className:"jsx-afce7f36ad9e097c "+"upload-area ".concat(m?"has-preview":""),children:[m?"video"===x.media_type?(0,s.jsx)("video",{src:m,className:"jsx-afce7f36ad9e097c upload-preview"}):(0,s.jsx)("img",{src:m,alt:"Preview",className:"jsx-afce7f36ad9e097c upload-preview"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"jsx-afce7f36ad9e097c",children:[(0,s.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",className:"jsx-afce7f36ad9e097c"}),(0,s.jsx)("circle",{cx:"8.5",cy:"8.5",r:"1.5",className:"jsx-afce7f36ad9e097c"}),(0,s.jsx)("path",{d:"M21 15l-5-5L5 21",className:"jsx-afce7f36ad9e097c"})]}),(0,s.jsx)("p",{className:"jsx-afce7f36ad9e097c",children:"Clique para selecionar imagem ou video"}),(0,s.jsx)("small",{className:"jsx-afce7f36ad9e097c",children:"Recomendado: 1080x1920 (9:16)"})]}),d&&(0,s.jsxs)("div",{className:"jsx-afce7f36ad9e097c upload-loading",children:[(0,s.jsx)("div",{className:"jsx-afce7f36ad9e097c spinner"}),(0,s.jsx)("span",{className:"jsx-afce7f36ad9e097c",children:"Enviando..."})]})]}),(0,s.jsx)("input",{ref:p,type:"file",accept:"image/*,video/*",onChange:b,style:{display:"none"},className:"jsx-afce7f36ad9e097c"}),(0,s.jsxs)("div",{className:"jsx-afce7f36ad9e097c form-group",children:[(0,s.jsx)("label",{className:"jsx-afce7f36ad9e097c",children:"Legenda (opcional)"}),(0,s.jsx)("textarea",{value:x.caption,onChange:e=>u({...x,caption:e.target.value}),placeholder:"Adicione uma legenda...",rows:2,maxLength:150,className:"jsx-afce7f36ad9e097c"}),(0,s.jsxs)("small",{className:"jsx-afce7f36ad9e097c text-muted",children:[x.caption.length,"/150"]})]}),(0,s.jsxs)("div",{className:"jsx-afce7f36ad9e097c form-group",children:[(0,s.jsx)("label",{className:"jsx-afce7f36ad9e097c",children:"Duracao"}),(0,s.jsxs)("select",{value:x.duration_hours,onChange:e=>u({...x,duration_hours:parseInt(e.target.value)}),className:"jsx-afce7f36ad9e097c",children:[(0,s.jsx)("option",{value:12,className:"jsx-afce7f36ad9e097c",children:"12 horas"}),(0,s.jsx)("option",{value:24,className:"jsx-afce7f36ad9e097c",children:"24 horas"}),(0,s.jsx)("option",{value:48,className:"jsx-afce7f36ad9e097c",children:"48 horas"}),(0,s.jsx)("option",{value:72,className:"jsx-afce7f36ad9e097c",children:"72 horas"})]})]}),(0,s.jsxs)("div",{className:"jsx-afce7f36ad9e097c form-group",children:[(0,s.jsx)("label",{className:"jsx-afce7f36ad9e097c",children:"Link (opcional)"}),(0,s.jsxs)("select",{value:x.link_type||"",onChange:e=>u({...x,link_type:e.target.value||null,link_id:null,link_url:""}),className:"jsx-afce7f36ad9e097c",children:[(0,s.jsx)("option",{value:"",className:"jsx-afce7f36ad9e097c",children:"Sem link"}),(0,s.jsx)("option",{value:"product",className:"jsx-afce7f36ad9e097c",children:"Produto"}),(0,s.jsx)("option",{value:"category",className:"jsx-afce7f36ad9e097c",children:"Categoria"}),(0,s.jsx)("option",{value:"promo",className:"jsx-afce7f36ad9e097c",children:"Promocao"}),(0,s.jsx)("option",{value:"external",className:"jsx-afce7f36ad9e097c",children:"Link externo"})]})]}),"external"===x.link_type&&(0,s.jsxs)("div",{className:"jsx-afce7f36ad9e097c form-group",children:[(0,s.jsx)("label",{className:"jsx-afce7f36ad9e097c",children:"URL"}),(0,s.jsx)("input",{type:"url",value:x.link_url,onChange:e=>u({...x,link_url:e.target.value}),placeholder:"https://...",className:"jsx-afce7f36ad9e097c"})]})]}),(0,s.jsxs)("div",{className:"jsx-afce7f36ad9e097c modal-footer",children:[(0,s.jsx)("button",{type:"button",onClick:()=>l(!1),className:"jsx-afce7f36ad9e097c btn btn-secondary",children:"Cancelar"}),(0,s.jsx)("button",{type:"submit",disabled:d||!x.media_url,className:"jsx-afce7f36ad9e097c btn btn-primary",children:"Publicar Story"})]})]})]})}),(0,s.jsx)(r(),{id:"afce7f36ad9e097c",children:".stories-grid.jsx-afce7f36ad9e097c{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px}.story-card.jsx-afce7f36ad9e097c{background:var(--color-card);-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;overflow:hidden;border:1px solid var(--color-border)}.story-media.jsx-afce7f36ad9e097c{position:relative;aspect-ratio:9/16;max-height:300px;overflow:hidden}.story-media.jsx-afce7f36ad9e097c img.jsx-afce7f36ad9e097c,.story-media.jsx-afce7f36ad9e097c video.jsx-afce7f36ad9e097c{width:100%;height:100%;-o-object-fit:cover;object-fit:cover}.story-badge-top.jsx-afce7f36ad9e097c{position:absolute;top:8px;left:8px}.story-status-badge.jsx-afce7f36ad9e097c{padding:4px 8px;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;font-size:11px;font-weight:600;color:white;text-transform:uppercase}.story-views.jsx-afce7f36ad9e097c{position:absolute;bottom:8px;left:8px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:4px;background:rgba(0,0,0,.6);padding:4px 8px;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;color:white;font-size:12px}.story-content.jsx-afce7f36ad9e097c{padding:12px}.story-caption.jsx-afce7f36ad9e097c{font-size:13px;color:var(--color-text);margin-bottom:8px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.story-meta.jsx-afce7f36ad9e097c{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;font-size:11px;color:var(--color-text-tertiary)}.story-actions.jsx-afce7f36ad9e097c{padding:0 12px 12px}.upload-area.jsx-afce7f36ad9e097c{border:2px dashed var(--color-border);-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;padding:40px;text-align:center;cursor:pointer;-webkit-transition:all.2s;-moz-transition:all.2s;-o-transition:all.2s;transition:all.2s;position:relative;min-height:200px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center}.upload-area.jsx-afce7f36ad9e097c:hover{border-color:var(--color-primary);background:var(--color-primary-light)}.upload-area.has-preview.jsx-afce7f36ad9e097c{padding:0;border-style:solid}.upload-preview.jsx-afce7f36ad9e097c{width:100%;height:300px;-o-object-fit:contain;object-fit:contain;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px}.upload-loading.jsx-afce7f36ad9e097c{position:absolute;inset:0;background:rgba(0,0,0,.7);display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;gap:8px;color:white;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px}.info-card.jsx-afce7f36ad9e097c{background:var(--color-info-bg);border:1px solid var(--color-info);-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;padding:16px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:12px;color:var(--color-info)}.info-card-icon.jsx-afce7f36ad9e097c{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0}.empty-state.jsx-afce7f36ad9e097c{text-align:center;padding:60px 20px;color:var(--color-text-secondary)}.empty-state.jsx-afce7f36ad9e097c svg.jsx-afce7f36ad9e097c{color:var(--color-text-tertiary);margin-bottom:16px}.empty-state.jsx-afce7f36ad9e097c h3.jsx-afce7f36ad9e097c{margin-bottom:8px;color:var(--color-text)}.empty-state.jsx-afce7f36ad9e097c p.jsx-afce7f36ad9e097c{margin-bottom:20px}"})]})}}},function(e){e.O(0,[29,2971,2117,1744],function(){return e(e.s=3405)}),_N_E=e.O()}]);