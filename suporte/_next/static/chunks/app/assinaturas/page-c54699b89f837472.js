(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[263],{6845:function(e,t,a){Promise.resolve().then(a.bind(a,8434))},6428:function(e,t,a){"use strict";a.d(t,{LP:function(){return i},QW:function(){return u},SC:function(){return c},o4:function(){return r},pE:function(){return d},sg:function(){return o}});let n="/api/mercado/admin",s="admin_token";function i(){try{return localStorage.getItem(s)}catch(e){return null}}function r(e){try{e?localStorage.setItem(s,e):localStorage.removeItem(s)}catch(e){}}function l(){let e=i(),t={"Content-Type":"application/json"};return e&&(t.Authorization="Bearer ".concat(e)),t}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="".concat(n).concat(e),s=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,a]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(a))}).join("&");s&&(a+="?".concat(s));let i=await fetch(a,{headers:l()});if(!i.ok)throw Error((await i.json().catch(()=>({message:"Erro de rede"}))).message||"HTTP ".concat(i.status));let r=await i.json();if(!1===r.success)throw Error(r.message||"Erro desconhecido");return void 0!==r.data?r.data:r}async function o(e,t){let a=await fetch("".concat(n).concat(e),{method:"POST",headers:l(),body:JSON.stringify(t)}),s=await a.json().catch(()=>null);if(!a.ok||s&&!1===s.success)throw Error((null==s?void 0:s.message)||"HTTP ".concat(a.status));return(null==s?void 0:s.data)!==void 0?s.data:s}async function d(e,t){let a=await fetch("".concat(n).concat(e),{method:"PUT",headers:l(),body:JSON.stringify(t)}),s=await a.json().catch(()=>null);if(!a.ok||s&&!1===s.success)throw Error((null==s?void 0:s.message)||"HTTP ".concat(a.status));return(null==s?void 0:s.data)!==void 0?s.data:s}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="".concat(n).concat(e),s=Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).map(e=>{let[t,a]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(a))}).join("&");s&&(a+="?".concat(s));let i=await fetch(a,{method:"DELETE",headers:l()}),r=await i.json().catch(()=>null);if(!i.ok||r&&!1===r.success)throw Error((null==r?void 0:r.message)||"HTTP ".concat(i.status));return(null==r?void 0:r.data)!==void 0?r.data:r}},8434:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return l}});var n=a(7437),s=a(2265),i=a(7128);let r=a(257).env.NEXT_PUBLIC_API_URL||"https://espocopi.com/api/mercado";function l(){var e,t,a,l,o;let{token:d}=(0,i.a)(),[u,h]=(0,s.useState)("subscriptions"),[p,m]=(0,s.useState)(!0),[v,x]=(0,s.useState)({subscriptions:[],plans:[],stats:null}),[f,j]=(0,s.useState)({status:"",plan_id:0,page:1}),[b,g]=(0,s.useState)(null),[y,N]=(0,s.useState)(!1),_=(0,s.useCallback)(async()=>{if(d){m(!0);try{let e=new URLSearchParams;e.append("view",u),f.status&&e.append("status",f.status),f.plan_id&&e.append("plan_id",f.plan_id),e.append("page",f.page);let t=await fetch("".concat(r,"/admin/subscriptions.php?").concat(e),{headers:{Authorization:"Bearer ".concat(d)}}),a=await t.json();a.success&&("subscriptions"===u&&x(e=>({...e,subscriptions:a.data.subscriptions,pagination:a.data.pagination})),"plans"===u&&x(e=>({...e,plans:a.data.plans})),"stats"===u&&x(e=>({...e,stats:a.data.stats})))}catch(e){console.error("Erro:",e)}finally{m(!1)}}},[d,u,f]);(0,s.useEffect)(()=>{_()},[_]),(0,s.useEffect)(()=>{d&&0===v.plans.length&&fetch("".concat(r,"/admin/subscriptions.php?view=plans"),{headers:{Authorization:"Bearer ".concat(d)}}).then(e=>e.json()).then(e=>{e.success&&x(t=>({...t,plans:e.data.plans}))})},[d,v.plans.length]);let C=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(confirm("Confirma ".concat(e," esta assinatura?")))try{let n=await fetch("".concat(r,"/admin/subscriptions.php"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(d)},body:JSON.stringify({action:e,subscription_id:t,...a})}),s=await n.json();alert(s.message||(s.success?"Sucesso!":"Erro")),s.success&&_()}catch(e){alert("Erro ao executar acao")}},k=async e=>{try{let t=await fetch("".concat(r,"/admin/subscriptions.php"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(d)},body:JSON.stringify({action:e.id?"update_plan":"create_plan",plan_id:e.id,...e})}),a=await t.json();alert(a.message||(a.success?"Plano salvo!":"Erro")),a.success&&(N(!1),g(null),_())}catch(e){alert("Erro ao salvar plano")}},w=e=>(0,n.jsx)("span",{className:"badge",style:{backgroundColor:{active:"#22c55e",cancelled:"#ef4444",expired:"#6b7280",pending:"#f59e0b"}[e]||"#6b7280"},children:e});return(0,n.jsxs)("div",{className:"page-container",children:[(0,n.jsxs)("div",{className:"page-header",children:[(0,n.jsx)("h1",{children:"SuperBora Club - Assinaturas"}),(0,n.jsxs)("div",{className:"header-actions",children:[(0,n.jsx)("button",{className:"tab-btn ".concat("subscriptions"===u?"active":""),onClick:()=>h("subscriptions"),children:"Assinaturas"}),(0,n.jsx)("button",{className:"tab-btn ".concat("plans"===u?"active":""),onClick:()=>h("plans"),children:"Planos"}),(0,n.jsx)("button",{className:"tab-btn ".concat("stats"===u?"active":""),onClick:()=>h("stats"),children:"Estatisticas"})]})]}),"stats"===u&&v.stats&&(0,n.jsxs)("div",{className:"stats-grid",children:[(0,n.jsxs)("div",{className:"stat-card",children:[(0,n.jsx)("div",{className:"stat-value",children:(null===(e=v.stats.subscriptions)||void 0===e?void 0:e.total)||0}),(0,n.jsx)("div",{className:"stat-label",children:"Total Assinaturas"})]}),(0,n.jsxs)("div",{className:"stat-card success",children:[(0,n.jsx)("div",{className:"stat-value",children:(null===(t=v.stats.subscriptions)||void 0===t?void 0:t.active)||0}),(0,n.jsx)("div",{className:"stat-label",children:"Ativas"})]}),(0,n.jsxs)("div",{className:"stat-card warning",children:[(0,n.jsx)("div",{className:"stat-value",children:(null===(a=v.stats.subscriptions)||void 0===a?void 0:a.cancelled)||0}),(0,n.jsx)("div",{className:"stat-label",children:"Canceladas"})]}),(0,n.jsxs)("div",{className:"stat-card info",children:[(0,n.jsxs)("div",{className:"stat-value",children:["R$ ",parseFloat((null===(l=v.stats.revenue)||void 0===l?void 0:l.total_revenue)||0).toFixed(2)]}),(0,n.jsx)("div",{className:"stat-label",children:"Receita Total"})]}),(0,n.jsxs)("div",{className:"stat-card",children:[(0,n.jsxs)("div",{className:"stat-value",children:["R$ ",parseFloat((null===(o=v.stats.revenue)||void 0===o?void 0:o.month_revenue)||0).toFixed(2)]}),(0,n.jsx)("div",{className:"stat-label",children:"Receita Mes"})]})]}),"plans"===u&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"section-header",children:[(0,n.jsx)("h2",{children:"Planos Disponiveis"}),(0,n.jsx)("button",{className:"btn btn-primary",onClick:()=>{g({}),N(!0)},children:"+ Novo Plano"})]}),(0,n.jsx)("div",{className:"plans-grid",children:v.plans.map(e=>(0,n.jsxs)("div",{className:"plan-card",children:[(0,n.jsxs)("div",{className:"plan-header",children:[(0,n.jsx)("h3",{children:e.name}),(0,n.jsxs)("span",{className:"plan-price",children:["R$ ",parseFloat(e.price).toFixed(2),"/","monthly"===e.billing_cycle?"mes":"ano"]})]}),(0,n.jsxs)("div",{className:"plan-stats",children:[(0,n.jsxs)("span",{children:[e.active_count||0," ativos"]}),(0,n.jsxs)("span",{children:[e.total_count||0," total"]})]}),(0,n.jsxs)("ul",{className:"plan-features",children:[e.free_delivery?(0,n.jsx)("li",{children:"Frete gratis"}):null,e.cashback_percent>0?(0,n.jsxs)("li",{children:[e.cashback_percent,"% cashback"]}):null,e.priority_support?(0,n.jsx)("li",{children:"Suporte prioritario"}):null,e.exclusive_offers?(0,n.jsx)("li",{children:"Ofertas exclusivas"}):null]}),(0,n.jsx)("div",{className:"plan-actions",children:(0,n.jsx)("button",{className:"btn btn-small",onClick:()=>{g(e),N(!0)},children:"Editar"})})]},e.id))})]}),"subscriptions"===u&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"filters-bar",children:[(0,n.jsxs)("select",{value:f.status,onChange:e=>j({...f,status:e.target.value,page:1}),children:[(0,n.jsx)("option",{value:"",children:"Todos Status"}),(0,n.jsx)("option",{value:"active",children:"Ativas"}),(0,n.jsx)("option",{value:"cancelled",children:"Canceladas"}),(0,n.jsx)("option",{value:"expired",children:"Expiradas"})]}),(0,n.jsxs)("select",{value:f.plan_id,onChange:e=>j({...f,plan_id:e.target.value,page:1}),children:[(0,n.jsx)("option",{value:"0",children:"Todos Planos"}),v.plans.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),p?(0,n.jsx)("div",{className:"loading",children:"Carregando..."}):(0,n.jsxs)("table",{className:"data-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"ID"}),(0,n.jsx)("th",{children:"Cliente"}),(0,n.jsx)("th",{children:"Plano"}),(0,n.jsx)("th",{children:"Status"}),(0,n.jsx)("th",{children:"Inicio"}),(0,n.jsx)("th",{children:"Fim"}),(0,n.jsx)("th",{children:"Acoes"})]})}),(0,n.jsx)("tbody",{children:v.subscriptions.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:e.id}),(0,n.jsxs)("td",{children:[(0,n.jsx)("div",{children:e.customer_name}),(0,n.jsx)("small",{children:e.customer_email})]}),(0,n.jsx)("td",{children:e.plan_name}),(0,n.jsx)("td",{children:w(e.status)}),(0,n.jsx)("td",{children:new Date(e.starts_at).toLocaleDateString("pt-BR")}),(0,n.jsx)("td",{children:e.ends_at?new Date(e.ends_at).toLocaleDateString("pt-BR"):"-"}),(0,n.jsx)("td",{children:"active"===e.status&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:"btn btn-small btn-danger",onClick:()=>C("cancel_subscription",e.id),children:"Cancelar"}),(0,n.jsx)("button",{className:"btn btn-small",onClick:()=>{let t=prompt("Quantos dias estender?","30");t&&C("extend_subscription",e.id,{days:parseInt(t)})},children:"Estender"})]})})]},e.id))})]}),v.pagination&&(0,n.jsxs)("div",{className:"pagination",children:[(0,n.jsx)("button",{disabled:1===f.page,onClick:()=>j({...f,page:f.page-1}),children:"Anterior"}),(0,n.jsxs)("span",{children:["Pagina ",f.page," de ",v.pagination.pages]}),(0,n.jsx)("button",{disabled:f.page>=v.pagination.pages,onClick:()=>j({...f,page:f.page+1}),children:"Proxima"})]})]}),y&&(0,n.jsx)(c,{plan:b,onClose:()=>{N(!1),g(null)},onSave:k})]})}function c(e){let{plan:t,onClose:a,onSave:i}=e,r=(()=>{try{return(null==t?void 0:t.features)?JSON.parse(t.features):[]}catch(e){return[]}})(),[l,c]=(0,s.useState)({id:(null==t?void 0:t.id)||0,name:(null==t?void 0:t.name)||"",slug:(null==t?void 0:t.slug)||"",price:(null==t?void 0:t.price)||0,billing_cycle:(null==t?void 0:t.billing_cycle)||"monthly",free_delivery:(null==t?void 0:t.free_delivery)||0,cashback_percent:(null==t?void 0:t.cashback_percent)||0,priority_support:(null==t?void 0:t.priority_support)||0,exclusive_offers:(null==t?void 0:t.exclusive_offers)||0,features:r});return(0,n.jsx)("div",{className:"modal-overlay",onClick:a,children:(0,n.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:"modal-header",children:[(0,n.jsx)("h2",{children:l.id?"Editar Plano":"Novo Plano"}),(0,n.jsx)("button",{className:"modal-close",onClick:a,children:"\xd7"})]}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),i(l)},children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Nome"}),(0,n.jsx)("input",{type:"text",value:l.name,onChange:e=>c({...l,name:e.target.value}),required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Slug"}),(0,n.jsx)("input",{type:"text",value:l.slug,onChange:e=>c({...l,slug:e.target.value}),required:!0})]}),(0,n.jsxs)("div",{className:"form-row",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Preco (R$)"}),(0,n.jsx)("input",{type:"number",step:"0.01",value:l.price,onChange:e=>c({...l,price:e.target.value}),required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Ciclo"}),(0,n.jsxs)("select",{value:l.billing_cycle,onChange:e=>c({...l,billing_cycle:e.target.value}),children:[(0,n.jsx)("option",{value:"monthly",children:"Mensal"}),(0,n.jsx)("option",{value:"yearly",children:"Anual"})]})]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Cashback (%)"}),(0,n.jsx)("input",{type:"number",step:"0.1",value:l.cashback_percent,onChange:e=>c({...l,cashback_percent:e.target.value})})]}),(0,n.jsx)("div",{className:"form-group",children:(0,n.jsxs)("label",{className:"checkbox-label",children:[(0,n.jsx)("input",{type:"checkbox",checked:l.free_delivery,onChange:e=>c({...l,free_delivery:e.target.checked?1:0})}),"Frete Gratis"]})}),(0,n.jsx)("div",{className:"form-group",children:(0,n.jsxs)("label",{className:"checkbox-label",children:[(0,n.jsx)("input",{type:"checkbox",checked:l.priority_support,onChange:e=>c({...l,priority_support:e.target.checked?1:0})}),"Suporte Prioritario"]})}),(0,n.jsx)("div",{className:"form-group",children:(0,n.jsxs)("label",{className:"checkbox-label",children:[(0,n.jsx)("input",{type:"checkbox",checked:l.exclusive_offers,onChange:e=>c({...l,exclusive_offers:e.target.checked?1:0})}),"Ofertas Exclusivas"]})}),(0,n.jsxs)("div",{className:"form-actions",children:[(0,n.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:a,children:"Cancelar"}),(0,n.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Salvar"})]})]})]})})}},7128:function(e,t,a){"use strict";a.d(t,{H:function(){return l},a:function(){return c}});var n=a(7437),s=a(2265),i=a(6428);let r=(0,s.createContext)(null);function l(e){let{children:t}=e,[a,l]=(0,s.useState)(null),[c,o]=(0,s.useState)(!0),d=(0,s.useCallback)(async()=>{if(!(0,i.LP)()){o(!1);return}try{let e=await (0,i.SC)("/auth/session.php");e.admin?l({...e.admin,name:e.admin.nome||e.admin.name,admin_id:e.admin.admin_id||e.admin.id}):((0,i.o4)(null),l(null))}catch(e){(0,i.o4)(null),l(null)}finally{o(!1)}},[]);(0,s.useEffect)(()=>{d()},[d]);let u=async(e,t)=>{let a=await (0,i.sg)("/auth/login.php",{email:e,senha:t});if(a.token)return(0,i.o4)(a.token),l({admin_id:a.admin_id,name:a.nome||a.name,email:a.email,role:a.role}),a;throw Error(a.message||"Erro ao fazer login")};return(0,n.jsx)(r.Provider,{value:{admin:a,loading:c,isAuthenticated:!!a,login:u,logout:()=>{(0,i.o4)(null),l(null)},checkSession:d},children:t})}function c(){let e=(0,s.useContext)(r);if(!e)throw Error("useAuth must be inside AuthProvider");return e}},257:function(e,t,a){"use strict";var n,s;e.exports=(null==(n=a.g.process)?void 0:n.env)&&"object"==typeof(null==(s=a.g.process)?void 0:s.env)?a.g.process:a(4227)},4227:function(e){!function(){var t={229:function(e){var t,a,n,s=e.exports={};function i(){throw Error("setTimeout has not been defined")}function r(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(a){try{return t.call(null,e,0)}catch(a){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{a="function"==typeof clearTimeout?clearTimeout:r}catch(e){a=r}}();var c=[],o=!1,d=-1;function u(){o&&n&&(o=!1,n.length?c=n.concat(c):d=-1,c.length&&h())}function h(){if(!o){var e=l(u);o=!0;for(var t=c.length;t;){for(n=c,c=[];++d<t;)n&&n[d].run();d=-1,t=c.length}n=null,o=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===r||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];c.push(new p(e,t)),1!==c.length||o||l(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},a={};function n(e){var s=a[e];if(void 0!==s)return s.exports;var i=a[e]={exports:{}},r=!0;try{t[e](i,i.exports,n),r=!1}finally{r&&delete a[e]}return i.exports}n.ab="//";var s=n(229);e.exports=s}()}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=6845)}),_N_E=e.O()}]);